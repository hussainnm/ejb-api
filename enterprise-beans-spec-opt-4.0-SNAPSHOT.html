<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="author" content="Jakarta Enterprise Beans Team, https://projects.eclipse.org/projects/ee4j.ejb">
<title>Jakarta Enterprise Beans, Optional Features</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Jakarta Enterprise Beans, Optional Features</h1>
<div class="details">
<span id="author" class="author">Jakarta Enterprise Beans Team, https://projects.eclipse.org/projects/ee4j.ejb</span><br>
<span id="email" class="email"><a href="https://dev.eclipse.org/mailman/listinfo/ejb-api-dev" class="bare">https://dev.eclipse.org/mailman/listinfo/ejb-api-dev</a></span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel2">
<li><a href="#_copyright">Copyright</a></li>
<li><a href="#_eclipse_foundation_specification_license">Eclipse Foundation Specification License</a>
<ul class="sectlevel3">
<li><a href="#_disclaimers">Disclaimers</a></li>
</ul>
</li>
<li><a href="#_introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#_acknowledgements">1.1. Acknowledgements</a></li>
<li><a href="#_organization_of_the_specification_documents">1.2. Organization of the Specification Documents</a></li>
<li><a href="#_document_conventions">1.3. Document Conventions</a></li>
</ul>
</li>
<li><a href="#_overview">2. Overview</a></li>
<li><a href="#_client_view_of_an_entity_bean">3. Client View of an Entity Bean</a>
<ul class="sectlevel2">
<li><a href="#_overview_2">3.1. Overview</a></li>
<li><a href="#_remote_clients">3.2. Remote Clients</a></li>
<li><a href="#_local_clients">3.3. Local Clients</a></li>
<li><a href="#_choosing_between_a_local_or_remote_client_view">3.4. Choosing Between a Local or Remote Client View</a></li>
<li><a href="#_ejb_container">3.5. EJB Container</a></li>
<li><a href="#_locating_an_entity_beans_home_interface">3.6. Locating an Entity Bean’s Home Interface</a></li>
<li><a href="#_what_a_container_provides">3.7. What a Container Provides</a></li>
<li><a href="#_entity_beans_remote_home_interface">3.8. Entity Bean’s Remote Home Interface</a></li>
<li><a href="#_create_methods">3.9. Create Methods</a></li>
<li><a href="#_finder_methods">3.10. Finder Methods</a></li>
<li><a href="#_remove_methods">3.11. Remove Methods</a></li>
<li><a href="#_home_methods">3.12. Home Methods</a></li>
<li><a href="#_entity_beans_local_home_interface">3.13. Entity Bean’s Local Home Interface</a></li>
<li><a href="#_create_methods_2">3.14. Create Methods</a></li>
<li><a href="#_finder_methods_2">3.15. Finder Methods</a></li>
<li><a href="#_remove_methods_2">3.16. Remove Methods</a></li>
<li><a href="#_home_methods_2">3.17. Home Methods</a></li>
<li><a href="#_entity_objects_life_cycle">3.18. Entity Object’s Life Cycle</a></li>
<li><a href="#_references_to_entity_object_remote_interfaces">3.19. References to Entity Object Remote Interfaces</a></li>
<li><a href="#_references_to_entity_object_local_interfaces">3.20. References to Entity Object Local Interfaces</a></li>
<li><a href="#_references_to_entity_object_and_stateful_session_bean_instance_passivation_and_conversational_state">3.21. References to Entity Object and Stateful Session Bean Instance Passivation and Conversational State</a></li>
<li><a href="#_primary_key_and_object_identity">3.22. Primary Key and Object Identity</a></li>
<li><a href="#_entity_beans_remote_interface">3.23. Entity Bean’s Remote Interface</a></li>
<li><a href="#_entity_beans_local_interface">3.24. Entity Bean’s Local Interface</a></li>
<li><a href="#_entity_beans_handle">3.25. Entity Bean’s Handle</a></li>
<li><a href="#_entity_home_handles">3.26. Entity Home Handles</a></li>
<li><a href="#_type_narrowing_of_object_references">3.27. Type Narrowing of Object References</a></li>
</ul>
</li>
<li><a href="#a384">4. EJB 2.1 Entity Bean Component Contract for Container-Managed Persistence</a>
<ul class="sectlevel2">
<li><a href="#_overview_3">4.1. Overview</a></li>
<li><a href="#_container_managed_entity_persistence_and_data_independence">4.2. Container-Managed Entity Persistence and Data Independence</a></li>
<li><a href="#_the_entity_bean_providers_view_of_container_managed_persistence">4.3. The Entity Bean Provider’s View of Container-Managed Persistence</a></li>
<li><a href="#_the_entity_bean_providers_programming_contract">4.4. The Entity Bean Provider’s Programming Contract</a></li>
<li><a href="#_the_entity_bean_providers_view_of_persistent_relationships">4.5. The Entity Bean Provider’s View of Persistent Relationships</a></li>
<li><a href="#_dependent_value_classes">4.6. Dependent Value Classes</a></li>
<li><a href="#_remove_protocols">4.7. Remove Protocols</a></li>
<li><a href="#_remove_methods_3">4.8. Remove Methods</a></li>
<li><a href="#_cascade_delete">4.9. Cascade-delete</a></li>
<li><a href="#_identity_of_entity_objects">4.10. Identity of Entity Objects</a></li>
<li><a href="#_semantics_of_assignment_for_relationships">4.11. Semantics of Assignment for Relationships</a></li>
<li><a href="#_use_of_the_java_util_collection_api_to_update_relationships">4.12. Use of the java.util.Collection API to Update Relationships</a></li>
<li><a href="#_use_of_set_accessor_methods_to_update_relationships">4.13. Use of Set Accessor Methods to Update Relationships</a></li>
<li><a href="#_assignment_rules_for_relationships">4.14. Assignment Rules for Relationships</a></li>
<li><a href="#_one_to_one_bidirectional_relationships">4.15. One-to-one Bidirectional Relationships</a></li>
<li><a href="#_one_to_one_unidirectional_relationships">4.16. One-to-one Unidirectional Relationships</a></li>
<li><a href="#_one_to_many_bidirectional_relationships">4.17. One-to-many Bidirectional Relationships</a></li>
<li><a href="#_one_to_many_unidirectional_relationships">4.18. One-to-many Unidirectional Relationships</a></li>
<li><a href="#_many_to_one_unidirectional_relationships">4.19. Many-to-one Unidirectional Relationships</a></li>
<li><a href="#_many_to_many_bidirectional_relationships">4.20. Many-to-many Bidirectional Relationships</a></li>
<li><a href="#_many_to_many_unidirectional_relationships">4.21. Many-to-many Unidirectional Relationships</a></li>
<li><a href="#_collections_managed_by_the_container">4.22. Collections Managed by the Container</a></li>
<li><a href="#_non_persistent_state">4.23. Non-persistent State</a></li>
<li><a href="#_the_relationship_between_the_internal_view_and_the_client_view">4.24. The Relationship Between the Internal View and the Client View</a></li>
<li><a href="#_restrictions_on_remote_interfaces">4.25. Restrictions on Remote Interfaces</a></li>
<li><a href="#_mapping_data_to_a_persistent_store">4.26. Mapping Data to a Persistent Store</a></li>
<li><a href="#_example">4.27. Example</a></li>
<li><a href="#_the_bean_providers_view_of_the_deployment_descriptor">4.28. The Bean Provider’s View of the Deployment Descriptor</a></li>
<li><a href="#_the_entity_bean_component_contract">4.29. The Entity Bean Component Contract</a></li>
<li><a href="#_runtime_execution_model_of_entity_beans">4.30. Runtime Execution Model of Entity Beans</a></li>
<li><a href="#_container_responsibilities">4.31. Container Responsibilities</a></li>
<li><a href="#_container_managed_fields">4.32. Container-Managed Fields</a></li>
<li><a href="#_container_managed_relationships">4.33. Container-Managed Relationships</a></li>
<li><a href="#_instance_life_cycle_contract_between_the_bean_and_the_container">4.34. Instance Life Cycle Contract Between the Bean and the Container</a></li>
<li><a href="#_instance_life_cycle">4.35. Instance Life Cycle</a></li>
<li><a href="#_bean_providers_entity_bean_instances_view">4.36. Bean Provider’s Entity Bean Instance’s View</a></li>
<li><a href="#_containers_view">4.37. Container’s View</a></li>
<li><a href="#_read_only_entity_beans">4.38. Read-only Entity Beans</a></li>
<li><a href="#_the_entitycontext_interface">4.39. The EntityContext Interface</a></li>
<li><a href="#_operations_allowed_in_the_methods_of_the_entity_bean_class">4.40. Operations Allowed in the Methods of the Entity Bean Class</a></li>
<li><a href="#_finder_methods_3">4.41. Finder Methods</a></li>
<li><a href="#_single_object_finder_methods">4.42. Single-Object Finder Methods</a></li>
<li><a href="#_multi_object_finder_methods">4.43. Multi-Object Finder Methods</a></li>
<li><a href="#_select_methods">4.44. Select Methods</a></li>
<li><a href="#_single_object_select_methods">4.45. Single-Object Select Methods</a></li>
<li><a href="#_multi_object_select_methods">4.46. Multi-Object Select Methods</a></li>
<li><a href="#_timer_notifications">4.47. Timer Notifications</a></li>
<li><a href="#_standard_application_exceptions_for_entities">4.48. Standard Application Exceptions for Entities</a></li>
<li><a href="#_createexception">4.49. CreateException</a></li>
<li><a href="#_duplicatekeyexception">4.50. DuplicateKeyException</a></li>
<li><a href="#_finderexception">4.51. FinderException</a></li>
<li><a href="#_objectnotfoundexception">4.52. ObjectNotFoundException</a></li>
<li><a href="#_removeexception">4.53. RemoveException</a></li>
<li><a href="#_commit_options">4.54. Commit Options</a></li>
<li><a href="#_concurrent_access_from_multiple_transactions">4.55. Concurrent Access from Multiple Transactions</a></li>
<li><a href="#_non_reentrant_and_re_entrant_instances">4.56. Non-reentrant and Re-entrant Instances</a></li>
<li><a href="#_responsibilities_of_the_enterprise_bean_provider">4.57. Responsibilities of the Enterprise Bean Provider</a></li>
<li><a href="#_classes_and_interfaces">4.58. Classes and Interfaces</a></li>
<li><a href="#_enterprise_bean_class">4.59. Enterprise Bean Class</a></li>
<li><a href="#_dependent_value_classes_2">4.60. Dependent Value Classes</a></li>
<li><a href="#_ejbcreatemethod_methods">4.61. ejbCreate&lt;METHOD&gt; Methods</a></li>
<li><a href="#_ejbpostcreatemethod_methods">4.62. ejbPostCreate&lt;METHOD&gt; Methods</a></li>
<li><a href="#_ejbhomemethod_methods">4.63. ejbHome&lt;METHOD&gt; Methods</a></li>
<li><a href="#_ejbselectmethod_methods">4.64. ejbSelect&lt;METHOD&gt; Methods</a></li>
<li><a href="#_business_methods">4.65. Business Methods</a></li>
<li><a href="#_entity_beans_remote_interface_2">4.66. Entity Bean’s Remote Interface</a></li>
<li><a href="#_entity_beans_remote_home_interface_2">4.67. Entity Bean’s Remote Home Interface</a></li>
<li><a href="#_entity_beans_local_interface_2">4.68. Entity Bean’s Local Interface</a></li>
<li><a href="#_entity_beans_local_home_interface_2">4.69. Entity Bean’s Local Home Interface</a></li>
<li><a href="#_entity_beans_primary_key_class">4.70. Entity Bean’s Primary Key Class</a></li>
<li><a href="#_entity_beans_deployment_descriptor">4.71. Entity Bean’s Deployment Descriptor</a></li>
<li><a href="#_the_responsibilities_of_the_container_provider">4.72. The Responsibilities of the Container Provider</a></li>
<li><a href="#_generation_of_implementation_classes">4.73. Generation of Implementation Classes</a></li>
<li><a href="#_enterprise_bean_class_2">4.74. Enterprise Bean Class</a></li>
<li><a href="#_ejbfindmethod_methods">4.75. ejbFind&lt;METHOD&gt; Methods</a></li>
<li><a href="#_ejbselectmethod_methods_2">4.76. ejbSelect&lt;METHOD&gt; Methods</a></li>
<li><a href="#_entity_ejbhome_class">4.77. Entity EJBHome Class</a></li>
<li><a href="#_entity_ejbobject_class">4.78. Entity EJBObject Class</a></li>
<li><a href="#_entity_ejblocalhome_class">4.79. Entity EJBLocalHome Class</a></li>
<li><a href="#_entity_ejblocalobject_class">4.80. Entity EJBLocalObject Class</a></li>
<li><a href="#_handle_class">4.81. Handle Class</a></li>
<li><a href="#_home_handle_class">4.82. Home Handle Class</a></li>
<li><a href="#_metadata_class">4.83. Metadata Class</a></li>
<li><a href="#_instances_re_entrance">4.84. Instance’s Re-entrance</a></li>
<li><a href="#_transaction_scoping_security_exceptions">4.85. Transaction Scoping, Security, Exceptions</a></li>
<li><a href="#_implementation_of_object_references">4.86. Implementation of Object References</a></li>
<li><a href="#_entitycontext">4.87. EntityContext</a></li>
<li><a href="#_primary_keys">4.88. Primary Keys</a></li>
<li><a href="#_primary_key_that_maps_to_a_single_field_in_the_entity_bean_class">4.89. Primary Key That Maps to a Single Field in the Entity Bean Class</a></li>
<li><a href="#_primary_key_that_maps_to_multiple_fields_in_the_entity_bean_class">4.90. Primary Key That Maps to Multiple Fields in the Entity Bean Class</a></li>
<li><a href="#_special_case_unknown_primary_key_class">4.91. Special Case: Unknown Primary Key Class</a></li>
</ul>
</li>
<li><a href="#a1840">5. EJB QL: EJB 2.1 Query Language for Container-Managed Persistence Query Methods</a>
<ul class="sectlevel2">
<li><a href="#_overview_4">5.1. Overview</a></li>
<li><a href="#_ejb_ql_definition">5.2. EJB QL Definition</a></li>
<li><a href="#_abstract_schema_types_and_query_domains">5.3. Abstract Schema Types and Query Domains</a></li>
<li><a href="#_query_methods">5.4. Query Methods</a></li>
<li><a href="#_naming">5.5. Naming</a></li>
<li><a href="#_examples">5.6. Examples</a></li>
<li><a href="#_the_from_clause_and_navigational_declarations">5.7. The FROM Clause and Navigational Declarations</a></li>
<li><a href="#_identifiers">5.8. Identifiers</a></li>
<li><a href="#_identification_variables">5.9. Identification Variables</a></li>
<li><a href="#_range_variable_declarations">5.10. Range Variable Declarations</a></li>
<li><a href="#_collection_member_declarations">5.11. Collection Member Declarations</a></li>
<li><a href="#_example_2">5.12. Example</a></li>
<li><a href="#_path_expressions">5.13. Path Expressions</a></li>
<li><a href="#_where_clause_and_conditional_expressions">5.14. WHERE Clause and Conditional Expressions</a></li>
<li><a href="#_literals">5.15. Literals</a></li>
<li><a href="#_identification_variables_2">5.16. Identification Variables</a></li>
<li><a href="#_path_expressions_2">5.17. Path Expressions</a></li>
<li><a href="#_input_parameters">5.18. Input Parameters</a></li>
<li><a href="#_conditional_expression_composition">5.19. Conditional Expression Composition</a></li>
<li><a href="#_operators_and_operator_precedence">5.20. Operators and Operator Precedence</a></li>
<li><a href="#_between_expressions">5.21. Between <em>Expressions</em></a></li>
<li><a href="#_in_expressions">5.22. In Expressions</a></li>
<li><a href="#_like_expressions">5.23. Like <em>Expressions</em></a></li>
<li><a href="#_null_comparison_expressions">5.24. Null Comparison Expressions</a></li>
<li><a href="#_empty_collection_comparison_expressions">5.25. Empty Collection Comparison Expressions</a></li>
<li><a href="#_collection_member_expressions">5.26. Collection Member Expressions</a></li>
<li><a href="#_functional_expressions">5.27. Functional Expressions</a></li>
<li><a href="#_select_clause">5.28. SELECT Clause</a></li>
<li><a href="#_null_values_in_the_query_result">5.29. Null Values in the Query Result</a></li>
<li><a href="#_aggregate_functions_in_the_select_clause">5.30. Aggregate Functions in the SELECT Clause</a></li>
<li><a href="#_examples_2">5.31. Examples</a></li>
<li><a href="#_order_by_clause">5.32. ORDER BY Clause</a></li>
<li><a href="#_return_value_types">5.33. Return Value Types</a></li>
<li><a href="#_null_values">5.34. Null Values</a></li>
<li><a href="#_equality_and_comparison_semantics">5.35. Equality and Comparison Semantics</a></li>
<li><a href="#_restrictions">5.36. Restrictions</a></li>
<li><a href="#_examples_3">5.37. Examples</a></li>
<li><a href="#_simple_queries">5.38. Simple Queries</a></li>
<li><a href="#_queries_with_relationships">5.39. Queries with Relationships</a></li>
<li><a href="#_queries_using_input_parameters">5.40. Queries Using Input Parameters</a></li>
<li><a href="#_queries_for_select_methods">5.41. Queries for Select Methods</a></li>
<li><a href="#_ejb_ql_and_sql">5.42. EJB QL and SQL</a></li>
<li><a href="#_ejb_ql_bnf">5.43. EJB QL BNF</a></li>
</ul>
</li>
<li><a href="#a2456">6. EJB 2.1 Entity Bean Component Contract for Bean-Managed Persistence</a>
<ul class="sectlevel2">
<li><a href="#_overview_of_bean_managed_entity_persistence">6.1. Overview of Bean-Managed Entity Persistence</a></li>
<li><a href="#_entity_bean_providers_view_of_persistence">6.2. Entity Bean Provider’s View of Persistence</a></li>
<li><a href="#_runtime_execution_model">6.3. Runtime Execution Model</a></li>
<li><a href="#_instance_life_cycle_2">6.4. Instance Life Cycle</a></li>
<li><a href="#_the_entity_bean_component_contract_2">6.5. The Entity Bean Component Contract</a></li>
<li><a href="#_entity_bean_instances_view">6.6. Entity Bean Instance’s View</a></li>
<li><a href="#_containers_view_2">6.7. Container’s View</a></li>
<li><a href="#_read_only_entity_beans_2">6.8. Read-only Entity Beans</a></li>
<li><a href="#_the_entitycontext_interface_2">6.9. The EntityContext Interface</a></li>
<li><a href="#_operations_allowed_in_the_methods_of_the_entity_bean_class_2">6.10. Operations Allowed in the Methods of the Entity Bean Class</a></li>
<li><a href="#_caching_of_entity_state_and_the_ejbload_and_ejbstore_methods">6.11. Caching of Entity State and the ejbLoad and ejbStore Methods</a></li>
<li><a href="#_ejbload_and_ejbstore_with_the_notsupported_transaction_attribute">6.12. ejbLoad and ejbStore with the NotSupported Transaction Attribute</a></li>
<li><a href="#_finder_method_return_type">6.13. Finder Method Return Type</a></li>
<li><a href="#_single_object_finder">6.14. Single-Object Finder</a></li>
<li><a href="#_multi_object_finders">6.15. Multi-Object Finders</a></li>
<li><a href="#_timer_notifications_2">6.16. Timer Notifications</a></li>
<li><a href="#_standard_application_exceptions_for_entities_2">6.17. Standard Application Exceptions for Entities</a></li>
<li><a href="#_createexception_2">6.18. CreateException</a></li>
<li><a href="#_duplicatekeyexception_2">6.19. DuplicateKeyException</a></li>
<li><a href="#_finderexception_2">6.20. FinderException</a></li>
<li><a href="#_objectnotfoundexception_2">6.21. ObjectNotFoundException</a></li>
<li><a href="#_removeexception_2">6.22. RemoveException</a></li>
<li><a href="#_commit_options_2">6.23. Commit Options</a></li>
<li><a href="#_concurrent_access_from_multiple_transactions_2">6.24. Concurrent Access from Multiple Transactions</a></li>
<li><a href="#_non_reentrant_and_re_entrant_instances_2">6.25. Non-reentrant and Re-entrant Instances</a></li>
<li><a href="#_responsibilities_of_the_enterprise_bean_provider_2">6.26. Responsibilities of the Enterprise Bean Provider</a></li>
<li><a href="#_classes_and_interfaces_2">6.27. Classes and Interfaces</a></li>
<li><a href="#_enterprise_bean_class_3">6.28. Enterprise Bean Class</a></li>
<li><a href="#_ejbcreatemethod_methods_2">6.29. ejbCreate&lt;METHOD&gt; Methods</a></li>
<li><a href="#_ejbpostcreatemethod_methods_2">6.30. ejbPostCreate&lt;METHOD&gt; Methods</a></li>
<li><a href="#_ejbfind_methods">6.31. ejbFind Methods</a></li>
<li><a href="#_ejbhomemethod_methods_2">6.32. ejbHome&lt;METHOD&gt; Methods</a></li>
<li><a href="#_business_methods_2">6.33. Business Methods</a></li>
<li><a href="#_entity_beans_remote_interface_3">6.34. Entity Bean’s Remote Interface</a></li>
<li><a href="#_entity_beans_remote_home_interface_3">6.35. Entity Bean’s Remote Home Interface</a></li>
<li><a href="#_entity_beans_local_interface_3">6.36. Entity Bean’s Local Interface</a></li>
<li><a href="#_entity_beans_local_home_interface_3">6.37. Entity Bean’s Local Home Interface</a></li>
<li><a href="#_entity_beans_primary_key_class_2">6.38. Entity Bean’s Primary Key Class</a></li>
<li><a href="#_the_responsibilities_of_the_container_provider_2">6.39. The Responsibilities of the Container Provider</a></li>
<li><a href="#_generation_of_implementation_classes_2">6.40. Generation of Implementation Classes</a></li>
<li><a href="#_entity_ejbhome_class_2">6.41. Entity EJBHome Class</a></li>
<li><a href="#_entity_ejbobject_class_2">6.42. Entity EJBObject Class</a></li>
<li><a href="#_entity_ejblocalhome_class_2">6.43. Entity EJBLocalHome Class</a></li>
<li><a href="#_entity_ejblocalobject_class_2">6.44. Entity EJBLocalObject Class</a></li>
<li><a href="#_handle_class_2">6.45. Handle Class</a></li>
<li><a href="#_home_handle_class_2">6.46. Home Handle Class</a></li>
<li><a href="#_metadata_class_2">6.47. Metadata Class</a></li>
<li><a href="#_instances_re_entrance_2">6.48. Instance’s Re-entrance</a></li>
<li><a href="#_transaction_scoping_security_exceptions_2">6.49. Transaction Scoping, Security, Exceptions</a></li>
<li><a href="#_implementation_of_object_references_2">6.50. Implementation of Object References</a></li>
<li><a href="#_entitycontext_2">6.51. EntityContext</a></li>
</ul>
</li>
<li><a href="#_ejb_1_1_entity_bean_component_contract_for_container_managed_persistence">7. EJB 1.1 Entity Bean Component Contract for Container-Managed Persistence</a>
<ul class="sectlevel2">
<li><a href="#_ejb_1_1_entity_beans_with_container_managed_persistence">7.1. EJB 1.1 Entity Beans with Container-Managed Persistence</a></li>
<li><a href="#_container_managed_fields_2">7.2. Container-Managed Fields</a></li>
<li><a href="#_ejbcreate_ejbpostcreate">7.3. ejbCreate, ejbPostCreate</a></li>
<li><a href="#_ejbremove">7.4. ejbRemove</a></li>
<li><a href="#_ejbload">7.5. ejbLoad</a></li>
<li><a href="#_ejbstore">7.6. ejbStore</a></li>
<li><a href="#_finder_hethods">7.7. Finder Hethods</a></li>
<li><a href="#_home_methods_3">7.8. Home Methods</a></li>
<li><a href="#_create_methods_3">7.9. Create Methods</a></li>
<li><a href="#_primary_key_type">7.10. Primary Key Type</a></li>
<li><a href="#_primary_key_that_maps_to_a_single_field_in_the_entity_bean_class_2">7.11. Primary Key that Maps to a Single Field in the Entity Bean Class</a></li>
<li><a href="#_primary_key_that_maps_to_multiple_fields_in_the_entity_bean_class_2">7.12. Primary Key that Maps to Multiple Fields in the Entity Bean Class</a></li>
<li><a href="#_special_case_unknown_primary_key_class_2">7.13. Special Case: Unknown Primary Key Class</a></li>
</ul>
</li>
<li><a href="#a3139">8. Support for JAX-RPC Web Service Endpoints</a>
<ul class="sectlevel2">
<li><a href="#_jax_rpc_web_service_client_view">8.1. JAX-RPC Web Service Client View</a></li>
<li><a href="#_the_responsibilities_of_the_bean_provider">8.2. The Responsibilities of the Bean Provider</a></li>
<li><a href="#_session_beans_jax_rpc_service_endpoint_interface">8.3. Session Bean’s JAX-RPC Service Endpoint Interface</a></li>
<li><a href="#_messagecontext_interface">8.4. MessageContext Interface</a></li>
<li><a href="#_the_responsibilities_of_the_container_provider_3">8.5. The Responsibilities of the Container Provider</a></li>
<li><a href="#_generation_of_wsdl">8.6. Generation of WSDL</a></li>
<li><a href="#_jax_rpc_message_handlers_for_web_service_endpoints">8.7. JAX-RPC Message Handlers for Web Service Endpoints</a></li>
<li><a href="#_the_sessioncontext_interface_restrictions">8.8. The SessionContext Interface Restrictions</a></li>
</ul>
</li>
<li><a href="#a3185">9. Support for Transactions</a>
<ul class="sectlevel2">
<li><a href="#_overview_5">9.1. Overview</a></li>
<li><a href="#_bean_providers_responsibilities">9.2. Bean Provider’s Responsibilities</a></li>
<li><a href="#_bean_managed_versus_container_managed_transaction_demarcation">9.3. Bean-Managed Versus Container-Managed Transaction Demarcation</a></li>
<li><a href="#_isolation_levels">9.4. Isolation Levels</a></li>
<li><a href="#_specification_of_the_transaction_attributes_for_a_beans_methods">9.5. Specification of the Transaction Attributes for a Bean’s Methods</a></li>
<li><a href="#_container_provider_responsibilities">9.6. Container Provider Responsibilities</a></li>
<li><a href="#_container_managed_transaction_demarcation_for_entity_beans">9.7. Container-Managed Transaction Demarcation for Entity Beans</a></li>
</ul>
</li>
<li><a href="#a3210">10. Exception Handling</a>
<ul class="sectlevel2">
<li><a href="#_application_exceptions">10.1. Application Exceptions</a></li>
<li><a href="#_bean_providers_responsibilities_2">10.2. Bean Provider’s Responsibilities</a></li>
<li><a href="#_application_exceptions_2">10.3. Application Exceptions</a></li>
<li><a href="#_system_exceptions">10.4. System Exceptions</a></li>
<li><a href="#_javax_ejb_nosuchentityexception">10.5. javax.ejb.NoSuchEntityException</a></li>
<li><a href="#_container_provider_responsibilities_2">10.6. Container Provider Responsibilities</a></li>
<li><a href="#_exceptions_from_method_invoked_via_entity_beans_client_view">10.7. Exceptions from Method Invoked via Entity Bean’s Client View</a></li>
<li><a href="#_exceptions_from_other_container_invoked_callbacks">10.8. Exceptions from Other Container-invoked Callbacks</a></li>
<li><a href="#_javax_ejb_nosuchentityexception_2">10.9. javax.ejb.NoSuchEntityException</a></li>
<li><a href="#_non_existing_entity_object">10.10. Non-existing Entity Object</a></li>
<li><a href="#_support_for_deprecated_use_of_java_rmi_remoteexception">10.11. Support for Deprecated Use of java.rmi.RemoteException</a></li>
<li><a href="#_clients_view_of_exceptions">10.12. Client’s View of Exceptions</a></li>
</ul>
</li>
<li><a href="#a3253">11. Support for Distributed Interoperability</a>
<ul class="sectlevel2">
<li><a href="#_mapping_objects_returned_by_entity_bean_finder_methods_to_idl">11.1. Mapping Objects Returned by Entity Bean Finder Methods to IDL</a></li>
</ul>
</li>
<li><a href="#a3258">12. Timer Service</a>
<ul class="sectlevel2">
<li><a href="#_bean_providers_view_of_the_timer_service">12.1. Bean Provider’s View of the Timer Service</a></li>
<li><a href="#_calendar_based_time_expressions">12.2. Calendar-Based Time Expressions</a></li>
<li><a href="#_non_persistent_timers">12.3. Non-persistent Timers</a></li>
<li><a href="#_the_timerservice_interface">12.4. The TimerService Interface</a></li>
<li><a href="#_timer_expiration_and_timeout_callback_method">12.5. Timer Expiration and Timeout Callback Method</a></li>
<li><a href="#_entity_bean_removal">12.6. Entity Bean Removal</a></li>
</ul>
</li>
<li><a href="#a3273">13. Deployment Descriptor</a>
<ul class="sectlevel2">
<li><a href="#_bean_providers_responsibilities_3">13.1. Bean Provider’s Responsibilities</a></li>
<li><a href="#_application_assemblers_responsibility">13.2. Application Assembler’s Responsibility</a></li>
</ul>
</li>
<li><a href="#_packaging_restrictions">14. Packaging Restrictions</a>
<ul class="sectlevel2">
<li><a href="#_restrictions_2">14.1. Restrictions</a></li>
</ul>
</li>
<li><a href="#_related_documents">15. Related Documents</a></li>
<li><a href="#_revision_history">16. Revision History</a>
<ul class="sectlevel2">
<li><a href="#_early_draft">16.1. Early Draft</a></li>
<li><a href="#_early_draft_2">16.2. Early Draft 2</a></li>
<li><a href="#_public_draft">16.3. Public Draft</a></li>
<li><a href="#_proposed_final_draft">16.4. Proposed Final Draft</a></li>
<li><a href="#_final_release_candidate">16.5. Final Release Candidate</a></li>
<li><a href="#_final_release">16.6. Final Release</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre>Specification: Jakarta Enterprise Beans, Optional Features

Version: {revnumber}

Status: {revremark}

Release: {revdate}</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_copyright"><a class="anchor" href="#_copyright"></a>Copyright</h3>
<div class="paragraph">
<p>Copyright (c) 2019 Eclipse Foundation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_eclipse_foundation_specification_license"><a class="anchor" href="#_eclipse_foundation_specification_license"></a>Eclipse Foundation Specification License</h3>
<div class="paragraph">
<p>By using and/or copying this document, or the Eclipse Foundation
document from which this statement is linked, you (the licensee) agree
that you have read, understood, and will comply with the following
terms and conditions:</p>
</div>
<div class="paragraph">
<p>Permission to copy, and distribute the contents of this document, or
the Eclipse Foundation document from which this statement is linked, in
any medium for any purpose and without fee or royalty is hereby
granted, provided that you include the following on ALL copies of the
document, or portions thereof, that you use:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>link or URL to the original Eclipse Foundation document.</p>
</li>
<li>
<p>All existing copyright notices, or if one does not exist, a notice
(hypertext is preferred, but a textual representation is permitted)
of the form: "Copyright (c) [$date-of-document]
Eclipse Foundation, Inc. <a href="#url to this license">[url to this license]</a>"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Inclusion of the full text of this NOTICE must be provided. We
request that authorship attribution be provided in any software,
documents, or other items or products that you create pursuant to the
implementation of the contents of this document, or any portion
thereof.</p>
</div>
<div class="paragraph">
<p>No right to create modifications or derivatives of Eclipse Foundation
documents is granted pursuant to this license, except anyone may
prepare and distribute derivative works and portions of this document
in software that implements the specification, in supporting materials
accompanying such software, and in documentation of such software,
PROVIDED that all such works include the notice below. HOWEVER, the
publication of derivative works of this document for use as a technical
specification is expressly prohibited.</p>
</div>
<div class="paragraph">
<p>The notice is:</p>
</div>
<div class="paragraph">
<p>"Copyright (c) 2018 Eclipse Foundation. This software or
document includes material copied from or derived from [title and URI
of the Eclipse Foundation specification document]."</p>
</div>
<div class="sect3">
<h4 id="_disclaimers"><a class="anchor" href="#_disclaimers"></a>Disclaimers</h4>
<div class="paragraph">
<p>THIS DOCUMENT IS PROVIDED &quot;AS IS,&quot; AND THE COPYRIGHT
HOLDERS AND THE ECLIPSE FOUNDATION MAKE NO REPRESENTATIONS OR
WARRANTIES, EXPRESS OR IMPLIED, INCLUDING, BUT NOT LIMITED TO,
WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE,
NON-INFRINGEMENT, OR TITLE; THAT THE CONTENTS OF THE DOCUMENT ARE
SUITABLE FOR ANY PURPOSE; NOR THAT THE IMPLEMENTATION OF SUCH CONTENTS
WILL NOT INFRINGE ANY THIRD PARTY PATENTS, COPYRIGHTS, TRADEMARKS OR
OTHER RIGHTS.</p>
</div>
<div class="paragraph">
<p>THE COPYRIGHT HOLDERS AND THE ECLIPSE FOUNDATION WILL NOT BE LIABLE
FOR ANY DIRECT, INDIRECT, SPECIAL OR CONSEQUENTIAL DAMAGES ARISING OUT
OF ANY USE OF THE DOCUMENT OR THE PERFORMANCE OR IMPLEMENTATION OF THE
CONTENTS THEREOF.</p>
</div>
<div class="paragraph">
<p>The name and trademarks of the copyright holders or the Eclipse
Foundation may NOT be used in advertising or publicity pertaining to
this document or its contents without specific, written prior
permission. Title to copyright in this document will at all times
remain with copyright holders.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This document describes features for which
support has been made optional as of the 3.2 release of the Enterprise
JavaBeans <em>TM</em> specification:</p>
</div>
<div class="literalblock">
<div class="content">
<pre> _EJB 2.1 Entity Bean Component Contract for
Container-Managed Persistence_</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> _EJB 2.1 Entity Bean Component Contract for
Bean-Managed Persistence_</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> _EJB 1.1 Entity Bean Component Contract for
Container-Managed Persistence_</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>_Client View of an Entity Bean_</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> _EJB QL: Query Language for
Container-Managed Persistence Query Methods_</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>_JAX-RPC Based Web Service Endpoints_</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>_JAX-RPC Web Service Client View._</pre>
</div>
</div>
<div class="sect2">
<h3 id="_acknowledgements"><a class="anchor" href="#_acknowledgements"></a>1.1. Acknowledgements</h3>
<div class="paragraph">
<p>The EJB 3.2 specification work is being
conducted as part of JSR-345 under the Java Community Process Program.
This specification is the result of the collaborative work of the
members of the EJB 3.2 Expert Group: Caucho Technology, Inc: Reza
Rahman; IBM: Jeremy Bauer; Oracle: Marina Vatkina, Linda DeMichiel; OW2:
Florent Benoit; Pramati Technologies: Ravikiran Noothi; RedHat: Pete
Muir, Carlo de Wolf; TmaxSoft, Inc.: Miju Byon; individual members: Adam
Bien; David Blevins; Antonio Goncalves; Stefan Heldt; Richard Hightower,
Jean-Louis Monteiro.</p>
</div>
</div>
<div class="sect2">
<h3 id="_organization_of_the_specification_documents"><a class="anchor" href="#_organization_of_the_specification_documents"></a>1.2. Organization of the Specification Documents</h3>
<div class="paragraph">
<p>This specification is organized into the
following documents:</p>
</div>
<div class="paragraph">
<p>EJB Core Contracts and Requirements</p>
</div>
<div class="paragraph">
<p>EJB Optional Features</p>
</div>
<div class="paragraph">
<p>The EJB Core Contracts and Requirements
document defines the contracts and requirements for the use and
implementation of Enterprise JavaBeans. These contracts include those
for the EJB 3.2 API, as well as for the earlier EJB API that is required
to be supported in this release.</p>
</div>
<div class="paragraph">
<p>This EJB Optional Features document defines
the contracts and requirements for the use and implementation of
features support for which has been made optional for the Enterprise
JavaBeans. These contracts are separated from the core contracts
requirements in the EJB 3.1 specification
<a href="Ejb.html#a3323">See Enterprise JavaBeans™</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_document_conventions"><a class="anchor" href="#_document_conventions"></a>1.3. Document Conventions</h3>
<div class="paragraph">
<p>The regular Times font is used for
information that is prescriptive by the EJB specification.</p>
</div>
<div class="paragraph">
<p>The italic Times font is used for paragraphs
that contain descriptive information, such as notes describing typical
use, or notes clarifying the text with prescriptive specification.</p>
</div>
<div class="paragraph">
<p>The Courier font is used for code examples.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview"><a class="anchor" href="#_overview"></a>2. Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This document describes features for which
support has been made optional as of the 3.2 release of the Enterprise
JavaBeans <em>TM</em> specification:</p>
</div>
<div class="literalblock">
<div class="content">
<pre> _EJB 2.1 Entity Bean Component Contract for
Container-Managed Persistence_</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> _EJB 2.1 Entity Bean Component Contract for
Bean-Managed Persistence_</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> _EJB 1.1 Entity Bean Component Contract for
Container-Managed Persistence_</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>_Client View of an Entity Bean_</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> _EJB QL: Query Language for
Container-Managed Persistence Query Methods_</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>_JAX-RPC Based Web Service Endpoints_</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>_JAX-RPC Web Service Client View._</pre>
</div>
</div>
<div class="paragraph">
<p>If an implementation supports such features,
it must do so in accordance with the requirements of this specification.
In addition, the following rules apply:</p>
</div>
<div class="paragraph">
<p>If any of the following features is
supported, all features in the list must be supported:</p>
</div>
<div class="paragraph">
<p>EJB 2.x entity beans with container-managed
persistence</p>
</div>
<div class="paragraph">
<p>EJB 1.1 entity beans with container-managed
persistence</p>
</div>
<div class="paragraph">
<p>EJB 2.x entity beans with bean-managed
persistence</p>
</div>
<div class="paragraph">
<p>EJB QL</p>
</div>
<div class="paragraph">
<p>If JAX-RPC web service endpoints are
supported, the JAX-RPC web service endpoint client view must be
supported.</p>
</div>
<div class="paragraph">
<p>See the general description of the EJB goals
and requirements in the EJB Core Contracts and Requirements
<a href="Ejb.html#a3339">See EJB 3.2 Core Contracts and Requirements.</a> document.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_client_view_of_an_entity_bean"><a class="anchor" href="#_client_view_of_an_entity_bean"></a>3. Client View of an Entity Bean</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes the client view of an
entity bean. It is actually a contract fulfilled by the container in
which the entity bean is deployed. Only the business methods are
supplied by the enterprise bean itself.</p>
</div>
<div class="paragraph">
<p>Although the client view of the deployed
entity beans is provided by classes implemented by the container, the
container itself is transparent to the client.</p>
</div>
<div class="sect2">
<h3 id="_overview_2"><a class="anchor" href="#_overview_2"></a>3.1. Overview</h3>
<div class="paragraph">
<p>For a client, an
entity bean is a component that represents an object-oriented view of
some entities stored in a persistent storage, such as a database, or
entities that are implemented by an existing enterprise application.</p>
</div>
<div class="paragraph">
<p>The client of an
entity bean may be a local client or the
client may be a remote client.</p>
</div>
<div class="paragraph">
<p>This section provides an overview of the
entity bean client view that is independent of whether the client is a
remote client or a local client. The differences between remote clients
and local clients are discussed in the following sections.</p>
</div>
<div class="paragraph">
<p>From its creation until its destruction, an
entity object lives in a container. Transparently to the client, the
container provides security, concurrency, transactions, persistence, and
other services for the entity objects that live in the container. The
container is transparent to the client—there is no API that a client can
use to manipulate the container.</p>
</div>
<div class="paragraph">
<p>Multiple clients can access an entity object
concurrently. The container in which the entity bean is deployed
properly synchronizes access to the entity object’s state using
transactions.</p>
</div>
<div class="paragraph">
<p>Each entity
object has an identity which, in general, survives a crash and restart
of the container in which the entity object has been created. The object
identity is implemented by the container with the cooperation of the
enterprise bean class.</p>
</div>
<div class="paragraph">
<p>Multiple enterprise beans can be deployed in
a container. For each entity bean deployed in a container, the container
provides a class that implements a home interface for the entity bean.
This interface allows the client to create, find, and remove entity
objects within the enterprise bean’s home as well as to execute home
business methods, which are not specific to a particular entity bean
object. A client can obtain the entity bean’s home interface through
dependency injection, or the client can look up the
entity bean’s home interface through JNDI.
It is the responsibility of the container to make the entity bean’s home
interface available in the JNDI name space.</p>
</div>
<div class="paragraph">
<p>A client view of an entity bean is
independent of the implementation of the entity bean and its container.
This ensures that a client application is portable across all container
implementations in which the entity bean might be deployed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_remote_clients"><a class="anchor" href="#_remote_clients"></a>3.2. Remote Clients</h3>
<div class="paragraph">
<p>A remote client
accesses an entity bean through the entity bean’s remote and remote home
interfaces. The remote and remote home interfaces of the entity bean
provide the remote client view.</p>
</div>
<div class="paragraph">
<p>The remote client view of an entity bean is
location independent. A client running in the same JVM as an entity bean
instance uses the same API to access the entity bean as a client running
in a different JVM on the same or different machine.</p>
</div>
<div class="paragraph">
<p>The container provides classes that implement
the entity bean’s remote and remote home interfaces. The objects that
implement the remote home and remote objects are remote Java objects,
and are accessible from a client through the standard Java™ APIs for
remote object invocation [<a href="Ejb.html#a3327">See Java Remote</a>].</p>
</div>
<div class="paragraph">
<p>A remote client of an entity object can be
another enterprise bean deployed in the same or different container or
can be an arbitrary Java program, such as an application, applet, or
servlet. The remote client view of an entity bean can also be mapped to
non-Java client environments, such as CORBA clients not written in the
Java programming language.</p>
</div>
</div>
<div class="sect2">
<h3 id="_local_clients"><a class="anchor" href="#_local_clients"></a>3.3. Local Clients</h3>
<div class="paragraph">
<p>Entity beans may
also have local clients. A local client is a client that is collocated
with the entity bean and which may be tightly coupled to the bean.</p>
</div>
<div class="paragraph">
<p>Unlike the remote client view, the
local client view of an entity bean is not
location independent. The local client view requires the collocation in
the same JVM of both the local client and the entity bean that provides
the local client view. The local client view therefore does not provide
the location transparency provided by the remote client view.</p>
</div>
<div class="paragraph">
<p>A local client accesses an entity bean
through the entity bean’s local home and local component interfaces. The
container provides classes that implement the entity bean’s local home
and local component interfaces. The objects that implement the local
home and local component interfaces are local Java objects.</p>
</div>
<div class="paragraph">
<p>The arguments of the methods of the
local component interface and
local home interface are passed by
reference<a href="#a3365">1</a>. Such entity beans and their clients
must be coded to assume that the state of any Java object that is passed
as an argument or result is potentially shared by caller and callee.</p>
</div>
<div class="paragraph">
<p>A local client of an entity bean may be a
session bean, a message-driven bean, another entity bean, or a web-tier
component.</p>
</div>
<div class="paragraph">
<p>The choice between the use of a local or
remote programming model is a design decision that the Bean Provider
makes when developing the entity bean application. In general, however,
entity beans are intended to be used with local clients. While it is
possible to provide both a client view and a local client view for an
entity bean with container-managed persistence, it is more likely that
the entity bean will be designed with the local view in mind.</p>
</div>
<div class="paragraph">
<p>Entity beans that have
container-managed relationships with other
entity beans, as described in <a href="Ejb.html#a384">See EJB 2.1
Entity Bean Component Contract for Container-Managed Persistence</a>, must
be accessed in the same local scope as those related beans, and
therefore typically provide a local client view. In order to be the
target of a container-managed relationship, an entity bean with
container-managed persistence must provide a local component interface.</p>
</div>
</div>
<div class="sect2">
<h3 id="_choosing_between_a_local_or_remote_client_view"><a class="anchor" href="#_choosing_between_a_local_or_remote_client_view"></a>3.4. Choosing Between a Local or Remote Client View</h3>
<div class="paragraph">
<p>The following considerations should be taken
into account in determining whether a local or
remote access should be used for an entity
bean:</p>
</div>
<div class="paragraph">
<p>When the EJB 2.1 and earlier remote home and
remote component interfaces are used, the narrowing of remote types
requires the use of javax.rmi.PortableRemoteObject.narrow rather than
Java language casts.</p>
</div>
<div class="paragraph">
<p>Remote calls may involve error cases due to
communication, resource usage on other servers, etc., which are not
expected in local calls. When the EJB 2.1 and earlier remote home and
remote component interfaces are used, the client has to explicitly
program handlers for handling the <em>java.rmi.RemoteException</em></p>
</div>
<div class="paragraph">
<p>Methods of a session bean’s remote business
interface must not expose entity beans local interface types, or the
managed collection classes that are used for EJB 2.1 entity beans with
container-managed persistence as arguments or results.</p>
</div>
<div class="paragraph">
<p>See EJB Core Contracts and Requirements
document <a href="Ejb.html#a3339">See EJB 3.2 Core Contracts and</a> Subsection “Choosing
Between a Local or Remote Client View” for the more considerations.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ejb_container"><a class="anchor" href="#_ejb_container"></a>3.5. EJB Container</h3>
<div class="paragraph">
<p>An EJB container (container for short) is a
system that functions as a runtime container for enterprise beans.</p>
</div>
<div class="paragraph">
<p>Multiple
enterprise beans can be deployed in a single container. For each entity
bean deployed in a container, the container provides a home interface
that allows the client to create, find, and remove entity objects that
belong to the entity bean. The home interface may also provide home
business methods, which are not specific to a particular entity bean
object. The container makes the entity bean’s home interface (defined by
the Bean Provider and implemented by the Container Provider) available
in the JNDI name space for clients.</p>
</div>
<div class="paragraph">
<p>An EJB server may host one or multiple EJB
containers. The containers are transparent to the client: there is no
client-level API to manipulate the container.</p>
</div>
</div>
<div class="sect2">
<h3 id="_locating_an_entity_beans_home_interface"><a class="anchor" href="#_locating_an_entity_beans_home_interface"></a>3.6. Locating an Entity Bean’s Home Interface</h3>
<div class="paragraph">
<p>A client obtains
an entity bean’s home interface through dependency injection, or the
client locates an entity bean’s home interface using
JNDI. A client’s JNDI name space may be
configured to include the home interfaces of enterprise beans deployed
in multiple EJB containers located on multiple machines on a network.
The actual location of an EJB container is, in general, transparent to
the client.</p>
</div>
<div class="paragraph">
<p>For example, the local home interface for the
<em>Account</em> entity bean can be located using the following code segment:</p>
</div>
<div class="paragraph">
<p>Context initialContext = new
InitialContext();</p>
</div>
<div class="paragraph">
<p>AccountHome accountHome = (AccountHome)</p>
</div>
<div class="paragraph">
<p>initialContext.lookup(“java:comp/env/ejb/accounts”);</p>
</div>
<div class="paragraph">
<p>If dependency injection were used, the home
interface could be obtained as follows:</p>
</div>
<div class="paragraph">
<p>@EJB AccountHome accountHome;</p>
</div>
</div>
<div class="sect2">
<h3 id="_what_a_container_provides"><a class="anchor" href="#_what_a_container_provides"></a>3.7. What a Container Provides</h3>
<div class="paragraph">
<p>The following diagram illustrates the view
that a container provides to the client of the entity beans deployed in
the container. Note that a client may be a local client of some entity
beans and a remote client of others.</p>
</div>
<div class="paragraph">
<p>===</p>
</div>
<div class="paragraph">
<p>Client View of Entity Beans Deployed in a Container</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-6.png" alt="image"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="_entity_beans_remote_home_interface"><a class="anchor" href="#_entity_beans_remote_home_interface"></a>3.8. Entity Bean’s Remote Home Interface</h3>
<div class="paragraph">
<p>This section is specific to entity beans that
provide a remote client view. Local home
interfaces are described in <a href="Ejb.html#a179">See Entity
Bean’s Local Home Interface</a>.</p>
</div>
<div class="paragraph">
<p>The container provides the implementation of
the remote home interface for each entity bean deployed in the container
that defines a remote home interface. An object that implements an
entity bean’s remote home interface is called an <em>EJBHome object.</em></p>
</div>
<div class="paragraph">
<p>The entity bean’s
remote home interface allows a client to do the following:</p>
</div>
<div class="paragraph">
<p>Create new entity objects within the home.</p>
</div>
<div class="paragraph">
<p>Find existing entity objects within the home.</p>
</div>
<div class="paragraph">
<p>Remove an entity object from the home.</p>
</div>
<div class="paragraph">
<p>Execute a home business method.</p>
</div>
<div class="paragraph">
<p>Get the <em>javax.ejb.EJBMetaData</em> interface for
the entity bean. The <em>javax.ejb.EJBMetaData</em> interface is intended to
allow application assembly tools to discover the metadata information
about the entity bean. The metadata information allows loose
client/server binding and scripting.</p>
</div>
<div class="paragraph">
<p>Obtain a handle for the home interface. The
home handle can be serialized and written to
stable storage. Later, possibly in a different JVM, the
handle can be deserialized from stable
storage and used to obtain a reference to the home interface.</p>
</div>
<div class="paragraph">
<p>An entity bean’s remote home interface must
extend the javax.ejb.EJBHome interface and follow the standard rules for
Java programming language remote interfaces.</p>
</div>
</div>
<div class="sect2">
<h3 id="_create_methods"><a class="anchor" href="#_create_methods"></a>3.9. Create Methods</h3>
<div class="paragraph">
<p>An entity bean’s remote home interface can
define zero or more create&lt;METHOD&gt; methods,
one for each way to create an entity object. The arguments of the create
methods are typically used to initialize the state of the created entity
object. The name of each create method starts with the prefix “ <em>create</em>
”.</p>
</div>
<div class="paragraph">
<p>The return type
of a create <em>&lt;METHOD&gt;</em> method on the remote home interface is the entity
bean’s remote interface.</p>
</div>
<div class="paragraph">
<p>The <em>throws</em> clause of every create
<em>&lt;METHOD&gt;</em> method on the remote home interface includes the
java.rmi.RemoteException and the javax.ejb.CreateException. It may
include additional application-level exceptions.</p>
</div>
<div class="paragraph">
<p>The following home interface illustrates
three possible create methods:</p>
</div>
<div class="paragraph">
<p>public interface AccountHome extends
javax.ejb.EJBHome \{</p>
</div>
<div class="literalblock">
<div class="content">
<pre> public Account create(String firstName,
String lastName,</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>double initialBalance)</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>throws RemoteException, CreateException;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public Account create(String accountNumber,</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>double initialBalance)</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>throws RemoteException, CreateException,</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>LowInitialBalanceException;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> public Account createLargeAccount(String
firstname,</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>String lastname, double initialBalance)</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>throws RemoteException, CreateException;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="paragraph">
<p>The following example illustrates how a
client creates a new entity object:</p>
</div>
<div class="paragraph">
<p>AccountHome accountHome = &#8230;&#8203;;</p>
</div>
<div class="paragraph">
<p>Account account = accountHome.create(“John”,
“Smith”, 500.00);</p>
</div>
</div>
<div class="sect2">
<h3 id="_finder_methods"><a class="anchor" href="#_finder_methods"></a>3.10. Finder Methods</h3>
<div class="paragraph">
<p>An entity bean’s
remote home interface defines one or more finder
methods<a href="#a3366">2</a>, one for each way to find an entity object
or collection of entity objects within the home. The name of each finder
method starts with the prefix “ <em>find</em> ”, such as <em>findLargeAccounts</em> .
The arguments of a finder method are used by the entity bean
implementation to locate the requested entity objects. The return type
of a finder method on the remote home interface must be the entity
bean’s remote interface, or a type representing a collection of objects
that implement the entity bean’s remote interface (see Subsections
<a href="Ejb.html#a1446">See Finder Methods</a> and
<a href="Ejb.html#a2729">See Finder Method Return Type</a>).</p>
</div>
<div class="paragraph">
<p>The <em>throws</em> clause of every finder method on
the remote home interface includes the java.rmi.RemoteException and the
javax.ejb.FinderException exceptions.</p>
</div>
<div class="paragraph">
<p>The remote home
interface includes the findByPrimaryKey(primaryKey) method, which allows
a client to locate an entity object using a primary key. The name of the
method is always findByPrimaryKey; it has a single argument that is the
same type as the entity bean’s primary key type, and its return type is
the entity bean’s remote interface. There is a unique
findByPrimaryKey(primaryKey) method for an entity bean on its remote
home interface; this method must not be overloaded. The implementation
of the findByPrimaryKey(primaryKey) method must ensure that the entity
object exists.</p>
</div>
<div class="paragraph">
<p>The following example shows the
findByPrimaryKey method:</p>
</div>
<div class="paragraph">
<p>public interface AccountHome extends
javax.ejb.EJBHome \{</p>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> public Account findByPrimaryKey(String
AccountNumber)</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>throws RemoteException, FinderException;</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="paragraph">
<p>The following example illustrates how a
client uses the findByPrimaryKey method:</p>
</div>
<div class="paragraph">
<p>AccountHome = &#8230;&#8203;;</p>
</div>
<div class="paragraph">
<p>Account account =
accountHome.findByPrimaryKey(“100-3450-3333”);</p>
</div>
</div>
<div class="sect2">
<h3 id="_remove_methods"><a class="anchor" href="#_remove_methods"></a>3.11. Remove Methods</h3>
<div class="paragraph">
<p>The
javax.ejb.EJBHome interface defines several methods that allow the
client to remove an entity object.</p>
</div>
<div class="paragraph">
<p>public interface EJBHome extends Remote \{</p>
</div>
<div class="literalblock">
<div class="content">
<pre> void remove(Handle handle) throws
RemoteException,</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>RemoveException;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> void remove(Object primaryKey) throws
RemoteException,</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>RemoveException;</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="paragraph">
<p>After an entity object has been removed,
subsequent attempts to access the entity object by a remote client
result in the java.rmi.NoSuchObjectException.</p>
</div>
</div>
<div class="sect2">
<h3 id="_home_methods"><a class="anchor" href="#_home_methods"></a>3.12. Home Methods</h3>
<div class="paragraph">
<p>An entity bean’s
remote home interface may define one or more
home methods. Home methods are methods that
the Bean Provider supplies for business logic that is not specific to an
entity bean instance.</p>
</div>
<div class="paragraph">
<p>Home methods on the remote home interface can
have arbitrary method names, but they must not start with “ <em>create</em> ”,
“ <em>find</em> ”, or “ <em>remove</em> ”.The arguments of a home method are used by
the entity bean implementation in computations that do not depend on a
specific entity bean instance. The method arguments and return value
types of a home method on the remote home interface must be legal types
for RMI-IIOP.</p>
</div>
<div class="paragraph">
<p>The <em>throws</em> clause of every home method on
the remote home interface includes the java.rmi.RemoteException. It may
also include additional application-level exceptions.</p>
</div>
<div class="paragraph">
<p>The following example shows two home methods:</p>
</div>
<div class="paragraph">
<p>public interface EmployeeHome extends
javax.ejb.EJBHome \{</p>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> // this method returns a living index
depending on</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> // the state and the base salary of an
employee:</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// the method is not specific to an instance</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> public float livingIndex(String state, float
Salary)</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>throws RemoteException;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> // this method adds a bonus to all of the
employees</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// based on a company profit-sharing index</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> public void addBonus(float
company_share_index)</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> throws RemoteException,
ShareIndexOutOfRangeException;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
</div>
<div class="sect2">
<h3 id="_entity_beans_local_home_interface"><a class="anchor" href="#_entity_beans_local_home_interface"></a>3.13. <a id="a179"></a>Entity Bean’s Local Home Interface</h3>
<div class="paragraph">
<p>The container provides the implementation of
the local home interface for each entity bean deployed in the container
that defines a local home interface. An object that implements an entity
bean’s local home interface is called an <em>EJBLocalHome object.</em></p>
</div>
<div class="paragraph">
<p>The entity bean’s
local home interface allows a local client to do the following:</p>
</div>
<div class="paragraph">
<p>Create new entity objects within the home.</p>
</div>
<div class="paragraph">
<p>Find existing entity objects within the home.</p>
</div>
<div class="paragraph">
<p>Remove an entity object from the home.</p>
</div>
<div class="paragraph">
<p>Execute a home business method.</p>
</div>
<div class="paragraph">
<p>An entity bean’s local home interface must
extend the javax.ejb.EJBLocalHome interface.</p>
</div>
</div>
<div class="sect2">
<h3 id="_create_methods_2"><a class="anchor" href="#_create_methods_2"></a>3.14. Create Methods</h3>
<div class="paragraph">
<p>An entity bean’s local home interface can
define zero or more create&lt;METHOD&gt; methods, one for each way to create
an entity object. The arguments of the create methods are typically used
to initialize the state of the created entity object. The name of each
create method starts with the prefix “ <em>create</em> ”.</p>
</div>
<div class="paragraph">
<p>The return type
of a create <em>&lt;METHOD&gt;</em> method on the local home interface is the entity
bean’s local interface.</p>
</div>
<div class="paragraph">
<p>The <em>throws</em> clause of every create
<em>&lt;METHOD&gt;</em> method on the local home interface includes the
javax.ejb.CreateException. It may include additional application-level
exceptions. It must not include the java.rmi.RemoteException.</p>
</div>
<div class="paragraph">
<p>The following local home interface
illustrates three possible create methods:</p>
</div>
<div class="paragraph">
<p>public interface AccountHome extends
javax.ejb.EJBLocalHome \{</p>
</div>
<div class="literalblock">
<div class="content">
<pre> public Account create(String firstName,
String lastName,</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>double initialBalance)</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>throws CreateException;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public Account create(String accountNumber,</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>double initialBalance)</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> throws CreateException,
LowInitialBalanceException;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> public Account createLargeAccount(String
firstname,</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>String lastname, double initialBalance)</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>throws CreateException;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="paragraph">
<p>The following example illustrates how a
client creates a new entity object:</p>
</div>
<div class="paragraph">
<p>AccountHome accountHome = &#8230;&#8203;;</p>
</div>
<div class="paragraph">
<p>Account account = accountHome.create(“John”,
“Smith”, 500.00);</p>
</div>
</div>
<div class="sect2">
<h3 id="_finder_methods_2"><a class="anchor" href="#_finder_methods_2"></a>3.15. Finder Methods</h3>
<div class="paragraph">
<p>An entity bean’s
local home interface defines one or more finder
methods<a href="#a3367">3</a>, one for each way to find an entity object
or collection of entity objects within the home. The name of each finder
method starts with the prefix “ <em>find</em> ”, such as <em>findLargeAccounts</em> .
The arguments of a finder method are used by the entity bean
implementation to locate the requested entity objects. The return type
of a finder method on the local home interface must be the entity bean’s
local interface, or a type representing a collection of objects that
implement the entity bean’s local interface (see Subsections
<a href="Ejb.html#a1446">See Finder Methods</a> and
<a href="Ejb.html#a2729">See Finder Method Return Type</a>).</p>
</div>
<div class="paragraph">
<p>The <em>throws</em> clause of every finder method on
the local home interface includes the javax.ejb.FinderException. The
<em>throws</em> clause must not include the java.rmi.RemoteException.</p>
</div>
<div class="paragraph">
<p>The local home
interface includes the findByPrimaryKey(primaryKey) method, which allows
a client to locate an entity object using a primary key. The name of the
method is always findByPrimaryKey; it has a single argument that is the
same type as the entity bean’s primary key type, and its return type is
the entity bean’s local interface. There is a unique
findByPrimaryKey(primaryKey) method for an entity bean on its local home
interface; this method must not be overloaded. The implementation of the
findByPrimaryKey method must ensure that the entity object exists.</p>
</div>
<div class="paragraph">
<p>The following example shows the
findByPrimaryKey method:</p>
</div>
<div class="paragraph">
<p>public interface AccountHome extends
javax.ejb.EJBLocalHome \{</p>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> public Account findByPrimaryKey(String
AccountNumber)</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>throws FinderException;</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="paragraph">
<p>The following example illustrates how a
client uses the findByPrimaryKey method:</p>
</div>
<div class="paragraph">
<p>AccountHome = &#8230;&#8203;;</p>
</div>
<div class="paragraph">
<p>Account account =
accountHome.findByPrimaryKey(“100-3450-3333”);</p>
</div>
</div>
<div class="sect2">
<h3 id="_remove_methods_2"><a class="anchor" href="#_remove_methods_2"></a>3.16. Remove Methods</h3>
<div class="paragraph">
<p>The
javax.ejb.EJBLocalHome interface defines the <em>remove</em> method to allow
the client to remove an entity object.</p>
</div>
<div class="paragraph">
<p>public interface EJBLocalHome \{</p>
</div>
<div class="literalblock">
<div class="content">
<pre> void remove(Object primaryKey) throws
RemoveException,</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>EJBException;</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="paragraph">
<p>After an entity object has been removed,
subsequent attempts to access the local entity object by the local
client result in the javax.ejb.NoSuchObjectLocalException.</p>
</div>
</div>
<div class="sect2">
<h3 id="_home_methods_2"><a class="anchor" href="#_home_methods_2"></a>3.17. Home Methods</h3>
<div class="paragraph">
<p>An entity bean’s
local home interface may define one or more
home methods. Home methods are methods that
the Bean Provider supplies for business logic that is not specific to an
entity bean instance.</p>
</div>
<div class="paragraph">
<p>Home methods can have arbitrary method names,
but they must not start with “ <em>create</em> ”, “ <em>find</em> ”, or “ <em>remove</em>
”.The arguments of a home method are used by the entity bean
implementation in computations that do not depend on a specific entity
bean instance.</p>
</div>
<div class="paragraph">
<p>The <em>throws</em> clause of a home method on the
local home interface may include additional application-level
exceptions. It must not include the java.rmi.RemoteException.</p>
</div>
<div class="paragraph">
<p>The following example shows two home methods:</p>
</div>
<div class="paragraph">
<p>public interface EmployeeHome extends
javax.ejb.EJBLocalHome \{</p>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> // this method returns a living index
depending on</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> // the state and the base salary of an
employee:</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// the method is not specific to an instance</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> public float livingIndex(String state, float
Salary);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> // this method adds a bonus to all of the
employees</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// based on a company profit sharing index</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> public void addBonus(float
company_share_index)</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>throws ShareIndexOutOfRangeException;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
</div>
<div class="sect2">
<h3 id="_entity_objects_life_cycle"><a class="anchor" href="#_entity_objects_life_cycle"></a>3.18. Entity Object’s Life Cycle</h3>
<div class="paragraph">
<p>This section describes the life cycle of an
entity object from the perspective of a client.</p>
</div>
<div class="paragraph">
<p>The following
diagram illustrates a client’s point of view of an entity object life
cycle. (The term “referenced” in the diagram means that the client
program has a reference to the entity object’s remote or local
interface.)</p>
</div>
<div class="paragraph">
<p>===</p>
</div>
<div class="paragraph">
<p>Client View of Entity Object Life Cycle</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-7.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>An entity object does not exist until it is
created. Until it is created, it has no identity. After it is created,
it has identity. A client creates an entity object using the entity
bean’s home interface, whose class is implemented by the container. When
a client creates an entity object, the client obtains a reference to the
newly created entity object.</p>
</div>
<div class="paragraph">
<p>In an environment with
legacy data, entity objects may “exist”
before the container and entity bean are deployed. In addition, an
entity object may be “created” in the environment via a mechanism other
than by invoking a create&lt;METHOD&gt; method of the home interface (e.g. by
inserting a database record), but still may be accessible via the finder
methods. Also, an entity object may be deleted directly using other
means than the remove operation (e.g. by deletion of a database record).
The “direct insert” and “direct delete” transitions in the diagram
represent such direct database manipulation.</p>
</div>
<div class="paragraph">
<p>All entity objects are considered
persistent objects. The lifetime of an
entity object is not limited by the lifetime of the Java Virtual Machine
process in which the entity bean instance executes. While a crash of the
Java Virtual Machine may result in a rollback of current transactions,
it does not destroy previously created entity objects nor invalidate the
references to the home and component interfaces held by clients.</p>
</div>
<div class="paragraph">
<p>Multiple clients
can access the same entity object concurrently. Transactions are used to
isolate the clients’ work from each other.</p>
</div>
</div>
<div class="sect2">
<h3 id="_references_to_entity_object_remote_interfaces"><a class="anchor" href="#_references_to_entity_object_remote_interfaces"></a>3.19. References to Entity Object Remote Interfaces</h3>
<div class="paragraph">
<p>A client can get a reference to an existing
entity object’s remote interface in any of
the following ways:</p>
</div>
<div class="paragraph">
<p>Receive the reference as a parameter in a
method call (input parameter or result).</p>
</div>
<div class="paragraph">
<p>Find the entity object using a finder method
defined in the entity bean’s remote home interface.</p>
</div>
<div class="paragraph">
<p>Obtain the reference from the entity object’s
handle. (See Section <a href="Ejb.html#a349">See Entity Bean’s
Handle</a>).</p>
</div>
<div class="paragraph">
<p>A client that has a reference to an entity
object’s remote interface can do any of the following:</p>
</div>
<div class="paragraph">
<p>Invoke business methods on the entity object
through the remote interface.</p>
</div>
<div class="paragraph">
<p>Obtain a reference to the enterprise bean’s
remote home interface.</p>
</div>
<div class="paragraph">
<p>Pass the reference as a parameter or return
value of a method call.</p>
</div>
<div class="paragraph">
<p>Obtain the entity object’s primary key.</p>
</div>
<div class="paragraph">
<p>Obtain the entity object’s handle.</p>
</div>
<div class="paragraph">
<p>Remove the entity object.</p>
</div>
<div class="paragraph">
<p>All references to an entity object that does
not exist are invalid. All attempted invocations on an entity object
that does not exist result in an java.rmi.NoSuchObjectException being
thrown.</p>
</div>
</div>
<div class="sect2">
<h3 id="_references_to_entity_object_local_interfaces"><a class="anchor" href="#_references_to_entity_object_local_interfaces"></a>3.20. References to Entity Object Local Interfaces</h3>
<div class="paragraph">
<p>A local client can get a reference to an
existing entity object’s local interface in
any of the following ways:</p>
</div>
<div class="paragraph">
<p>Receive the reference as a result of a method
call.</p>
</div>
<div class="paragraph">
<p>Find the entity object using a finder method
defined in the entity bean’s local home interface.</p>
</div>
<div class="paragraph">
<p>A local client that has a reference to an
entity object’s local interface can do any of the following:</p>
</div>
<div class="paragraph">
<p>Invoke business methods on the entity object
through the local interface.</p>
</div>
<div class="paragraph">
<p>Obtain a reference to the enterprise bean’s
local home interface.</p>
</div>
<div class="paragraph">
<p>Pass the reference as a parameter or return
value of a local method call.</p>
</div>
<div class="paragraph">
<p>Obtain the entity object’s primary key.</p>
</div>
<div class="paragraph">
<p>Remove the entity object.</p>
</div>
<div class="paragraph">
<p>All local references to an entity object that
does not exist are invalid. All attempted invocations on an entity
object that does not exist result in a
javax.ejb.NoSuchObjectLocalException being thrown.</p>
</div>
<div class="paragraph">
<p>A local interface type must not be passed as
an argument or result of a remote interface method.</p>
</div>
</div>
<div class="sect2">
<h3 id="_references_to_entity_object_and_stateful_session_bean_instance_passivation_and_conversational_state"><a class="anchor" href="#_references_to_entity_object_and_stateful_session_bean_instance_passivation_and_conversational_state"></a>3.21. References to Entity Object and Stateful Session Bean Instance Passivation and Conversational State</h3>
<div class="paragraph">
<p>If an entity bean is
referenced from a stateful session bean, the
Bean Provider is required to ensure that the <em>PrePassivate</em> method
leaves the instance fields ready to be serialized by the container. In
addition to the rules described in EJB Core Contracts and Requirements
document <a href="Ejb.html#a3339">See EJB 3.2 Core Contracts and</a> Subsection “Instance
Passivation and Conversational State”, for the entity bean references,
the objects that are assigned to the instance’s non- <em>transient</em> fields
after the session bean <em>PrePassivate</em> method completes can also be one
of the following:</p>
</div>
<div class="paragraph">
<p>A reference to an entity bean’s local
component interface, even if it is not serializable.</p>
</div>
<div class="paragraph">
<p>A reference to an entity bean’s local home
interface, even if it is not serializable.</p>
</div>
</div>
<div class="sect2">
<h3 id="_primary_key_and_object_identity"><a class="anchor" href="#_primary_key_and_object_identity"></a>3.22. Primary Key and Object Identity</h3>
<div class="paragraph">
<p>Every entity
object has a unique identity within its home. If two entity objects have
the same home and the same primary key, they are considered identical.</p>
</div>
<div class="paragraph">
<p>The Enterprise
JavaBeans architecture allows a primary key class to be any class that
is a legal Value Type in RMI-IIOP, subject to the restrictions defined
in Subsections <a href="Ejb.html#a1725">See Entity Bean’s Primary Key
Class</a> and <a href="Ejb.html#a3011">See Entity Bean’s Primary Key
Class</a>. The primary key class may be specific to an entity bean class
(i.e., each entity bean class may define a different class for its
primary key, but it is possible that multiple entity beans use the same
primary key class).</p>
</div>
<div class="paragraph">
<p>A client that
holds a reference to an entity object’s component interface can
determine the entity object’s identity within its home by invoking the
getPrimaryKey method on the reference.</p>
</div>
<div class="paragraph">
<p>The object
identity associated with a reference does not change over the lifetime
of the reference. (That is, getPrimaryKey always returns the same value
when called on the same entity object reference). If an entity object
has both a remote home interface and a local home interface, the result
of invoking the getPrimaryKey method on a reference to the entity
object’s remote interface and on a reference to the entity object’s
local interface is the same.</p>
</div>
<div class="paragraph">
<p>A client can test whether two entity object
references refer to the same entity object by using the <em>isIdentical</em>
 method. Alternatively, if a client obtains
two entity object references from the same home, it can determine if
they refer to the same entity by comparing their primary keys using the
equals method.</p>
</div>
<div class="paragraph">
<p>The following code illustrates using the
isIdentical method to test if two object references refer to the same
entity object:</p>
</div>
<div class="paragraph">
<p>Account acc1 = &#8230;&#8203;;</p>
</div>
<div class="paragraph">
<p>Account acc2 = &#8230;&#8203;;</p>
</div>
<div class="paragraph">
<p>if (acc1.isIdentical(acc2)) \{</p>
</div>
<div class="literalblock">
<div class="content">
<pre>// acc1 and acc2 are the same entity object</pre>
</div>
</div>
<div class="paragraph">
<p>} else \{</p>
</div>
<div class="literalblock">
<div class="content">
<pre> // acc2 and acc2 are different entity
objects</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="paragraph">
<p>A client that knows the primary key of an
entity object can obtain a reference to the entity object by invoking
the findByPrimaryKey(key) method on the entity bean’s home interface.</p>
</div>
<div class="paragraph">
<p>Note that the Enterprise JavaBeans
architecture does not specify “object equality” (i.e. use of the ==
operator) for entity object references. The result of comparing two
object references using the Java programming language
Object.equals(Object obj) method is unspecified. Performing the
Object.hashCode() method on two object references that represent the
entity object is not guaranteed to yield the same result. Therefore, a
client should always use the isIdentical method to determine if two
entity object references refer to the same entity object.</p>
</div>
<div class="paragraph">
<p>Note that the use of <em>isIdentical</em> for the
comparison of object references applies to the implementation of the
methods of the <em>java.util.Collection</em> API as well.</p>
</div>
</div>
<div class="sect2">
<h3 id="_entity_beans_remote_interface"><a class="anchor" href="#_entity_beans_remote_interface"></a>3.23. Entity Bean’s Remote Interface</h3>
<div class="paragraph">
<p>A client can
access an entity object through the entity bean’s remote interface. An
entity bean’s remote interface must extend the javax.ejb.EJBObject
interface. A remote interface defines the business methods that are
callable by remote clients.</p>
</div>
<div class="paragraph">
<p>The following example illustrates the
definition of an entity bean’s remote interface:</p>
</div>
<div class="paragraph">
<p>public interface Account extends
javax.ejb.EJBObject \{</p>
</div>
<div class="literalblock">
<div class="content">
<pre>void debit(double amount)</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>throws java.rmi.RemoteException,</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>InsufficientBalanceException;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>void credit(double amount)</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>throws java.rmi.RemoteException;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>double getBalance()</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>throws java.rmi.RemoteException;</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="paragraph">
<p>The javax.ejb.EJBObject interface defines the
methods that allow the client to perform the following operations on an
entity object’s reference:</p>
</div>
<div class="paragraph">
<p>Obtain the remote home interface for the
entity object.</p>
</div>
<div class="paragraph">
<p>Remove the entity object.</p>
</div>
<div class="paragraph">
<p>Obtain the entity object’s handle.</p>
</div>
<div class="paragraph">
<p>Obtain the entity object’s primary key.</p>
</div>
<div class="paragraph">
<p>The container provides the implementation of
the methods defined in the javax.ejb.EJBObject interface. Only the
business methods are delegated to the instances of the enterprise bean
class.</p>
</div>
<div class="paragraph">
<p>Note that the entity object does not expose
the methods of the javax.ejb.EnterpriseBean interface to the client.
These methods are not intended for the client—they are used by the
container to manage the enterprise bean instances.</p>
</div>
</div>
<div class="sect2">
<h3 id="_entity_beans_local_interface"><a class="anchor" href="#_entity_beans_local_interface"></a>3.24. Entity Bean’s Local Interface</h3>
<div class="paragraph">
<p>A local client
can access an entity object through the entity bean’s local interface.
An entity bean’s local interface must extend the
javax.ejb.EJBLocalObject interface. A local interface defines the
business methods that are callable by local clients.</p>
</div>
<div class="paragraph">
<p>The following example illustrates the
definition of an entity bean’s local interface:</p>
</div>
<div class="paragraph">
<p>public interface Account extends
javax.ejb.EJBLocalObject \{</p>
</div>
<div class="literalblock">
<div class="content">
<pre>void debit(double amount)</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>throws InsufficientBalanceException;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>void credit(double amount);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>double getBalance();</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="literalblock">
<div class="content">
<pre> _Note that the methods of the entity bean’s
local interface must not throw the java.rmi.RemoteException._</pre>
</div>
</div>
<div class="paragraph">
<p>The
javax.ejb.EJBLocalObject interface defines
the methods that allow the local client to
perform the following operations on an
entity object’s local reference:</p>
</div>
<div class="paragraph">
<p>Obtain the local home interface for the
entity object.</p>
</div>
<div class="paragraph">
<p>Remove the entity object.</p>
</div>
<div class="paragraph">
<p>Obtain the entity object’s primary key.</p>
</div>
<div class="paragraph">
<p>The container provides the implementation of
the methods defined in the javax.ejb.EJBLocalObject interface. Only the
business methods are delegated to the instances of the enterprise bean
class.</p>
</div>
<div class="paragraph">
<p>Note that the entity object does not expose
the methods of the javax.ejb.EntityBean or the optional
<em>javax.ejb.TimedObject</em> interface to the local client. These methods are
not intended for the local client—they are used by the container to
manage the enterprise bean instances.</p>
</div>
</div>
<div class="sect2">
<h3 id="_entity_beans_handle"><a class="anchor" href="#_entity_beans_handle"></a>3.25. <a id="a349"></a>Entity Bean’s Handle</h3>
<div class="paragraph">
<p>An entity
object’s handle is an object that identifies the entity object on a
network. A client that has a reference to an entity object’s remote
interface can obtain the entity object’s handle by invoking the
getHandle method on the remote interface. The <em>getHandle</em> method is only
available on the remote interface.</p>
</div>
<div class="paragraph">
<p>Since a handle
class extends java.io.Serializable, a client may serialize the handle.
The client may use the serialized handle later, possibly in a different
process or even system, to re-obtain a reference to the entity object
identified by the handle.</p>
</div>
<div class="paragraph">
<p>The client code must use the
javax.rmi.PortableRemoteObject.narrow method to convert the result of
the getEJBObject method invoked on a handle to the entity bean’s remote
interface type.</p>
</div>
<div class="paragraph">
<p>The lifetime and scope of a handle is
specific to the handle implementation. At the minimum, a program running
in one JVM must be able to obtain and serialize the handle, and another
program running in a different JVM must be able to deserialize it and
re-create an object reference. An entity handle is typically implemented
to be usable over a long period of time—it must be usable at least
across a server restart.</p>
</div>
<div class="paragraph">
<p>Containers that store long-lived entities
will typically provide handle implementations that allow clients to
store a handle for a long time (possibly many years). Such a handle will
be usable even if parts of the technology used by the container (e.g.
ORB, DBMS, server) have been upgraded or replaced while the client has
stored the handle. Support for this “quality of service” is not required
by the EJB specification.</p>
</div>
<div class="paragraph">
<p>An EJB container is not required to accept a
handle that was generated by another vendor’s EJB container.</p>
</div>
<div class="paragraph">
<p>The use of a handle is illustrated by the
following example:</p>
</div>
<div class="paragraph">
<p>entity object and</p>
</div>
<div class="paragraph">
<p>ObjectOutputStream stream = &#8230;&#8203;;</p>
</div>
<div class="paragraph">
<p>Account account = &#8230;&#8203;;</p>
</div>
<div class="paragraph">
<p>Handle handle = account.getHandle();</p>
</div>
<div class="paragraph">
<p>stream.writeObject(handle);</p>
</div>
<div class="paragraph">
<p>storage, and use the</p>
</div>
<div class="paragraph">
<p>the</p>
</div>
<div class="paragraph">
<p>ObjectInputStream stream = &#8230;&#8203;;</p>
</div>
<div class="paragraph">
<p>Handle handle = (Handle)
stream.readObject(handle);</p>
</div>
<div class="paragraph">
<p>Account account =
(Account)javax.rmi.PortableRemoteObject.narrow(</p>
</div>
<div class="literalblock">
<div class="content">
<pre>handle.getEJBObject(), Account.class);</pre>
</div>
</div>
<div class="paragraph">
<p>account.debit(100.00);</p>
</div>
<div class="paragraph">
<p>A handle is not a capability, in the security
sense, that would automatically grant its holder the right to invoke
methods on the object. When a reference to an object is obtained from a
handle, and then a method on the object is invoked, the container
performs the usual access checks based on the caller’s principal.</p>
</div>
</div>
<div class="sect2">
<h3 id="_entity_home_handles"><a class="anchor" href="#_entity_home_handles"></a>3.26. Entity Home Handles</h3>
<div class="paragraph">
<p>The EJB
specification allows a client to obtain a handle for the remote home
interface. The client can use the home handle to store a reference to an
entity bean’s remote home interface in stable storage, and re-create the
reference later. This handle functionality may be useful to a client
that needs to use the remote home interface in the future, but does not
know the JNDI name of the remote home interface.</p>
</div>
<div class="paragraph">
<p>A handle to a remote home interface must
implement the javax.ejb.HomeHandle interface.</p>
</div>
<div class="paragraph">
<p>The client code must use the
javax.rmi.PortableRemoteObject.narrow method to convert the result of
the getEJBHome method invoked on a handle to the home interface type.</p>
</div>
<div class="paragraph">
<p>The lifetime and scope of a handle is
specific to the handle implementation. At a minimum, a program running
in one JVM must be able to serialize the handle, and another program
running in a different JVM must be able to deserialize it and re-create
an object reference. An entity handle is typically implemented to be
usable over a long period of time—it must be usable at least across a
server restart.</p>
</div>
</div>
<div class="sect2">
<h3 id="_type_narrowing_of_object_references"><a class="anchor" href="#_type_narrowing_of_object_references"></a>3.27. Type Narrowing of Object References</h3>
<div class="paragraph">
<p>A client program
that is intended to be interoperable with all compliant EJB container
implementations must use the javax.rmi.PortableRemoteObject.narrow
method to perform type-narrowing of the client-side representations of
the remote home and remote interfaces.</p>
</div>
<div class="paragraph">
<p>Note: Programs that use the
cast operator to narrow the remote and
remote home interfaces are likely to fail if the container
implementation uses RMI-IIOP as the underlying communication transport.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a384"><a class="anchor" href="#a384"></a>4. EJB 2.1 Entity Bean Component Contract for Container-Managed Persistence</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The EJB 2.1 entity bean component contract
for container-managed persistence is the contract between an entity bean
and its container. It defines the life cycle of the entity bean
instances, the model for method delegation of the business methods
invoked by the client, and the model for the management of the entity
bean’s persistent state and relationships. The main goal of this
contract is to ensure that an entity bean component using
container-managed persistence is portable across all compliant EJB
containers.</p>
</div>
<div class="paragraph">
<p>This chapter defines the Enterprise Bean
Provider’s view of this contract and responsibilities of the Container
Provider for managing the life cycle of the enterprise bean instances
and their persistent state and relationships.</p>
</div>
<div class="paragraph">
<p>Note that use of dependency injection,
interceptors, and Java language metadata annotations is not supported
for EJB 2.1 entity beans.</p>
</div>
<div class="sect2">
<h3 id="_overview_3"><a class="anchor" href="#_overview_3"></a>4.1. Overview</h3>
<div class="paragraph">
<p>In accordance
with the architecture for container-managed persistence, the Bean
Provider develops a set of entity beans for an application, and
determines the relationships among them. The Bean Provider designs an
abstract persistence schema for each entity bean, which defines its
container-managed fields and relationships,
and determines the methods for accessing them. The entity bean instance
accesses its container-managed fields and
relationships at runtime by means of the methods defined for its
abstract persistence schema.</p>
</div>
<div class="paragraph">
<p>The abstract
persistence schema is specified in the deployment descriptor that is
produced by the Bean Provider. The Deployer, using the Container
Provider’s tools, determines how the persistent fields and relationships
defined by the abstract persistence schema are mapped to a database or
other persistent store, and generates the necessary additional classes
and interfaces that enable the container to manage the persistent fields
and relationships of the entity bean instances at runtime.</p>
</div>
<div class="paragraph">
<p>This chapter
describes the component contract for an EJB 2.1 entity bean with
container-managed persistence, and how data independence is maintained
between the entity bean instance and its representation in the
persistent store. It describes this contract from the viewpoints of both
the Bean Provider and the container.</p>
</div>
</div>
<div class="sect2">
<h3 id="_container_managed_entity_persistence_and_data_independence"><a class="anchor" href="#_container_managed_entity_persistence_and_data_independence"></a>4.2. Container-Managed Entity Persistence and Data Independence</h3>
<div class="paragraph">
<p>The EJB component
model provides a separation between the client view of a bean (as
presented by its home and component interfaces) and the entity bean
class (which provides the implementation of the client view). The EJB
architecture for container-managed persistence adds to this a separation
between the entity bean class (as defined by the Bean Provider) and its
persistent representation. The container-managed persistence
architecture thus provides not only a layer of data independence between
the client view of a bean as an <em>entity object</em> and the Bean Provider’s
internal view of the bean in terms of the entity bean instance, but also
between the entity bean instance and its persistent representation. This
allows an entity bean to be evolved independently from its clients,
without requiring the redefinition or recompilation of those clients,
and it allows an entity bean to be redeployed across different
containers and different persistent data stores, without requiring the
redefinition or recompilation of the entity bean class.</p>
</div>
<div class="paragraph">
<p>In container-managed persistence, unlike in
bean-managed persistence, the Bean Provider does not write database
access calls in the methods of the entity bean class. Instead,
persistence is handled by the container at runtime. The entity Bean
Provider must specify in the deployment descriptor those persistent
fields and relationships for which the container must handle data
access. The Bean Provider codes all
persistent data access by using the accessor methods that are defined
for the abstract persistence schema. The implementation of the
persistent fields and relationships, as well as all data access, is
deferred to the container.</p>
</div>
<div class="paragraph">
<p>It is the
responsibility of the Deployer to map the abstract persistence schema of
a set of interrelated entity bean classes into the physical schema used
by the underlying data store (e.g., into a relational schema) by using
the Container Provider’s tools. The Deployer uses the deployment
descriptor as input to the Container Provider’s tools to perform this
mapping. The Container Provider’s tools are also used to generate the
concrete implementation of the entity bean classes, including the code
that delegates calls to the accessor methods of the entity bean class to
the runtime persistent data access layer of the container.</p>
</div>
<div class="paragraph">
<p>The EJB
deployment descriptor for EJB 2.1 entity beans describes <em>logical</em>
relationships among entity beans. It does not provide a mechanism for
specifying how the abstract persistence schema of an entity bean or of a
set of interrelated entity beans is to be mapped to an underlying
database. This is the responsibility of the Deployer, who, using the
Container Provider’s tools, uses the logical relationships that are
specified in the deployment descriptor to map to the physical
relationships that are specific to the underlying resource. It is the
responsibility of the container to manage the mapping between the
logical and physical relationships at runtime and to manage the
referential integrity of the relationships.</p>
</div>
<div class="paragraph">
<p>The advantage of
using container-managed persistence is that the entity bean can be
logically independent of the data source in which the entity is stored.
The Container Provider’s tools can, for example, generate classes that
use JDBC or SQLJ to access the entity state in a relational database;
classes that implement access to a non-relational data source, such as
an IMS database; or classes that implement function calls to existing
enterprise applications. These tools are typically specific to each data
source.</p>
</div>
<div class="paragraph">
<p>===</p>
</div>
<div class="paragraph">
<p>View of Underlying Data Sources Accessed Through Entity Bean</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-8.png" alt="image"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="_the_entity_bean_providers_view_of_container_managed_persistence"><a class="anchor" href="#_the_entity_bean_providers_view_of_container_managed_persistence"></a>4.3. The Entity Bean Provider’s View of Container-Managed Persistence</h3>
<div class="paragraph">
<p>An entity bean
implements an object view of a business entity or set of business
entities stored in an underlying database or implemented by an existing
enterprise application (for example, by a mainframe program or by an ERP
application).</p>
</div>
<div class="paragraph">
<p>An
entity bean with container-managed persistence typically consists of its
entity bean class; a component interface which defines its client view
business methods; a home interface which defines the create, remove,
home, and finder methods of its client view; and its abstract
persistence schema as specified in the deployment descriptor.</p>
</div>
<div class="paragraph">
<p>A client of an entity bean can control the
life cycle of a bean by using the bean’s home interface and can
manipulate the bean as a business entity by using the methods defined by
its component interface. The home and component interfaces of a bean
define its client view.</p>
</div>
<div class="paragraph">
<p>An entity bean with container-managed
persistence typically has container-managed
relationships with other container-managed persistence entity beans, as
defined by the <em>relationships</em>  element of
the deployment descriptor. The architecture for container-managed
persistence thus allows the Bean Provider to implement complex
applications by defining a complex abstract persistence schema
encompassing multiple entity bean classes related by means of
container-managed relationships.</p>
</div>
<div class="paragraph">
<p>An entity bean accesses related entity beans
by means of the accessor methods for its
container-managed relationship fields, which
are specified by the <em>cmr-field</em>  elements
of its abstract persistence schema defined in the deployment descriptor.
Entity bean relationships are defined in
terms of the local interfaces of the related beans, and the view an
entity bean presents to its related beans is defined by its local home
and local interfaces. Thus, an entity bean can be the target of a
relationship from another entity bean only if it has a local interface.</p>
</div>
<div class="paragraph">
<p>The Bean Provider programming an application
that uses container-managed persistence typically avoids calls to the
methods of the remote home and remote interfaces in favor of invoking
related beans by means of the methods of their local interfaces. Unlike
remote method calls, such internal method invocations are made using
call-by-reference and commonly do not involve the checking of method
permissions.</p>
</div>
<div class="paragraph">
<p>The Enterprise JavaBeans architecture for
container-managed persistence provides great flexibility to the Bean
Provider in designing an application.</p>
</div>
<div class="paragraph">
<p>For example, a group of related entity beans—
<em>Order</em> , <em>LineItem</em> , and <em>Customer</em> —might all be defined as having
only local interfaces, with a remotable session bean containing the
business logic that drives their invocation. The individual entity beans
form a coordinated whole that provides an interrelated set of services
that are exposed by their several home and component interfaces. The
services provided by the local network of entity beans is exposed to the
remote client view through the home and remote interfaces of the session
bean, which offers a coarser grained remote service.</p>
</div>
<div class="paragraph">
<p>Alternatively, a single entity bean might
represent an independent, remotable business object that forms a unit of
distribution that is designed to be referenced remotely by multiple
enterprise beans and/or other remote clients. Such a remotable entity
bean might make use of other entity beans within its local scope to
further model its complex internal state. For example, an <em>Order</em> entity
bean might make use of a <em>LineItem</em> entity bean internally, not exposing
it to remote clients. In this case, the <em>Order</em> entity bean might define
both a remote and a local component interface, where the local interface
is presented only to the related entity beans, such as <em>LineItem</em> , and
the remote interface is presented to session beans and/or web-tier
clients.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_entity_bean_providers_programming_contract"><a class="anchor" href="#_the_entity_bean_providers_programming_contract"></a>4.4. The Entity Bean Provider’s Programming Contract</h3>
<div class="paragraph">
<p>The Bean Provider
must observe the following programming contract when defining an entity
bean class that uses container-managed persistence:</p>
</div>
<div class="paragraph">
<p>The Bean Provider
must define the entity bean class as an abstract class. The container
provides the implementation class that is used at runtime.</p>
</div>
<div class="paragraph">
<p>The
container-managed persistent fields and
container-managed relationship fields must
<em>not</em> be defined in the entity bean class. From the perspective of the
Bean Provider, the container-managed persistent fields and
container-managed relationship fields are virtual fields only, and are
accessed through get and set accessor methods. The implementation of the
container-managed persistent fields and container-managed relationship
fields is supplied by the container.</p>
</div>
<div class="paragraph">
<p>The
container-managed persistent fields and container-managed relationship
fields must be specified in the deployment descriptor using the
<em>cmp-field</em> and <em>cmr-field</em> elements respectively. The names of these
fields must be valid Java identifiers and must begin with a lowercase
letter, as determined by <em>java.lang.Character.isLowerCase</em> .</p>
</div>
<div class="paragraph">
<p>The Bean Provider
must define the accessor methods for the container-managed persistent
fields and container-managed relationship fields as get and set methods,
using the JavaBeans conventions. The implementation of the accessor
methods is supplied by the container.</p>
</div>
<div class="paragraph">
<p>The accessor
methods must be public, must be abstract, and must bear the name of the
container-managed persistent field ( <em>cmp-field</em> ) or container-managed
relationship field ( <em>cmr-field</em> ) that is specified in the deployment
descriptor, and in which the first letter of the name of the cmp-field
or cmr-field has been uppercased and prefixed by “ <em>get</em> ” or “ <em>set</em> ”.</p>
</div>
<div class="paragraph">
<p>The accessor
methods for a container-managed relationship field must be defined in
terms of the local interface of the related entity bean, as described in
<a href="Ejb.html#a437">See The Entity Bean Provider’s View of
Persistent Relationships</a>.</p>
</div>
<div class="paragraph">
<p>The accessor
methods for container-managed relationship fields for
one-to-many or
many-to-many relationships must utilize one
of the following Collection interfaces:
<em>java.util.Collection</em> or <em>java.util.Set</em> . The Collection interfaces
used in relationships are specified in the deployment descriptor. The
implementation of the collection classes used for the container-managed
relationship fields is supplied by the container.</p>
</div>
<div class="paragraph">
<p>An entity bean local interface type (or a
collection of such) can be the type of a cmr-field. An entity bean local
interface type (or a collection of such) cannot be the type of a
cmp-field.</p>
</div>
<div class="paragraph">
<p>The accessor
methods for the container-managed relationship fields must not be
exposed in the remote interface of an entity bean.</p>
</div>
<div class="paragraph">
<p>The local
interface types of the entity bean and of related entity beans must not
be exposed through the remote interface of the entity bean.</p>
</div>
<div class="paragraph">
<p>The collection classes that are used for
container-managed relationships must not be exposed through the remote
interface of the entity bean.</p>
</div>
<div class="paragraph">
<p>Once the primary
key for an entity bean has been set, the Bean Provider must not attempt
to change it by use of set accessor methods on the primary key
cmp-fields. The Bean Provider should therefore not expose the set
accessor methods for the primary key cmp-fields in the component
interface of the entity bean.</p>
</div>
<div class="paragraph">
<p>The Bean Provider
must ensure that the Java types assigned to the cmp-fields are
restricted to the following: Java primitive types and Java serializable
types.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_entity_bean_providers_view_of_persistent_relationships"><a class="anchor" href="#_the_entity_bean_providers_view_of_persistent_relationships"></a>4.5. <a id="a437"></a>The Entity Bean Provider’s View of Persistent Relationships</h3>
<div class="paragraph">
<p>An entity bean
may have relationships with other entity beans with container-managed
persistence.</p>
</div>
<div class="paragraph">
<p>Relationships may be one-to-one, one-to-many,
or many-to-many relationships.</p>
</div>
<div class="paragraph">
<p>Container-managed
relationships can exist only among entity beans within the same local
relationship scope, as defined by the <em>relationships</em>
 element in the deployment descriptor.
Container-managed relationships are defined in terms of the local
interfaces of the related beans.</p>
</div>
<div class="paragraph">
<p>Relationships may be either bidirectional or
unidirectional. If a relationship is
bidirectional, it can be navigated in both directions, whereas a
unidirectional relationship can be navigated in one direction only.</p>
</div>
<div class="paragraph">
<p>A unidirectional
relationship is implemented with a cmr-field on the entity bean instance
from which navigation can take place, and no related cmr-field on the
entity bean instance that is the target of the relationship.
Unidirectional relationships are typically used when the Bean Provider
wishes to restrict the visibility of a relationship.</p>
</div>
<div class="paragraph">
<p>An entity bean that does not have a
local interface can have only unidirectional
relationships from itself to other entity beans. The lack of a local
interface prevents other entity beans from having a relationship to it.</p>
</div>
<div class="paragraph">
<p>The bean developer navigates or manipulates
relationships by using the get and set
accessor methods for the container-managed relationship fields and the
<em>java.util.Collection</em> API for collection-valued container-managed
relationship fields.</p>
</div>
<div class="paragraph">
<p>The Bean Provider must consider the type and
cardinality of relationships when the entity
bean classes are programmed. The get method for a cmr-field must return
either the local interface of the entity bean or a collection (either
<em>java.util.Collection</em> or <em>java.util.Set</em> ) of the same. The set method
for the relationship must take as an argument the entity bean’s local
interface or a collection of the same.</p>
</div>
</div>
<div class="sect2">
<h3 id="_dependent_value_classes"><a class="anchor" href="#_dependent_value_classes"></a>4.6. Dependent Value Classes</h3>
<div class="paragraph">
<p>A dependent value class is a concrete class
that is the value of a cmp-field. A dependent value class may be a class
that the Bean Provider wishes to use internally within an entity bean
with container-managed persistence, and/or it may be a class that the
Bean Provider chooses to expose through the remote (or local) interface
of the entity bean.</p>
</div>
<div class="paragraph">
<p>A dependent value
class can be the value of a cmp-field; it cannot be the value of a
cmr-field.</p>
</div>
<div class="paragraph">
<p>The get accessor method for a cmp-field that
corresponds to a dependent value class returns a <em>copy</em> of the dependent
value class instance. The assignment of a dependent value class value to
a cmp-field using the set accessor method causes the value to be copied
to the target cmp-field.</p>
</div>
<div class="paragraph">
<p>A dependent value class must be serializable.
The internal structure of a dependent value class is not described in
the EJB deployment descriptor.</p>
</div>
</div>
<div class="sect2">
<h3 id="_remove_protocols"><a class="anchor" href="#_remove_protocols"></a>4.7. Remove Protocols</h3>
<div class="paragraph">
<p>The Bean Provider can specify the removal of
an entity object in two ways:</p>
</div>
<div class="paragraph">
<p>By the use of a <em>remove</em>
 method on the entity bean’s component
interface or home interface.</p>
</div>
<div class="paragraph">
<p>By the use of a <em>cascade-delete</em>
 specification in the deployment descriptor.</p>
</div>
</div>
<div class="sect2">
<h3 id="_remove_methods_3"><a class="anchor" href="#_remove_methods_3"></a>4.8. Remove Methods</h3>
<div class="paragraph">
<p>When the <em>remove</em> method is invoked on
an entity object, the container must invoke the entity Bean Provider’s
<em>ejbRemove</em>  method as described in Section
<a href="Ejb.html#a1279">See Container’s View</a>. After the Bean
Provider’s <em>ejbRemove</em> method returns (and prior to returning to the
client), the container must remove the entity object from all
relationships in which it participates, and then remove its persistent
representation. <a href="#a3368">4</a></p>
</div>
<div class="paragraph">
<p>Once an entity has been removed from a
relationship, the accessor methods for any relationships to the entity
will reflect this removal. An accessor method for a one-to-one or
many-to-one relationship to the entity will return null; and an accessor
method for a many-to-many relationship to the entity will return a
collection from which the entity object has been removed.</p>
</div>
<div class="paragraph">
<p>The container must detect any subsequent
attempt to invoke an accessor method on the removed entity object and
throw the <em>java.rmi.NoSuchObjectException</em> if the client is a remote
client or the <em>javax.ejb.NoSuchObjectLocalException</em> if the client is a
local client. The container must detect an attempt to assign a removed
entity object as the value of a cmr-field of another object (whether as
an argument to a set accessor method or as an argument to a method of
the <em>java.util.Collection</em> API) and throw the
<em>java.lang.IllegalArgumentException</em> .</p>
</div>
<div class="paragraph">
<p>After removing the entity object from all
relationships and removing its persistent representation, the container
must then cascade the removal to all entity beans with which the entity
had been previously in container-managed relationships for which the
<em>cascade-delete</em> option was specified.</p>
</div>
<div class="paragraph">
<p>More than one relationship may be affected by
the removal of an entity object, as in the following example. Once the
shipping address object used by the <em>Order</em> bean has been removed, the
billing address accessor method will also return null.</p>
</div>
<div class="paragraph">
<p>public void changeAddress()</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Address a = createAddress();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>setShippingAddress(a);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>setBillingAddress(a);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> //both relationships now reference the same
entity object</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>getShippingAddress().remove();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> if (getBillingAddress() == null) // it must
be</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>else ...</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// this is impossible....</pre>
</div>
</div>
<div class="paragraph">
<p>The <em>remove</em> method, alone, causes only the
entity on which it is invoked to be removed. It does not cause the
deletion to be cascaded to other entity objects. In order for the
deletion of one entity object to be automatically cascaded to another,
the <em>cascade-delete</em>  mechanism should be
used.</p>
</div>
</div>
<div class="sect2">
<h3 id="_cascade_delete"><a class="anchor" href="#_cascade_delete"></a>4.9. Cascade-delete</h3>
<div class="paragraph">
<p>The
<em>cascade-delete</em> deployment descriptor element is used within a
particular relationship to specify that the lifetime of one or more
entity objects is dependent upon the lifetime of another entity object.</p>
</div>
<div class="paragraph">
<p>The
<em>cascade-delete</em> deployment descriptor element is contained within the
<em>ejb-relationship-role</em> element. The <em>cascade-delete</em> element can only
be specified for an <em>ejb-relationship-role</em> element contained in an
<em>ejb-relation</em> element if the <em>other</em> <em>ejb-relationship-role</em> element in
the same <em>ejb-relation</em> element specifies a <em>multiplicity</em> of <em>One</em> .
The <em>cascade-delete</em> option cannot be specified for a many-to-many
relationship. The deletion of one entity object can only be cascaded to
cause the deletion of other entity objects if the first entity object is
in a one-to-one or one-to-many relationship with those other entity
objects.</p>
</div>
<div class="paragraph">
<p>If an entity is deleted, and the
<em>cascade-delete</em> deployment descriptor element is specified for a
related entity bean, then the removal is cascaded to cause the removal
of the related entity object or objects. As with the <em>remove</em> operation,
the removal triggered by the <em>cascade-delete</em> option causes the
container to invoke the <em>ejbRemove</em> method on the entity bean instance
that is to be removed before the persistent representation of that
entity object is removed. Once an entity has been removed from a
relationship because of a cascaded delete, the accessor methods for any
relationships to the entity will reflect this removal. An accessor
method for a one-to-one or many-to-one relationship to the entity will
return null; and an accessor method for a many-to-many relationship to
the entity will return a collection from which the entity object has
been removed. After removing the entity object from all relationships
and removing its persistent representation, the container must then
cascade the removal to all entity beans with which the entity had been
previously been in container-managed relationships for which the
<em>cascade-delete</em> option was specified.</p>
</div>
<div class="paragraph">
<p>The use of <em>cascade-delete</em> causes only the
entity object or objects in the relationship for which it is specified
to be deleted. It does not cause the deletion to be further cascaded to
other entity objects, unless they are participants in relationship roles
for which <em>cascade-delete</em> has also been specified.</p>
</div>
</div>
<div class="sect2">
<h3 id="_identity_of_entity_objects"><a class="anchor" href="#_identity_of_entity_objects"></a>4.10. Identity of Entity Objects</h3>
<div class="paragraph">
<p>From the viewpoint of the Bean Provider,
entity objects have a runtime object
identity that is maintained by the container.</p>
</div>
<div class="paragraph">
<p>The container maintains the persistent
identity of an entity object on the basis of its primary key.</p>
</div>
<div class="paragraph">
<p>The primary key
of an entity bean may or may not be visible as one or more cmp-fields of
the instance, depending on the way in which it is specified. The Bean
Provider specifies the primary key as described in
<a href="Ejb.html#a1820">See Primary Keys</a>. Once it has been set, the
Bean Provider must not attempt to change the value of a primary key
field by means of a set method on its cmp-fields.</p>
</div>
<div class="paragraph">
<p>When a new instance of an entity bean whose
primary key fields are visible in the entity
bean class is created, the Bean Provider must use the
<em>ejbCreate&lt;METHOD&gt;</em> method to set all the primary key fields of the
entity bean instance before the instance can participate in a
relationship, e.g. be used in a set accessor method for a cmr-field. The
Bean Provider must not reset a primary key value by means of a set
method on any of its cmp-fields after it has been set in the
<em>ejbCreate&lt;METHOD&gt;</em> method. If the Bean Provider attempts to reset a
primary key value, the container must throw the
<em>java.lang.IllegalStateException</em> .</p>
</div>
<div class="paragraph">
<p>Note that the container’s implementation of
the referential integrity semantics for container-managed relationships
must not cause the value of the primary key to change.</p>
</div>
<div class="paragraph">
<p>The Bean Provider should not use untrimmed or
blank-padded string-valued primary key fields. Use of untrimmed primary
key fields may cause comparison operations based on primary keys to
fail, and may result in non-portable behavior. If untrimmed strings are
used in primary key fields or other cmp-fields, the container or
database system may trim them.</p>
</div>
</div>
<div class="sect2">
<h3 id="_semantics_of_assignment_for_relationships"><a class="anchor" href="#_semantics_of_assignment_for_relationships"></a>4.11. <a id="a496"></a>Semantics of Assignment for Relationships</h3>
<div class="paragraph">
<p>The assignment operations for
container-managed relationships have a
special semantics that is determined by the referential integrity
semantics for the relationship multiplicity.</p>
</div>
<div class="paragraph">
<p>In the case of a one-to-one relationship,
when the Bean Provider uses a set accessor method to assign an object
from a cmr-field in one instance to a cmr-field of the <em>same
relationship type</em> (i.e., as defined by the <em>ejb-relation</em> and
<em>ejb-relationship-role</em> deployment descriptor elements) in another
instance, the object is effectively <em>moved</em> and the value of the source
cmr-field is set to null in the same transaction context. If the
argument to the set accessor method is not of the same type as the
cmr-field, the container must throw the
<em>java.lang.IllegalArgumentException</em> .</p>
</div>
<div class="paragraph">
<p>In the case of a one-to-many or many-to-many
relationship, either the <em>java.util.Collection</em> API or a set accessor
method may be used to manipulate the contents of a collection-valued
cmr-field. These two approaches are discussed below.</p>
</div>
</div>
<div class="sect2">
<h3 id="_use_of_the_java_util_collection_api_to_update_relationships"><a class="anchor" href="#_use_of_the_java_util_collection_api_to_update_relationships"></a>4.12. Use of the java.util.Collection API to Update Relationships</h3>
<div class="paragraph">
<p>The methods of the <em>java.util.Collection</em> API
for the container-managed collections used
for collection-valued cmr-fields have the usual semantics, with the
following exception: the <em>add</em> and <em>addAll</em> methods applied to
container-managed collections in one-to-many relationships have a
special semantics that is determined by the
referential integrity of one-to-many
relationships.</p>
</div>
<div class="paragraph">
<p>If the argument to the <em>add</em>
 method is already an element of a
collection-valued relationship field of the <em>same relationship type</em> as
the target collection (as defined by the <em>ejb-relation</em> and
<em>ejb-relationship-role</em> deployment descriptor elements), it is removed
from this first relationship and added, in the same transaction context,
to the target relationship (i.e., it is effectively moved from one
collection of the relationship type to the other). For example, if there
is a one-to-many relationship between field offices and sales
representatives, adding a sales representative to a new field office
will have the effect of removing him or her from his or her current
field office. If the argument to the <em>add</em> method is not an element of a
collection-valued relationship of the <em>same relationship type</em> , it is
simply added to the target collection and not removed from its current
collection, if any.</p>
</div>
<div class="paragraph">
<p>The <em>addAll</em>
method, when applied to a target collection in a one-to-many
relationship, has similar semantics, applied to the members of its
collection argument individually.</p>
</div>
<div class="paragraph">
<p>Note that in the case of many-to-many
relationships, adding an element or elements to the contents of a
collection-valued cmr-field has no effect on the source collection, if
any. For example, if there is a many-to-many relationship between
customers and sales representatives, a customer can be added to the set
of customers handled by a particular sales representative without
affecting the set of customers handled by any other sales
representative.</p>
</div>
<div class="paragraph">
<p>When the <em>java.util.Collection</em>
 API is used to manipulate the contents of
container-managed relationship fields, the argument to any Collection
method defined with a single Object parameter must be of the element
type of the collection defined for the target cmr-field. The argument
for any collection-valued parameter must be a <em>java.util.Collection</em> (or
<em>java.util.Set</em> ), all of whose elements are of the element type of the
collection defined for the target cmr-field. If an argument is not of
the correct type for the relationship, the container must throw the
<em>java.lang.IllegalArgumentException</em> .</p>
</div>
<div class="paragraph">
<p>The Bean Provider should exercise caution
when using an Iterator over a collection in a container-managed
relationship. In particular, the Bean Provider should not modify the
container-managed collection while the iteration is in progress in any
way that causes elements to be added or removed, other than by the
<em>java.util.Iterator.remove()</em>  method. If
elements are added or removed from the underlying container-managed
collection used by an iterator other than by the
<em>java.util.Iterator.remove()</em> method, the container should throw the
<em>java.lang.IllegalStateException</em> on the next operation on the iterator.</p>
</div>
<div class="paragraph">
<p>The following example illustrates how
operations on container-managed relationships that affect the contents
of a collection-valued cmr-field viewed through an iterator can be
avoided. Because there is a one-to-many relationship between field
offices and sales representatives, adding a sales representative to a
new field office causes the sales representative to be removed from the
current field office.</p>
</div>
<div class="paragraph">
<p>Collection nySalesreps =
nyOffice.getSalesreps();</p>
</div>
<div class="paragraph">
<p>Collection sfSalesreps =
sfOffice.getSalesreps();</p>
</div>
<div class="paragraph">
<p>Iterator i = nySalesreps.iterator();</p>
</div>
<div class="paragraph">
<p>Salesrep salesrep;</p>
</div>
<div class="paragraph">
<p>while (i.hasNext()) \{</p>
</div>
<div class="literalblock">
<div class="content">
<pre>salesrep = (Salesrep)i.next();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> sfSalesreps.add(salesrep); // removes
salesrep from nyOffice</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="paragraph">
<p>the salesrep</p>
</div>
<div class="paragraph">
<p>while (i.hasNext()) \{</p>
</div>
<div class="literalblock">
<div class="content">
<pre>salesrep = (Salesrep)i.next();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>i.remove();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>sfSalesreps.add(salesrep);</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
</div>
<div class="sect2">
<h3 id="_use_of_set_accessor_methods_to_update_relationships"><a class="anchor" href="#_use_of_set_accessor_methods_to_update_relationships"></a>4.13. Use of Set Accessor Methods to Update Relationships</h3>
<div class="paragraph">
<p>The semantics of a
set accessor method, when applied to a
collection-valued cmr-field, is also determined by the
referential integrity semantics associated
with the multiplicity of the relationship. The identity of the
collection object referenced by a cmr-field does not change when a set
accessor method is executed.</p>
</div>
<div class="paragraph">
<p>In the case of a one-to-many relationship, if
a collection of entity objects is assigned from a cmr-field of in one
instance to a cmr-field of the same relationship type in another
instance, the objects in the collection are effectively moved. The
contents of the collection of the target instance are replaced with the
contents of the collection of the source instance, but the <em>identity</em> of
the collection object containing the instances in the relationship does
not change. The source cmr-field references the same collection object
as before (i.e., the identity of the collection object is preserved),
but the collection is empty.</p>
</div>
<div class="paragraph">
<p>The Bean Provider can thus use the set method
to move objects between the collections referenced by cmr-fields of the
same relationship type in different instances. The
set accessor method, when applied to a
cmr-field in a one-to-many relationship thus has the semantics of the
<em>java.util.Collection</em> methods <em>clear</em> , followed by <em>addAll</em> , applied
to the target collection; and <em>clear</em> , applied to the source
collection. It is the responsibility of the container to transfer the
contents of the collection instances in the same transaction context.</p>
</div>
<div class="paragraph">
<p>Note that if the collection that is passed to
the cmr setter method is an unmanaged collection (i.e., not itself the
value of a collection-valued cmr-field), the same requirements apply in
the case that the collection contains entity objects that already
participate in a one-to-many relationship of the same relationship type
as the target cmr-field.</p>
</div>
<div class="paragraph">
<p>In the following example, the telephone
numbers associated with the billing address of an <em>Order</em> bean instance
are transferred to the shipping address. Billing address and shipping
address are different instances of the same local interface type,
<em>Address</em> . <em>Address</em> is related to <em>TelephoneNumber</em> in a one-to-many
relationship. The example illustrates how a Bean Provider uses the set
method to move a set of instances.</p>
</div>
<div class="paragraph">
<p>public void changeTelephoneNumber() \{</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Address a = getShippingAddress();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Address b = getBillingAddress();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Collection c = b.getTelephoneNumbers();</pre>
</div>
</div>
<div class="paragraph">
<p>a.setTelephoneNumbers(b.getTelephoneNumbers());</p>
</div>
<div class="literalblock">
<div class="content">
<pre>if (c.isEmpty()) \{ // must be true...</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="paragraph">
<p>In the case of a
many-to-many relationship, if the value of a
cmr-field is assigned to a cmr-field of the same relationship type in
another instance, the objects in the collection of the first instance
are assigned as the contents of the cmr-field of the second instance.
The identities of the collection objects referenced by the cmr-fields do
not change. The contents of the collections are shared, but not the
collections themselves. The set accessor method, when applied to a
cmr-field in a many-to-many relationship thus has the semantics of the
<em>java.util.Collection</em> methods <em>clear</em> , followed by <em>addAll</em> , applied
to the target collection.</p>
</div>
<div class="paragraph">
<p>For example, if there is a many-to-many
relationship between customers and sales representatives, assigning the
set of customers of one sales representative to the another sales
representative will result in both sales representatives handling the
same customers. If the second sales representative originally handled a
different group of customers, those customers will no longer be handled
by that sales representative.</p>
</div>
<div class="paragraph">
<p>public void shareCustomers(SalesRep rep) \{</p>
</div>
<div class="literalblock">
<div class="content">
<pre>setCustomers(rep.getCustomers());</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> // the customers are shared among the sales
reps</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="paragraph">
<p>The following section,
<a href="Ejb.html#a558">See Assignment Rules for Relationships</a>,
defines the semantics of assignment for relationships in further detail.</p>
</div>
</div>
<div class="sect2">
<h3 id="_assignment_rules_for_relationships"><a class="anchor" href="#_assignment_rules_for_relationships"></a>4.14. <a id="a558"></a>Assignment Rules for Relationships</h3>
<div class="paragraph">
<p>This section
defines the semantics of assignment and collection manipulation in
one-to-one, one-to-many, and many-to-many container-managed
relationships.</p>
</div>
<div class="paragraph">
<p>The figures make
use of two entity beans, with local interface types A and B. Instances
with local interface type <em>A</em> are typically designated as <em>a1</em> ,&#8230;&#8203;,
<em>an</em> ; instances with local interface type <em>B</em> are typically designated
as <em>b1</em> ,&#8230;&#8203;, <em>bm</em> . Interface <em>A</em> exposes accessor methods <em>getB</em> and
<em>setB</em> for navigable relationships with <em>B</em> : <em>getB</em> returns an instance
of <em>B</em> or a collection of instances of <em>B</em> , depending on the
multiplicity of the relationship. Similarly, <em>B</em> exposes accessor
methods <em>getA</em> and <em>setA</em> for navigable relationships with <em>A</em> .</p>
</div>
<div class="paragraph">
<p>All changes in each subsection are assumed to
be applied to the figure labeled “Before change” at the beginning of the
subsection (i.e., changes are not cumulative). The results of changes
are designated graphically as well as in conditional expressions
expressed in the Java <em>TM</em> programming language.</p>
</div>
</div>
<div class="sect2">
<h3 id="_one_to_one_bidirectional_relationships"><a class="anchor" href="#_one_to_one_bidirectional_relationships"></a>4.15. One-to-one Bidirectional Relationships</h3>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-9.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Before change:</p>
</div>
<div class="paragraph">
<p>B b1 = a1.getB();</p>
</div>
<div class="paragraph">
<p>B b2 = a2.getB();</p>
</div>
<div class="paragraph">
<p>Change:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_a1.setB(a2.getB());_</pre>
</div>
</div>
<div class="paragraph">
<p>Expected result:</p>
</div>
<div class="paragraph">
<p>(b2.isIdentical(a1.getB())) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a2.getB() == null) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b1.getA() == null) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a1.isIdentical(b2.getA()))</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-10.png" alt="image"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="_one_to_one_unidirectional_relationships"><a class="anchor" href="#_one_to_one_unidirectional_relationships"></a>4.16. One-to-one Unidirectional Relationships</h3>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-11.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Before change:</p>
</div>
<div class="paragraph">
<p>B b1 = a1.getB();</p>
</div>
<div class="paragraph">
<p>B b2 = a2.getB();</p>
</div>
<div class="paragraph">
<p>Change:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_a1.setB(a2.getB());_</pre>
</div>
</div>
<div class="paragraph">
<p>Expected result:</p>
</div>
<div class="literalblock">
<div class="content">
<pre> _(b2.isIdentical(a1.getB())) &amp;&amp; (_ a2.getB()
=== null)</pre>
</div>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-12.png" alt="image"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="_one_to_many_bidirectional_relationships"><a class="anchor" href="#_one_to_many_bidirectional_relationships"></a>4.17. One-to-many Bidirectional Relationships</h3>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-13.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Before change:</p>
</div>
<div class="paragraph">
<p>Collection b1 = a1.getB();</p>
</div>
<div class="paragraph">
<p>Collection b2 = a2.getB();</p>
</div>
<div class="paragraph">
<p>B b11, b12, &#8230;&#8203; , b1n; // members of b1</p>
</div>
<div class="paragraph">
<p>B b21, b22, &#8230;&#8203; , b2m; // members of b2</p>
</div>
<div class="paragraph">
<p>Change:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_a1.setB(a2.getB());_</pre>
</div>
</div>
<div class="paragraph">
<p>Expected result:</p>
</div>
<div class="paragraph">
<p>(a2.getB().isEmpty()) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b2.isEmpty()) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b1 == a1.getB()) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b2 == a2.getB()) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a1.getB().contains(b21)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a1.getB().contains(b22)) &amp;&amp; &#8230;&#8203; &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a1.getB().contains(b2m)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b11.getA() == null) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b12.getA() == null) &amp;&amp; &#8230;&#8203; &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b1n.getA() == null) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a1.isIdentical(b21.getA())) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a1.isIdentical(b22.getA())) &amp;&amp; &#8230;&#8203;&amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a1.isIdentical(b2m.getA()))</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-14.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Change:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_b2m.setA(b1n.getA());_</pre>
</div>
</div>
<div class="paragraph">
<p>Expected result:</p>
</div>
<div class="paragraph">
<p>(b1.contains(b11)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b1.contains(b12)) &amp;&amp; &#8230;&#8203; &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b1.contains(b1n)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b1.contains(b2m)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b2.contains(b21)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b2.contains(b22)) &amp;&amp; &#8230;&#8203; &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b2.contains(b2m_1)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a1.isIdentical(b11.getA())) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a1.isIdentical(b12.getA())) &amp;&amp; &#8230;&#8203; &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a1.isIdentical(b1n.getA())) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a2.isIdentical(b21.getA())) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a2.isIdentical(b22.getA())) &amp;&amp; &#8230;&#8203; &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a2.isIdentical(b2m_1.getA())) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a1.isIdentical(b2m.getA()))</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-15.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Change:</p>
</div>
<div class="paragraph">
<p>a1.getB().add(b2m);</p>
</div>
<div class="paragraph">
<p>Expected result:</p>
</div>
<div class="paragraph">
<p>(b1.contains(b11)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b1.contains(b12)) &amp;&amp; &#8230;&#8203; &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b1.contains(b1n)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b1.contains(b2m)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b2.contains(b21)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b2.contains(b22)) &amp;&amp; &#8230;&#8203; &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b2.contains(b2m_1)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a1.isIdentical(b11.getA())) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a1.isIdentical(b12.getA())) &amp;&amp; &#8230;&#8203; &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a1.isIdentical(b1n.getA())) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a2.isIdentical(b21.getA())) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a2.isIdentical(b22.getA())) &amp;&amp; &#8230;&#8203; &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a2.isIdentical(b2m_1.getA())) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a1.isIdentical(b2m.getA()))</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-16.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Change:</p>
</div>
<div class="paragraph">
<p>a1.getB().remove(b1n);</p>
</div>
<div class="paragraph">
<p>Expected result:</p>
</div>
<div class="paragraph">
<p>(b1n.getA() == null) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b1 == a1.getB()) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b1.contains(b11)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b1.contains(b12)) &amp;&amp; &#8230;&#8203; &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b1.contains(b1n_1)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>!(b1.contains(b1n))</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-17.png" alt="image"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="_one_to_many_unidirectional_relationships"><a class="anchor" href="#_one_to_many_unidirectional_relationships"></a>4.18. One-to-many Unidirectional Relationships</h3>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-18.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Before change:</p>
</div>
<div class="paragraph">
<p>Collection b1 = a1.getB();</p>
</div>
<div class="paragraph">
<p>Collection b2 = a2.getB();</p>
</div>
<div class="paragraph">
<p>B b11, b12, &#8230;&#8203; , b1n; // members of b1</p>
</div>
<div class="paragraph">
<p>B b21, b22, &#8230;&#8203; , b2m; // members of b2</p>
</div>
<div class="paragraph">
<p>Change:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_a1.setB(a2.getB());_</pre>
</div>
</div>
<div class="paragraph">
<p>Expected result:</p>
</div>
<div class="paragraph">
<p>(a2.getB().isEmpty()) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b2.isEmpty()) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b1 == a1.getB()) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b2 == a2.getB()) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a1.getB().contains(b21)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a1.getB().contains(b22)) &amp;&amp; &#8230;&#8203; &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a1.getB().contains(b2m))</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-19.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Change:</p>
</div>
<div class="paragraph">
<p>a1.getB().add(b2m);</p>
</div>
<div class="paragraph">
<p>Expected result:</p>
</div>
<div class="paragraph">
<p>(b1 == a1.getB()) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b1.contains(b2m))</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-20.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Change:</p>
</div>
<div class="paragraph">
<p>a1.getB().remove(b1n);</p>
</div>
<div class="paragraph">
<p>Expected result:</p>
</div>
<div class="paragraph">
<p>(a1.getB().contains(b11)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a1.getB().contains(b12)) &amp;&amp; &#8230;&#8203; &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a1.getB().contains(b1n_1)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>!(a1.getB().contains(b1n)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-21.png" alt="image"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="_many_to_one_unidirectional_relationships"><a class="anchor" href="#_many_to_one_unidirectional_relationships"></a>4.19. Many-to-one Unidirectional Relationships</h3>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-22.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Before change:</p>
</div>
<div class="paragraph">
<p>B b11, b12, &#8230;&#8203; , b1n;</p>
</div>
<div class="paragraph">
<p>B b21, b22, &#8230;&#8203; , b2m;</p>
</div>
<div class="paragraph">
<p>(a1.isIdentical(b1n.getA() )) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a2.isIdentical(b2m.getA() ))</p>
</div>
<div class="paragraph">
<p>Change:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_b1j.setA(b2k.getA());_</pre>
</div>
</div>
<div class="paragraph">
<p>Expected result:</p>
</div>
<div class="paragraph">
<p>(a1.isIdentical(b11.getA())) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a1.isIdentical(b12.getA())) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>(a2.isIdentical(b1j.getA())) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>(a1.isIdentical(b1n.getA())) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a2.isIdentical(b21.getA())) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a2.isIdentical(b22.getA())) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>(a2.isIdentical(b2k.getA())) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>(a2.isIdentical(b2m.getA()))</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-23.png" alt="image"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="_many_to_many_bidirectional_relationships"><a class="anchor" href="#_many_to_many_bidirectional_relationships"></a>4.20. Many-to-many Bidirectional Relationships</h3>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-24.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Before change the following holds:</p>
</div>
<div class="paragraph">
<p>(a1.getB().contains(b1)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a1.getB().contains(b2)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a2.getB().contains(b1)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a2.getB().contains(b2)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a2.getB().contains(b3)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a3.getB().contains(b2)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a3.getB().contains(b3)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a3.getB().contains(b4)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a4.getB().contains(b3)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a4.getB().contains(b4)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a4.getB().contains(b5)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a5.getB().contains(b4)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a5.getB().contains(b5)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b1.getA().contains(a1)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b1.getA().contains(a2)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b2.getA().contains(a1)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b2.getA().contains(a2)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b2.getA().contains(a3)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b3.getA().contains(a2)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b3.getA().contains(a3)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b3.getA().contains(a4)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b4.getA().contains(a3)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b4.getA().contains(a4)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b4.getA().contains(a5)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b5.getA().contains(a4)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b5.getA().contains(a5)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>Change:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_a1.setB(a3.getB());_</pre>
</div>
</div>
<div class="paragraph">
<p>Expected result:</p>
</div>
<div class="paragraph">
<p>(a1.getB().contains(b2)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a1.getB().contains(b3)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a1.getB().contains(b4)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a3.getB().contains(b2)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a3.getB().contains(b3)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a3.getB().contains(b4)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b1.getA().contains(a2)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b2.getA().contains(a1)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b2.getA().contains(a2)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b2.getA().contains(a3)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b3.getA().contains(a1)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b3.getA().contains(a2)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b3.getA().contains(a3)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b3.getA().contains(a4)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b4.getA().contains(a1)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b4.getA().contains(a3)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b4.getA().contains(a4)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b4.getA().contains(a5))</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-25.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Change:</p>
</div>
<div class="paragraph">
<p>a1.getB().add(b3);</p>
</div>
<div class="paragraph">
<p>Expected result:</p>
</div>
<div class="paragraph">
<p>(a1.getB().contains(b1)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a1.getB().contains(b2)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a1.getB().contains(b3)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b3.getA().contains(a1)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b3.getA().contains(a2)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b3.getA().contains(a3)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b3.getA().contains(a4)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-26.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Change:</p>
</div>
<div class="paragraph">
<p>a2.getB().remove(b2);</p>
</div>
<div class="paragraph">
<p>Expected result:</p>
</div>
<div class="paragraph">
<p>(a2.getB().contains(b1)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a2.getB().contains(b3)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b2.getA().contains(a1)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(b2.getA().contains(a3))</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-27.png" alt="image"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="_many_to_many_unidirectional_relationships"><a class="anchor" href="#_many_to_many_unidirectional_relationships"></a>4.21. Many-to-many Unidirectional Relationships</h3>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-28.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Before change the following holds:</p>
</div>
<div class="paragraph">
<p>(a1.getB().contains(b1)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a1.getB().contains(b2)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a2.getB().contains(b1)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a2.getB().contains(b2)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a2.getB().contains(b3)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a3.getB().contains(b2)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a3.getB().contains(b3)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a3.getB().contains(b4)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a4.getB().contains(b3)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a4.getB().contains(b4)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a4.getB().contains(b5)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a5.getB().contains(b4)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a5.getB().contains(b5)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>Change:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_a1.setB(a3.getB());_</pre>
</div>
</div>
<div class="paragraph">
<p>Expected Result:</p>
</div>
<div class="paragraph">
<p>(a1.getB().contains(b2)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a1.getB().contains(b3)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a1.getB().contains(b4)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a3.getB().contains(b2)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a3.getB().contains(b3)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a3.getB().contains(b4)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-29.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Change:</p>
</div>
<div class="paragraph">
<p>a1.getB().add(b3);</p>
</div>
<div class="paragraph">
<p>Expected result:</p>
</div>
<div class="paragraph">
<p>(a1.getB().contains(b1)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a1.getB().contains(b2)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a1.getB().contains(b3))</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-30.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>Change:</p>
</div>
<div class="paragraph">
<p>a2.getB().remove(b2);</p>
</div>
<div class="paragraph">
<p>Expected result:</p>
</div>
<div class="paragraph">
<p>(a2.getB().contains(b1)) &amp;&amp;</p>
</div>
<div class="paragraph">
<p>(a2.getB().contains(b3))</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-31.png" alt="image"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="_collections_managed_by_the_container"><a class="anchor" href="#_collections_managed_by_the_container"></a>4.22. Collections Managed by the Container</h3>
<div class="paragraph">
<p>The collections
that are used in the representation of one-to-many and many-to-many
container-managed relationships are implemented and managed by the
container. The following semantics apply to these collections:</p>
</div>
<div class="paragraph">
<p>It is the responsibility of the container to
preserve the runtime identity of the collection objects used in
container-managed relationships.</p>
</div>
<div class="paragraph">
<p>There is no constructor available to the Bean
Provider for the container-managed collections.</p>
</div>
<div class="paragraph">
<p>If there are no related values for a given
container-managed relationship, the get accessor method for that
cmr-field returns an empty collection (and not <em>null</em> ).</p>
</div>
<div class="paragraph">
<p>It is the responsibility of the container to
raise the <em>java.lang.IllegalArgumentException</em>
 if the Bean Provider attempts to assign
<em>null</em> as the value of a collection-valued cmr-field by means of the set
accessor method.</p>
</div>
<div class="paragraph">
<p>It is the responsibility of the container to
ensure that when the <em>java.util.Collection</em>
API is used to manipulate the contents of container-managed relationship
fields, the argument to any Collection method defined with a single
Object parameter must be of the element type of the collection defined
for the target cmr-field. The argument for any collection-valued
parameter must be a <em>java.util.Collection</em> (or <em>java.util.Set</em> ), all of
whose elements are of the element type of the collection defined for the
target cmr-field. If an argument is not of the correct type for the
relationship, the container must throw the
<em>java.lang.IllegalArgumentException</em> .</p>
</div>
<div class="paragraph">
<p>It is the responsibility of the container to
throw the <em>java.lang.IllegalStateException</em>
if an attempt is made to modify a container-managed collection
corresponding to a multivalued cmr-field using the
<em>java.util.Collection</em> API outside of the transaction context in which
the collection object was initially materialized.</p>
</div>
<div class="paragraph">
<p>It is the responsibility of the container to
throw the <em>java.lang.IllegalStateException</em> if an attempt is made to use
a <em>java.util.Iterator</em>  for a
container-managed collection in a transaction context other than that in
which the iterator was obtained.</p>
</div>
</div>
<div class="sect2">
<h3 id="_non_persistent_state"><a class="anchor" href="#_non_persistent_state"></a>4.23. Non-persistent State</h3>
<div class="paragraph">
<p>The Bean Provider
may use instance variables in the entity
bean instance to maintain non-persistent state, e.g. a JMS connection.</p>
</div>
<div class="paragraph">
<p>The Bean Provider can use instance variables
to store values that depend on the persistent state of the entity bean
instance, although this use is not encouraged. The Bean Provider should
use the ejbLoad method to resynchronize the
values of any instance variables that depend on the entity bean’s
persistent state. In general, any non-persistent state that depends on
the persistent state of an entity bean should be recomputed during the
ejbLoad method.</p>
</div>
<div class="paragraph">
<p>The Bean Provider should exercise care in
passing the contents of instance variables as the arguments or results
of method invocations when local interfaces are used. In general, the
Bean Provider should avoid passing state that is maintained in instance
variables as the argument or result of a local method invocation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_relationship_between_the_internal_view_and_the_client_view"><a class="anchor" href="#_the_relationship_between_the_internal_view_and_the_client_view"></a>4.24. The Relationship Between the Internal View and the Client View</h3>
<div class="paragraph">
<p>In designing the
entity bean, the Bean Provider should keep in mind the following:</p>
</div>
<div class="paragraph">
<p>The classes that are exposed by the
remote interface are decoupled from the
persistence layer. Instances of these classes are passed to and from the
client by value.</p>
</div>
<div class="paragraph">
<p>The classes that are exposed by the
local interface of the bean may be tightly
coupled to the bean’s internal state. Instances of these classes are
passed to and from the client by reference and may therefore be modified
by the client. The Bean Provider should exercise care in determining
what is exposed through the local interface of the bean.</p>
</div>
</div>
<div class="sect2">
<h3 id="_restrictions_on_remote_interfaces"><a class="anchor" href="#_restrictions_on_remote_interfaces"></a>4.25. Restrictions on Remote Interfaces</h3>
<div class="paragraph">
<p>The following restrictions apply to the
remote interface of an entity bean with container-managed persistence.</p>
</div>
<div class="paragraph">
<p>The Bean Provider must not expose the get and
set methods for container-managed relationship fields or the persistent
<em>Collection</em> classes that are used in container-managed relationships
through the remote interface of the bean.</p>
</div>
<div class="paragraph">
<p>The Bean Provider must not expose local
interface types or local home interface types through the remote
interface or remote home interface of the bean.</p>
</div>
<div class="paragraph">
<p>The Bean Provider must not expose the
container-managed collection classes that are used for relationships
through the remote interface of the bean.</p>
</div>
<div class="paragraph">
<p>The Bean Provider must not expose timers or
timer handles through the remote interface of the bean.</p>
</div>
<div class="paragraph">
<p>Dependent value classes can be exposed in the
remote interface or remote home interface and can be included in the
client ejb-jar file.</p>
</div>
<div class="paragraph">
<p>The Bean Provider is free to expose get and
set methods that correspond to cmp-fields of the entity bean through the
bean’s remote interface.</p>
</div>
</div>
<div class="sect2">
<h3 id="_mapping_data_to_a_persistent_store"><a class="anchor" href="#_mapping_data_to_a_persistent_store"></a>4.26. Mapping Data to a Persistent Store</h3>
<div class="paragraph">
<p>This
specification does not prescribe how the abstract persistence schema of
an entity bean should be mapped to a relational (or other) schema of a
persistent store, or define how such a mapping is described.</p>
</div>
</div>
<div class="sect2">
<h3 id="_example"><a class="anchor" href="#_example"></a>4.27. Example</h3>
<div class="paragraph">
<p><a href="Ejb.html#a861">See Relationship
Example</a> illustrates an <em>Order</em> entity bean with relationships to line
items and customers, which are other entity beans within the same local
scope. <em>Product</em> is indirectly related to <em>Order</em> by means of the
relationship between <em>LineItem</em> and <em>Product</em> . Sample code for the
<em>OrderBean</em> class follows the figure.</p>
</div>
<div class="paragraph">
<p>===</p>
</div>
<div class="paragraph">
<p><a id="a861"></a>Relationship Example</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-32.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>package com.acme.order;</p>
</div>
<div class="paragraph">
<p>OrderBean, the</p>
</div>
<div class="paragraph">
<p>bean. OrderEJB has</p>
</div>
<div class="paragraph">
<p>entity beans</p>
</div>
<div class="paragraph">
<p>interfaces.</p>
</div>
<div class="paragraph">
<p>import java.util.Collection;</p>
</div>
<div class="paragraph">
<p>import java.util.Vector;</p>
</div>
<div class="paragraph">
<p>import java.util.Date;</p>
</div>
<div class="paragraph">
<p>import javax.naming.*;</p>
</div>
<div class="paragraph">
<p>public abstract class OrderBean implements
javax.ejb.EntityBean \{</p>
</div>
<div class="literalblock">
<div class="content">
<pre>private javax.ejb.EntityContext context;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// define status codes for processing</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>static final int BACKORDER = 1;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>static final int SHIPPED = 2;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>static final int UNSHIPPED = 3;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// get and set methods for the cmp fields</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public abstract int getOrderStatus();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> public abstract void setOrderStatus(int
orderStatus);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public abstract boolean getCreditApproved();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> public abstract void
setCreditApproved(boolean creditapproved);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public abstract Date getOrderDate();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> public abstract void setOrderDate(Date
orderDate);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> // get and set methods for the relationship
fields</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public abstract Collection getLineItems();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> public abstract void setLineItems(Collection
lineitems);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public abstract Customer getCustomer();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> public abstract void setCustomer(Customer
customer);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// business methods.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// addLineItem:</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// This method is used to add a line item.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> // It creates the lineitem object and adds
it to the</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// persistent managed relationship.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public void addLineItem(Product product,</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>int quantity,</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Address address)</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>throws InsufficientInfoException</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>\{</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// create a new line item</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>if (validAddress(address)) \{</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> // Address is a legacy class. It is a
dependent value</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> // class that is available both in the
client and in</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// the entity bean, and is serializable.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> // We will use the address as the value of a
cmp field</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// of lineItem.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>try \{</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Context ic = new InitialContext();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>LineItemLocalHome litemLocalHome =</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>(LineItemLocalHome)ic.lookup("LineItemEJB");</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>LineItem litem = litemLocalHome.create();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>litem.setProduct(product);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>litem.setQuantity(quantity);</pre>
</div>
</div>
<div class="paragraph">
<p>litem.setTax(calculateTax(product.getPrice(),</p>
</div>
<div class="literalblock">
<div class="content">
<pre>quantity,</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>address));</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>litem.setStatus(UNSHIPPED);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> // set the address for the line item to be
shipped</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>litem.setAddress(address);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> // The lineItem entity bean uses a dependent
value</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> // class to represent the dates for the
order status.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> // This class holds shipment date, expected
shipment</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// date, credit approval date, and inventory</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> // dates which are internal to the order
fullfillment</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> // process. Not all this information will be
available</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// to the client.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Dates dates = new Dates();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>litem.setDates(dates);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>getLineItems().add(litem);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>} catch (Exception someexception) \{}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>} else \{</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>throw new InsufficientInfoException();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// getOrderLineItems:</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> // This method makes a view of the lineitems
that are in this</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> // order available in the client. It makes
only the relevant</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> // information visible to the client and
hides the internal</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> // details of the representation of the
lineitem</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public Collection getOrderLineItems() \{</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Vector clientlineitems = new Vector();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Collection lineitems = getLineItems();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> java.util.Iterator iterator =
lineitems.iterator();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> // ClientLineItem is a value class that is
used in</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// the client view.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> // The entity Bean Provider abstracts from
the persistent</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> // representation of the line item to
construct the client</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// view.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>ClientLineItem clitem;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>while (iterator.hasNext()) \{</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>LineItem litem = (LineItem)iterator.next();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>clitem = new ClientLineItem();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> // only the name of the product is available
in the</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// client view</pre>
</div>
</div>
<div class="paragraph">
<p>clitem.setProductName(litem.getProduct().getName());</p>
</div>
<div class="literalblock">
<div class="content">
<pre>clitem.setQuantity(litem.getQuantity());</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> // the client view gets a specific
descriptive message</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// depending on the line item status.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>clitem.setCurrentStatus(</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>statusCodeToString(litem.getStatus()));</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// address is not copied to the client view.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> // as this class includes other information
with</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> // respect to the order handing that should
not be</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> // available to the client. Only the
relevant info</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// is copied.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>int lineitemStatus = litem.getStatus();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>if ( lineitemStatus == BACKORDER) \{</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>clitem.setShipDate(</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>litem.getDates().getExpectedShipDate());</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>} else if (lineitemStatus == SHIPPED) \{</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>clitem.setShipDate(</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>litem.getDates().getShippedDate());</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>//add the new line item</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>clientlineitems.add(clitem);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// return the value objects to the client</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>return clientlineitems;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> // other methods internal to the entity bean
class</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>// other javax.ejb.EntityBean methods</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_bean_providers_view_of_the_deployment_descriptor"><a class="anchor" href="#_the_bean_providers_view_of_the_deployment_descriptor"></a>4.28. <a id="a1013"></a>The Bean Provider’s View of the Deployment Descriptor</h3>
<div class="paragraph">
<p>The persistent fields (cmp-fields) and
relationships (cmr-fields) of an entity bean must be declared in the
deployment descriptor.</p>
</div>
<div class="paragraph">
<p>The deployment descriptor provides the
following information about the abstract persistence schemas of entity
beans and their container-managed
relationships:</p>
</div>
<div class="paragraph">
<p>An <em>ejb-name</em> element for each entity bean.
The <em>ejb-name</em> must be a valid Java identifier and must be unique within
the <em>ejb-name</em> elements of the ejb-jar file.</p>
</div>
<div class="paragraph">
<p>An <em>abstract-schema-name</em> element for each
entity bean. The <em>abstract-schema-name</em> must be a valid Java identifier
and must be unique within the <em>abstract-schema-name</em> elements of the
ejb-jar file. The <em>abstract-schema-name</em> element is used in the
specification of EJB QL queries.</p>
</div>
<div class="paragraph">
<p>A set of <em>ejb-relation</em> elements, each
of which contains a pair of <em>ejb-relationship-role</em> elements to describe
the two roles in the relationship.<a href="#a3369">5</a></p>
</div>
<div class="paragraph">
<p>Each <em>ejb-relationship-role</em> element
describes a relationship role: its name, its multiplicity within a
relation, and its navigability. It specifies the name of the <em>cmr-field</em>
that is used from the perspective of the relationship participant. The
<em>cmr-field-type</em> element must be specified if the type of the cmr-field
is <em>java.util.Collection</em> or <em>java.util.Set</em> . Each relationship role
refers to an entity bean by means of an ejb-name element contained in
the <em>relationship-role-source</em> element.</p>
</div>
<div class="paragraph">
<p>The following example shows a deployment
descriptor segment that defines the abstract persistence schema for a
set of related entity beans. The deployment descriptor elements for
container-managed persistence and relationships are described further in
Chapter <a href="Ejb.html#a3273">See Deployment Descriptor</a>.</p>
</div>
<div class="paragraph">
<p>&lt;ejb-jar&gt;</p>
</div>
<div class="paragraph">
<p>&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>&lt;enterprise-beans&gt;</p>
</div>
<div class="paragraph">
<p>&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>&lt;/enterprise-beans&gt;</p>
</div>
<div class="paragraph">
<p>&lt;relationships&gt;</p>
</div>
<div class="paragraph">
<p>&lt;!--</p>
</div>
<div class="paragraph">
<p>ONE-TO-MANY: Order LineItem</p>
</div>
<div class="paragraph">
<p>-&#8594;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ejb-relation&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;ejb-relation-name&gt;Order-LineItem&lt;/ejb-relation-name&gt;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ejb-relationship-role&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ejb-relationship-role-name&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>order-has-lineitems</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/ejb-relationship-role-name&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;multiplicity&gt;One&lt;/multiplicity&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;relationship-role-source&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ejb-name&gt;OrderEJB&lt;/ejb-name&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/relationship-role-source&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;cmr-field&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;cmr-field-name&gt;lineItems&lt;/cmr-field-name&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;cmr-field-type&gt;java.util.Collection</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/cmr-field-type&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/cmr-field&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/ejb-relationship-role&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ejb-relationship-role&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;ejb-relationship-role-name&gt;lineitem-belongsto-order</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/ejb-relationship-role-name&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;multiplicity&gt;Many&lt;/multiplicity&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;cascade-delete/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;relationship-role-source&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ejb-name&gt;LineItemEJB&lt;/ejb-name&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/relationship-role-source&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;cmr-field&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;cmr-field-name&gt;order&lt;/cmr-field-name&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/cmr-field&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/ejb-relationship-role&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/ejb-relation&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;!--</p>
</div>
<div class="paragraph">
<p>ONE-TO-MANY unidirectional relationship:</p>
</div>
<div class="paragraph">
<p>Product is not aware of its relationship with
LineItem</p>
</div>
<div class="paragraph">
<p>-&#8594;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ejb-relation&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;ejb-relation-name&gt;Product-LineItem&lt;/ejb-relation-name&gt;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ejb-relationship-role&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ejb-relationship-role-name&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>product-has-lineitems</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/ejb-relationship-role-name&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;multiplicity&gt;One&lt;/multiplicity&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;relationship-role-source&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ejb-name&gt;ProductEJB&lt;/ejb-name&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/relationship-role-source&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> &lt;!-- since Product does not know about
LineItem</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> there is no cmr field in Product for
accessing</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Lineitem</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>--&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/ejb-relationship-role&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ejb-relationship-role&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ejb-relationship-role-name&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>lineitem-for-product</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/ejb-relationship-role-name&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;multiplicity&gt;Many&lt;/multiplicity&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;relationship-role-source&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ejb-name&gt;LineItemEJB&lt;/ejb-name&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/relationship-role-source&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;cmr-field&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;cmr-field-name&gt;product&lt;/cmr-field-name&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/cmr-field&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/ejb-relationship-role&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/ejb-relation&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;!--</p>
</div>
<div class="paragraph">
<p>ONE-TO-MANY: Order Customer:</p>
</div>
<div class="paragraph">
<p>-&#8594;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ejb-relation&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;ejb-relation-name&gt;Order-Customer&lt;/ejb-relation-name&gt;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ejb-relationship-role&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ejb-relationship-role-name&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>customer-has-orders</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/ejb-relationship-role-name&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;multiplicity&gt;One&lt;/multiplicity&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;relationship-role-source&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ejb-name&gt;CustomerEJB&lt;/ejb-name&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/relationship-role-source&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;cmr-field&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;cmr-field-name&gt;orders&lt;/cmr-field-name&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;cmr-field-type&gt;java.util.Collection</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/cmr-field-type&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/cmr-field&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/ejb-relationship-role&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ejb-relationship-role&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ejb-relationship-role-name&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>order-belongsto-customer</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/ejb-relationship-role-name&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;multiplicity&gt;Many&lt;/multiplicity&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;relationship-role-source&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;ejb-name&gt;OrderEJB&lt;/ejb-name&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/relationship-role-source&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;cmr-field&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;cmr-field-name&gt;customer&lt;/cmr-field-name&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/cmr-field&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/ejb-relationship-role&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;/ejb-relation&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/relationships&gt;</p>
</div>
<div class="paragraph">
<p>&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>&lt;/ejb-jar&gt;</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_entity_bean_component_contract"><a class="anchor" href="#_the_entity_bean_component_contract"></a>4.29. The Entity Bean Component Contract</h3>
<div class="paragraph">
<p>This section specifies the container-managed
persistence contract between an entity bean and its container.</p>
</div>
</div>
<div class="sect2">
<h3 id="_runtime_execution_model_of_entity_beans"><a class="anchor" href="#_runtime_execution_model_of_entity_beans"></a>4.30. Runtime Execution Model of Entity Beans</h3>
<div class="paragraph">
<p>This subsection
describes the runtime model and the classes
used in the description of the contract between an entity bean and its
container. <a href="Ejb.html#a1155">See Overview of the Entity Bean
Runtime Execution Model</a> shows an overview of the runtime model. The
client of an entity bean may be a local client or it may be a remote
client.</p>
</div>
<div class="paragraph">
<p>===</p>
</div>
<div class="paragraph">
<p><a id="a1155"></a>Overview of the Entity Bean Runtime Execution Model</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-33.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>An enterprise bean is an object whose class
is provided by the Bean Provider. The class of an entity bean with
container-managed persistence is abstract. The concrete bean class is
generated by the Container Provider’s tools at deployment time. The
container is also responsible for providing the implementation of the
<em>java.util.Collection</em> classes that are used in maintaining the
container-managed relationships of the entity bean.</p>
</div>
<div class="paragraph">
<p>An entity <em>EJBObject</em>
 or
EJBLocalObject is an object whose class was
generated at deployment time by the Container Provider’s tools. A client
never references an entity bean instance directly—a client always
references an entity EJBObject or EJBLocalObject whose class is
generated by the Container Provider’s tools. The entity EJBObject class
implements an entity bean’s remote interface. The entity EJBLocalObject
class implements an entity bean’s local interface. A related entity bean
never references another entity bean instance directly—a related entity
bean, like any other local client of an entity bean, always references
an entity EJBLocalObject whose class is generated by the Container
Provider’s tools.</p>
</div>
<div class="paragraph">
<p>An entity <em>EJBHome</em>
 or EJBLocalHome
object provides life cycle operations
(create, find, remove) for its entity objects as well as home business
methods, which are business methods that are not specific to an entity
bean instance. The class for the entity EJBHome or EJBLocalHome object
is generated by the Container Provider’s tools at deployment time. The
entity EJBHome or EJBLocalHome object implements the entity bean’s
remote or local home interface that was defined by the Bean Provider.</p>
</div>
</div>
<div class="sect2">
<h3 id="_container_responsibilities"><a class="anchor" href="#_container_responsibilities"></a>4.31. Container Responsibilities</h3>
<div class="paragraph">
<p>The following are the container
responsibilities for the management of persistent state.</p>
</div>
</div>
<div class="sect2">
<h3 id="_container_managed_fields"><a class="anchor" href="#_container_managed_fields"></a>4.32. Container-Managed Fields</h3>
<div class="paragraph">
<p>An entity bean with container-managed
persistence relies on the container to perform
persistent data access on behalf of the
entity bean instances. The container transfers data between an entity
bean instance and the underlying resource manager. The container also
implements the creation, removal, and lookup of the entity object in the
underlying database.</p>
</div>
<div class="paragraph">
<p>The container
transfers data between the entity bean and the underlying data source as
a result of the execution of the entity bean’s methods. Because of the
requirement that all data access occur through the
accessor methods, the container can
implement both eager and
lazy loading and storing schemes.</p>
</div>
<div class="paragraph">
<p>The container is responsible for implementing
the entity bean class by providing the implementation of the get and set
accessor methods for its abstract persistence schema. The container is
allowed to use Java serialization to store the container-managed
persistent fields (cmp-fields).</p>
</div>
<div class="paragraph">
<p>The container must also manage the mapping
between primary keys and EJBLocalObjects or
EJBObjects. If both a remote and a local interface are specified for the
entity bean, the container must manage the mapping between EJBObjects
and EJBLocalObjects.</p>
</div>
<div class="paragraph">
<p>Because the container is free to optimize the
delivery of persistent data to the bean instance (for example, by the
use of lazy loading strategies), the contents of the entity bean
instance and the contents of container-managed collections may not be
fully materialized.</p>
</div>
</div>
<div class="sect2">
<h3 id="_container_managed_relationships"><a class="anchor" href="#_container_managed_relationships"></a>4.33. Container-Managed Relationships</h3>
<div class="paragraph">
<p>The container
maintains the relationships among entity beans.</p>
</div>
<div class="paragraph">
<p>It is the responsibility of the container to
maintain the referential integrity of the
container-managed relationships, as described in
<a href="Ejb.html#a496">See Semantics of Assignment for
Relationships</a>, in accordance with the semantics of the relationship
type as specified in the deployment descriptor. For example, if an
entity bean is added to a collection corresponding to the
container-managed relationship field of another entity bean, the
container-managed relationship field of the first entity bean must also
be updated by the container in the same transaction context.</p>
</div>
<div class="paragraph">
<p>It is the responsibility of the container to
throw the <em>java.lang.IllegalArgumentException</em>
 when the argument to a set method in a
relationship is an instance of the wrong relationship type or a
collection containing instances of the wrong type, or when an argument
to a method of the <em>java.util.Collection</em>
API used to manipulate a collection-valued container-managed
relationship field is an instance of the wrong type or a collection that
contains instances of the wrong type (see Section
<a href="Ejb.html#a496">See Semantics of Assignment for
Relationships</a>).</p>
</div>
<div class="paragraph">
<p>It is the responsibility of the container to
throw the <em>java.lang.IllegalStateException</em>
when a method of the <em>java.util.Collection</em> API is used to access a
collection-valued cmr-field within a transaction context other than the
transaction context in which the cmr-field was initially materialized.
For example, if the container-managed collection is returned as the
result of a local interface method with transaction attribute
<em>RequiresNew</em> , and the client attempts to access the collection, the
container must throw the <em>IllegalStateException</em> .</p>
</div>
<div class="paragraph">
<p>It is the responsibility of the container to
throw the <em>java.lang.IllegalStateException</em> when a <em>java.util.Iterator</em>
 is used to access a collection-valued
cmr-field within a transaction context other than the transaction
context in which the iterator was initially obtained.</p>
</div>
</div>
<div class="sect2">
<h3 id="_instance_life_cycle_contract_between_the_bean_and_the_container"><a class="anchor" href="#_instance_life_cycle_contract_between_the_bean_and_the_container"></a>4.34. Instance Life Cycle Contract Between the Bean and the Container</h3>
<div class="paragraph">
<p>This section
describes the part of the component contract between the entity bean and
the container that relates to the management of the entity bean
instance’s life cycle.</p>
</div>
</div>
<div class="sect2">
<h3 id="_instance_life_cycle"><a class="anchor" href="#_instance_life_cycle"></a>4.35. Instance Life Cycle</h3>
<div class="paragraph">
<p>===</p>
</div>
<div class="paragraph">
<p><a id="a1191"></a>Life Cycle of an Entity Bean Instance.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-34.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>An entity bean
instance is in one of the following three states:</p>
</div>
<div class="paragraph">
<p>It does not exist.</p>
</div>
<div class="paragraph">
<p>Pooled state. An instance in the pooled state
is not associated with any particular entity object identity.</p>
</div>
<div class="paragraph">
<p>Ready state. An instance in the ready state
is assigned an entity object identity.</p>
</div>
<div class="paragraph">
<p>The following
steps describe the life cycle of an entity bean instance:</p>
</div>
<div class="paragraph">
<p>An entity bean instance’s life starts when
the container creates the instance using newInstance. The container then
invokes the setEntityContext method to pass the instance a reference to
the EntityContext interface. The EntityContext interface allows the
instance to invoke services provided by the container and to obtain the
information about the caller of a client-invoked method.</p>
</div>
<div class="paragraph">
<p>The instance enters the pool of available
instances. Each entity bean has its own pool. While the instance is in
the available pool, the instance is not associated with any particular
entity object identity. All instances in the pool are considered
equivalent, and therefore any instance can be assigned by the container
to any entity object identity at the transition to the ready state.
While the instance is in the pooled state, the container may use the
instance to execute any of the entity bean’s finder methods (shown as
<em>ejbFind&lt;METHOD&gt;</em> in the diagram) or any of the entity bean’s home
methods (shown ejbHome&lt;METHOD&gt; in the diagram). The instance does <em>not</em>
move to the ready state during the execution of a finder or a home
method. An <em>ejbSelect&lt;METHOD&gt;</em> method may be called by an entity bean’s
home method while the instance is in the pooled state.</p>
</div>
<div class="paragraph">
<p>An instance transitions from the
pooled state to the
ready state when the container selects that
instance to service a client call to an entity object or an <em>ejbTimeout</em>
method. There are two possible transitions from the pooled to the ready
state: through the <em>ejbCreate&lt;METHOD&gt;</em> and <em>ejbPostCreate&lt;METHOD&gt;</em>
methods, or through the <em>ejbActivate</em> method. The container invokes the
<em>ejbCreate&lt;METHOD&gt;</em> and <em>ejbPostCreate&lt;METHOD&gt;</em> methods when the
instance is assigned to an entity object during entity object creation
(i.e., when the client invokes a create method on the entity bean’s home
object). The container invokes the <em>ejbActivate</em> method on an instance
when an instance needs to be activated to service an invocation on an
existing entity object—this occurs because there is no suitable instance
in the ready state to service the client’s call or the <em>ejbTimeout</em>
method.</p>
</div>
<div class="paragraph">
<p>When an entity bean instance is in the ready
state, the instance is associated with a specific entity object
identity. While the instance is in the ready state, the container can
synchronize the state of the instance with the state of the entity in
the underlying data source whenever it determines the need to, in the
process invoking the <em>ejbLoad</em> and <em>ejbStore</em> methods zero or more
times. A business method can be invoked on the instance zero or more
times. The <em>ejbTimeout</em> method can be invoked on the instance zero or
more times. Invocations of the <em>ejbLoad</em> and <em>ejbStore</em> methods can be
arbitrarily mixed with invocations of business methods and <em>ejbTimeout</em>
method invocations. An <em>ejbSelect&lt;METHOD&gt;</em> method can be called by a
business method (or <em>ejbLoad</em> or <em>ejbStore</em> method or <em>ejbTimeout</em>
method ) while the instance is in the ready state.</p>
</div>
<div class="paragraph">
<p>The container can choose to
passivate an entity bean instance within a
transaction. To passivate an instance, the container first invokes the
ejbStore method to allow the instance to prepare itself for the
synchronization of the database state with the instance’s state, and
then the container invokes the ejbPassivate
method to return the instance to the pooled state.</p>
</div>
<div class="paragraph">
<p>Eventually, the container will transition the
instance to the pooled state. There are
three possible transitions from the ready to the pooled state: through
the <em>ejbPassivate</em> method, through the <em>ejbRemove</em> method, and because
of a transaction rollback for <em>ejbCreate</em> , <em>ejbPostCreate</em> , or
<em>ejbRemove</em> (not shown in <a href="Ejb.html#a1191">See Life Cycle of
an Entity Bean Instance.</a>). The container invokes the <em>ejbPassivate</em>
method when the container wants to disassociate the instance from the
entity object identity without removing the entity object. The container
invokes the <em>ejbRemove</em> method when the container is removing the entity
object (i.e., when the client invoked the <em>remove</em> method on the entity
object’s component interface or a <em>remove</em> method on the entity bean’s
home interface). If <em>ejbCreate</em> , <em>ejbPostCreate</em> , or <em>ejbRemove</em> is
called and the transaction rolls back, the container will transition the
bean instance to the pooled state.</p>
</div>
<div class="paragraph">
<p>When the instance is put back into the pool,
it is no longer associated with an entity object identity. The container
can assign the instance to any entity object within the same entity bean
home.</p>
</div>
<div class="paragraph">
<p>The container can remove an instance in the
pool by calling the <em>unsetEntityContext</em>
method on the instance.</p>
</div>
<div class="paragraph">
<p>Notes:</p>
</div>
<div class="paragraph">
<p>The EntityContext
interface passed by the container to the instance in the
setEntityContext method is an interface, not a class that contains
static information. For example, the result of the
EntityContext.getPrimaryKey method might be different each time an
instance moves from the pooled state to the ready state, and the result
of the getCallerPrincipal and isCallerInRole methods may be different in
each business method.</p>
</div>
<div class="paragraph">
<p>A RuntimeException thrown from any method of
an entity bean class (including the business methods and the callbacks
invoked by the container) results in the transition to the “does not
exist” state. The container must not invoke any method on the instance
after a RuntimeException has been caught. From the caller’s perspective,
the corresponding entity object continues to exist. The client can
continue accessing the entity object through its component interface
because the container can use a different entity bean instance to
delegate the client’s requests. Exception handling is described further
in Chapter <a href="Ejb.html#a3210">See Exception Handling</a>.</p>
</div>
<div class="paragraph">
<p>The container is not required to maintain a
pool of instances in the pooled state. The
pooling approach is an example of a possible implementation, but it is
not the required implementation. Whether the container uses a pool or
not has no bearing on the entity bean coding
style.</p>
</div>
</div>
<div class="sect2">
<h3 id="_bean_providers_entity_bean_instances_view"><a class="anchor" href="#_bean_providers_entity_bean_instances_view"></a>4.36. Bean Provider’s Entity Bean Instance’s View</h3>
<div class="paragraph">
<p>The following describes the entity bean
instance’s view of the contract as seen by the Bean Provider:</p>
</div>
<div class="paragraph">
<p>The entity Bean
Provider is responsible for implementing the following methods in the
abstract entity bean class:</p>
</div>
<div class="paragraph">
<p>A public
constructor that takes no arguments.</p>
</div>
<div class="literalblock">
<div class="content">
<pre> _public void setEntityContext(EntityContext
ic)_ ;</pre>
</div>
</div>
<div class="paragraph">
<p>A container uses
this method to pass a reference to the EntityContext interface to the
entity bean instance. If the entity bean instance needs to use the
EntityContext interface during its lifetime, it must remember the
EntityContext interface in an instance variable.</p>
</div>
<div class="paragraph">
<p>This method executes with an unspecified
transaction context (Refer to EJB Core Contracts and Requirements
document <a href="Ejb.html#a3339">See EJB 3.2 Core Contracts and</a> Subsection “Handling
of Methods that Run with an unspecified transaction context” for how the
container executes methods with an unspecified transaction context). An
identity of an entity object is not available during this method. The
entity bean must not attempt to access its persistent state and
relationships using the accessor methods during this method.</p>
</div>
<div class="paragraph">
<p>The instance can take advantage of the
setEntityContext() method to allocate any resources that are to be held
by the instance for its lifetime. Such resources cannot be specific to
an entity object identity because the instance might be reused during
its lifetime to serve multiple entity object identities.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_public void unsetEntityContext();_</pre>
</div>
</div>
<div class="paragraph">
<p>A container
invokes this method before terminating the life of the instance.</p>
</div>
<div class="paragraph">
<p>This method executes with an unspecified
transaction context. An identity of an entity object is not available
during this method. The entity bean must not attempt to access its
persistent state and relationships using the accessor methods during
this method.</p>
</div>
<div class="paragraph">
<p>The instance can take advantage of the
<em>unsetEntityContext</em> method to free any resources that are held by the
instance. (These resources typically had been allocated by the
setEntityContext method.)</p>
</div>
<div class="literalblock">
<div class="content">
<pre> _public PrimaryKeyClass
ejbCreate&lt;METHOD&gt;(...)_ ;</pre>
</div>
</div>
<div class="paragraph">
<p>There are
zero<a href="#a3370">6</a> or more ejbCreate&lt;METHOD&gt; methods, whose
signatures match the signatures of the create&lt;METHOD&gt; methods of the
entity bean’s home interface. The container invokes an
<em>ejbCreate&lt;METHOD&gt;</em> method on an entity bean instance when a client
invokes a matching create&lt;METHOD&gt; method on the entity bean’s home
interface.</p>
</div>
<div class="paragraph">
<p>The entity Bean Provider’s responsibility is
to initialize the instance in the ejbCreate&lt;METHOD&gt; methods from the
input arguments, using the get and set accessor methods, such that when
the <em>ejbCreate&lt;METHOD&gt;</em> method returns, the persistent representation of
the instance can be created. The entity Bean Provider is guaranteed that
the values that will be initially returned by the instance’s get methods
for container-managed fields will be the Java language defaults (e.g. 0
for integer, null for pointers), except for collection-valued
cmr-fields, which will have the empty collection (or set) as their
value. The entity Bean Provider must not attempt to modify the values of
cmr-fields in an <em>ejbCreate&lt;METHOD&gt;</em> method. This should be done in the
<em>ejbPostCreate&lt;METHOD&gt;</em> method instead.</p>
</div>
<div class="paragraph">
<p>The entity object created by the
<em>ejbCreate&lt;METHOD&gt;</em> method must have a unique primary key. This means
that the primary key must be different from the primary keys of all the
existing entity objects within the same home. However, it is legal to
reuse the primary key of a previously removed entity object. The
implementation of the Bean Provider’s <em>ejbCreate&lt;METHOD&gt;</em> methods should
be coded to return a null.<a href="#a3371">7</a></p>
</div>
<div class="paragraph">
<p>An <em>ejbCreate&lt;METHOD&gt;</em> method executes in the
transaction context determined by the transaction attribute of the
matching create&lt;METHOD&gt; method. The database insert operations are
performed by the container within the same transaction context after the
Bean Provider’s ejbCreate&lt;METHOD&gt; method completes.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_public void ejbPostCreate&lt;METHOD&gt;(...);_</pre>
</div>
</div>
<div class="paragraph">
<p>For each
ejbCreate&lt;METHOD&gt; method, there is a matching ejbPostCreate&lt;METHOD&gt;
method that has the same input parameters but whose return type is
<em>void</em> . The container invokes the matching ejbPostCreate&lt;METHOD&gt; method
on an instance after it invokes the ejbCreate&lt;METHOD&gt; method with the
same arguments. The instance can discover the primary key by calling
<em>getPrimaryKey</em> on its entity context object.</p>
</div>
<div class="paragraph">
<p>The entity object identity is available
during the ejbPostCreate&lt;METHOD&gt; method. The instance may, for example,
obtain the component interface of the associated entity object and pass
it to another enterprise bean as a method argument.</p>
</div>
<div class="paragraph">
<p>The entity Bean Provider may use the
<em>ejbPostCreate&lt;METHOD&gt;</em> to set the values of cmr-fields to complete the
initialization of the entity bean instance.</p>
</div>
<div class="paragraph">
<p>An <em>ejbPostCreate&lt;METHOD&gt;</em> method executes in
the same transaction context as the previous ejbCreate&lt;METHOD&gt; method.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_public void ejbActivate();_</pre>
</div>
</div>
<div class="paragraph">
<p>The container
invokes this method on the instance when the container picks the
instance from the pool and assigns it to a specific entity object
identity. The ejbActivate method gives the entity bean instance the
chance to acquire additional resources that it needs while it is in the
ready state.</p>
</div>
<div class="paragraph">
<p>This method executes with an unspecified
transaction context. The entity bean must not attempt to access its
persistent state or relationships using the accessor methods during this
method.</p>
</div>
<div class="paragraph">
<p>The instance can obtain the identity of the
entity object via the getPrimaryKey, <em>getEJBLocalObject</em> , or
getEJBObject method on the entity context. The instance can rely on the
fact that the primary key and entity object identity will remain
associated with the instance until the completion of ejbPassivate or
ejbRemove.</p>
</div>
<div class="literalblock">
<div class="content">
<pre> _public void ejbPassivate()_ ; +
The container invokes this method on an
instance when the container decides to disassociate the instance from an
entity object identity, and to put the instance back into the pool of
available instances. The _ejbPassivate_ method gives the instance the
chance to release any resources that should not be held while the
instance is in the pool. (These resources typically had been allocated
during the _ejbActivate_ method.)</pre>
</div>
</div>
<div class="paragraph">
<p>This method executes with an unspecified
transaction context. The entity bean must not attempt to access its
persistent state or relationships using the accessor methods during this
method.</p>
</div>
<div class="paragraph">
<p>The instance can still obtain the identity of
the entity object via the getPrimaryKey, <em>getEJBLocalObject</em> , or
getEJBObject method of the EntityContext interface.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_public void ejbRemove()_ ;</pre>
</div>
</div>
<div class="paragraph">
<p>The container
invokes the ejbRemove method on an entity bean instance in response to a
client-invoked remove operation on the entity bean’s home or component
interface or as the result of a cascade-delete operation. The instance
is in the ready state when ejbRemove is invoked and it will be entered
into the pool when the method completes.</p>
</div>
<div class="paragraph">
<p>The entity Bean Provider can use the
ejbRemove method to implement any actions that must be done before the
entity object’s persistent representation is removed.</p>
</div>
<div class="paragraph">
<p>The container synchronizes the instance’s
state before it invokes the ejbRemove method. This means that the state
of the instance at the beginning of the ejbRemove method is the same as
it would be at the beginning of a business method.</p>
</div>
<div class="paragraph">
<p>This method and the database delete
operation(s) execute in the transaction context determined by the
transaction attribute of the remove method that triggered the
<em>ejbRemove</em> method. The instance can still obtain the identity of the
entity object via the getPrimaryKey, getEJBLocalObject, or getEJBObject
method of the EntityContext interface.</p>
</div>
<div class="paragraph">
<p>After the entity Bean Provider’s ejbRemove
returns, and in the same transaction context, the container removes the
entity bean from all relationships in which it participates before
removing the entity object’s persistent representation.</p>
</div>
<div class="paragraph">
<p>Since the instance will be entered into the
pool, the state of the instance at the end of this method must be
equivalent to the state of a passivated instance. This means that the
instance must release any resource that it would normally release in the
ejbPassivate method.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_public void ejbLoad()_ ;</pre>
</div>
</div>
<div class="paragraph">
<p>When the
container needs to synchronize the state of an enterprise bean instance
with the entity object’s persistent state, the container calls the
<em>ejbLoad</em> method.</p>
</div>
<div class="paragraph">
<p>The entity Bean Provider can assume that the
instance’s persistent state has been loaded just before the ejbLoad
method is invoked. It is the responsibility of the Bean Provider to use
the <em>ejbLoad</em> method to recompute or initialize the values of any
instance variables that depend on the entity bean’s persistent state. In
general, any transient state that depends on the persistent state of an
entity bean should be recalculated using the ejbLoad method. The entity
bean can use the ejbLoad method, for instance, to perform some
computation on the values returned by the accessor methods (for example,
uncompressing text fields).</p>
</div>
<div class="paragraph">
<p>This method executes in the transaction
context determined by the transaction attribute of the business method
or <em>ejbTimeout</em> method that triggered the ejbLoad method.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_public void ejbStore();_</pre>
</div>
</div>
<div class="paragraph">
<p>When the
container needs to synchronize the state of the entity object’s
persistent state with the state of the enterprise bean instance, the
container first calls the ejbStore method on the instance.</p>
</div>
<div class="paragraph">
<p>The entity Bean Provider should use the
ejbStore method to update the instance using the accessor methods before
its persistent state is synchronized. For example, the ejbStore method
may perform compression of text before the text is stored in the
database.</p>
</div>
<div class="paragraph">
<p>The Bean Provider can assume that after the
<em>ejbStore</em> method returns, the persistent state of the instance is
synchronized.</p>
</div>
<div class="paragraph">
<p>This method executes in the same transaction
context as the previous ejbLoad or ejbCreate method invoked on the
instance. All business methods or the <em>ejbTimeout</em> method invoked
between the previous ejbLoad or ejbCreate <em>&lt;METHOD&gt;</em> method and this
ejbStore method are also invoked in the same transaction context.</p>
</div>
<div class="paragraph">
<p>public &lt;primary key type or collection&gt;
ejbFind&lt;METHOD&gt;(&#8230;&#8203;);</p>
</div>
<div class="paragraph">
<p>The Bean Provider
of an entity bean with container-managed persistence does not write the
finder (ejbFind&lt;METHOD&gt;) methods.</p>
</div>
<div class="paragraph">
<p>The finder methods are generated at the
entity bean deployment time using the Container Provider’s tools. The
syntax for the Bean Provider’s specification of finder methods is
described in the <a href="Ejb.html#a1840">See EJB QL: EJB 2.1 Query
Language for Container-Managed Persistence Query Methods</a>.</p>
</div>
<div class="paragraph">
<p>public &lt;type&gt; ejbHome&lt;METHOD&gt;(&#8230;&#8203;);</p>
</div>
<div class="paragraph">
<p>The container
invokes this method on the instance when the container selects the
instance to execute a matching client-invoked &lt;METHOD&gt; home method. The
instance is in the pooled state (i.e., it is not assigned to any
particular entity object identity) when the container selects the
instance to execute the ejbHome&lt;METHOD&gt; method on it, and it is returned
to the pooled state when the execution of the ejbHome&lt;METHOD&gt; method
completes.</p>
</div>
<div class="paragraph">
<p>The ejbHome&lt;METHOD&gt; method executes in the
transaction context determined by the transaction attribute of the
matching &lt;METHOD&gt; home method, as described in EJB Core Contracts and
Requirements document <a href="Ejb.html#a3339">See EJB 3.2 Core</a>
Subsection “Container-Managed Transaction Demarcation for Business
Methods”.</p>
</div>
<div class="paragraph">
<p>The entity Bean Provider provides the
implementation of the ejbHome&lt;METHOD&gt; method. The entity bean must not
attempt to access its persistent state or relationships using the
accessor methods during this method because a home method is not
specific to a particular bean instance.</p>
</div>
<div class="paragraph">
<p>public abstract &lt;type&gt; <em>e</em>
jbSelect&lt;METHOD&gt;(&#8230;&#8203;);</p>
</div>
<div class="paragraph">
<p>The Bean Provider
may provide zero or more select methods. A select method is a query
method that is not directly exposed to the client in the home or
component interface. The Bean Provider typically calls a select method
within a business method.</p>
</div>
<div class="paragraph">
<p>The Bean Provider defines the select methods
as <em>abstract</em> methods.</p>
</div>
<div class="paragraph">
<p>The select methods are generated at the
entity bean deployment time using the Container Provider’s tools.</p>
</div>
<div class="paragraph">
<p>The syntax for the specification of select
methods is described in <a href="Ejb.html#a1840">See EJB QL: EJB 2.1
Query Language for Container-Managed Persistence Query Methods</a>.</p>
</div>
<div class="paragraph">
<p>The ejbSelect&lt;METHOD&gt; method executes in the
transaction context determined by the transaction attribute of the
invoking business method.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_public void ejbTimeout(...);_</pre>
</div>
</div>
<div class="paragraph">
<p>The container invokes the <em>ejbTimeout</em> method
on an instance when a timer for the instance has expired. The
<em>ejbTimeout</em> method notifies the instance of the time-based event and
allows the instance to execute the business logic to handle it.</p>
</div>
<div class="paragraph">
<p>The <em>ejbTimeout</em> method executes in the
transaction context determined by its transaction attribute.</p>
</div>
</div>
<div class="sect2">
<h3 id="_containers_view"><a class="anchor" href="#_containers_view"></a>4.37. <a id="a1279"></a>Container’s View</h3>
<div class="paragraph">
<p>This subsection
describes the container’s view of the state management contract. The
container must call the following methods:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_public void setEntityContext(ec)_ ;</pre>
</div>
</div>
<div class="paragraph">
<p>The container
invokes this method to pass a reference to the EntityContext interface
to the entity bean instance. The container must invoke this method after
it creates the instance, and before it puts the instance into the pool
of available instances.</p>
</div>
<div class="paragraph">
<p>The container invokes this method with an
unspecified transaction context. At this point, the EntityContext is not
associated with any entity object identity.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_public void unsetEntityContext()_ ;</pre>
</div>
</div>
<div class="paragraph">
<p>The container
invokes this method when the container wants to reduce the number of
instances in the pool. After this method completes, the container must
not reuse this instance.</p>
</div>
<div class="paragraph">
<p>The container invokes this method with an
unspecified transaction context.</p>
</div>
<div class="literalblock">
<div class="content">
<pre> _public_ _PrimaryKeyClass_
_ejbCreate&lt;METHOD&gt;(...)_ ; +
_public void ejbPostCreate&lt;METHOD&gt;(...)_ ;</pre>
</div>
</div>
<div class="paragraph">
<p>The container
invokes these two methods during the creation of an entity object as a
result of a client invoking a create&lt;METHOD&gt; method on the entity bean’s
home interface.</p>
</div>
<div class="paragraph">
<p>The container invokes the ejbCreate&lt;METHOD&gt;
method whose signature matches the create&lt;METHOD&gt; method invoked by the
client.</p>
</div>
<div class="paragraph">
<p>Prior to invoking the ejbCreate&lt;METHOD&gt;
method provided by the Bean Provider, the container must ensure that the
values that will be initially returned by the instance’s get methods for
container-managed fields will be the Java language defaults (e.g. 0 for
integer, null for pointers), except for collection-valued cmr-fields,
which must have the empty collection (or set) as their value.</p>
</div>
<div class="paragraph">
<p>The container is responsible for calling the
<em>ejbCreate&lt;METHOD&gt;</em> method, for obtaining the primary key fields of the
newly created entity object persistent representation, and for creating
an entity EJBObject reference and/or EJBLocalObject reference for the
newly created entity object. The container must establish the primary
key before it invokes the ejbPostCreate&lt;METHOD&gt; method.</p>
</div>
<div class="paragraph">
<p>The entity object created by the
<em>ejbCreate&lt;METHOD&gt;</em> method must have a unique primary key. This means
that the primary key must be different from the primary keys of all the
existing entity objects within the same home. However, it is legal to
reuse the primary key of a previously removed entity object. The
container may, but is not required to, throw the <em>DuplicateKeyException</em>
on the Bean Provider’s attempt to create an entity object with a
duplicate primary key<a href="#a3372">8</a>.</p>
</div>
<div class="paragraph">
<p>The container may create the representation
of the entity in the database immediately, or it can defer it to a later
time (for example to the time after the matching ejbPostCreate&lt;METHOD&gt;
has been called, or to the end of the transaction), depending on the
caching strategy that it uses.</p>
</div>
<div class="paragraph">
<p>The container then invokes the matching
ejbPostCreate&lt;METHOD&gt; method with the same arguments on the instance to
allow the instance to fully initialize itself. The instance can discover
the primary key by calling the getPrimaryKey method on its entity
context object.</p>
</div>
<div class="paragraph">
<p>Finally, the container returns the entity
object’s remote interface (i.e., a reference to the entity EJBObject) to
the client if the client is a remote client or the entity object’s local
interface (i.e., a reference to the entity EJBLocalObject) if the client
is a local client.</p>
</div>
<div class="paragraph">
<p>The container must invoke the ejbCreate
<em>&lt;METHOD&gt;</em> and ejbPostCreate <em>&lt;METHOD&gt;</em> methods and create the
representation of the persistent instance in the database in the
transaction context determined by the transaction attribute of the
matching create&lt;METHOD&gt; method, as described in EJB Core Contracts and
Requirements document <a href="Ejb.html#a3339">See EJB 3.2 Core</a>
Subsection “Container-Managed Transaction Demarcation for Business
Methods”.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_public void ejbActivate()_ ;</pre>
</div>
</div>
<div class="paragraph">
<p>The container
invokes this method on an entity bean instance at activation time (i.e.,
when the instance is taken from the pool and assigned to an entity
object identity). The container must ensure that the primary key of the
associated entity object is available to the instance if the instance
invokes the getPrimaryKey, <em>getEJBLocalObject</em> , or getEJBObject method
on its EntityContext interface.</p>
</div>
<div class="paragraph">
<p>The container invokes this method with an
unspecified transaction context.</p>
</div>
<div class="paragraph">
<p>Note that instance is not yet ready for the
delivery of a business method. The container must still invoke the
ejbLoad method prior to a business method.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_public void ejbPassivate()_ ;</pre>
</div>
</div>
<div class="paragraph">
<p>The container
invokes this method on an entity bean instance at passivation time
(i.e., when the instance is being disassociated from an entity object
identity and moved into the pool). The container must ensure that the
identity of the associated entity object is still available to the
instance if the instance invokes the getPrimaryKey, <em>getEJBLocalObject</em>
, or getEJBObject method on its entity context.</p>
</div>
<div class="paragraph">
<p>The container invokes this method with an
unspecified transaction context.</p>
</div>
<div class="paragraph">
<p>Note that if the instance state has been
updated by a transaction, the container must first invoke the ejbStore
method on the instance before it invokes ejbPassivate on it.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_public void ejbRemove();_</pre>
</div>
</div>
<div class="paragraph">
<p>The container
invokes the ejbRemove method in response to a client-invoked remove
operation on the entity bean’s home or component interface or as the
result of a cascade-delete operation. The instance is in the ready state
when <em>ejbRemove</em> is invoked and it will be entered into the pool when
the method completes.</p>
</div>
<div class="paragraph">
<p>The container synchronizes the instance’s
state before it invokes the ejbRemove method. This means that the
persistent state of the instance at the beginning of the ejbRemove
method is the same as it would be at the beginning of a business method
(i.e., if the instance is not already synchronized from the state in the
database, the container must invoke <em>ejbLoad</em> before it invokes
<em>ejbRemove</em> ).</p>
</div>
<div class="paragraph">
<p>The container must ensure that the identity
of the associated entity object is still available to the instance in
the <em>ejbRemove</em> method (i.e., the instance can invoke the getPrimaryKey,
<em>getEJBLocalObject</em> , or getEJBObject method on its EntityContext in the
<em>ejbRemove</em> method).</p>
</div>
<div class="paragraph">
<p>After the entity Bean Provider’s ejbRemove
method returns, and in the same transaction context, the container
removes the entity bean instance from all relationships in which it
participates and then removes the entity object’s persistent
representation.</p>
</div>
<div class="paragraph">
<p>The container may delete the representation
of the entity in the database immediately, or it can defer it to a later
time (for example to the end of the transaction), depending on the
caching strategy that it uses.</p>
</div>
<div class="paragraph">
<p>The container must ensure that the ejbRemove
method and database delete operations are performed in the transaction
context determined by the transaction attribute of the invoked remove
method, as described in EJB Core Contracts and Requirements document
<a href="Ejb.html#a3339">See EJB 3.2 Core Contracts and Requirements.</a> Subsection “Container-Managed
Transaction Demarcation for Business Methods”.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_public void ejbLoad()_ ;</pre>
</div>
</div>
<div class="paragraph">
<p>When the
container needs to synchronize the state of an enterprise bean instance
with the entity object’s state in the database, the container calls the
<em>ejbLoad</em> method. Depending on its caching strategy, the container may
first read the entity object’s state from the database, before invoking
the <em>ejbLoad</em> method, or it may use a lazy loading strategy in making
this state visible to the instance.</p>
</div>
<div class="paragraph">
<p>The exact times that the container invokes
<em>ejbLoad</em> depend on the configuration of the component and the
container, and are not defined by the EJB architecture. Typically, the
container will call <em>ejbLoad</em> before the first business method within a
transaction or before invoking the <em>ejbTimeout</em> method on an instance.</p>
</div>
<div class="paragraph">
<p>The container must invoke this method in the
transaction context determined by the transaction attribute of the
business method or <em>ejbTimeout</em> method that triggered the ejbLoad
method.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_public void ejbStore()_ ;</pre>
</div>
</div>
<div class="paragraph">
<p>When the
container needs to synchronize the state of the entity object in the
database with the state of the enterprise bean instance, the container
calls the ejbStore method on the instance. This synchronization always
happens at the end of a transaction, unless the bean is specified as
read-only (see section <a href="Ejb.html#a1342">See Read-only Entity
Beans</a>). However, the container may also invoke this method when it
passivates the instance in the middle of a transaction, or when it needs
to transfer the most recent state of the entity object to another
instance for the same entity object in the same transaction.</p>
</div>
<div class="paragraph">
<p>The container must invoke this method in the
same transaction context as the previous ejbLoad, ejbCreate <em>&lt;METHOD&gt;</em> ,
or <em>ejbTimeout</em> method invoked on the instance. All business methods or
the <em>ejbTimeout</em> method invoked between the previous ejbLoad or
ejbCreate <em>&lt;METHOD&gt;</em> method and this ejbStore method are also invoked in
the same transaction context.</p>
</div>
<div class="paragraph">
<p>After the <em>ejbStore</em> method returns, the
container may store the persistent state of the instance to the
database, depending on its caching strategy. If the container uses a
lazy storing caching strategy, it is the container’s responsibility to
write the representation of the persistent object to the database in the
same transaction context as that of the <em>ejbStore</em> method.</p>
</div>
<div class="paragraph">
<p>public &lt;primary key type or collection&gt;
ejbFind&lt;METHOD&gt;(&#8230;&#8203;);</p>
</div>
<div class="paragraph">
<p>The implementation of the <em>ejbFind&lt;METHOD&gt;</em>
 method is supplied by the container.</p>
</div>
<div class="paragraph">
<p>The container invokes the ejbFind&lt;METHOD&gt;
method on an instance when a client invokes a matching find&lt;METHOD&gt;
method on the entity bean’s home interface. The container must pick an
instance that is in the pooled state (i.e., the instance is not
associated with any entity object identity) for the execution of the
ejbFind&lt;METHOD&gt; method. If there is no instance in the pooled state, the
container creates one and calls the setEntityContext method on the
instance before dispatching the finder method.</p>
</div>
<div class="paragraph">
<p>The container must invoke the ejbFind&lt;METHOD&gt;
method in the transaction context determined by the transaction
attribute of the matching find method, as described in EJB Core
Contracts and Requirements document <a href="Ejb.html#a3339">See EJB</a> Subsection “Container-Managed
Transaction Demarcation for Business Methods”.</p>
</div>
<div class="paragraph">
<p>The container is responsible for ensuring
that updates to the states of all entity beans in the same transaction
context as the <em>ejbFind&lt;METHOD&gt;</em> method and whose abstract schema types
are accessed in the method’s EJB QL query are visible in the results of
the <em>ejbFind&lt;METHOD&gt;</em> method. Before invoking the <em>ejbFind&lt;METHOD&gt;</em>
method, the container must first synchronize the state of those entity
bean instances by invoking the <em>ejbStore</em> method on them. This
requirement does not apply to the <em>ejbFindByPrimaryKey</em> method. The
results of the <em>ejbFindByPrimaryKey</em> method, however, must reflect the
entities that have been created or removed within the same transaction
context.</p>
</div>
<div class="paragraph">
<p>After the ejbFind&lt;METHOD&gt; method completes,
the instance remains in the pooled state. The container may, but is not
required to, immediately activate the objects that were located by the
finder using the transition through the ejbActivate method.</p>
</div>
<div class="paragraph">
<p>If the ejbFind&lt;METHOD&gt; method is declared to
return a single primary key, the container creates an entity EJBObject
(EJBLocalObject) reference for the primary key and returns it to the
client (local client). If the ejbFind&lt;METHOD&gt; method is declared to
return a collection of primary keys, the container creates a collection
of entity EJBObject (EJBLocalObject) references for the primary keys
returned from the ejbFind&lt;METHOD&gt; method, and returns the collection to
the client (local client).</p>
</div>
<div class="paragraph">
<p>The implementations of the finder methods are
generated at the entity bean deployment time using the Container
Provider’s tools.</p>
</div>
<div class="paragraph">
<p>public <em> &lt;type&gt; </em> ejbSelect&lt;METHOD&gt;(&#8230;&#8203;);</p>
</div>
<div class="paragraph">
<p>A select method
is a query method that is not directly exposed to the client in the home
or component interface. The Bean Provider typically calls a select
method within a business method or home method.</p>
</div>
<div class="paragraph">
<p>A select method executes in the transaction
context determined by the transaction attribute of the invoking business
method.</p>
</div>
<div class="paragraph">
<p>The container is responsible for ensuring
that all updates to the states of all entity beans in the same
transaction context as the <em>ejbSelect&lt;METHOD&gt;</em> method and whose abstract
schema types are accessed in the EJB QL query for the
<em>ejbSelect&lt;METHOD&gt;</em> method are visible in the results of the
<em>ejbSelect&lt;METHOD&gt; method</em> by invoking the <em>ejbStore</em> method on those
entity bean instances.</p>
</div>
<div class="paragraph">
<p>The implementations of the select methods are
generated at the entity bean deployment time using the Container
Provider’s tools.</p>
</div>
<div class="paragraph">
<p>public &lt;type&gt; ejbHome&lt;METHOD&gt;(&#8230;&#8203;);</p>
</div>
<div class="paragraph">
<p>The container
invokes the ejbHome&lt;METHOD&gt; method on an instance when a client invokes
a matching &lt;METHOD&gt; home method on the entity bean’s home interface. The
container must pick an instance that is in the pooled state (i.e., the
instance is not associated with any entity object identity) for the
execution of the ejbHome&lt;METHOD&gt; method. If there is no instance in the
pooled state, the container creates one and calls the setEntityContext
method on the instance before dispatching the home method.</p>
</div>
<div class="paragraph">
<p>After the ejbHome&lt;METHOD&gt; method completes,
the instance remains in the pooled state.</p>
</div>
<div class="paragraph">
<p>The container must invoke the ejbHome&lt;METHOD&gt;
method in the transaction context determined by the transaction
attribute of the matching &lt;METHOD&gt; home method, as described in EJB Core
Contracts and Requirements document <a href="Ejb.html#a3339">See EJB</a> Subsection “Container-Managed
Transaction Demarcation for Business Methods”.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_public void ejbTimeout(...);_</pre>
</div>
</div>
<div class="paragraph">
<p>The container invokes the <em>ejbTimeout</em> method
on the instance when a timer with which the entity has been registered
expires. If there is no suitable instance in the ready state, the
container must activate an instance, invoking the <em>ejbActivate</em> method
and transitioning it to the ready state.</p>
</div>
<div class="paragraph">
<p>The container invokes the <em>ejbTimeout</em> method
in the context of a transaction determined by its transaction attribute.</p>
</div>
</div>
<div class="sect2">
<h3 id="_read_only_entity_beans"><a class="anchor" href="#_read_only_entity_beans"></a>4.38. <a id="a1342"></a>Read-only Entity Beans</h3>
<div class="paragraph">
<p>Compliant implementations of this
specification may optionally support read-only entity beans. A read-only
entity bean is an entity bean whose instances are not intended to be
updated and/or created by the application. Read-only beans are best
suited for situations where the underlying data never changes or changes
infrequently.</p>
</div>
<div class="paragraph">
<p>Containers that support read-only
beans do not call the <em>ejbStore</em> method on them. The <em>ejbLoad</em> method
should typically be called by the container when the state of the bean
instance is initially loaded from the database, or at designated refresh
intervals.<a href="#a3373">9</a></p>
</div>
<div class="paragraph">
<p>If a read-only bean is used, the state
of such a bean should not be updated by the application, and the
behavior is unspecified if this occurs.<a href="#a3374">10</a></p>
</div>
<div class="paragraph">
<p>Read-only beans are designated by
vendor-specific means that are outside the scope of this specification,
and their use is therefore not portable.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_entitycontext_interface"><a class="anchor" href="#_the_entitycontext_interface"></a>4.39. The EntityContext Interface</h3>
<div class="paragraph">
<p>A container
provides the entity bean instances with an <em>EntityContext</em> , which gives
the entity bean instance access to the instance’s context maintained by
the container. The <em>EntityContext</em> interface has the following methods:</p>
</div>
<div class="paragraph">
<p>The <em>getEJBObject</em> method returns the entity
bean’s remote interface.</p>
</div>
<div class="paragraph">
<p>The <em>getEJBHome</em> method returns the entity
bean’s remote home interface.</p>
</div>
<div class="paragraph">
<p>The <em>getEJBLocalObject</em> method returns the
entity bean’s local interface.</p>
</div>
<div class="paragraph">
<p>The <em>getEJBLocalHome</em> method returns the
entity bean’s local home interface.</p>
</div>
<div class="paragraph">
<p>The <em>getCallerPrincipal</em> method returns the
<em>java.security.Principal</em> that identifies the invoker.</p>
</div>
<div class="paragraph">
<p>The <em>isCallerInRole</em> method tests if the
entity bean instance’s caller has a particular role.</p>
</div>
<div class="paragraph">
<p>The <em>setRollbackOnly</em> method allows the
instance to mark the current transaction such that the only outcome of
the transaction is a rollback.</p>
</div>
<div class="paragraph">
<p>The <em>getRollbackOnly</em> method allows the
instance to test if the current transaction has been marked for
rollback.</p>
</div>
<div class="paragraph">
<p>The <em>getPrimaryKey</em> method returns the entity
bean’s primary key.</p>
</div>
<div class="paragraph">
<p>The <em>getTimerService</em> method returns the
<em>javax.ejb.TimerService</em> interface.</p>
</div>
<div class="paragraph">
<p>The <em>getUserTransaction</em> method returns the
<em>javax.transaction.UserTransaction</em> interface. Entity bean instances
must not call this method.</p>
</div>
<div class="paragraph">
<p>The <em>lookup</em> method enables the entity bean
to look up its environment entries in the JNDI naming context.</p>
</div>
</div>
<div class="sect2">
<h3 id="_operations_allowed_in_the_methods_of_the_entity_bean_class"><a class="anchor" href="#_operations_allowed_in_the_methods_of_the_entity_bean_class"></a>4.40. Operations Allowed in the Methods of the Entity Bean Class</h3>
<div class="paragraph">
<p>Table
<a href="Ejb.html#a1367">See Operations Allowed in the Methods of an
Entity Bean</a> defines the methods of an entity bean class in which the
enterprise bean instances can access the methods of the
javax.ejb.EntityContext interface, the java:comp/env environment naming
context, resource managers, <em>TimerService</em> and <em>Timer</em> methods, the
<em>EntityManager</em> and <em>EntityManagerFactory</em> methods, and other enterprise
beans.</p>
</div>
<div class="paragraph">
<p>If an entity bean instance attempts to invoke
a method of the EntityContext interface, and the access is not allowed
in Table <a href="Ejb.html#a1367">See Operations Allowed in the
Methods of an Entity Bean</a>, the container must throw the
java.lang.IllegalStateException.</p>
</div>
<div class="paragraph">
<p>If a entity bean instance attempts to invoke
a method of the <em>TimerService</em> or <em>Timer</em> interface and the access is
not allowed in Table <a href="Ejb.html#a1367">See Operations Allowed
in the Methods of an Entity Bean</a>, the container must throw the
java.lang.IllegalStateException.</p>
</div>
<div class="paragraph">
<p>If an entity bean instance attempts to access
a resource manager, an enterprise bean, an entity manager or entity
manager factory, and the access is not allowed in Table
<a href="Ejb.html#a1367">See Operations Allowed in the Methods of an
Entity Bean</a>, the behavior is undefined by the EJB architecture.</p>
</div>
<div class="paragraph">
<p>===</p>
</div>
<div class="paragraph">
<p><a id="a1367"></a>Operations Allowed in the Methods of an Entity
Bean</p>
</div>
<div class="paragraph">
<p>Bean method</p>
</div>
<div class="paragraph">
<p>Bean method can perform the following
operations</p>
</div>
<div class="paragraph">
<p>constructor</p>
</div>
<div class="paragraph">
<p>-</p>
</div>
<div class="paragraph">
<p>setEntityContext</p>
</div>
<div class="paragraph">
<p>unsetEntityContext</p>
</div>
<div class="paragraph">
<p>EntityContext methods: getEJBHome,
getEJBLocalHome, lookup</p>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env</p>
</div>
<div class="paragraph">
<p>ejbCreate</p>
</div>
<div class="paragraph">
<p>EntityContext methods: getEJBHome,
getEJBLocalHome, getCallerPrincipal, getRollbackOnly, isCallerInRole,
setRollbackOnly, getTimerService, lookup</p>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env</p>
</div>
<div class="paragraph">
<p>Resource manager access</p>
</div>
<div class="paragraph">
<p>Enterprise bean access</p>
</div>
<div class="paragraph">
<p>EntityManagerFactory access</p>
</div>
<div class="paragraph">
<p>EntityManager access</p>
</div>
<div class="paragraph">
<p>ejbPostCreate</p>
</div>
<div class="paragraph">
<p>EntityContext methods: getEJBHome,
getEJBLocalHome, getCallerPrincipal, getRollbackOnly, isCallerInRole,
setRollbackOnly, getEJBObject <em>, getEJBLocalObject,</em> getPrimaryKey,
getTimerService, lookup</p>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env</p>
</div>
<div class="paragraph">
<p>Resource manager access</p>
</div>
<div class="paragraph">
<p>Enterprise bean access</p>
</div>
<div class="paragraph">
<p>Timer service or Timer methods</p>
</div>
<div class="paragraph">
<p>EntityManagerFactory access</p>
</div>
<div class="paragraph">
<p>EntityManager access</p>
</div>
<div class="paragraph">
<p>ejbRemove</p>
</div>
<div class="paragraph">
<p>EntityContext methods: getEJBHome,
getEJBLocalHome, getCallerPrincipal, getRollbackOnly, isCallerInRole,
setRollbackOnly, getEJBObject <em>, getEJBLocalObject</em> , getPrimaryKey,
getTimerService, lookup</p>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env</p>
</div>
<div class="paragraph">
<p>Resource manager access</p>
</div>
<div class="paragraph">
<p>Enterprise bean access</p>
</div>
<div class="paragraph">
<p>Timer service or Timer methods</p>
</div>
<div class="paragraph">
<p>EntityManagerFactory access</p>
</div>
<div class="paragraph">
<p>EntityManager access</p>
</div>
<div class="paragraph">
<p>ejbHome</p>
</div>
<div class="paragraph">
<p>EntityContext methods: getEJBHome,
getEJBLocalHome, getCallerPrincipal, getRollbackOnly, isCallerInRole,
setRollbackOnly, getTimerService, lookup</p>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env</p>
</div>
<div class="paragraph">
<p>Resource manager access</p>
</div>
<div class="paragraph">
<p>Enterprise bean access</p>
</div>
<div class="paragraph">
<p>EntityManagerFactory access</p>
</div>
<div class="paragraph">
<p>EntityManager access</p>
</div>
<div class="paragraph">
<p>ejbActivate</p>
</div>
<div class="paragraph">
<p>ejbPassivate</p>
</div>
<div class="paragraph">
<p>EntityContext methods: getEJBHome,
getEJBLocalHome, getEJBObject, getEJBLocalObject, getPrimaryKey,
getTimerService, lookup</p>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env</p>
</div>
<div class="paragraph">
<p>ejbLoad</p>
</div>
<div class="paragraph">
<p>ejbStore</p>
</div>
<div class="paragraph">
<p>EntityContext methods: getEJBHome,
getEJBLocalHome, getCallerPrincipal, getRollbackOnly, isCallerInRole,
setRollbackOnly, getEJBObject, getEJBLocalObject, getPrimaryKey,
getTimerService, lookup</p>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env</p>
</div>
<div class="paragraph">
<p>Resource manager access</p>
</div>
<div class="paragraph">
<p>Enterprise bean access</p>
</div>
<div class="paragraph">
<p>Timer service or Timer methods</p>
</div>
<div class="paragraph">
<p>EntityManagerFactory access</p>
</div>
<div class="paragraph">
<p>EntityManager access</p>
</div>
<div class="paragraph">
<p>business method</p>
</div>
<div class="paragraph">
<p>from component interface</p>
</div>
<div class="paragraph">
<p>EntityContext methods: getEJBHome,
getEJBLocalHome, getCallerPrincipal, getRollbackOnly, isCallerInRole,
setRollbackOnly, getEJBObject, getEJBLocalObject, getPrimaryKey,
getTimerService, lookup</p>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env</p>
</div>
<div class="paragraph">
<p>Resource manager access</p>
</div>
<div class="paragraph">
<p>Enterprise bean access</p>
</div>
<div class="paragraph">
<p>Timer service or Timer methods</p>
</div>
<div class="paragraph">
<p>EntityManagerFactory access</p>
</div>
<div class="paragraph">
<p>EntityManager access</p>
</div>
<div class="paragraph">
<p>ejbTimeout</p>
</div>
<div class="paragraph">
<p>EntityContext methods: getEJBHome,
getEJBLocalHome, getRollbackOnly, setRollbackOnly, getCallerPrincipal,
isCallerInRole, getEJBObject, getEJBLocalObject, getPrimaryKey,
getTimerService, lookup</p>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env</p>
</div>
<div class="paragraph">
<p>Resource manager access</p>
</div>
<div class="paragraph">
<p>Enterprise bean access</p>
</div>
<div class="paragraph">
<p>Timer service or Timer methods</p>
</div>
<div class="paragraph">
<p>EntityManagerFactory access</p>
</div>
<div class="paragraph">
<p>EntityManager access</p>
</div>
<div class="paragraph">
<p>Additional restrictions:</p>
</div>
<div class="paragraph">
<p>The getRollbackOnly and setRollbackOnly
methods of the EntityContext interface should be used only in the
enterprise bean methods that execute in the context of a transaction.
The container must throw the java.lang.IllegalStateException if the
methods are invoked while the instance is not associated with a
transaction.</p>
</div>
<div class="paragraph">
<p>Reasons for disallowing operations:</p>
</div>
<div class="paragraph">
<p>Invoking the getEJBObject,
<em>getEJBLocalObject</em> , and getPrimaryKey methods is disallowed in the
entity bean methods in which there is no entity object identity
associated with the instance.</p>
</div>
<div class="paragraph">
<p>Invoking the <em>getEJBObject</em> and <em>getEJBHome</em>
methods is disallowed if the entity bean does not define a remote client
view.</p>
</div>
<div class="paragraph">
<p>Invoking the <em>getEJBLocalObject</em> and
<em>getEJBLocalHome</em> methods is disallowed if the entity bean does not
define a local client view.</p>
</div>
<div class="paragraph">
<p>Invoking the getRollbackOnly and
setRollbackOnly methods is disallowed in the entity bean methods for
which the container does not have a meaningful transaction context.</p>
</div>
<div class="paragraph">
<p>Accessing resource managers and enterprise
beans, including accessing the persistent state of an entity bean
instance, is disallowed in the entity bean methods for which the
container does not have a meaningful transaction context or client
security context.</p>
</div>
</div>
<div class="sect2">
<h3 id="_finder_methods_3"><a class="anchor" href="#_finder_methods_3"></a>4.41. <a id="a1446"></a>Finder Methods</h3>
<div class="paragraph">
<p>An entity bean’s
home interface defines one or more finder
methods<a href="#a3375">11</a>, one for each way to find an entity
object or collection of entity objects within the home. The name of each
finder method starts with the prefix “ <em>find</em> ”, such as
<em>findLargeAccounts</em> . The arguments of a finder method are used in the
implementation of the query for the finder method to locate the
requested entity objects.</p>
</div>
<div class="paragraph">
<p>Every finder method except
<em>findByPrimaryKey(key)</em> must be associated with a <em>query</em> element in the
deployment descriptor. The entity Bean Provider declaratively specifies
the EJB QL finder query and associates it with the finder method in the
deployment descriptor. A finder method is normally characterized by an
EJB QL query string specified in the <em>query</em> element. EJB QL is
described in Chapter <a href="Ejb.html#a1840">See EJB QL: EJB 2.1
Query Language for Container-Managed Persistence Query Methods</a>. A
compliant implementation of this specification is required to support
EJB QL as defined in Chapter <a href="Ejb.html#a1840">See EJB QL: EJB
2.1 Query Language for Container-Managed Persistence Query Methods</a> for
use with finder methods.</p>
</div>
<div class="paragraph">
<p>In the case that both the remote home
interface and local home interface define a finder method with the same
name and argument types, the EJB QL query string specified by the
<em>query</em> element defines the semantics of both methods.</p>
</div>
</div>
<div class="sect2">
<h3 id="_single_object_finder_methods"><a class="anchor" href="#_single_object_finder_methods"></a>4.42. Single-Object Finder Methods</h3>
<div class="paragraph">
<p>Some finder
methods (such as findByPrimaryKey) are designed to return at most one
entity object. For single-object finders, the result type of a
find&lt;METHOD&gt;method defined in the entity bean’s remote home interface is
the entity bean’s remote interface, and the result type of the
find&lt;METHOD&gt;method defined in the entity bean’s local home interface is
the entity bean’s local interface.</p>
</div>
<div class="paragraph">
<p>The following code illustrates the definition
of a single-object finder defined on the remote home interface.</p>
</div>
<div class="paragraph">
<p>public interface AccountHome extends
javax.ejb.EJBHome \{</p>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> Account findByPrimaryKey(AccountPrimaryKey
primkey)</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>throws FinderException, RemoteException;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="paragraph">
<p>Note that a finder method defined on the
local home interface must not throw the <em>RemoteException</em> .</p>
</div>
<div class="paragraph">
<p>In general, when defining a single-object
finder method other than <em>findByPrimaryKey</em> , the entity Bean Provider
should be sure that the finder method will always return only a single
entity object. This may occur, for example, if the EJB QL query string
that is used to specify the finder query includes an equality test on
the entity bean’s primary key fields. If the entity Bean Provider uses
an unknown primary key class (see <a href="Ejb.html#a1833">See
Special Case: Unknown Primary Key Class</a>), the Bean Provider will
typically define the finder method as a multi-object finder.</p>
</div>
<div class="paragraph">
<p>Note that a single-object finder method may
return a null value. If the result set of the query consists of a single
null value, the container must return the null value as the result of
the method. If the result set of a query for a single-object finder
method contains more than one value (whether non-null, null, or a
combination), the container must throw the <em>FinderException</em> from the
finder method. If the result set of the query contains no values, the
container must throw the <em>ObjectNotFoundException</em> .</p>
</div>
</div>
<div class="sect2">
<h3 id="_multi_object_finder_methods"><a class="anchor" href="#_multi_object_finder_methods"></a>4.43. Multi-Object Finder Methods</h3>
<div class="paragraph">
<p>Some finder
methods are designed to return multiple entity objects. For multi-object
finders defined on the entity bean’s local home interface, the result
type of the find&lt;METHOD&gt;method is a collection of objects implementing
the entity bean’s local interface. For multi-object finders defined on
the entity bean’s remote home interface, the result type of the
find&lt;METHOD&gt;method is a collection of objects implementing the entity
bean’s remote interface.</p>
</div>
<div class="paragraph">
<p>The Bean Provider uses the Java™ 2
java.util.Collection interface to define a collection type for the
result type of a finder method for an entity bean with container-managed
persistence.</p>
</div>
<div class="paragraph">
<p>The collection of values returned by the
container may contain duplicates if DISTINCT is not specified in the
SELECT clause of the query for the finder method.</p>
</div>
<div class="paragraph">
<p>The collection of values returned by the
container may contain null values if the finder method returns the
values of a cmr-field and null values are not eliminated by the query.</p>
</div>
<div class="paragraph">
<p>A portable client
program must use the PortableRemoteObject.narrow method to convert the
objects contained in the collections returned by a finder method on the
entity bean’s remote home interface to the entity bean’s remote
interface type.</p>
</div>
<div class="paragraph">
<p>The following is
an example of a multi-object finder method defined on the remote home
interface:</p>
</div>
<div class="paragraph">
<p>public interface AccountHome extends
javax.ejb.EJBHome \{</p>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> java.util.Collection
findLargeAccounts(double limit)</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>throws FinderException, RemoteException;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="paragraph">
<p>Note that if this finder method were defined
on the local home interface, it would not throw the <em>RemoteException</em> .</p>
</div>
</div>
<div class="sect2">
<h3 id="_select_methods"><a class="anchor" href="#_select_methods"></a>4.44. <a id="a1479"></a>Select Methods</h3>
<div class="paragraph">
<p>Select methods
are query methods for use by the Bean Provider within an entity bean
instance. Unlike finder methods, select methods are not specified in the
entity bean’s home interface. A select method is an abstract method
defined by the Bean Provider on an entity bean class. A select method
must not be exposed in the home or component interface of an entity
bean.</p>
</div>
<div class="paragraph">
<p>The semantics of a select method, like those
of a finder method, are defined by an EJB QL query string. A select
method is similar to a finder method, but unlike a finder method, but it
can return values that correspond to any cmp- or cmr-field type.</p>
</div>
<div class="paragraph">
<p>Every select method must be associated with a
<em>query</em>  element in the deployment
descriptor. The entity Bean Provider declaratively specifies the EJB QL
query and associates it with the select method in the deployment
descriptor. A select method is normally characterized by an EJB QL query
string specified in the <em>query</em> element. EJB QL is described in Chapter
<a href="Ejb.html#a1840">See EJB QL: EJB 2.1 Query Language for
Container-Managed Persistence Query Methods</a>. A compliant implementation
of this specification is required to support EJB QL as defined in
Chapter <a href="Ejb.html#a1840">See EJB QL: EJB 2.1 Query Language
for Container-Managed Persistence Query Methods</a> for use with select
methods.</p>
</div>
<div class="paragraph">
<p>Typically an ejbSelect&lt;METHOD&gt;method that
returns entity objects returns these as EJBLocalObjects. If the
ejbSelect&lt;METHOD&gt;method returns an EJBObject or collection of
EJBObjects, the Bean Provider must specify the value of the
<em>result-type-mapping</em> element in the <em>query</em> deployment descriptor
element for the select method as <em>Remote</em> .</p>
</div>
<div class="paragraph">
<p>An ejbSelect&lt;METHOD&gt; is not based on the
identity of the entity bean instance on which it is invoked. However,
the Bean Provider can use the primary key of an entity bean as an
argument to an <em>ejbSelect&lt;METHOD&gt;</em> to define a query that is logically
scoped to a particular entity bean instance.</p>
</div>
<div class="paragraph">
<p>The following table illustrates the semantics
of finder and select methods.</p>
</div>
<div class="paragraph">
<p>===</p>
</div>
<div class="paragraph">
<p>Comparison of Finder and Select Methods</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 34%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">Finder methods</th>
<th class="tableblock halign-left valign-top">Select methods</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">method</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>find&lt;METHOD&gt;</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ejbSelect&lt;METHOD&gt;</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">visibility</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exposed to client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">internal to entity bean class</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">instance</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">arbitrary bean instance in pooled state</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">instance: current instance (could be bean
instance in pooled state or ready state)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">return value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EJBObjects or EJBLocalObjects of the same
type as the entity bean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EJBObjects,
EJBLocalObjects, or cmp-field types</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_single_object_select_methods"><a class="anchor" href="#_single_object_select_methods"></a>4.45. Single-Object Select Methods</h3>
<div class="paragraph">
<p>Some select
methods are designed to return at most one value. In general, when
defining a single-object select method, the entity Bean Provider must be
sure that the select method will always return only a single object or
value. If the query specified by the select method returns multiple
values of the designated type, the container must throw the
FinderException.</p>
</div>
<div class="paragraph">
<p>Note that a single-object select method may
return a null value. If the result set of the query consists of a single
null value, the container must return the null value as the result of
the method. If the result set of a query for a single-object select
method contains more than one value (whether non-null, null, or a
combination), the container must throw the <em>FinderException</em> from the
select method. If the result set of the query contains no values, the
contain must throw the <em>ObjectNotFoundException</em> .</p>
</div>
<div class="paragraph">
<p>The Bean Provider will typically define a
select method as a multi-object select
method.</p>
</div>
</div>
<div class="sect2">
<h3 id="_multi_object_select_methods"><a class="anchor" href="#_multi_object_select_methods"></a>4.46. Multi-Object Select Methods</h3>
<div class="paragraph">
<p>Some select methods are designed to return
multiple values. For these multi-object select methods, the result type
of the ejbSelect&lt;METHOD&gt;method is a collection of objects.</p>
</div>
<div class="paragraph">
<p>The Bean Provider
uses the Java™ 2 java.util.Collection interface or java.util.Set
interface to define a collection type for the result type of a select
method. The type of the elements of the collection is determined by the
type of the SELECT clause of the
corresponding EJB QL query. If the Bean Provider uses the
<em>java.util.Collection</em> interface, the collection of values returned by
the container may contain duplicates if DISTINCT is not specified in the
SELECT clause of the query. If a query for a select method whose result
type is <em>java.util.Set</em> does not specify
DISTINCT in its SELECT clause, the container
must interpret the query as if SELECT
DISTINCT had been specified.</p>
</div>
<div class="paragraph">
<p>The collection of values returned by the
container may contain null values if the select method returns the
values of a cmr-field or cmp-field and null values are not eliminated by
the query.</p>
</div>
<div class="paragraph">
<p>The following is
an example of a multi-object select method definition in the <em>OrderBean</em>
class:</p>
</div>
<div class="paragraph">
<p>public abstract class OrderBean implements
javax.ejb.EntityBean\{</p>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>public abstract java.util.Collection</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> ejbSelectAllOrderedProducts(Customer
customer)</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>throws FinderException;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> // internal finder method to find all
products ordered</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_timer_notifications"><a class="anchor" href="#_timer_notifications"></a>4.47. Timer Notifications</h3>
<div class="paragraph">
<p>An entity bean can be registered with the EJB
timer service for time-based event notifications if it implements the
<em>javax.ejb.TimedObject</em> interface. The container invokes the bean
instance’s <em>ejbTimeout</em> method when a timer for the bean has expired.
See <a href="Ejb.html#a3258">See Timer Service</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_standard_application_exceptions_for_entities"><a class="anchor" href="#_standard_application_exceptions_for_entities"></a>4.48. <a id="a1524"></a>Standard Application Exceptions for Entities</h3>
<div class="paragraph">
<p>The EJB
specification defines the following standard application exceptions:</p>
</div>
<div class="paragraph">
<p>javax.ejb.CreateException</p>
</div>
<div class="paragraph">
<p>javax.ejb.DuplicateKeyException</p>
</div>
<div class="paragraph">
<p>javax.ejb.FinderException</p>
</div>
<div class="paragraph">
<p>javax.ejb.ObjectNotFoundException</p>
</div>
<div class="paragraph">
<p>javax.ejb.RemoveException</p>
</div>
<div class="paragraph">
<p>This section describes the use of these
exceptions by entity beans with container-managed persistence.</p>
</div>
</div>
<div class="sect2">
<h3 id="_createexception"><a class="anchor" href="#_createexception"></a>4.49. CreateException</h3>
<div class="paragraph">
<p>From the client’s
perspective, a CreateException (or a subclass of CreateException)
indicates that an application level error occurred during a
create&lt;METHOD&gt; operation. If a client receives this exception, the
client does not know, in general, whether the entity object was created
but not fully initialized, or not created at all. Also, the client does
not know whether or not the transaction has been marked for rollback.
(However, the client may determine the transaction status using the
UserTransaction interface or the <em>setRollbackOnly</em> method of the
<em>EJBContext</em> interface.)</p>
</div>
<div class="paragraph">
<p>Both the container and the Bean Provider may
throw the CreateException (or subclass of CreateException) from the
create&lt;METHOD&gt;, ejbCreate&lt;METHOD&gt; and ejbPostCreate&lt;METHOD&gt; methods to
indicate an application-level error from the create or initialization
operation. Optionally, the container or Bean Provider may mark the
transaction for rollback before throwing this exception.</p>
</div>
<div class="paragraph">
<p>The container or Bean Provider is encouraged
to mark the transaction for rollback only if data integrity would be
lost if the transaction were committed by the client. Typically, when a
<em>CreateException</em> is thrown, it leaves the database in a consistent
state, allowing the client to recover. For example, the
<em>ejbCreate&lt;METHOD&gt;</em> method may throw the <em>CreateException</em> to indicate
that the some of the arguments to the <em>create&lt;METHOD&gt;</em> method are
invalid.</p>
</div>
<div class="paragraph">
<p>The container treats the CreateException as
any other application exception. See Section
<a href="Ejb.html#a3227">See Container Provider Responsibilities</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_duplicatekeyexception"><a class="anchor" href="#_duplicatekeyexception"></a>4.50. DuplicateKeyException</h3>
<div class="paragraph">
<p>The
DuplicateKeyException is a subclass of CreateException. It may be thrown
by the container to indicate to the client or local client that the
entity object cannot be created because an entity object with the same
key already exists. The unique key causing the violation may be the
primary key, or another key defined in the underlying database.</p>
</div>
<div class="paragraph">
<p>Normally, the container should not mark the
transaction for rollback before throwing the exception.</p>
</div>
<div class="paragraph">
<p>When the client or local client receives a
DuplicateKeyException, the client knows that the entity was not created,
and that the transaction has not typically been marked for rollback.</p>
</div>
</div>
<div class="sect2">
<h3 id="_finderexception"><a class="anchor" href="#_finderexception"></a>4.51. FinderException</h3>
<div class="paragraph">
<p>From the client’s
perspective, a FinderException (or a subclass of FinderException)
indicates that an application level error occurred during the find
operation. Typically, the transaction has not been marked for rollback
because of the FinderException.</p>
</div>
<div class="paragraph">
<p>The container
throws the FinderException (or subclass of FinderException) from the
implementation of a finder or select method to indicate an
application-level error in the finder or select method. The container
should not, typically, mark the transaction for rollback before throwing
the FinderException.</p>
</div>
<div class="paragraph">
<p>The container treats the FinderException as
any other application exception. See Section
<a href="Ejb.html#a3227">See Container Provider
Responsibilities</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_objectnotfoundexception"><a class="anchor" href="#_objectnotfoundexception"></a>4.52. ObjectNotFoundException</h3>
<div class="paragraph">
<p>The
ObjectNotFoundException is a subclass of FinderException. The container
throws the <em>ObjectNotFoundException</em> from the implementation of a finder
or select method to indicate that the requested object does not exist.</p>
</div>
<div class="paragraph">
<p>Only single-object finder or select methods
(see Subsections <a href="Ejb.html#a1446">See Finder Methods</a> and
<a href="Ejb.html#a1479">See Select Methods</a>) should throw this
exception. Multi-object finder or select methods must not throw this
exception. Multi-object finder or select methods should return an empty
collection as an indication that no matching objects were found.</p>
</div>
</div>
<div class="sect2">
<h3 id="_removeexception"><a class="anchor" href="#_removeexception"></a>4.53. RemoveException</h3>
<div class="paragraph">
<p>From the client’s
perspective, a RemoveException (or a subclass of RemoveException)
indicates that an application level error occurred during a remove
operation. If a client receives this exception, the client does not
know, in general, whether the entity object was removed or not. The
client also does not know if the transaction has been marked for
rollback. (However, the client may determine the transaction status
using the UserTransaction interface.)</p>
</div>
<div class="paragraph">
<p>The container or Bean Provider throws the
RemoveException (or subclass of RemoveException) from a remove method to
indicate an application-level error from the entity object removal
operation. Optionally, the container or Bean Provider may mark the
transaction for rollback before throwing this exception.</p>
</div>
<div class="paragraph">
<p>The container or Bean Provider is encouraged
to mark the transaction for rollback only if data integrity would be
lost if the transaction were committed by the client. Typically, when a
<em>RemoveException</em> is thrown, it leaves the database in a consistent
state, allowing the client to recover.</p>
</div>
<div class="paragraph">
<p>The container
treats the RemoveException as any other application exception. See
Section <a href="Ejb.html#a3227">See Container Provider
Responsibilities</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_commit_options"><a class="anchor" href="#_commit_options"></a>4.54. <a id="a1554"></a>Commit Options</h3>
<div class="paragraph">
<p>The Entity Bean
protocol is designed to give the container the flexibility to select the
disposition of the instance state at transaction commit time. This
flexibility allows the container to optimally manage the association of
an entity object identity with the enterprise bean instances.</p>
</div>
<div class="paragraph">
<p>The container can select from the following
commit-time options:</p>
</div>
<div class="paragraph">
<p>Option A: The container caches a “ready”
instance between transactions. The container knows that the bean
instance has exclusive access to the state of the object in the
persistent storage. Therefore, the container does not have to
synchronize the instance’s state from the persistent storage at the
beginning of the next transaction or have to verify that the instance’s
state is in sync with the persistent storage at the beginning of the
next transaction.</p>
</div>
<div class="paragraph">
<p>Option B: The container caches a “ready”
instance between transactions. In contrast to Option A, in this option
the instance may not have exclusive access to the state of the object in
the persistent storage. Therefore, the container must synchronize the
instance’s state from the persistent storage at the beginning of the
next transaction if the instance’s state in the persistent storage has
changed. Containers using optimistic concurrency control strategies may
instead choose to rollback the transaction if this invariant has not
been met: The container must ensure that in order for a transaction to
be successfully committed, the transaction must only operate on instance
data that is in sync with the persistent storage at the beginning of the
transaction.</p>
</div>
<div class="paragraph">
<p>Option <em>C</em> : The container does not cache a
“ready” instance between transactions. The container returns the
instance to the pool of available instances after a transaction has
completed.</p>
</div>
<div class="paragraph">
<p>Variants of these strategies that capture the
same semantics from the Bean Provider’s viewpoint may be employed, e.g.,
to optimize data access.</p>
</div>
<div class="paragraph">
<p>The following illustrative lazy loading
strategies are consistent with the intent of these requirements:</p>
</div>
<div class="paragraph">
<p>If <em>ejbLoad</em> is called at the beginning of
the transaction without the instance’s persistent state having been
loaded from the persistent storage, the persistent state must be faulted
in when <em>ejbLoad</em> causes the bean’s getter accessor methods to be
invoked. If the <em>ejbLoad</em> method is empty, data may be faulted in as
needed in the course of executing the businesss methods of the bean.</p>
</div>
<div class="paragraph">
<p>If the instance’s persistent state is cached
between transactions, <em>ejbLoad</em> need not be called and persistent data
need not be faulted in from the persistent storage (unless it has not
previously been accessed). In this case, because <em>ejbLoad</em> has been
previously called when the instance was entered into the ready state for
the first time, and because the bean instance’s state is consistent with
its persistent state, there is no need to call <em>ejbLoad</em> unless the
instance’s state in the persistent storage has changed. In this case,
the container must ensure that in order for the transaction to be
successfully committed, the instance’s persistent state was in sync with
the persistent storage at the beginning of the transaction.</p>
</div>
<div class="paragraph">
<p>The following table provides a summary of the
commit-time options.</p>
</div>
<div class="paragraph">
<p>===</p>
</div>
<div class="paragraph">
<p>Summary of Commit-Time Options</p>
</div>
<div class="paragraph">
<p>Write instance state to database</p>
</div>
<div class="paragraph">
<p>Instance stays</p>
</div>
<div class="paragraph">
<p>ready</p>
</div>
<div class="paragraph">
<p>Instance state remains valid</p>
</div>
<div class="paragraph">
<p>Option A</p>
</div>
<div class="paragraph">
<p>Yes</p>
</div>
<div class="paragraph">
<p>Yes</p>
</div>
<div class="paragraph">
<p>Yes</p>
</div>
<div class="paragraph">
<p>Option B</p>
</div>
<div class="paragraph">
<p>Yes</p>
</div>
<div class="paragraph">
<p>Yes</p>
</div>
<div class="paragraph">
<p>No</p>
</div>
<div class="paragraph">
<p>Option C</p>
</div>
<div class="paragraph">
<p>Yes</p>
</div>
<div class="paragraph">
<p>No</p>
</div>
<div class="paragraph">
<p>No</p>
</div>
<div class="paragraph">
<p>Note that the container synchronizes the
instance’s state with the persistent storage at transaction commit for
all three options.</p>
</div>
<div class="paragraph">
<p>The selection of the commit option is
transparent to the entity bean implementation—the entity bean will work
correctly regardless of the commit-time option chosen by the container.
The Bean Provider writes the entity bean in the same way.</p>
</div>
<div class="literalblock">
<div class="content">
<pre> _Note: The Bean Provider relies on the
ejbLoad method to be invoked in order to resynchronize the bean’s
transient state with its persistent state. It is the responsibility of
the container to call the ejbLoad method at the beginning of a new
transaction if the bean instance’s persistent data has
changed.link:#a3376[12]_</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_concurrent_access_from_multiple_transactions"><a class="anchor" href="#_concurrent_access_from_multiple_transactions"></a>4.55. Concurrent Access from Multiple Transactions</h3>
<div class="paragraph">
<p>When writing the entity bean business
methods, the Bean Provider does not have to worry about concurrent
access from multiple transactions. The Bean Provider may assume that the
container will ensure appropriate
synchronization for entity objects that are
accessed concurrently from multiple transactions.</p>
</div>
<div class="paragraph">
<p>The container
typically uses one of the following implementation strategies to achieve
proper synchronization. (These strategies are illustrative, not
prescriptive.)</p>
</div>
<div class="paragraph">
<p>The container activates multiple instances of
the entity bean, one for each transaction in which the entity object is
being accessed. The transaction synchronization is performed by the
underlying database during the accessor method calls performed by the
business methods, the <em>ejbTimeout</em> method, and by the <em>ejbLoad</em> ,
<em>ejbCreate&lt;METHOD&gt;</em> , <em>ejbStore</em> , and <em>ejbRemove</em> methods. The
commit-time options B and C in Subsection
<a href="Ejb.html#a1554">See Commit Options</a> apply to this type of
container.</p>
</div>
<div class="paragraph">
<p>===</p>
</div>
<div class="paragraph">
<p>Multiple Clients Can Access the Same Entity Object Using Multiple
Instances</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-35.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>With this strategy, the type of lock acquired
by <em>ejbLoad</em> or get accessor method (if a lazy loading cache management
strategy is used) leads to a trade-off. If <em>ejbLoad</em> or the accessor
method acquires an exclusive lock on the instance&#8217;s state in the
database, the throughput of read-only transactions could be impacted. If
<em>ejbLoad</em> or the accessor method acquires a shared lock and the instance
is updated, then either <em>ejbStore</em> or a set accessor method will need to
promote the lock to an exclusive lock (which may cause a deadlock if it
happens concurrently under multiple transactions), or, if the container
uses an optimistic cache concurrency control strategy, the container
will need to validate the state of the cache against the database at
transaction commit (which may result in a rollback of the transaction).</p>
</div>
<div class="paragraph">
<p>It is expected
that containers will provide deployment-time configuration options that
will allow control to be exercised over the logical transaction
isolation levels that their caching strategies provide.</p>
</div>
<div class="paragraph">
<p>The container acquires exclusive access to
the entity object’s state in the database. The container activates a
single instance and serializes the access from multiple transactions to
this instance. The commit-time option A in Subsection
<a href="Ejb.html#a1554">See Commit Options</a> applies to this type of
container.</p>
</div>
<div class="paragraph">
<p>===</p>
</div>
<div class="paragraph">
<p>Multiple Clients Can Access the Same Entity Object Using Single Instance</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-36.png" alt="image"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="_non_reentrant_and_re_entrant_instances"><a class="anchor" href="#_non_reentrant_and_re_entrant_instances"></a>4.56. <a id="a1596"></a>Non-reentrant and Re-entrant Instances</h3>
<div class="paragraph">
<p>An entity Bean
Provider can specify that an entity bean is non-reentrant. If an
instance of a non-reentrant entity bean executes a client request in a
given transaction context, and another request with the same transaction
context arrives for the same entity object, the container will throw an
exception to the second request. This rule allows the Bean Provider to
program the entity bean as single-threaded,
non-reentrant code.</p>
</div>
<div class="paragraph">
<p>The functionality of entity beans with
container-managed persistence may require loopbacks in the same
transaction context. An example of a loopback is when the client calls
entity object A, A calls entity object B, and B calls back A in the same
transaction context. The entity bean’s method invoked by the loopback
shares the current execution context (which includes the transaction and
security contexts) with the Bean’s method invoked by the client.</p>
</div>
<div class="paragraph">
<p>If the entity bean is specified as
non-reentrant in the deployment descriptor, the container must reject an
attempt to re-enter the instance via the entity bean’s component
interface while the instance is executing a business method. (This can
happen, for example, if the instance has invoked another enterprise
bean, and the other enterprise bean tries to make a
loopback call.) If the attempt is made to
reenter the instance through the remote interface, the container must
throw the <em>java.rmi.RemoteException</em> to the caller. If the attempt is
made to reenter the instance through the local interface, the container
must throw the <em>javax.ejb.EJBException</em> to the caller. The container
must allow the call if the Bean’s deployment descriptor specifies that
the entity bean is re-entrant.</p>
</div>
<div class="paragraph">
<p>Re-entrant entity
beans must be programmed and used with caution. First, the Bean Provider
must code the entity bean with the anticipation of a
loopback call. Second, since the container
cannot, in general, tell a loopback from a concurrent call from a
different client, the client programmer must be careful to avoid code
that could lead to a concurrent call in the same transaction context.</p>
</div>
<div class="paragraph">
<p>Concurrent calls in the same transaction
context targeted at the same entity object are illegal and may lead to
unpredictable results. Since the container cannot, in general,
distinguish between an illegal concurrent call and a legal loopback,
application programmers are encouraged to avoid using loopbacks. Entity
beans that do not need callbacks should be marked as non-reentrant in
the deployment descriptor, allowing the container to detect and prevent
illegal concurrent calls from clients.</p>
</div>
</div>
<div class="sect2">
<h3 id="_responsibilities_of_the_enterprise_bean_provider"><a class="anchor" href="#_responsibilities_of_the_enterprise_bean_provider"></a>4.57. Responsibilities of the Enterprise Bean Provider</h3>
<div class="paragraph">
<p>This section describes the responsibilities
of an entity Bean Provider to ensure that an entity bean with
container-managed persistence can be deployed in any EJB container.</p>
</div>
</div>
<div class="sect2">
<h3 id="_classes_and_interfaces"><a class="anchor" href="#_classes_and_interfaces"></a>4.58. Classes and Interfaces</h3>
<div class="paragraph">
<p>The entity Bean
Provider is responsible for providing the following class files:</p>
</div>
<div class="paragraph">
<p>Entity bean class and any dependent classes</p>
</div>
<div class="paragraph">
<p>Primary key class</p>
</div>
<div class="paragraph">
<p>Entity bean’s remote interface and entity
bean’s remote home interface, if the entity bean provides a remote
client view</p>
</div>
<div class="paragraph">
<p>Entity bean’s local interface and local home
interface, if the entity bean provides a local client view</p>
</div>
<div class="paragraph">
<p>The Bean Provider must provide a remote
interface and a remote home interface or a local interface and a local
home interface for the bean. The Bean Provider may provide a remote
interface, remote home interface, local interface, and local home
interface for the bean. Other combinations are not allowed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_enterprise_bean_class"><a class="anchor" href="#_enterprise_bean_class"></a>4.59. Enterprise Bean Class</h3>
<div class="paragraph">
<p>The following are
the requirements for an entity bean class:</p>
</div>
<div class="paragraph">
<p>The class must
implement, directly or indirectly, the javax.ejb.EntityBean interface.</p>
</div>
<div class="paragraph">
<p>The class may implement, directly or
indirectly, the <em>javax.ejb.TimedObject</em> interface.</p>
</div>
<div class="paragraph">
<p>The class must be defined as public and must
be abstract. The class must be a top level class.</p>
</div>
<div class="paragraph">
<p>The class must define a public constructor
that takes no arguments.</p>
</div>
<div class="paragraph">
<p>The class must not define the finalize()
method.</p>
</div>
<div class="paragraph">
<p>The class may, but is not required to,
implement the entity bean’s component interface<a href="#a3377">13</a>.
If the class implements the entity bean’s component interface, the class
must provide no-op implementations of the methods defined by that
interface. The container will never invoke these methods on the bean
instances at runtime.</p>
</div>
<div class="paragraph">
<p>The entity bean class must implement the
business methods, and the ejbCreate <em>&lt;METHOD&gt;</em> and ejbPostCreate
<em>&lt;METHOD&gt;</em> methods as described later in this section.</p>
</div>
<div class="paragraph">
<p>The entity bean class must implement the
ejbHome&lt;METHOD&gt; methods that correspond to the home business methods
specified in the bean’s home interface. These methods are executed on an
instance in the pooled state; hence they must not access state that is
particular to a specific bean instance (e.g., the accessor methods for
the bean’s abstract persistence schema must not be used by these
methods).</p>
</div>
<div class="paragraph">
<p>The entity bean class must implement the get
and set accessor methods of the bean’s abstract persistence schema as
<em>abstract</em> methods.</p>
</div>
<div class="paragraph">
<p>The entity bean class may have superclasses
and/or superinterfaces. If the entity bean has superclasses, the
business methods, the ejbCreate <em>&lt;METHOD&gt;</em> and ejbPostCreate <em>&lt;METHOD&gt;</em>
methods, and the methods of the EntityBean interface and/or the
<em>TimedObject</em> interface may be implemented in the enterprise bean class
or in any of its superclasses.</p>
</div>
<div class="paragraph">
<p>The entity bean class is allowed to implement
other methods (for example helper methods invoked internally by the
business methods) in addition to the methods required by the EJB
specification.</p>
</div>
<div class="paragraph">
<p>The entity bean class does not implement the
finder methods. The implementations of the finder methods are provided
by the container.</p>
</div>
<div class="paragraph">
<p>The entity bean class must implement any
ejbSelect&lt;METHOD&gt; methods as abstract methods.</p>
</div>
</div>
<div class="sect2">
<h3 id="_dependent_value_classes_2"><a class="anchor" href="#_dependent_value_classes_2"></a>4.60. Dependent Value Classes</h3>
<div class="paragraph">
<p>The following are
the requirements for a dependent value class:</p>
</div>
<div class="paragraph">
<p>The class must be defined as public and must
not be abstract.</p>
</div>
<div class="paragraph">
<p>The class must be serializable.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ejbcreatemethod_methods"><a class="anchor" href="#_ejbcreatemethod_methods"></a>4.61. ejbCreate&lt;METHOD&gt; Methods</h3>
<div class="paragraph">
<p>The entity bean
class must implement the ejbCreate&lt;METHOD&gt; methods that correspond to
the create&lt;METHOD&gt; methods specified in the entity bean’s home interface
or local home interface.</p>
</div>
<div class="paragraph">
<p>The entity bean class may define zero or more
ejbCreate&lt;METHOD&gt; methods whose signatures must follow these rules:</p>
</div>
<div class="paragraph">
<p>The method name must have ejbCreate as its
prefix.</p>
</div>
<div class="paragraph">
<p>The method must be declared as public.</p>
</div>
<div class="paragraph">
<p>The method must not be declared as final or
static.</p>
</div>
<div class="paragraph">
<p>The return type must be the entity bean’s
primary key type.</p>
</div>
<div class="paragraph">
<p>If the <em>ejbCreate&lt;METHOD&gt;</em> method corresponds
to a <em>create&lt;METHOD&gt;</em> on the entity bean’s remote home interface, the
method arguments and return value types must be legal types for
RMI-IIOP.</p>
</div>
<div class="paragraph">
<p>The <em>throws</em> clause must define the
<em>javax.ejb.CreateException</em> . The <em>throws</em> clause may define arbitrary
application specific exceptions.</p>
</div>
<div class="paragraph">
<p>EJB 1.0 allowed the <em>ejbCreate</em> method to
throw the java.rmi.RemoteException to indicate a non-application
exception. This practice was deprecated in EJB 1.1—an EJB 1.1 or EJB 2.0
or later compliant enterprise bean should throw the
<em>javax.ejb.EJBException</em> or another <em>java.lang.RuntimeException</em> to
indicate non-application exceptions to the container (see Section
<a href="Ejb.html#a3221">See System Exceptions</a>). The <em>ejbCreate</em>
method of an entity bean with cmp-version 2.x must not throw the
java.rmi.RemoteException..</p>
</div>
</div>
<div class="sect2">
<h3 id="_ejbpostcreatemethod_methods"><a class="anchor" href="#_ejbpostcreatemethod_methods"></a>4.62. ejbPostCreate&lt;METHOD&gt; Methods</h3>
<div class="paragraph">
<p>For each
ejbCreate&lt;METHOD&gt; method, the entity bean class must define a matching
ejbPostCreate&lt;METHOD&gt; method, using the following rules:</p>
</div>
<div class="paragraph">
<p>The method name must have ejbPostCreate as
its prefix.</p>
</div>
<div class="paragraph">
<p>The method must be declared as public.</p>
</div>
<div class="paragraph">
<p>The method must not be declared as final or
static.</p>
</div>
<div class="paragraph">
<p>The return type must be <em>void</em> .</p>
</div>
<div class="paragraph">
<p>The method arguments must be the same as the
arguments of the matching ejbCreate&lt;METHOD&gt; method.</p>
</div>
<div class="paragraph">
<p>The <em>throws</em> clause may define arbitrary
application specific exceptions, including the
javax.ejb.CreateException.</p>
</div>
<div class="paragraph">
<p>EJB 1.0 allowed the <em>ejbPostCreate</em> method to
throw the java.rmi.RemoteException to indicate a non-application
exception. This practice was deprecated in EJB 1.1—an EJB 1.1 or EJB 2.0
or later compliant enterprise bean should throw the
<em>javax.ejb.EJBException</em> or another <em>java.lang.RuntimeException</em> to
indicate non-application exceptions to the container (see Section
<a href="Ejb.html#a3221">See System Exceptions</a>). The <em>ejbPostCreate</em>
method of an entity bean with cmp-version 2.x must not throw the
java.rmi.RemoteException..</p>
</div>
</div>
<div class="sect2">
<h3 id="_ejbhomemethod_methods"><a class="anchor" href="#_ejbhomemethod_methods"></a>4.63. ejbHome&lt;METHOD&gt; Methods</h3>
<div class="paragraph">
<p>The entity bean
class may define zero or more home methods whose signatures must follow
the following rules:</p>
</div>
<div class="paragraph">
<p>An <em>ejbHome&lt;METHOD&gt;</em> method must exist for
every home <em>&lt;METHOD&gt;</em> method on the entity bean’s remote home or local
home interface. The method name must have ejbHome as its prefix followed
by the name of the <em>&lt;METHOD&gt;</em> method in which the first character has
been uppercased.</p>
</div>
<div class="paragraph">
<p>The method must be declared as public.</p>
</div>
<div class="paragraph">
<p>The method must not be declared as static.</p>
</div>
<div class="paragraph">
<p>If the <em>ejbHome&lt;METHOD&gt;</em> method corresponds
to a home <em>&lt;METHOD&gt;</em> on the entity bean’s remote home interface, the
method argument and return value types must be legal types for RMI-IIOP.</p>
</div>
<div class="paragraph">
<p>The <em>throws</em> clause may define arbitrary
application specific exceptions. The <em>throws</em> clause must not throw the
<em>java.rmi.RemoteException</em> .</p>
</div>
</div>
<div class="sect2">
<h3 id="_ejbselectmethod_methods"><a class="anchor" href="#_ejbselectmethod_methods"></a>4.64. ejbSelect&lt;METHOD&gt; Methods</h3>
<div class="paragraph">
<p>The entity bean
class may define one or more select methods whose signatures must follow
the following rules:</p>
</div>
<div class="paragraph">
<p>The method name must have ejbSelect as its
prefix.</p>
</div>
<div class="paragraph">
<p>The method must be declared as public.</p>
</div>
<div class="paragraph">
<p>The method must be declared as abstract.</p>
</div>
<div class="paragraph">
<p>The <em>throws</em> clause must define the
<em>javax.ejb.FinderException</em> . The <em>throws</em> clause may define arbitrary
application specific exceptions.</p>
</div>
</div>
<div class="sect2">
<h3 id="_business_methods"><a class="anchor" href="#_business_methods"></a>4.65. Business Methods</h3>
<div class="paragraph">
<p>The entity bean
class may define zero or more business methods whose signatures must
follow these rules:</p>
</div>
<div class="paragraph">
<p>The method names can be arbitrary, but they
must not start with ‘ <em>ejb</em> ’ to avoid conflicts with the callback
methods used by the EJB architecture.</p>
</div>
<div class="paragraph">
<p>The business method must be declared as
public.</p>
</div>
<div class="paragraph">
<p>The method must not be declared as final or
static.</p>
</div>
<div class="paragraph">
<p>If the business method corresponds to a
method of the entity bean’s remote interface, the method argument and
return value types must be legal types for RMI-IIOP.</p>
</div>
<div class="paragraph">
<p>The <em>throws</em> clause may define arbitrary
application specific exceptions.</p>
</div>
<div class="paragraph">
<p>EJB 1.0 allowed the business methods to throw
the java.rmi.RemoteException to indicate a non-application exception.
This practice was deprecated in EJB 1.1—an EJB 1.1 or EJB 2.0 or later
compliant enterprise bean should throw the <em>javax.ejb.EJBException</em> or
another <em>java.lang.RuntimeException</em> to indicate non-application
exceptions to the container (see Section <a href="Ejb.html#a3221">See
System Exceptions</a>).The business methods of an entity bean with
cmp-version 2.x must not throw the java.rmi.RemoteException.</p>
</div>
</div>
<div class="sect2">
<h3 id="_entity_beans_remote_interface_2"><a class="anchor" href="#_entity_beans_remote_interface_2"></a>4.66. Entity Bean’s Remote Interface</h3>
<div class="paragraph">
<p>The following are
the requirements for the entity bean’s remote interface:</p>
</div>
<div class="paragraph">
<p>The interface
must extend the javax.ejb.EJBObject interface.</p>
</div>
<div class="paragraph">
<p>The methods
defined in the remote interface must follow the rules for RMI-IIOP. This
means that their argument and return value types must be valid types for
RMI-IIOP, and their <em>throws</em> clauses must include the
java.rmi.RemoteException.</p>
</div>
<div class="paragraph">
<p>The remote interface is allowed to have
superinterfaces. Use of interface inheritance is subject to the RMI-IIOP
rules for the definition of remote interfaces.</p>
</div>
<div class="paragraph">
<p>For each method defined in the remote
interface, there must be a matching method in the entity bean’s class.
The matching method must have:</p>
</div>
<div class="paragraph">
<p>The same name.</p>
</div>
<div class="paragraph">
<p>The same number and types of its arguments,
and the same return type.</p>
</div>
<div class="paragraph">
<p>All the exceptions defined in the <em>throws</em>
clause of the matching method of the enterprise Bean class must be
defined in the <em>throws</em> clause of the method of the remote interface.</p>
</div>
<div class="paragraph">
<p>The remote interface methods must not expose
local interface types, local home interface types, timer handles, or the
managed collection classes that are used for entity beans with
container-managed persistence as arguments or results.</p>
</div>
</div>
<div class="sect2">
<h3 id="_entity_beans_remote_home_interface_2"><a class="anchor" href="#_entity_beans_remote_home_interface_2"></a>4.67. Entity Bean’s Remote Home Interface</h3>
<div class="paragraph">
<p>The following are
the requirements for the entity bean’s home interface:</p>
</div>
<div class="paragraph">
<p>The interface
must extend the javax.ejb.EJBHome interface.</p>
</div>
<div class="paragraph">
<p>The methods defined in this interface must
follow the rules for RMI-IIOP. This means that their argument and return
types must be of valid types for RMI-IIOP, and their <em>throws</em> clauses
must include the java.rmi.RemoteException.</p>
</div>
<div class="paragraph">
<p>The remote home interface is allowed to have
superinterfaces. Use of interface inheritance is subject to the RMI-IIOP
rules for the definition of remote interfaces.</p>
</div>
<div class="paragraph">
<p>Each method defined in the remote home
interface must be one of the following:</p>
</div>
<div class="paragraph">
<p>A create method.</p>
</div>
<div class="paragraph">
<p>A finder method.</p>
</div>
<div class="paragraph">
<p>A home method.</p>
</div>
<div class="paragraph">
<p>Each create method must be named “
<em>create&lt;METHOD&gt;</em> ”, e.g. createLargeAccounts. Each create method name
must match one of the ejbCreate&lt;METHOD&gt; methods defined in the
enterprise bean class. The matching ejbCreate&lt;METHOD&gt; method must have
the same number and types of its arguments. (Note that the return type
is different.)</p>
</div>
<div class="paragraph">
<p>The return type for a create&lt;METHOD&gt; method
must be the entity bean’s remote interface type.</p>
</div>
<div class="paragraph">
<p>All the exceptions defined in the <em>throws</em>
clause of the matching ejbCreate <em>&lt;METHOD&gt;</em> and ejbPostCreate <em>&lt;METHOD&gt;</em>
methods of the enterprise bean class must be included in the <em>throws</em>
clause of the matching create method of the home interface (i.e., the
set of exceptions defined for the create method must be a superset of
the union of exceptions defined for the ejbCreate <em>&lt;METHOD&gt;</em> and
ejbPostCreate <em>&lt;METHOD&gt;</em> methods).</p>
</div>
<div class="paragraph">
<p>The <em>throws</em> clause of a create <em>&lt;METHOD&gt;</em>
method must include the javax.ejb.CreateException.</p>
</div>
<div class="paragraph">
<p>Each finder method must be named “ <em>find</em>
&lt;METHOD&gt;” (e.g. findLargeAccounts).</p>
</div>
<div class="paragraph">
<p>The return type for a find&lt;METHOD&gt; method
must be the entity bean’s remote interface type (for a single-object
finder), or a collection thereof (for a multi-object finder).</p>
</div>
<div class="paragraph">
<p>The remote home interface must always include
the findByPrimaryKey method, which is always a single-object finder. The
method must declare the primary key class as the method argument.</p>
</div>
<div class="paragraph">
<p>The <em>throws</em> clause of a finder method must
include the javax.ejb.FinderException.</p>
</div>
<div class="paragraph">
<p>Home methods can have arbitrary names, but
they must not start with “create”, “find”, or “ <em>remove</em> ”. Their
argument and return types must be of valid types for RMI-IIOP, and their
<em>throws</em> clauses must include the java.rmi.RemoteException. The matching
ejbHome method specified in the entity bean class must have the same
number and types of arguments and must return the same type as the home
method as specified in the remote home interface of the bean.</p>
</div>
<div class="paragraph">
<p>The remote home interface methods must not
expose local interface types, local home interface types, timers or
timer handles, or the managed collection classes that are used for
entity beans with container-managed persistence as arguments or results.</p>
</div>
</div>
<div class="sect2">
<h3 id="_entity_beans_local_interface_2"><a class="anchor" href="#_entity_beans_local_interface_2"></a>4.68. Entity Bean’s Local Interface</h3>
<div class="paragraph">
<p>The following are
the requirements for the entity bean’s local interface:</p>
</div>
<div class="paragraph">
<p>The interface
must extend the javax.ejb.EJBLocalObject interface.</p>
</div>
<div class="paragraph">
<p>For each method defined in the local
interface, there must be a matching method in the entity bean’s class.
The matching method must have:</p>
</div>
<div class="paragraph">
<p>The same name.</p>
</div>
<div class="paragraph">
<p>The same number and types of its arguments,
and the same return type.</p>
</div>
<div class="paragraph">
<p>All the exceptions defined in the <em>throws</em>
clause of the matching method of the enterprise Bean class must be
defined in the <em>throws</em> clause of the method of the local interface.</p>
</div>
</div>
<div class="sect2">
<h3 id="_entity_beans_local_home_interface_2"><a class="anchor" href="#_entity_beans_local_home_interface_2"></a>4.69. Entity Bean’s Local Home Interface</h3>
<div class="paragraph">
<p>The following are
the requirements for the entity bean’s local home interface:</p>
</div>
<div class="paragraph">
<p>The interface
must extend the javax.ejb.EJBLocalHome interface.</p>
</div>
<div class="paragraph">
<p>Each method defined in the home interface
must be one of the following:</p>
</div>
<div class="paragraph">
<p>A create method.</p>
</div>
<div class="paragraph">
<p>A finder method.</p>
</div>
<div class="paragraph">
<p>A home method.</p>
</div>
<div class="paragraph">
<p>Each create method must be named “
<em>create&lt;METHOD&gt;</em> ”, e.g. createLargeAccounts. Each create method name
must match one of the ejbCreate&lt;METHOD&gt; methods defined in the
enterprise bean class. The matching ejbCreate&lt;METHOD&gt; method must have
the same number and types of its arguments. (Note that the return type
is different.)</p>
</div>
<div class="paragraph">
<p>The return type for a create&lt;METHOD&gt; method
on the local home interface must be the entity bean’s local interface
type.</p>
</div>
<div class="paragraph">
<p>All the exceptions defined in the <em>throws</em>
clause of the matching ejbCreate <em>&lt;METHOD&gt;</em> and ejbPostCreate <em>&lt;METHOD&gt;</em>
methods of the enterprise bean class must be included in the <em>throws</em>
clause of the matching create method of the local home interface (i.e.,
the set of exceptions defined for the create method must be a superset
of the union of exceptions defined for the ejbCreate <em>&lt;METHOD&gt;</em> and
ejbPostCreate <em>&lt;METHOD&gt;</em> methods).</p>
</div>
<div class="paragraph">
<p>The <em>throws</em> clause of a create <em>&lt;METHOD&gt;</em>
method must include the javax.ejb.CreateException.</p>
</div>
<div class="paragraph">
<p>Each finder method must be named “ <em>find</em>
&lt;METHOD&gt;” (e.g. findLargeAccounts).</p>
</div>
<div class="paragraph">
<p>The return type for a find&lt;METHOD&gt; method
defined on the local home interface must be the entity bean’s local
interface type (for a single-object finder), or a collection thereof
(for a multi-object finder).</p>
</div>
<div class="paragraph">
<p>The local home interface must always include
the findByPrimaryKey method, which is always a single-object finder. The
method must declare the primary key class as the method argument.</p>
</div>
<div class="paragraph">
<p>The <em>throws</em> clause of a finder method must
include the javax.ejb.FinderException.</p>
</div>
<div class="paragraph">
<p>Home methods can have arbitrary names, but
they must not start with “create”, “find”, or “ <em>remove</em> ”. The matching
ejbHome method specified in the entity bean class must have the same
number and types of arguments and must return the same type as the home
method as specified in the home interface of the bean. The <em>throws</em>
clause of a home method defined on the local home interface must not
include the java.rmi.RemoteException.</p>
</div>
</div>
<div class="sect2">
<h3 id="_entity_beans_primary_key_class"><a class="anchor" href="#_entity_beans_primary_key_class"></a>4.70. <a id="a1725"></a>Entity Bean’s Primary Key Class</h3>
<div class="paragraph">
<p>The Bean Provider
must specify a primary key class in the deployment descriptor.</p>
</div>
<div class="paragraph">
<p>The primary key
type must be a legal Value Type in RMI-IIOP.</p>
</div>
<div class="paragraph">
<p>The class must provide suitable
implementation of the hashCode() and equals(Object other) methods to
simplify the management of the primary keys by the container.</p>
</div>
</div>
<div class="sect2">
<h3 id="_entity_beans_deployment_descriptor"><a class="anchor" href="#_entity_beans_deployment_descriptor"></a>4.71. Entity Bean’s Deployment Descriptor</h3>
<div class="paragraph">
<p>The Bean Provider must specify the
relationships in which the entity beans participate in the
<em>relationships</em> element.</p>
</div>
<div class="paragraph">
<p>The Bean Provider must provide unique names
to designate entity beans as follows, and as described in
<a href="Ejb.html#a1013">See The Bean Provider’s View of the
Deployment Descriptor</a>.</p>
</div>
<div class="paragraph">
<p>The Bean Provider must specify unique names
for entity beans which are defined in the ejb-jar file by using the
ejb-name element.</p>
</div>
<div class="paragraph">
<p>The Bean Provider must specify a unique
abstract schema name for an entity bean using the <em>abstract-schema-name</em>
deployment descriptor element.</p>
</div>
<div class="paragraph">
<p>The Bean Provider
must define a query for each finder or select method except
<em>findByPrimaryKey(key)</em> . Typically this will be provided as the content
of the ejb-ql element contained in the query element for the entity
bean. The syntax of EJB QL is defined in Chapter
<a href="Ejb.html#a1840">See EJB QL: EJB 2.1 Query Language for
Container-Managed Persistence Query Methods</a>.</p>
</div>
<div class="paragraph">
<p>Since EJB QL query strings are embedded in
the deployment descriptor, which is an XML document, it may be necessary
to encode the following characters in the query string: “ <em>&gt;</em> ”, “ <em>&lt;</em>
“.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_responsibilities_of_the_container_provider"><a class="anchor" href="#_the_responsibilities_of_the_container_provider"></a>4.72. The Responsibilities of the Container Provider</h3>
<div class="paragraph">
<p>This section
describes the responsibilities of the Container Provider to support
entity beans. The Container Provider is responsible for providing the
deployment tools, and for managing the entity beans at runtime,
including their persistent state and relationships.</p>
</div>
<div class="paragraph">
<p>Because the EJB specification does not define
the API between deployment tools and the container, we assume that the
deployment tools described in this section are provided by the Container
Provider. Alternatively, the deployment tools may be provided by a
different vendor who uses the container vendor’s specific API.</p>
</div>
</div>
<div class="sect2">
<h3 id="_generation_of_implementation_classes"><a class="anchor" href="#_generation_of_implementation_classes"></a>4.73. Generation of Implementation Classes</h3>
<div class="paragraph">
<p>The deployment
tools provided by the Container Provider are responsible for the
generation of additional classes when the entity bean is deployed. The
tools obtain the information that they need for generation of the
additional classes by introspecting the classes and interfaces provided
by the Bean Provider and by examining the entity bean’s deployment
descriptor.</p>
</div>
<div class="paragraph">
<p>The deployment tools must generate the
following classes:</p>
</div>
<div class="paragraph">
<p>A class that implements the entity bean’s
remote home interface (i.e., the entity EJBHome class).</p>
</div>
<div class="paragraph">
<p>A class that implements the entity bean’s
remote interface (i.e., the entity EJBObject class).</p>
</div>
<div class="paragraph">
<p>A class that implements the entity bean’s
local home interface (i.e., the entity EJBLocalHome class).</p>
</div>
<div class="paragraph">
<p>A class that implements the entity bean’s
local interface (i.e., the EJBLocalObject class).</p>
</div>
<div class="paragraph">
<p>A class that implements the entity bean class
(i.e., a concrete class corresponding to the abstract entity bean class
that was provided by the Bean Provider).</p>
</div>
<div class="paragraph">
<p>The deployment tools may also generate a
class that mixes some container-specific code with the entity bean
class. The code may, for example, help the container to manage the
entity bean instances at runtime. Tools can use subclassing, delegation,
and code generation.</p>
</div>
<div class="paragraph">
<p>The deployment tools may also allow
generation of additional code that wraps the business methods and that
is used to customize the business logic for an existing operational
environment. For example, a wrapper for a debit function on the Account
bean may check that the debited amount does not exceed a certain limit,
or perform security checking that is specific to the operational
environment.</p>
</div>
</div>
<div class="sect2">
<h3 id="_enterprise_bean_class_2"><a class="anchor" href="#_enterprise_bean_class_2"></a>4.74. Enterprise Bean Class</h3>
<div class="paragraph">
<p>The following are
the requirements for a concrete entity bean class:</p>
</div>
<div class="paragraph">
<p>The class must extend the abstract entity
bean class provided by the Bean Provider.</p>
</div>
<div class="paragraph">
<p>The class must be defined as public and must
not be abstract.</p>
</div>
<div class="paragraph">
<p>The class must define a public constructor
that takes no arguments.</p>
</div>
<div class="paragraph">
<p>The class must implement the get and set
accessor methods of the bean’s abstract persistence schema.</p>
</div>
<div class="paragraph">
<p>The class must not define the <em>finalize</em>
method.</p>
</div>
<div class="paragraph">
<p>The entity bean class must implement the
<em>ejbFind&lt;METHOD&gt;</em> methods.</p>
</div>
<div class="paragraph">
<p>The entity bean class must implement the
<em>ejbSelect&lt;METHOD&gt;</em> methods.</p>
</div>
<div class="paragraph">
<p>The entity bean class is allowed to implement
other methods in addition to the methods required by the EJB
specification.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ejbfindmethod_methods"><a class="anchor" href="#_ejbfindmethod_methods"></a>4.75. ejbFind&lt;METHOD&gt; Methods</h3>
<div class="paragraph">
<p>For each
find&lt;METHOD&gt; method in the remote home
interface or local home interface of the entity bean, there must be a
corresponding <em>ejbFind&lt;METHOD&gt;</em>  method with
the same argument types in the concrete entity bean class.</p>
</div>
<div class="paragraph">
<p>The method name must have ejbFind as its
prefix.</p>
</div>
<div class="paragraph">
<p>The method must be declared as public.</p>
</div>
<div class="paragraph">
<p>If the <em>ejbFind&lt;METHOD&gt;</em> method corresponds
to a <em>find&lt;METHOD&gt;</em> on the entity bean’s remote home interface, the
method argument and return value types must be legal types for RMI-IIOP.</p>
</div>
<div class="paragraph">
<p>The return type of an <em>ejbFind&lt;METHOD&gt;</em>
method must be the entity bean’s primary key type, or a collection of
primary keys.</p>
</div>
<div class="paragraph">
<p>The <em>throws</em> clause must define the
<em>javax.ejb.FinderException</em> . The <em>throws</em>
clause may define arbitrary application specific exceptions.</p>
</div>
<div class="paragraph">
<p>Every finder method except
<em>ejbFindByPrimaryKey(key)</em> is specified in the <em>query</em> deployment
descriptor element for the entity. The container must use the EJB QL
query string that is the content of the <em>ejb-ql</em> element or the
descriptive query specification contained in the <em>description</em> element
as the definition of the query of the corresponding ejbFind&lt;METHOD&gt;
method.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ejbselectmethod_methods_2"><a class="anchor" href="#_ejbselectmethod_methods_2"></a>4.76. ejbSelect&lt;METHOD&gt; Methods</h3>
<div class="paragraph">
<p>For each
ejbSelect&lt;METHOD&gt; method in the abstract entity bean class, there must
be a method with the same argument and result types in the concrete
entity bean class.</p>
</div>
<div class="paragraph">
<p>Every select method is specified in a <em>query</em>
deployment descriptor element for the entity. The container must use the
EJB QL query string that is the content of the <em>ejb-ql</em> element or the
descriptive query specification that is contained in the <em>description</em>
element as the definition of the query of the corresponding
ejbSelect&lt;METHOD&gt;method.</p>
</div>
<div class="paragraph">
<p>The container must use the contents of the
<em>query</em> element, the corresponding EJB QL string and the type of the
values selected as specified by the SELECT clause to determine the type
of the values returned by a select method.</p>
</div>
<div class="paragraph">
<p>The container must ensure that there are no
duplicates returned by a select method if the return type is
java.util.Set.</p>
</div>
</div>
<div class="sect2">
<h3 id="_entity_ejbhome_class"><a class="anchor" href="#_entity_ejbhome_class"></a>4.77. Entity EJBHome Class</h3>
<div class="paragraph">
<p>The entity
EJBHome class, which is generated by deployment tools, implements the
entity bean’s remote home interface. This class implements the methods
of the javax.ejb.EJBHome interface, and the type-specific create and
finder methods specific to the entity bean.</p>
</div>
<div class="paragraph">
<p>The implementation of each create&lt;METHOD&gt;
method invokes a matching ejbCreate&lt;METHOD&gt; method, followed by the
matching ejbPostCreate&lt;METHOD&gt; method, passing the create&lt;METHOD&gt;
parameters to these matching methods.</p>
</div>
<div class="paragraph">
<p>The implementation of the remove methods
defined in the javax.ejb.EJBHome interface must activate an instance (if
an instance is not already in the ready state) and invoke the ejbRemove
method on the instance.</p>
</div>
<div class="paragraph">
<p>The implementation of each find&lt;METHOD&gt;
method invokes a matching ejbFind&lt;METHOD&gt; method. The implementation of
the find&lt;METHOD&gt; method must create an entity object reference for the
primary key returned from the ejbFind&lt;METHOD&gt; and return the entity
object reference to the client. If the ejbFind&lt;METHOD&gt; method returns a
collection of primary keys, the implementation of the find&lt;METHOD&gt;
method must create a collection of entity object references for the
primary keys and return the collection to the client.</p>
</div>
<div class="paragraph">
<p>The implementation of each &lt;METHOD&gt; home
method invokes a matching ejbHome&lt;METHOD&gt; method (in which the first
character of <em>&lt;METHOD&gt;</em> is uppercased in the name of the ejbHome&lt;METHOD&gt;
method), passing the parameters of the &lt;METHOD&gt; method to the matching
ejbHome&lt;METHOD&gt;method.</p>
</div>
</div>
<div class="sect2">
<h3 id="_entity_ejbobject_class"><a class="anchor" href="#_entity_ejbobject_class"></a>4.78. Entity EJBObject Class</h3>
<div class="paragraph">
<p>The entity
EJBObject class, which is generated by deployment tools, implements the
entity bean’s remote interface. It implements the methods of the
javax.ejb.EJBObject interface and the remote business methods specific
to the entity bean.</p>
</div>
<div class="paragraph">
<p>The implementation of the remove method
(defined in the javax.ejb.EJBObject interface) must activate an instance
(if an instance is not already in the ready state) and invoke the
ejbRemove method on the instance.</p>
</div>
<div class="paragraph">
<p>The implementation of each remote business
method must activate an instance (if an instance is not already in the
ready state) and invoke the matching business method on the instance.</p>
</div>
</div>
<div class="sect2">
<h3 id="_entity_ejblocalhome_class"><a class="anchor" href="#_entity_ejblocalhome_class"></a>4.79. Entity EJBLocalHome Class</h3>
<div class="paragraph">
<p>The entity
EJBLocalHome class, which is generated by deployment tools, implements
the entity bean’s local home interface. This class implements the
methods of the javax.ejb.EJBLocalHome interface, and the type-specific
create and finder methods specific to the entity bean.</p>
</div>
<div class="paragraph">
<p>The implementation of each create&lt;METHOD&gt;
method invokes a matching ejbCreate&lt;METHOD&gt; method, followed by the
matching ejbPostCreate&lt;METHOD&gt; method, passing the create&lt;METHOD&gt;
parameters to these matching methods.</p>
</div>
<div class="paragraph">
<p>The implementation of the remove method
defined in the javax.ejb.EJBLocalHome interface must activate an
instance (if an instance is not already in the ready state) and invoke
the ejbRemove method on the instance.</p>
</div>
<div class="paragraph">
<p>The implementation of each find&lt;METHOD&gt;
method invokes a matching ejbFind&lt;METHOD&gt; method. The implementation of
the find&lt;METHOD&gt; method must create a local entity object reference for
the primary key returned from the ejbFind&lt;METHOD&gt; and return the local
entity object reference to the local client. If the ejbFind&lt;METHOD&gt;
method returns a collection of primary keys, the implementation of the
find&lt;METHOD&gt; method must create a collection of local entity object
references for the primary keys and return the collection to the local
client.</p>
</div>
<div class="paragraph">
<p>The implementation of each &lt;METHOD&gt; home
method invokes a matching ejbHome&lt;METHOD&gt; method (in which the first
character of <em>&lt;METHOD&gt;</em> is uppercased in the name of the ejbHome&lt;METHOD&gt;
method), passing the parameters of the &lt;METHOD&gt; method to the matching
ejbHome&lt;METHOD&gt; method.</p>
</div>
</div>
<div class="sect2">
<h3 id="_entity_ejblocalobject_class"><a class="anchor" href="#_entity_ejblocalobject_class"></a>4.80. Entity EJBLocalObject Class</h3>
<div class="paragraph">
<p>The entity
EJBLocalObject class, which is generated by deployment tools, implements
the entity bean’s local interface. It implements the methods of the
javax.ejb.EJBLocalObject interface and the local business methods
specific to the entity bean.</p>
</div>
<div class="paragraph">
<p>The implementation of the remove method
(defined in the javax.ejb.EJBLocalObject interface) must activate an
instance (if an instance is not already in the ready state) and invoke
the ejbRemove method on the instance.</p>
</div>
<div class="paragraph">
<p>The implementation of each local business
method must activate an instance (if an instance is not already in the
ready state) and invoke the matching business method on the instance.</p>
</div>
</div>
<div class="sect2">
<h3 id="_handle_class"><a class="anchor" href="#_handle_class"></a>4.81. Handle Class</h3>
<div class="paragraph">
<p>The deployment
tools are responsible for implementing the handle class for the entity
bean. The handle class must be serializable by the Java Serialization
protocol.</p>
</div>
<div class="paragraph">
<p>As the handle class is not entity bean
specific, the container may, but is not required to, use a single class
for all deployed entity beans.</p>
</div>
</div>
<div class="sect2">
<h3 id="_home_handle_class"><a class="anchor" href="#_home_handle_class"></a>4.82. Home Handle Class</h3>
<div class="paragraph">
<p>The deployment
tools responsible for implementing the home
handle class for the entity bean. The handle
class must be serializable by the Java Serialization protocol.</p>
</div>
<div class="paragraph">
<p>Because the home handle class is not entity
bean specific, the container may, but is not required to, use a single
class for the home handles of all deployed entity beans.</p>
</div>
</div>
<div class="sect2">
<h3 id="_metadata_class"><a class="anchor" href="#_metadata_class"></a>4.83. Metadata Class</h3>
<div class="paragraph">
<p>The deployment
tools are responsible for implementing the class that provides metadata
information to the remote client view contract. The class must be a
valid RMI-IIOP Value Type, and must implement the javax.ejb.EJBMetaData
interface.</p>
</div>
<div class="paragraph">
<p>Because the metadata class is not entity bean
specific, the container may, but is not required to, use a single class
for all deployed enterprise beans.</p>
</div>
</div>
<div class="sect2">
<h3 id="_instances_re_entrance"><a class="anchor" href="#_instances_re_entrance"></a>4.84. Instance’s Re-entrance</h3>
<div class="paragraph">
<p>The container runtime must enforce the rules
defined in Section <a href="Ejb.html#a1596">See Non-reentrant and
Re-entrant Instances</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_transaction_scoping_security_exceptions"><a class="anchor" href="#_transaction_scoping_security_exceptions"></a>4.85. Transaction Scoping, Security, Exceptions</h3>
<div class="paragraph">
<p>The container runtime must follow the rules
on transaction scoping and
exception handling described in Chapters 9
and <a href="Ejb.html#a3210">See Exception Handling</a>. The container
runtime must follow the rules on security
checking described in the EJB Core Contracts and Requirements document
<a href="Ejb.html#a3339">See EJB 3.2 Core Contracts and Requirements.</a> Chapter “Security Management”.</p>
</div>
</div>
<div class="sect2">
<h3 id="_implementation_of_object_references"><a class="anchor" href="#_implementation_of_object_references"></a>4.86. Implementation of Object References</h3>
<div class="paragraph">
<p>The container
should implement the distribution protocol between the remote client and
the container such that the object references of the remote home and
remote interfaces used by entity bean clients are usable for a long
period of time. Ideally, a remote client should be able to use an object
reference across a server crash and restart. An object reference should
become invalid only when the entity object has been removed, or after a
reconfiguration of the server environment (for example, when the entity
bean is moved to a different EJB server or container).</p>
</div>
<div class="paragraph">
<p>The motivation for this is to simplify the
programming model for the entity bean client. While the client code
needs to have a recovery handler for the system exceptions thrown from
the individual method invocations on the remote home and remote
interface, the client should not be forced to re-obtain the object
references.</p>
</div>
</div>
<div class="sect2">
<h3 id="_entitycontext"><a class="anchor" href="#_entitycontext"></a>4.87. EntityContext</h3>
<div class="paragraph">
<p>The container must implement the
EntityContext.getEJBObject method such that
the bean instance can use the Java language cast to convert the returned
value to the entity bean’s remote interface type. Specifically, the bean
instance does not have to use the PortableRemoteObject.narrow method for
the type conversion.</p>
</div>
</div>
<div class="sect2">
<h3 id="_primary_keys"><a class="anchor" href="#_primary_keys"></a>4.88. <a id="a1820"></a>Primary Keys</h3>
<div class="paragraph">
<p>The container
must be able to manipulate the primary key type of an entity bean.
Therefore, the primary key type for an entity bean with
container-managed persistence must follow the rules in this subsection,
in addition to those specified in Subsection
<a href="Ejb.html#a1725">See Entity Bean’s Primary Key Class</a>.</p>
</div>
<div class="paragraph">
<p>There are two ways to specify a primary key
class for an entity bean with container-managed persistence:</p>
</div>
<div class="paragraph">
<p>Primary key that maps to a single field in
the entity bean class.</p>
</div>
<div class="paragraph">
<p>Primary key that maps to multiple fields in
the entity bean class.</p>
</div>
<div class="paragraph">
<p>The second method is necessary for
implementing compound keys, and the first method is convenient for
single-field keys. Without the first method, simple types such as String
would have to be wrapped in a user-defined class.</p>
</div>
</div>
<div class="sect2">
<h3 id="_primary_key_that_maps_to_a_single_field_in_the_entity_bean_class"><a class="anchor" href="#_primary_key_that_maps_to_a_single_field_in_the_entity_bean_class"></a>4.89. Primary Key That Maps to a Single Field in the Entity Bean Class</h3>
<div class="paragraph">
<p>The Bean Provider
uses the primkey-field element of the
deployment descriptor to specify the container-managed field of the
entity bean class that contains the primary key. The field’s type must
be the primary key type.</p>
</div>
</div>
<div class="sect2">
<h3 id="_primary_key_that_maps_to_multiple_fields_in_the_entity_bean_class"><a class="anchor" href="#_primary_key_that_maps_to_multiple_fields_in_the_entity_bean_class"></a>4.90. Primary Key That Maps to Multiple Fields in the Entity Bean Class</h3>
<div class="paragraph">
<p>The primary key
class must be public, and must have a public constructor with no
parameters.</p>
</div>
<div class="paragraph">
<p>All fields in the primary key class must be
declared as public.</p>
</div>
<div class="paragraph">
<p>The names of the fields in the primary key
class must be a subset of the names of the container-managed fields.
(This allows the container to extract the primary key fields from an
instance’s container-managed fields, and vice versa.)</p>
</div>
</div>
<div class="sect2">
<h3 id="_special_case_unknown_primary_key_class"><a class="anchor" href="#_special_case_unknown_primary_key_class"></a>4.91. <a id="a1833"></a>Special Case: Unknown Primary Key Class</h3>
<div class="paragraph">
<p>In special
situations, the entity Bean Provider may choose not to specify the
primary key class or the primary key fields for an entity bean with
container-managed persistence. This case usually happens when the entity
bean does not have a natural primary key, and/or the Bean Provider wants
to allow the Deployer using the Container Provider’s tools to select the
primary key fields at deployment time. The entity bean’s primary key
type will usually be derived from the primary key type used by the
underlying database system that stores the entity objects. The primary
key used by the database system may not be known to the Bean Provider.</p>
</div>
<div class="paragraph">
<p>In this special case, the type of the
argument of the findByPrimaryKey method must be declared as
java.lang.Object. The Bean Provider must specify the primary key class
in the deployment descriptor as of the type java.lang.Object.</p>
</div>
<div class="paragraph">
<p>When defining the primary key for the
enterprise bean, the Deployer using the Container Provider’s tools will
typically add additional container-managed fields to the concrete
subclass of the entity bean class (this typically happens for entity
beans that do not have a natural primary key, and the primary keys are
system-generated by the underlying database system that stores the
entity objects). In this case, the container must generate the primary
key value when the entity bean instance is created (and before
<em>ejbPostCreate</em> is invoked on the instance.)</p>
</div>
<div class="paragraph">
<p>The primary key class is specified at
deployment time in the situations when the Bean Provider develops an
entity bean that is intended to be used with multiple back-ends that
provide persistence, and when these multiple back-ends require different
primary key structures.</p>
</div>
<div class="paragraph">
<p>Use of entity beans with a deferred primary
key type specification limits the client application programming model,
because the clients written prior to deployment of the entity bean may
not use, in general, the methods that rely on the knowledge of the
primary key type.</p>
</div>
<div class="paragraph">
<p>The implementation of the enterprise bean
class methods must be done carefully. For example, the methods should
not depend on the type of the object returned from
<em>EntityContext.getPrimaryKey,</em> because the return type is determined by
the Deployer after the EJB class has been written.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a1840"><a class="anchor" href="#a1840"></a>5. EJB QL: EJB 2.1 Query Language for Container-Managed Persistence Query Methods</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Enterprise
JavaBeans query language, EJB QL, is used to define queries for entity
beans with container-managed persistence. EJB QL enables the Bean
Provider to specify the semantics of query methods in a portable way.</p>
</div>
<div class="paragraph">
<p>This chapter provides the complete definition
of EJB QL that is required to be supported for use with EJB 2.1 entity
beans with container managed persistence. Implementations of this
specification are permitted, but not required, to provide the extensions
to EJB QL defined by the Java Persistence query language
<a href="Ejb.html#a3325">See Java™ Persistence API</a> for use with finder and select
methods. Applications that make use of such extensions in finder and
select methods will not be portable.</p>
</div>
<div class="sect2">
<h3 id="_overview_4"><a class="anchor" href="#_overview_4"></a>5.1. Overview</h3>
<div class="paragraph">
<p>EJB QL is a query
specification language for the finder and select methods of entity beans
with container-managed persistence. EJB QL can be compiled to a target
language, such as SQL, of a database or other persistent store. This
allows the execution of queries to be shifted to the native language
facilities provided by the persistent store, instead of requiring
queries to be executed on the runtime representation of the entity
beans’ state. As a result, query methods can be optimizable as well as
portable.</p>
</div>
<div class="paragraph">
<p>The Enterprise JavaBeans query language uses
the abstract persistence schemas of entity beans, including their
relationships, for its data model. It defines operators and expressions
based on this data model.</p>
</div>
<div class="paragraph">
<p>The Bean Provider uses EJB QL to write
queries based on the abstract persistence schemas and the relationships
defined in the deployment descriptor. EJB QL depends on navigation and
selection __ based on the cmp-fields and cmr-fields of the related
entity beans. The Bean Provider can navigate from an entity bean to
other entity beans by using the names of cmr-fields in EJB QL queries.</p>
</div>
<div class="paragraph">
<p>EJB QL allows the
Bean Provider to use the abstract schema types of entity beans in a
query if the abstract persistence schemas of the beans are defined in
the same deployment descriptor as the query.</p>
</div>
<div class="paragraph">
<p>It is possible to parse and validate EJB QL
queries before entity beans are deployed because EJB QL is based on the
abstract schema types of entity beans.</p>
</div>
<div class="paragraph">
<p>EJB QL queries can be used in two different
ways:</p>
</div>
<div class="paragraph">
<p>as queries for selecting entity objects
through finder methods defined in the home interface. Finder methods
allow the results of an EJB QL query to be used by the clients of the
entity bean.</p>
</div>
<div class="paragraph">
<p>as queries for selecting entity objects or
other values derived from an entity bean’s abstract schema type through
select methods defined on the entity bean class. Select methods allow
the Bean Provider to use EJB QL to find objects or values related to the
state of an entity bean without directly exposing the results to the
client.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ejb_ql_definition"><a class="anchor" href="#_ejb_ql_definition"></a>5.2. EJB QL Definition</h3>
<div class="paragraph">
<p>EJB QL uses a SQL-like syntax to select
objects or values based on the abstract schema types and relationships
of entity beans. The path expressions of EJB QL allow the Bean Provider
to navigate over relationships defined by the cmr-fields of the abstract
schema types of entity beans.</p>
</div>
<div class="paragraph">
<p>This chapter provides the full definition of
the language.</p>
</div>
<div class="paragraph">
<p>An EJB QL query
is a string which consists of the following clauses:</p>
</div>
<div class="paragraph">
<p>a SELECT clause,
which determines the type of the objects or values to be selected.</p>
</div>
<div class="paragraph">
<p>a FROM clause,
which provides declarations that designate the domain to which the
expressions specified in the SELECT clause and WHERE clause of the query
apply.</p>
</div>
<div class="paragraph">
<p>an optional WHERE
clause, which may be used to restrict the results that are returned by
the query.</p>
</div>
<div class="paragraph">
<p>an optional ORDER BY clause, which may be
used to order the results that are returned by the query.</p>
</div>
<div class="paragraph">
<p>In BNF syntax, an EJB QL query is defined as:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">EJB QL </dt>
<dd>
<p>= select_clause from_clause</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>An EJB QL query
must always have a SELECT and a FROM clause. The square brackets []
indicate that the WHERE and ORDER BY clauses are optional.</p>
</div>
<div class="paragraph">
<p>An EJB QL query may have parameters that
correspond to the parameters of the finder or select method for which it
is defined.</p>
</div>
<div class="paragraph">
<p>An EJB QL query is statically defined in the
<em>ejb-ql</em> deployment descriptor element.</p>
</div>
</div>
<div class="sect2">
<h3 id="_abstract_schema_types_and_query_domains"><a class="anchor" href="#_abstract_schema_types_and_query_domains"></a>5.3. Abstract Schema Types and Query Domains</h3>
<div class="paragraph">
<p>EJB QL is a typed language whose design is
based on the type model of EJB 2.0 container-managed persistence. Every
expression in EJB QL has a type. The type of the expression is derived
from the structure of the expression; the abstract schema types of the
identification variable declarations; the types to which the cmp-fields
and cmr-fields evaluate; and the types of literals. The allowable types
in EJB QL are the abstract schema types of entity beans and cmp-fields.</p>
</div>
<div class="paragraph">
<p>The abstract schema type of an entity bean is
derived from its entity bean class and the information provided in the
deployment descriptor. There is a one-to-one mapping between entity bean
abstract schema types and entity bean homes. Abstract schema names, as
specified by the <em>abstract-schema-name</em> elements in the deployment
descriptor, are used to denote entity bean abstract schema types in EJB
QL.</p>
</div>
<div class="paragraph">
<p>Informally, the abstract schema type of an
entity bean can be characterized as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre> _For every get accessor method of the entity
bean class that corresponds to a_ _cmp-field element in the deployment
descriptor, there is a field (“cmp-field”) whose abstract schema type
corresponds to the result type of the accessor method._</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> _For every get accessor method of the entity
bean that corresponds to a_ _cmr-field_ _element in the deployment
descriptor, there is a field (“cmr-field”) whose type is the abstract
schema type of the entity bean denoted by the ejb-name element contained
in the corresponding ejb-relationship-role element (or, if the role has
a multiplicity of Many, a collection of such)._</pre>
</div>
</div>
<div class="paragraph">
<p>Abstract schema types are specific to the EJB
QL data model. The container is not required to implement or otherwise
materialize an abstract schema type.</p>
</div>
<div class="paragraph">
<p>The
domain of an EJB QL query consists of the abstract schema types of all
entity beans with container-managed persistence that are defined in the
same deployment descriptor.</p>
</div>
<div class="paragraph">
<p>The Bean Provider creates an ejb-jar file
which contains a deployment descriptor describing several entity beans
and their relationships. EJB QL assumes that a single deployment
descriptor in an ejb-jar file constitutes a nondecomposable unit for the
container responsible for implementing the abstract persistence schemas
of the entity beans and the relationships defined in the deployment
descriptor and the ejb-jar file. Queries can be written by utilizing
navigation over the cmr-fields of related beans supplied in the same
ejb-jar by the Bean Provider because they are implemented and managed by
the same container.</p>
</div>
<div class="paragraph">
<p>The domain of a
query may be restricted by the <em>navigability</em> of the relationships of
the entity bean on which it is based. The cmr-fields of an entity bean’s
abstract schema type determine navigability. Using the cmr-fields and
their values, a query can select related entity beans and use their
abstract schema types in the query.</p>
</div>
</div>
<div class="sect2">
<h3 id="_query_methods"><a class="anchor" href="#_query_methods"></a>5.4. Query Methods</h3>
<div class="paragraph">
<p>EJB QL is used for two types of query
methods:</p>
</div>
<div class="paragraph">
<p>Finder
methods—Finder methods are defined in the home interface(s) of an entity
bean and return entity objects or local entity objects. A finder method
that is defined on the remote home interface must return either an
EJBObject or a collection of EJBObjects; a finder method that is defined
on the local home interface must return either an EJBLocalObject or a
collection of EJBLocalObjects. The result type of a finder method
defined on the remote home interface of an entity bean is the entity
bean’s remote interface (or a collection of objects implementing the
entity bean’s remote interface). The result type of a finder method
defined on the local home interface of an entity bean is the entity
bean’s local interface (or a collection of objects implementing the
entity bean’s local interface).</p>
</div>
<div class="paragraph">
<p>Select
methods—Select methods are a special type of query method not directly
exposed through the client view. The Bean Provider typically uses select
methods to select the persistent state of an entity object or to select
entities that are related to the entity bean for which the query is
defined. The result type of a select method can be an EJBLocalObject (or
a collection of EJBLocalObjects), an EJBObject (or a collection of
EJBObjects), a cmp-field value (or a collection of such), or the result
of an aggregate function.</p>
</div>
</div>
<div class="sect2">
<h3 id="_naming"><a class="anchor" href="#_naming"></a>5.5. Naming</h3>
<div class="paragraph">
<p>Entity beans are
designated in EJB QL query strings by their abstract schema names.
The Bean Provider assigns unique abstract
schema names to entity beans as part of the development process so that
they can be used within queries. These unique names are scoped within
the deployment descriptor file.</p>
</div>
</div>
<div class="sect2">
<h3 id="_examples"><a class="anchor" href="#_examples"></a>5.6. <a id="a1882"></a>Examples</h3>
<div class="paragraph">
<p>The following convention refers to the names
used for entity beans in subsequent examples: An entity bean as a whole
is designated by <em>&lt;name&gt;EJB,</em> and its entity bean class and abstract
schema type are designated by <em>&lt;name&gt;</em> , following the convention used
to name the local interface of an entity bean.</p>
</div>
<div class="paragraph">
<p>The first example assumes that the Bean
Provider provides several entity beans, <em>OrderEJB</em> , <em>ProductEJB</em> ,
<em>LineItemEJB</em> , <em>ShippingAddressEJB</em> , and <em>BillingAddressEJB</em> . The
abstract schema types for these entity beans are <em>Order</em> , <em>Product</em> ,
<em>LineItem</em> , <em>ShippingAddress</em> , and <em>BillingAddress</em> respectively.
These beans are logically in the same ejb-jar file, as shown in
<a href="Ejb.html#a1886">See Several Entity Beans with Abstract
Persistence Schemas Defined in the Same Ejb-jar File.</a>. Only two of the
entity beans, OrderEJB and ProductEJB, have remote interfaces and remote
home interfaces.</p>
</div>
<div class="paragraph">
<p>===</p>
</div>
<div class="paragraph">
<p><a id="a1886"></a>Several Entity Beans with Abstract Persistence
Schemas Defined in the Same Ejb-jar File.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-37.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>The entity beans <em>ShippingAddress</em> and
<em>BillingAddress</em> each have one-to-many relationships with <em>Order</em> .
There is also a one-to-many relationship between <em>Order</em> and <em>Lineitem</em>
. The entity bean <em>LineItem</em> is related to <em>Product</em> in a many-to-one
relationship.</p>
</div>
<div class="paragraph">
<p>EJB QL allows the Bean Provider to specify
finder queries for OrderEJB by navigating over the cmr-fields and
cmp-fields defined by <em>Order</em> and <em>LineItem</em> . A finder method query to
find all orders with pending line items might be written as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>SELECT DISTINCT OBJECT(o)</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>_FROM Order AS o, IN(o.lineItems) AS l_</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>_WHERE l.shipped = FALSE_</pre>
</div>
</div>
<div class="paragraph">
<p>This query navigates over the cmr-field
<em>lineItems</em> of the abstract schema type <em>Order</em> to find line items, and
uses the cmp-field <em>shipped</em> of <em>LineItem</em> to select those orders that
have at least one line item that has not yet shipped. (Note that this
query does not select orders that have no line items.)</p>
</div>
<div class="paragraph">
<p>Although predefined reserved identifiers,
such as DISTINCT, OBJECT, FROM, AS, IN, WHERE, and FALSE appear in upper
case in this example, predefined reserved identifiers are case
insensitive.</p>
</div>
<div class="paragraph">
<p>The SELECT clause of this example designates
the return type of this query to be of type Order. If this query is
defined for a finder method on the entity bean’s remote home interface,
the finder method will return objects of the entity bean’s remote
interface type corresponding to the abstract schema type instances
selected by the query. If this same query is defined for a finder method
on the entity bean’s local home interface, the finder method will return
objects of the entity bean’s local interface type corresponding to these
same abstract schema type instances. Finder methods must always return
EJBObjects or EJBLocalObjects of the bean type for which the query
method is defined.</p>
</div>
<div class="paragraph">
<p>Because the same deployment descriptor
defines the abstract persistence schemas of the related entity beans,
the Bean Provider can also specify a query for <em>OrderEJB</em> that utilizes
the abstract schema type of <em>ProductEJB</em> , and hence the cmp-fields and
cmr-fields of both the abstract schema types <em>Order</em> and <em>Product</em> . For
example, if the abstract schema type <em>Product</em> has a cmp-field named
<em>product_type</em> , a finder query for <em>OrderEJB</em> can be specified using
this cmp-field. Such a finder query might be: “Find all orders for
products with product type office supplies”. An EJB QL query string for
this might be as follows.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>SELECT DISTINCT OBJECT(o)</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM Order o, IN(o.lineItems) l</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> WHERE l.product.product_type = _‘_
office_supplies’</pre>
</div>
</div>
<div class="paragraph">
<p>Because <em>Order</em> is related to <em>Product</em> by
means of the relationships between <em>Order</em> and <em>LineItem</em> and between
<em>LineItem</em> and <em>Product</em> , navigation using the cmr-fields <em>lineItems</em>
and <em>product</em> is needed to express the query. This query is specified by
using the <em>abstract-schema-name</em> for <em>OrderEJB</em> , namely <em>Order</em> , which
designates the abstract schema type over which the query ranges. The
basis for the navigation is provided by the cmr-fields <em>lineItems</em> and
<em>product</em> of the abstract schema types Order and LineItem respectively.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_from_clause_and_navigational_declarations"><a class="anchor" href="#_the_from_clause_and_navigational_declarations"></a>5.7. The FROM Clause and Navigational Declarations</h3>
<div class="paragraph">
<p>The FROM clause
of an EJB QL query defines the domain of the query by declaring
identification variables. The
domain of the query may be constrained by
path expressions.</p>
</div>
<div class="paragraph">
<p>Identification variables designate instances
of a particular entity bean abstract schema type. The FROM clause can
contain multiple identification variable declarations separated by a
comma ( <em>,</em> ).</p>
</div>
<div class="paragraph">
<p>from_clause ::= <em>FROM</em>
identification_variable_declaration<br>
[, identification_variable_declaration]*<br>
identification_variable_declaration ::= collection_member_declaration
|<br>
range_variable_declaration<br>
collection_member_declaration ::= <em>IN</em>
(collection_valued_path_expression) [ <em>AS</em> ] identifier</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">range_variable_declaration </dt>
<dd>
<p>abstract_schema_name [ <em>AS</em> ] identifier</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following subsections discuss the
constructs used in the FROM clause.</p>
</div>
</div>
<div class="sect2">
<h3 id="_identifiers"><a class="anchor" href="#_identifiers"></a>5.8. Identifiers</h3>
<div class="paragraph">
<p>An
identifier is a character sequence of unlimited length. The character
sequence must begin with a Java identifier start character, and all
other characters must be Java identifier part characters. An identifier
start character is any character for which the method
<em>Character.isJavaIdentifierStart</em> returns true. This includes the
underscore ( <em>_</em> ) character and the dollar sign ( <em>$</em> ) character. An
identifier part character is any character for which the method
<em>Character.isJavaIdentifierPart</em> returns true. The
question mark ( <em>?</em> ) character is reserved
for use by EJB QL.</p>
</div>
<div class="paragraph">
<p>The following are the reserved identifiers in
EJB QL: SELECT, FROM, WHERE, <em>DISTINCT</em> , <em>OBJECT, NULL</em> , <em>TRUE</em> ,
<em>FALSE</em> , <em>NOT</em> , <em>AND</em> , <em>OR</em> , <em>BETWEEN</em> , <em>LIKE</em> , <em>IN</em> , <em>AS</em> ,
UNKNOWN<a href="#a3378">14</a>, EMPTY, MEMBER, OF, <em>IS, AVG, MAX, MIN,
SUM, COUNT, ORDER, BY, ASC, DESC, MOD</em> .</p>
</div>
<div class="paragraph">
<p>Reserved identifiers are case insensitive.
Reserved identifiers must not be used as identification variables.</p>
</div>
<div class="paragraph">
<p>It is recommended that the Bean Provider not
use other SQL reserved words as identification variables in EJB QL
queries because they may be used as EJB QL reserved identifiers in
future versions of the EJB specification.</p>
</div>
</div>
<div class="sect2">
<h3 id="_identification_variables"><a class="anchor" href="#_identification_variables"></a>5.9. <a id="a1914"></a>Identification Variables</h3>
<div class="paragraph">
<p>An identification
variable is a valid identifier declared in the
FROM clause of an EJB QL query. An
identification variable may be declared using the special operators IN
and, optionally, AS.</p>
</div>
<div class="paragraph">
<p>All identification variables must be declared
in the FROM clause. Identification variables cannot be declared in other
clauses.</p>
</div>
<div class="paragraph">
<p>An identification variable must not be a
reserved identifier or have the same name as any of the following:</p>
</div>
<div class="paragraph">
<p>abstract-schema-name</p>
</div>
<div class="paragraph">
<p>ejb-name<a href="#a3379">15</a></p>
</div>
<div class="paragraph">
<p>Identification variables are case
insensitive.</p>
</div>
<div class="paragraph">
<p>An identification variable evaluates to a
value of the type of the expression used in declaring the variable. For
example, consider the previous finder query for OrderEJB:</p>
</div>
<div class="paragraph">
<p>SELECT DISTINCT OBJECT(o)</p>
</div>
<div class="paragraph">
<p>FROM Order o, IN(o.lineItems) l</p>
</div>
<div class="paragraph">
<p>WHERE l.product.product_type =
‘office_supplies’</p>
</div>
<div class="paragraph">
<p>In the FROM clause declaration
<em>IN(o.lineItems) l</em> , <em>_ the identification variable _l</em> evaluates to
any LineItem value directly reachable from Order. The cmr-field
<em>lineItems</em> is a collection of instances of the abstract schema type
LineItem and the identification variable <em>l</em> refers to an element of
this collection. The type of <em>l</em> is the abstract schema type of
<em>LineItem</em> .</p>
</div>
<div class="paragraph">
<p>An identification variable ranges over the
abstract schema type of an entity bean. An identification variable
designates an instance of an entity bean abstract schema type or an
element of a collection of entity bean abstract schema types instances.
Identification variables are existentially quantified in an EJB QL
query.</p>
</div>
<div class="paragraph">
<p>An identification
variable always designates a reference to a single value. It is declared
in one of two ways; as a range variable or as a collection member
identification variable:</p>
</div>
<div class="paragraph">
<p>A range variable is declared using the
abstract schema name of an entity bean.</p>
</div>
<div class="paragraph">
<p>A collection member identification variable
is declared using a collection-valued path expression.</p>
</div>
<div class="paragraph">
<p>The identification variable declarations are
evaluated from left to right in the FROM clause. A collection member
identification variable declaration can use the result of a preceding
identification variable declaration of the query string.</p>
</div>
</div>
<div class="sect2">
<h3 id="_range_variable_declarations"><a class="anchor" href="#_range_variable_declarations"></a>5.10. Range Variable Declarations</h3>
<div class="paragraph">
<p>The EJB QL syntax
for declaring an identification variable as a range variable is similar
to that of SQL; optionally, it uses the AS keyword.</p>
</div>
<div class="paragraph">
<p>range_variable_declaration ::=
abstract_schema_name [ <em>AS</em> ] identifier</p>
</div>
<div class="paragraph">
<p>Objects or values that are related to an
entity bean are typically obtained by navigation using path expressions.
However, navigation does not reach all objects. Range variable
declarations allow the Bean Provider to designate a “root” for objects
which may not be reachable by navigation.</p>
</div>
<div class="paragraph">
<p>If the Bean Provider wants to select values
by comparing more than one instance of an entity bean abstract schema
type, more than one identification variable ranging over the abstract
schema type is needed in the FROM clause.</p>
</div>
<div class="paragraph">
<p>The following finder method query returns
orders whose quantity is greater than the order quantity for John Smith.
This example illustrates the use of two different identification
variables in the FROM clause, both of the abstract schema type Order.
The SELECT clause of this query determines that it is the orders with
quantities larger than John Smith’s that are returned.</p>
</div>
<div class="paragraph">
<p>SELECT DISTINCT OBJECT(o1)</p>
</div>
<div class="paragraph">
<p>FROM Order o1, Order o2</p>
</div>
<div class="paragraph">
<p>WHERE o1.quantity &gt; o2.quantity AND</p>
</div>
<div class="literalblock">
<div class="content">
<pre>o2.customer.lastname = ‘Smith’ AND</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>o2.customer.firstname= ‘John’</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_collection_member_declarations"><a class="anchor" href="#_collection_member_declarations"></a>5.11. Collection Member Declarations</h3>
<div class="paragraph">
<p>An identification
variable declared by a collection_member_declaration ranges over values
of a collection obtained by navigation using a path expression. Such a
path expression represents a navigation involving the cmr-fields of an
entity bean abstract schema type. Because a path expression can be based
on another path expression, the navigation can use the cmr-fields of
related entity beans. Path expressions are discussed in
<a href="Ejb.html#a1956">See Path Expressions</a>.</p>
</div>
<div class="paragraph">
<p>An identification variable of a collection
member declaration is declared using a special operator, the reserved
identifier IN. The argument to the IN
operator is a collection-valued path expression. The path expression
evaluates to a collection type specified as a result of navigation to a
collection-valued cmr-field of an entity bean abstract schema type.</p>
</div>
<div class="paragraph">
<p>The syntax for declaring a collection member
identification variable is as follows:</p>
</div>
<div class="paragraph">
<p>collection_member_declaration ::= <em>IN (</em>
collection_valued_path_expression <em>)</em> [AS] identifier</p>
</div>
<div class="paragraph">
<p>For example, the FROM clause for a query
defined for <em>OrderEJB</em> might contain the following collection member
declaration:</p>
</div>
<div class="paragraph">
<p>IN(o.lineItems) l</p>
</div>
<div class="paragraph">
<p>In this example, lineItems is the name of a
cmr-field whose value is a collection of instances of the abstract
schema type LineItem of the LineItemEJB entity bean. The identification
variable <em>l</em> designates a member of this collection, a single LineItem
abstract schema type instance. In this example, <em>o</em> is an identification
variable of the abstract schema type Order.</p>
</div>
</div>
<div class="sect2">
<h3 id="_example_2"><a class="anchor" href="#_example_2"></a>5.12. Example</h3>
<div class="paragraph">
<p>The following FROM clause contains two
identification variable declaration clauses. The identification variable
declared in the first clause is used in the second clause. The clauses
declare the variables <em>o</em> and <em>l</em> respectively. The range variable
declaration <em>Order</em> AS o designates the identification variable <em>o</em> as a
range variable whose type is the abstract schema type, Order. The
identification variable <em>l</em> has the abstract schema type <em>LineItem</em> .
Because the clauses are evaluated from left to right, the identification
variable <em>l</em> can utilize the results of the navigation on <em>o</em> .</p>
</div>
<div class="literalblock">
<div class="content">
<pre>FROM Order AS o, IN(o.lineItems) l</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_path_expressions"><a class="anchor" href="#_path_expressions"></a>5.13. <a id="a1956"></a>Path Expressions</h3>
<div class="paragraph">
<p>An identification
variable followed by the navigation operator ( <em>.</em> ) and a cmp-field or
cmr-field is a path expression. The type of the path expression is the
type computed as the result of navigation; that is, the type of the
cmp-field or cmr-field to which the expression navigates.</p>
</div>
<div class="paragraph">
<p>Depending on navigability, a path expression
that leads to a cmr-field may be further composed. Path expressions can
be composed from other path expressions if the original path expression
evaluates to a single-valued type (not a collection) corresponding to a
cmr-field. A path expression that ends in a cmp-field is terminal and
cannot be further composed.</p>
</div>
<div class="paragraph">
<p>Path expression navigability is composed
using “inner join” semantics. That is, if the value of a non-terminal
cmr-field in the path expression is null, the path is considered to have
no value, and does not participate in the determination of the result.</p>
</div>
<div class="paragraph">
<p>The syntax for single-valued path expressions
and collection valued path expressions is as follows:</p>
</div>
<div class="paragraph">
<p>cmp_path_expression ::=</p>
</div>
<div class="literalblock">
<div class="content">
<pre> \{identification_variable |
single_valued_cmr_path_expression}.cmp_field</pre>
</div>
</div>
<div class="paragraph">
<p>single_valued_cmr_path_expression ::=</p>
</div>
<div class="paragraph">
<p>identification_variable.[single_valued_cmr_field
.]*single_valued_cmr_field</p>
</div>
<div class="paragraph">
<p>single_valued_path_expression ::=</p>
</div>
<div class="literalblock">
<div class="content">
<pre> cmp_path_expression |
single_valued_cmr_path_expression</pre>
</div>
</div>
<div class="paragraph">
<p>collection_valued_path_expression ::=</p>
</div>
<div class="paragraph">
<p>identification_variable.[single_valued_cmr_field.]*collection_valued_cmr_field</p>
</div>
<div class="paragraph">
<p>A <em>single_valued_cmr_field</em>
 is designated by the name of a cmr-field in
a one-to-one or many-to-one relationship. The type of a
<em>single_valued_cmr_path_expression</em> is the abstract schema type of the
related entity bean.</p>
</div>
<div class="paragraph">
<p>A <em>collection_valued_cmr_field</em>
 is designated by the name of a cmr-field in
a one-to-many or a many-to-many relationship. The type of a
<em>collection_valued_cmr_field</em> is a collection of values of the abstract
schema type of the related entity bean.</p>
</div>
<div class="paragraph">
<p>Navigation to a related entity bean results
in a value of the related entity bean’s abstract schema type.</p>
</div>
<div class="paragraph">
<p>The evaluation of a path expression
terminating in a cmp-field results in the abstract schema type
corresponding to the Java type designated by the cmp-field.</p>
</div>
<div class="paragraph">
<p>It is syntactically illegal to compose a path
expression from a path expression that evaluates to a collection. For
example, if o designates Order, the path expression o.lineItems.product
is illegal since navigation to <em>lineItems</em> results in a collection. This
case should produce an error when the EJB QL query string is verified.
To handle such a navigation, an identification variable must be declared
in the FROM clause to range over the elements of the <em>lineItems</em>
collection. Another path expression must be used to navigate over each
such element in the WHERE clause of the query, as in the following:</p>
</div>
<div class="paragraph">
<p>SELECT OBJECT(o)</p>
</div>
<div class="paragraph">
<p>FROM Order AS o, IN(o.lineItems) l</p>
</div>
<div class="paragraph">
<p>WHERE l.product.name = ‘widget’</p>
</div>
</div>
<div class="sect2">
<h3 id="_where_clause_and_conditional_expressions"><a class="anchor" href="#_where_clause_and_conditional_expressions"></a>5.14. WHERE Clause and Conditional Expressions</h3>
<div class="paragraph">
<p>The WHERE clause
of a query consists of a conditional expression used to select objects
or values that satisfy the expression. The WHERE clause thus restricts
the result of a query.</p>
</div>
<div class="paragraph">
<p>A WHERE clause is defined as follows:</p>
</div>
<div class="paragraph">
<p>where_clause ::= <em>WHERE</em>
conditional_expression</p>
</div>
<div class="paragraph">
<p>The following sections describe the language
constructs that can be used in a conditional expression of the WHERE
clause.</p>
</div>
</div>
<div class="sect2">
<h3 id="_literals"><a class="anchor" href="#_literals"></a>5.15. Literals</h3>
<div class="paragraph">
<p>A string literal
is enclosed in single quotes—for example: ‘literal’. A string literal
that includes a single quote is represented by two single quotes—for
example: ‘literal’’s’. EJB QL string literals, like Java <em>String</em>
literals, use unicode character encoding.</p>
</div>
<div class="paragraph">
<p>An exact numeric
literal is a numeric value without a decimal point, such as 57, -957,
+62. Exact numeric literals support numbers in the range of Java <em>long</em>
. Exact numeric literals use the Java integer literal syntax.</p>
</div>
<div class="paragraph">
<p>An approximate
numeric literal is a numeric value in
scientific notation, such as 7E3, -57.9E2, or a numeric value with a
decimal, such as 7., -95.7, +6.2. Approximate numeric literals support
numbers in the range of Java <em>double</em> . Approximate literals use the
Java floating point literal syntax.</p>
</div>
<div class="paragraph">
<p>The Bean Provider may utilize appropriate
suffixes to indicate the specific type of the literal in accordance with
the Java Language Specification.</p>
</div>
<div class="paragraph">
<p>The boolean
literals are <em>TRUE</em> and <em>FALSE</em> .</p>
</div>
<div class="paragraph">
<p>Although predefined reserved literals appear
in upper case, they are case insensitive.</p>
</div>
</div>
<div class="sect2">
<h3 id="_identification_variables_2"><a class="anchor" href="#_identification_variables_2"></a>5.16. Identification Variables</h3>
<div class="paragraph">
<p>All
identification variables used in the WHERE clause of an EJB QL query
must be declared in the FROM clause, as described in
<a href="Ejb.html#a1914">See Identification Variables</a>.</p>
</div>
<div class="paragraph">
<p>Identification variables are existentially
quantified in the WHERE clause. This means
that an identification variable represents a member of a collection or
an instance of an entity bean’s abstract schema type. An identification
variable never designates a collection in its entirety.</p>
</div>
</div>
<div class="sect2">
<h3 id="_path_expressions_2"><a class="anchor" href="#_path_expressions_2"></a>5.17. Path Expressions</h3>
<div class="paragraph">
<p>It is illegal to
use a <em>collection_valued_path_expression</em> within a WHERE clause as part
of a conditional expression except in an
<em>empty_collection_comparison_expression or collection_member_expression</em>
.</p>
</div>
</div>
<div class="sect2">
<h3 id="_input_parameters"><a class="anchor" href="#_input_parameters"></a>5.18. Input Parameters</h3>
<div class="paragraph">
<p>The following
rules apply to input parameters. Input parameters can only be used in
the WHERE clause of a query.</p>
</div>
<div class="paragraph">
<p>Input parameters are designated by the
question mark ( <em>?</em> ) prefix followed by an integer. For example: <em>?1</em> .</p>
</div>
<div class="paragraph">
<p>Input parameters are numbered starting from
1.</p>
</div>
<div class="paragraph">
<p>The number of distinct input parameters in an
EJB QL query must not exceed the number of input parameters for the
finder or select method. It is not required that the EJB QL query use
all of the input parameters for the finder or select method.</p>
</div>
<div class="paragraph">
<p>An input parameter evaluates to the abstract
schema type of the corresponding parameter defined in the signature of
the finder or select method with which the query is associated. It is
the responsibility of the container to map the input parameter to the
appropriate abstract schema type value.</p>
</div>
<div class="paragraph">
<p>Note that if an input parameter value is
null, comparison operations or arithmetic operations involving the input
parameter will return an unknown value. See
<a href="Ejb.html#a2207">See Null Values</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_conditional_expression_composition"><a class="anchor" href="#_conditional_expression_composition"></a>5.19. Conditional Expression Composition</h3>
<div class="paragraph">
<p>Conditional
expressions are composed of other conditional expressions, comparison
operations, logical operations, path expressions that evaluate to
boolean values, and boolean literals.</p>
</div>
<div class="paragraph">
<p>Arithmetic
expressions can be used in comparison expressions. Arithmetic
expressions are composed of other arithmetic expressions, arithmetic
operations, path expressions that evaluate to numeric values, and
numeric literals.</p>
</div>
<div class="paragraph">
<p>Arithmetic operations use numeric promotion.</p>
</div>
<div class="paragraph">
<p>Standard bracketing <em>()</em> for ordering
expression evaluation is supported.</p>
</div>
<div class="paragraph">
<p>Conditional expressions are defined as
follows:</p>
</div>
<div class="paragraph">
<p>conditional_expression ::= conditional_term |
conditional_expression <em>OR</em> conditional_term<br>
conditional_term ::= conditional_factor | conditional_term <em>AND</em>
conditional_factor<br>
conditional_factor ::= [ <em>NOT</em> ] conditional_primary<br>
conditional_primary ::= simple_cond_expression |
(conditional_expression)<br>
simple_cond_expression ::= comparison_expression | between_expression |
like_expression |<br>
in_expression | null_comparison_expression |<br>
empty_collection_comparison_expression |</p>
</div>
<div class="literalblock">
<div class="content">
<pre>collection_member_expression</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_operators_and_operator_precedence"><a class="anchor" href="#_operators_and_operator_precedence"></a>5.20. Operators and Operator Precedence</h3>
<div class="paragraph">
<p>The operators are
listed below in order of decreasing precedence.</p>
</div>
<div class="paragraph">
<p>Navigation operator ( <em>.</em> )</p>
</div>
<div class="paragraph">
<p>Arithmetic operators:</p>
</div>
<div class="paragraph">
<p>+, - unary</p>
</div>
<div class="paragraph">
<p>*, / multiplication and division</p>
</div>
<div class="paragraph">
<p>+, - addition and subtraction</p>
</div>
<div class="paragraph">
<p>Comparison operators : <em>=</em> , <em>&gt;</em> , <em>&gt;=</em> , <em>&lt;</em>
, <em>&#8656;</em> , <em>&lt;&gt;</em> (not equal)</p>
</div>
<div class="paragraph">
<p>Logical operators: <em>NOT</em> , <em>AND</em> , <em>OR</em></p>
</div>
<div class="paragraph">
<p>The following sections describe other
operators used in specific expressions.</p>
</div>
</div>
<div class="sect2">
<h3 id="_between_expressions"><a class="anchor" href="#_between_expressions"></a>5.21. Between <em>Expressions</em></h3>
<div class="literalblock">
<div class="content">
<pre> _The syntax for the use of the comparison
operator [NOT] BETWEEN in an conditional expression is as follows:_</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> _arithmetic_expression_ [ _NOT_ ] _BETWEEN_
_arithmetic-expression_ _AND_ _arithmetic-expression_</pre>
</div>
</div>
<div class="paragraph">
<p>The BETWEEN expression</p>
</div>
<div class="paragraph">
<p>x BETWEEN y AND z</p>
</div>
<div class="paragraph">
<p>is semantically equivalent to:</p>
</div>
<div class="paragraph">
<p>y &#8656; x AND x &#8656; z</p>
</div>
<div class="paragraph">
<p>The rules for unknown and NULL values in
comparison operations apply. See <a href="Ejb.html#a2207">See Null
Values</a>.</p>
</div>
<div class="paragraph">
<p>Examples are:</p>
</div>
<div class="literalblock">
<div class="content">
<pre> _p.age BETWEEN 15 and 19_ is equivalent to
_p.age &gt;= 15 AND p.age &lt;= 19_</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> _p.age NOT BETWEEN 15 and 19_ is equivalent
to _p.age &lt; 15 OR p.age &gt; 19_</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_in_expressions"><a class="anchor" href="#_in_expressions"></a>5.22. In Expressions</h3>
<div class="paragraph">
<p>The syntax for
the use of the comparison operator [NOT] IN in a conditional expression
is as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre> _cmp_path_expression_ [ _NOT_ ] _IN_ (
\{literal | input_parameter} _[_ , \{ _literal | input_parameter}]*_ )</pre>
</div>
</div>
<div class="paragraph">
<p>The <em>cmp_path_expression</em> <em>_ must have a
string or numeric value. The literal and/or input_parameter values must
be _like</em> the same abstract schema type of the cmp_path_expression in
type. (See <a href="Ejb.html#a2265">See Equality and Comparison
Semantics</a>).</p>
</div>
<div class="paragraph">
<p>Examples are:</p>
</div>
<div class="literalblock">
<div class="content">
<pre> _o.country IN (’UK’, ’US’, ’France’)_ is
true for _UK_ and false for _Peru_ , and is equivalent to the expression
_(o.country = ’UK’) OR (o.country = ’US’) OR (o.country = ’ France’)_ .</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> _o.country NOT IN (’UK’, ’US’, ’France’)_ is
false for _UK_ and true for _Peru_ , and is equivalent to the expression
_NOT ((o.country = ’UK’) OR (o.country = ’US’) OR (o.country =
’France’))_ .</pre>
</div>
</div>
<div class="paragraph">
<p>There must be at least one element in the
comma separated list that defines the set of values for the <em>IN</em>
expression.</p>
</div>
<div class="paragraph">
<p>If the value of a <em>cmp_path_expression</em> in an
IN or NOT IN expression is <em>NULL</em> or unknown, the value of the
expression is unknown.</p>
</div>
</div>
<div class="sect2">
<h3 id="_like_expressions"><a class="anchor" href="#_like_expressions"></a>5.23. Like <em>Expressions</em></h3>
<div class="literalblock">
<div class="content">
<pre> _The syntax for the use of the comparison
operator [NOT] LIKE in a conditional expression is as follows:_</pre>
</div>
</div>
<div class="paragraph">
<p> <em>cmp_path_expression</em> [ <em>NOT</em> ]
<em>LIKE</em> <em>pattern_value</em> [ <em>ESCAPE</em> <em>escape_character</em> ]</p>
</div>
<div class="paragraph">
<p>The <em>cmp_path_expression</em> must have a string
value. The <em>pattern_value</em> is a string literal or a string-valued input
parameter in which an underscore ( <em>_ ) stands for any single
character, a percent ( <em>%</em> ) character stands for any sequence of
characters (including the empty sequence), and all other characters
stand for themselves. The optional <em>escape_character</em> </em> is a
single-character string literal or a character-valued input parameter
(i.e., <em>char</em> or <em>Character</em> ) and is used to escape the special meaning
of the underscore and percent characters in <em>pattern_value</em>
<em>.<a href="#a3380">16</a></em></p>
</div>
<div class="paragraph">
<p>Examples are:</p>
</div>
<div class="literalblock">
<div class="content">
<pre> _address.phone LIKE ‘12%3’_ is true for
‘123’ ‘12993’ and false for ‘1234’</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> _asentence.word LIKE ‘l_se’_ is true for
‘lose’ and false for ‘loose’</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> _aword.underscored LIKE ‘\_%’ ESCAPE ‘\’_ is
true for ‘_foo’ and false for ‘bar’</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> _address.phone NOT LIKE ‘12%3’_ is false for
‘123’ and ‘12993’ and true for ‘1234’</pre>
</div>
</div>
<div class="paragraph">
<p>If <em>the value of the</em> <em>cmp_path_expression</em>
or <em>pattern_value</em> is <em>NULL</em> or unknown, the value of the LIKE
expression is unknown. If the <em>escape_character</em> is specified and is
<em>NULL</em> , the value of the LIKE expression is unknown.</p>
</div>
</div>
<div class="sect2">
<h3 id="_null_comparison_expressions"><a class="anchor" href="#_null_comparison_expressions"></a>5.24. Null Comparison Expressions</h3>
<div class="paragraph">
<p>The syntax for
the use of the comparison operator IS NULL in a conditional expression
is as follows:</p>
</div>
<div class="paragraph">
<p>\{single_valued_path_expression |
input_parameter } <em>IS</em> [ <em>NOT</em> ] <em>NULL</em> __</p>
</div>
<div class="paragraph">
<p>A null comparison expression tests whether or
not the single-valued path expression or input parameter is a <em>NULL</em>
value.</p>
</div>
</div>
<div class="sect2">
<h3 id="_empty_collection_comparison_expressions"><a class="anchor" href="#_empty_collection_comparison_expressions"></a>5.25. Empty Collection Comparison Expressions</h3>
<div class="paragraph">
<p>The syntax for
the use of the comparison operator IS EMPTY in an
<em>empty_collection_comparison_expression</em> is as follows:</p>
</div>
<div class="paragraph">
<p>collection_valued_path_expression <em>IS</em> [
<em>NOT</em> ] <em>EMPTY</em></p>
</div>
<div class="paragraph">
<p>This expression tests whether or not the
collection designated by the collection-valued path expression is empty
(i.e, has no elements).</p>
</div>
<div class="paragraph">
<p>Note that a collection-valued path expression
can only be used in the WHERE clause in an empty collection comparison
expression or in a collection member expression.</p>
</div>
<div class="paragraph">
<p>The collection designated by the
collection-valued path expression used in an
empty collection comparison expression must not be used in the FROM
clause for the declaration of an identification variable. An
identification variable declared as a member of a collection implicitly
designates the existence of a non-empty relationship; testing whether
the same collection is empty is contradictory. Therefore, the following
query is invalid.</p>
</div>
<div class="paragraph">
<p>SELECT OBJECT(o)</p>
</div>
<div class="paragraph">
<p>FROM Order o, IN(o.lineItems) l</p>
</div>
<div class="paragraph">
<p>WHERE o.lineItems IS EMPTY</p>
</div>
<div class="paragraph">
<p>If the value of the collection-valued path
expression in an empty collection comparison expression is unknown, the
value of the empty comparison expression is unknown.</p>
</div>
</div>
<div class="sect2">
<h3 id="_collection_member_expressions"><a class="anchor" href="#_collection_member_expressions"></a>5.26. Collection Member Expressions</h3>
<div class="paragraph">
<p>The syntax for
the use of the comparison operator MEMBER OF<a href="#a3381">17</a> in
an <em>collection_member_expression</em> is as follows:</p>
</div>
<div class="paragraph">
<p>\{single_valued_cmr_path_expression |
identification_variable | input_parameter }</p>
</div>
<div class="literalblock">
<div class="content">
<pre> _[NOT] MEMBER [OF]_
collection_valued_path_expression</pre>
</div>
</div>
<div class="paragraph">
<p>This expression tests whether the designated
value is a member of the collection specified by the collection-valued
path expression.</p>
</div>
<div class="paragraph">
<p>Note that a collection-valued path expression
can only be used in the WHERE clause in an empty collection comparison
expression or in a collection member expression.</p>
</div>
<div class="paragraph">
<p>If the collection valued path expression
designates an empty collection, the value of the MEMBER OF expression is
FALSE and the value of the NOT MEMBER OF expression is TRUE. Otherwise,
if the value of the collection-valued path
expression or single-valued cmr path expression in the collection member
expression is unknown, the value of the collection member expression is
unknown.</p>
</div>
</div>
<div class="sect2">
<h3 id="_functional_expressions"><a class="anchor" href="#_functional_expressions"></a>5.27. Functional Expressions</h3>
<div class="paragraph">
<p>EJB QL includes
the following built-in functions<a href="#a3382">18</a>, which may be
used in the WHERE clause of a query.</p>
</div>
<div class="paragraph">
<p>String Functions:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_CONCAT(String, String)_ returns a _String_</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> _SUBSTRING(String, start, length)_ returns a
_String_</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> _LOCATE(String, String [,
start])link:#a3383[19]_ returns an _int_</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>_LENGTH(String)_ returns an _int_</pre>
</div>
</div>
<div class="paragraph">
<p>Note that <em>start</em> and <em>length</em> are integer
values. The first position in a string is designated as <em>1</em> by these
functions.</p>
</div>
<div class="paragraph">
<p>Arithmetic Functions:</p>
</div>
<div class="literalblock">
<div class="content">
<pre> _ABS(number)_ returns a number ( _int_ ,
_float_ , or _double_ ) of the same type as the argument to the function</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>_SQRT(double)_ returns a _double_</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>_MOD(int, int)_ returns an _int_</pre>
</div>
</div>
<div class="paragraph">
<p>Numeric arguments to these functions may
correspond to the numeric Java object types as well as the primitive
numeric types.</p>
</div>
<div class="paragraph">
<p>If the value of any argument to a functional
expression is null or unknown, the value of the functional expression is
unknown.</p>
</div>
</div>
<div class="sect2">
<h3 id="_select_clause"><a class="anchor" href="#_select_clause"></a>5.28. SELECT Clause</h3>
<div class="paragraph">
<p>The SELECT clause
denotes the query result. The SELECT clause contains either a single
range variable that ranges over an entity bean abstract schema type, a
single-valued path expression, or an aggregate select expression. In the
case of a finder method, the SELECT clause is restricted to contain
either a single range variable or a single-valued path expression that
evaluates to the abstract schema type of the entity bean for which the
finder method is defined.</p>
</div>
<div class="paragraph">
<p>The SELECT clause has the following syntax:</p>
</div>
<div class="paragraph">
<p>select_clause ::= <em>SELECT</em> [ <em>DISTINCT</em> ]
\{select_expression | <em>OBJECT</em> (identification_variable)}</p>
</div>
<div class="paragraph">
<p>select_expression ::=
single_valued_path_expression | aggregate_select_expression</p>
</div>
<div class="paragraph">
<p>aggregate_select_expression ::=</p>
</div>
<div class="literalblock">
<div class="content">
<pre> \{ _AVG_ | _MAX_ | _MIN_ | _SUM_ | _COUNT_
_}_ _(_ [ _DISTINCT_ ] cmp_path_expression _)_ |</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> _COUNT (_ [ _DISTINCT_ ]
identification_variable | single_valued_cmr_path_expression _)_</pre>
</div>
</div>
<div class="paragraph">
<p>All standalone identification variables in
the SELECT clause must be qualified by the
OBJECT operator. The SELECT clause must not
use the OBJECT operator to qualify path expressions.</p>
</div>
<div class="paragraph">
<p>Note that the SELECT clause must be specified
to return a single-valued expression. The query below is therefore not
valid:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_SELECT o.lineItems FROM Order AS o_</pre>
</div>
</div>
<div class="paragraph">
<p>The DISTINCT
keyword is used to specify that duplicate values must be eliminated from
the query result. If DISTINCT is not specified, duplicate values are not
eliminated unless the query is specified for a method whose result type
is <em>java.util.Set.</em> If a query is specified for a method whose result
type is <em>java.util.Set</em> , but does not specify DISTINCT, the container
must interpret the query as if SELECT
DISTINCT had been specified. In general, however, the Bean Provider
should specify the DISTINCT keyword when writing queries for methods
that return <em>java.util.Set</em> .</p>
</div>
<div class="paragraph">
<p>The SELECT clause determines the type of the
values returned by a query. For example, the following query returns a
collection of products:</p>
</div>
<div class="paragraph">
<p>SELECT l.product FROM Order AS o,
IN(o.lineItems) l</p>
</div>
<div class="paragraph">
<p>It is the responsibility of the container to
map the abstract schema types returned by the query to the Java types
that are returned by the finder or select method with which the query is
associated and to materialize those return types, as described in
<a href="Ejb.html#a2190">See Return Value Types</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_null_values_in_the_query_result"><a class="anchor" href="#_null_values_in_the_query_result"></a>5.29. Null Values in the Query Result</h3>
<div class="paragraph">
<p>If the result of an EJB QL query corresponds
to a cmr-field or cmp-field whose value is null, the container must
include that null value in the result that is returned by the finder or
select method. The Bean Provider can use the IS NOT NULL construct to
eliminate such null values from the result set of the query.</p>
</div>
<div class="paragraph">
<p>If the finder or select method is a
single-object finder or select method, and the result set of the query
consists of a single null value, the container must return the null
value as the result of the method. If the result set of a query for a
single-object finder or select method contains more than one value
(whether non-null, null, or a combination), the container must throw the
FinderException.</p>
</div>
<div class="paragraph">
<p>Note, however, that cmp-field types defined
in terms of Java numeric primitive types cannot produce NULL values in
the query result. An EJB QL query that returns such a cmp-field type as
a result type must not return a null value. (If the Bean Provider wishes
to allow null values for cmp-fields, he or she should specify those
cmp-fields to have the equivalent Java object types instead of primitive
types, e.g., <em>Integer</em> rather than <em>int</em> .)</p>
</div>
</div>
<div class="sect2">
<h3 id="_aggregate_functions_in_the_select_clause"><a class="anchor" href="#_aggregate_functions_in_the_select_clause"></a>5.30. Aggregate Functions in the SELECT Clause</h3>
<div class="paragraph">
<p>The result of an EJB QL query may be the
result of an aggregate function applied to a path expression.</p>
</div>
<div class="paragraph">
<p>The following aggregate functions can be used
in the SELECT clause of an EJB QL query: AVG, COUNT, MAX, MIN, SUM.</p>
</div>
<div class="paragraph">
<p>For all aggregate functions except COUNT, the
path expression that is the argument to the aggregate function must
terminate in a cmp-field. The path expression argument to COUNT may
terminate in either a cmp-field or a cmr-field, or the argument to COUNT
may be an identification variable.</p>
</div>
<div class="paragraph">
<p>Arguments to the functions SUM and AVG must
be numeric. Arguments to the functions MAX and MIN must correspond to
orderable cmp-field types (i.e., numeric types, string types, character
types, or date types).</p>
</div>
<div class="paragraph">
<p>The argument to an aggregate function
may be preceded by the keyword DISTINCT to specify that duplicate values
are to be eliminated before the aggregate function is
applied.<a href="#a3384">20</a></p>
</div>
<div class="paragraph">
<p>Null values are eliminated before the
aggregate function is applied, regardless of whether the keyword
DISTINCT is specified.</p>
</div>
</div>
<div class="sect2">
<h3 id="_examples_2"><a class="anchor" href="#_examples_2"></a>5.31. Examples</h3>
<div class="paragraph">
<p>The following example returns all line items
related to some order:</p>
</div>
<div class="paragraph">
<p>SELECT OBJECT(l)</p>
</div>
<div class="paragraph">
<p>FROM Order o, IN(o.lineItems) l</p>
</div>
<div class="paragraph">
<p>The following query returns all line items
regardless of whether a line item is related to any order or product:</p>
</div>
<div class="paragraph">
<p>SELECT OBJECT(l)</p>
</div>
<div class="paragraph">
<p>FROM LineItems AS l</p>
</div>
<div class="paragraph">
<p>The following query returns the average order
quantity:</p>
</div>
<div class="paragraph">
<p>SELECT AVG(o.quantity)</p>
</div>
<div class="paragraph">
<p>FROM Order o</p>
</div>
<div class="paragraph">
<p>The following query returns the total cost of
the items that John Smith has ordered.</p>
</div>
<div class="paragraph">
<p>SELECT SUM(l.price)</p>
</div>
<div class="paragraph">
<p>FROM Order o, IN(o.lineItems) l</p>
</div>
<div class="paragraph">
<p>WHERE o.customer.lastname = ‘Smith’ AND
o.customer.firstname = ‘John’</p>
</div>
<div class="paragraph">
<p>The following query returns the number of
items in John Smith’s entire order.</p>
</div>
<div class="paragraph">
<p>SELECT COUNT(l)</p>
</div>
<div class="paragraph">
<p>FROM Order o, IN(o.lineItems) l</p>
</div>
<div class="paragraph">
<p>WHERE o.customer.lastname = ‘Smith’ AND
o.customer.firstname = ‘John’</p>
</div>
<div class="paragraph">
<p>The following query returns the total number
of orders.</p>
</div>
<div class="paragraph">
<p>SELECT COUNT(o)</p>
</div>
<div class="paragraph">
<p>FROM Order o</p>
</div>
<div class="paragraph">
<p>The following query counts the number of
items in John Smith’s order for which prices have been specified.</p>
</div>
<div class="paragraph">
<p>SELECT COUNT(l.price)</p>
</div>
<div class="paragraph">
<p>FROM Order o, IN(o.lineItems) l</p>
</div>
<div class="paragraph">
<p>WHERE o.customer.lastname = ‘Smith’ AND
o.customer.firstname = ‘John’</p>
</div>
<div class="paragraph">
<p>Note that this is equivalent to:</p>
</div>
<div class="paragraph">
<p>SELECT COUNT(l)</p>
</div>
<div class="paragraph">
<p>FROM Order o, IN(o.lineItems) l</p>
</div>
<div class="paragraph">
<p>WHERE o.customer.lastname = ‘Smith’ AND
o.customer.firstname = ‘John’</p>
</div>
<div class="paragraph">
<p>AND l.price IS NOT NULL</p>
</div>
</div>
<div class="sect2">
<h3 id="_order_by_clause"><a class="anchor" href="#_order_by_clause"></a>5.32. ORDER BY Clause</h3>
<div class="paragraph">
<p>The ORDER BY clause allows the objects or
values that are returned by the query to be ordered.</p>
</div>
<div class="paragraph">
<p>The syntax of the ORDER BY clause is</p>
</div>
<div class="paragraph">
<p>orderby_clause ::= <em>ORDER BY</em> orderby_item [,
orderby_item]*</p>
</div>
<div class="paragraph">
<p>orderby_item ::= cmp_path_expression</p>
</div>
<div class="paragraph">
<p>When the ORDER BY clause is used in an EJB QL
query, the SELECT clause of the query must be one of the following:</p>
</div>
<div class="paragraph">
<p>an identification variable x, denoted as
OBJECT(x)</p>
</div>
<div class="paragraph">
<p>a <em>single_valued_cmr_path_expression</em></p>
</div>
<div class="paragraph">
<p>a <em>cmp_path_expression</em></p>
</div>
<div class="paragraph">
<p>In the first two cases, each <em>orderby_item</em>
must be an orderable cmp-field of the entity bean abstract schema type
value returned by the SELECT clause. In the third case, the
<em>orderby_item</em> must evaluate to the same cmp-field of the same entity
bean abstract schema type as the <em>cmp_path_expression</em> in the SELECT
clause.</p>
</div>
<div class="paragraph">
<p>For example, the first two queries below are
legal, but the third and fourth are not.</p>
</div>
<div class="paragraph">
<p>SELECT OBJECT(o)</p>
</div>
<div class="paragraph">
<p>FROM Customer c, IN(c.orders) o</p>
</div>
<div class="paragraph">
<p>WHERE c.address.state = ‘CA’</p>
</div>
<div class="paragraph">
<p>ORDER BY o.quantity, o.totalcost</p>
</div>
<div class="paragraph">
<p>SELECT o.quantity</p>
</div>
<div class="paragraph">
<p>FROM Customer c, IN(c.orders) o</p>
</div>
<div class="paragraph">
<p>WHERE c.address.state = ‘CA’</p>
</div>
<div class="paragraph">
<p>ORDER BY o.quantity</p>
</div>
<div class="paragraph">
<p>SELECT l.product.product_name</p>
</div>
<div class="paragraph">
<p>FROM Order o, IN(o.lineItems) l</p>
</div>
<div class="paragraph">
<p>WHERE o.customer.lastname = ‘Smith’ AND
o.customer.firstname = ‘John’</p>
</div>
<div class="paragraph">
<p>ORDER BY l.product.price</p>
</div>
<div class="paragraph">
<p>SELECT l.product.product_name</p>
</div>
<div class="paragraph">
<p>FROM Order o, IN(o.lineItems) l</p>
</div>
<div class="paragraph">
<p>WHERE o.customer.lastname = ‘Smith’ AND
o.customer.firstname = ‘John’</p>
</div>
<div class="paragraph">
<p>ORDER BY o.quantity</p>
</div>
<div class="paragraph">
<p>If more than one <em>orderby_item</em> is specified,
the left-to-right sequence of the <em>orderby_item</em> elements determines the
precedence, whereby the leftmost <em>orderby_item</em> has highest precedence.</p>
</div>
<div class="paragraph">
<p>The keyword ASC specifies that ascending
ordering be used; the keyword DESC specifies that descending ordering be
used. Ascending ordering is the default.</p>
</div>
<div class="paragraph">
<p>SQL rules for the ordering of null values
apply: that is, all null values must appear before all non-null values
in the ordering or all null values must appear after all non-null values
in the ordering, but it is not specified which.</p>
</div>
<div class="paragraph">
<p>It is the container’s responsibility to
ensure that the ordering of the query result is preserved in the result
of the finder or select method if the ORDER BY clause is used.</p>
</div>
</div>
<div class="sect2">
<h3 id="_return_value_types"><a class="anchor" href="#_return_value_types"></a>5.33. <a id="a2190"></a>Return Value Types</h3>
<div class="paragraph">
<p>The value of a query result, specified by the
SELECT clause, is an entity bean abstract
schema type, a cmp-field type, or the result of an aggregate function.
The finder or select method with which the query is associated in the
deployment descriptor determines how this result is mapped to the Java
type that is visible as the result of the query method.</p>
</div>
<div class="paragraph">
<p>How the result
type of a query is mapped depends on whether the query is defined for a
finder method on the remote home interface, for a finder method on the
local home interface, or for a select method.</p>
</div>
<div class="paragraph">
<p>The result type of a query for a finder
method must be the entity bean abstract schema type that corresponds to
the entity bean type of the entity bean on whose home interface the
finder method is defined. If the query is used for a finder method
defined on the remote home interface of the bean, the result of the
finder method is the entity bean’s remote interface (or a collection of
objects implementing the entity bean’s remote interface). If the finder
method is defined on the local home interface, the result is the entity
bean’s local interface (or a collection of objects implementing the
entity bean’s local interface).</p>
</div>
<div class="paragraph">
<p>If the result type of a query for a select
method is an entity bean abstract schema type, the return values for the
query method are instances of the entity bean’s local interface or
instances of the entity bean’s remote interface, depending on whether
the value of the <em>result-type-mapping</em>
deployment descriptor element contained in the <em>query</em> element for the
select method is <em>Local</em> or <em>Remote</em> . The default value for
<em>result-type-mapping</em> is <em>Local</em> .</p>
</div>
<div class="paragraph">
<p>If the result type of a query used for a
select method is an abstract schema type corresponding to a cmp-field
type (excluding queries whose SELECT clause uses one of the aggregate
functions AVG, COUNT, MAX, MIN, SUM), the result type of the select
method is as follows:</p>
</div>
<div class="paragraph">
<p>If the Java type of the cmp-field is an
object type and the select method is a single-object select method, the
result of the select method is an instance of that object type. If the
select method is a multi-object select method, the result is a
collection of instances of that type.</p>
</div>
<div class="paragraph">
<p>If the Java type of the cmp-field is a
primitive Java type (e.g., int), and the select method is a
single-object select method, the result of the select method is that
primitive type.</p>
</div>
<div class="paragraph">
<p>If the Java type of the cmp-field is a
primitive Java type (e.g., int), and the select method is a multi-object
select method, the result of the select method is a collection of values
of the corresponding wrappered type (e.g., Integer).</p>
</div>
<div class="paragraph">
<p>If the select method query is an aggregate
query, the select method must be a single-object select method.</p>
</div>
<div class="paragraph">
<p>The result type of the select method must be
a primitive type, a wrappered type, or an object type that is compatible
with the standard JDBC conversion mappings for the type of the cmp-field
<a href="Ejb.html#a3335">See JDBC™ 4.1 API (JDBC specification).</a>.</p>
</div>
<div class="paragraph">
<p>If the aggregate query uses the SUM, AVG,
MAX, or MIN operator, and the result type of the select method is an
object type and there are no values to which the aggregate function can
be applied, the select method returns null.</p>
</div>
<div class="paragraph">
<p>If the aggregate query uses the SUM, AVG,
MAX, or MIN operator, and the result type of the select method is a
primitive type and there are no values to which the aggregate function
can be applied, the container must throw the <em>ObjectNotFoundException</em> .</p>
</div>
<div class="paragraph">
<p>If the aggregate query uses the COUNT
operator, the result of the select method should be an exact numeric
type. If there are no values to which the COUNT method can be applied,
the result of the select method is 0.</p>
</div>
<div class="paragraph">
<p>The result of a finder or select method may
contain a null value if a cmp-field or cmr-field in the query result is
null.</p>
</div>
</div>
<div class="sect2">
<h3 id="_null_values"><a class="anchor" href="#_null_values"></a>5.34. <a id="a2207"></a>Null Values</h3>
<div class="paragraph">
<p>When the target
of a reference does not exist in the persistent store, its value is
regarded as <em>NULL</em> . SQL 92 <em>NULL</em> semantics
<a href="Ejb.html#a3331">See Database Language SQL. ANSI X3.135-1992
or ISO/IEC 9075:1992.</a> defines the evaluation of conditional expressions
containing <em>NULL</em> values.</p>
</div>
<div class="paragraph">
<p>The following is a brief description of these
semantics:</p>
</div>
<div class="paragraph">
<p>Comparison or arithmetic operations with a
NULL value always yield an unknown value.</p>
</div>
<div class="paragraph">
<p>Two NULL values are not considered to be
equal, the comparison yields an unknown value.</p>
</div>
<div class="paragraph">
<p>Comparison or arithmetic operations with an
unknown value always yield an unknown value.</p>
</div>
<div class="paragraph">
<p>The IS NULL and IS NOT NULL operators convert
a <em>NULL</em> cmp-field or single-valued cmr-field value into the respective
TRUE or FALSE value.</p>
</div>
<div class="paragraph">
<p>Boolean operators use three valued logic,
defined by <a href="Ejb.html#a2216">See Definition of the AND
Operator</a>, <a href="Ejb.html#a2235">See Definition of the OR
Operator</a>, and <a href="Ejb.html#a2254">See Definition of the NOT
Operator</a>.</p>
</div>
<div class="paragraph">
<p>===</p>
</div>
<div class="paragraph">
<p>Definition of the <a id="a2216"></a>AND
Operator</p>
</div>
<div class="paragraph">
<p>AND</p>
</div>
<div class="literalblock">
<div class="content">
<pre>T</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>F</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>U</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>T</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>T</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>F</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>U</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>F</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>F</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>F</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>F</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>U</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>U</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>F</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>U</pre>
</div>
</div>
<div class="paragraph">
<p>===</p>
</div>
<div class="paragraph">
<p>Definition of the <a id="a2235"></a>OR
Operator</p>
</div>
<div class="paragraph">
<p>OR</p>
</div>
<div class="literalblock">
<div class="content">
<pre>T</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>F</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>U</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>T</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>T</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>T</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>T</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>F</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>T</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>F</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>U</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>U</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>T</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>U</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>U</pre>
</div>
</div>
<div class="paragraph">
<p>===</p>
</div>
<div class="paragraph">
<p>Definition of the <a id="a2254"></a>NOT
Operator</p>
</div>
<div class="paragraph">
<p>NOT</p>
</div>
<div class="literalblock">
<div class="content">
<pre>T</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>F</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>F</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>T</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>U</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>U</pre>
</div>
</div>
<div class="paragraph">
<p>Note: EJB QL defines the
empty string, ‘’, as a string with 0 length,
which is not equal to a NULL value. However, NULL values and empty
strings may not always be distinguished when queries are mapped to some
persistent stores. The Bean Provider should therefore not rely on the
semantics of EJB QL comparisons involving the empty string and NULL
value.</p>
</div>
</div>
<div class="sect2">
<h3 id="_equality_and_comparison_semantics"><a class="anchor" href="#_equality_and_comparison_semantics"></a>5.35. <a id="a2265"></a>Equality and Comparison Semantics</h3>
<div class="paragraph">
<p>EJB QL only
permits the values of <em>like</em> types to be compared. A type is <em>like</em>
another type if they correspond to the same Java language type, or if
one is a primitive Java language type and the other is the wrappered
Java class type equivalent (e.g., <em>int</em> and <em>Integer</em> are like types in
this sense). There is one exception to this rule: it is valid to compare
numeric values for which the rules of numeric promotion apply.
Conditional expressions attempting to compare non-like type values are
disallowed except for this numeric case.</p>
</div>
<div class="paragraph">
<p>Note that EJB QL permits the arithmetic
operators and comparison operators to be applied to cmp-fields and input
parameters of the wrappered Java class equivalents to the primitive
numeric Java types.</p>
</div>
<div class="paragraph">
<p>Two entity objects of the same abstract
schema type are equal if and only if they have the same primary key
value.</p>
</div>
</div>
<div class="sect2">
<h3 id="_restrictions"><a class="anchor" href="#_restrictions"></a>5.36. Restrictions</h3>
<div class="paragraph">
<p>Date and time
values should use the standard Java <em>long</em> millisecond value. The
standard way to produce millisecond values is to use
<em>java.util.Calendar</em> .</p>
</div>
<div class="paragraph">
<p>Although SQL
requires support for fixed decimal comparison in arithmetic expressions,
EJB QL does not. For this reason EJB QL restricts exact numeric literals
to those without a decimal point (and numerics with a decimal point as
an alternate representation for approximate numeric values).</p>
</div>
<div class="paragraph">
<p>Support for the BigDecimal and BigInteger
types is optional for containers in EJB 2.1. Applications that depend on
such types in EJB QL queries may not be portable.</p>
</div>
<div class="literalblock">
<div class="content">
<pre> _Boolean_ comparison is restricted to _=_
and _&lt;&gt;_ .</pre>
</div>
</div>
<div class="paragraph">
<p>EJB QL does not
support the use of comments.</p>
</div>
<div class="paragraph">
<p>The data model
for container-managed persistence does not currently support
inheritance. Therefore, entity objects of different types cannot be
compared. EJB QL queries that contain such comparisons are invalid.</p>
</div>
</div>
<div class="sect2">
<h3 id="_examples_3"><a class="anchor" href="#_examples_3"></a>5.37. Examples</h3>
<div class="paragraph">
<p>The following
examples illustrate the syntax and semantics of EJB QL. These examples
are based on the example presented in <a href="Ejb.html#a1882">See
Examples</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_simple_queries"><a class="anchor" href="#_simple_queries"></a>5.38. Simple Queries</h3>
<div class="paragraph">
<p>Find all orders:</p>
</div>
<div class="paragraph">
<p>SELECT OBJECT(o)</p>
</div>
<div class="paragraph">
<p>FROM Order o</p>
</div>
<div class="paragraph">
<p>Find all orders that need to be shipped to
California:</p>
</div>
<div class="paragraph">
<p>SELECT OBJECT(o)</p>
</div>
<div class="paragraph">
<p>FROM Order o</p>
</div>
<div class="paragraph">
<p>WHERE o.shipping_address.state = ‘CA’</p>
</div>
<div class="paragraph">
<p>Find all states for which there are orders:</p>
</div>
<div class="paragraph">
<p>SELECT DISTINCT o.shipping_address.state</p>
</div>
<div class="paragraph">
<p>FROM Order o</p>
</div>
</div>
<div class="sect2">
<h3 id="_queries_with_relationships"><a class="anchor" href="#_queries_with_relationships"></a>5.39. Queries with Relationships</h3>
<div class="paragraph">
<p>Find all orders that have line items:</p>
</div>
<div class="paragraph">
<p>SELECT DISTINCT OBJECT(o)</p>
</div>
<div class="paragraph">
<p>FROM Order o, IN(o.lineItems) l</p>
</div>
<div class="paragraph">
<p>Note that the result of this query does not
include orders with no associated line items. This query can also be
written as:</p>
</div>
<div class="paragraph">
<p>SELECT OBJECT(o)</p>
</div>
<div class="paragraph">
<p>FROM Order o</p>
</div>
<div class="paragraph">
<p>WHERE o.lineItems IS NOT EMPTY</p>
</div>
<div class="paragraph">
<p>Find all orders that have no line items:</p>
</div>
<div class="paragraph">
<p>SELECT OBJECT(o)</p>
</div>
<div class="paragraph">
<p>FROM Order o</p>
</div>
<div class="paragraph">
<p>WHERE o.lineItems IS EMPTY</p>
</div>
<div class="paragraph">
<p>Find all pending orders:</p>
</div>
<div class="paragraph">
<p>SELECT DISTINCT OBJECT(o)</p>
</div>
<div class="paragraph">
<p>FROM Order o, IN(o.lineItems) l</p>
</div>
<div class="paragraph">
<p>WHERE l.shipped = FALSE</p>
</div>
<div class="paragraph">
<p>Find all orders in which the shipping address
differs from the billing address. This example assumes that the Bean
Provider uses two distinct entity beans to designate shipping and
billing addresses, as in <a href="Ejb.html#a1886">See Several Entity
Beans with Abstract Persistence Schemas Defined in the Same Ejb-jar
File.</a>.</p>
</div>
<div class="paragraph">
<p>SELECT OBJECT(o)</p>
</div>
<div class="paragraph">
<p>FROM Order o</p>
</div>
<div class="paragraph">
<p>WHERE</p>
</div>
<div class="paragraph">
<p>NOT (o.shipping_address.state =
o.billing_address.state AND</p>
</div>
<div class="literalblock">
<div class="content">
<pre> o.shipping_address.city =
o.billing_address.city AND</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> o.shipping_address.street =
o.billing_address.street)</pre>
</div>
</div>
<div class="paragraph">
<p>If the Bean Provider uses a single entity
bean in two different relationships for both the shipping address and
the billing address, the above expression can be simplified based on the
equality rules defined in Section <a href="Ejb.html#a2265">See
Equality and Comparison Semantics</a>. The query can then be written as:</p>
</div>
<div class="paragraph">
<p>SELECT OBJECT(o)</p>
</div>
<div class="paragraph">
<p>FROM Order o</p>
</div>
<div class="paragraph">
<p>WHERE o.shipping_address &lt;&gt; o.billing_address</p>
</div>
<div class="paragraph">
<p>The query checks whether the same entity bean
abstract schema type instance (identified by its primary key) is related
to an order through two distinct relationships.</p>
</div>
<div class="paragraph">
<p>Find all orders for a book titled ‘Applying
Enterprise JavaBeans: Component-Based Development for the J2EE
Platform’:</p>
</div>
<div class="paragraph">
<p>SELECT DISTINCT OBJECT(o)</p>
</div>
<div class="paragraph">
<p>FROM Order o, IN(o.lineItems) l</p>
</div>
<div class="paragraph">
<p>WHERE l.product.type = ‘book’ AND</p>
</div>
<div class="literalblock">
<div class="content">
<pre> l.product.name = ‘Applying Enterprise
JavaBeans:</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> Component-Based Development for the J2EE
Platform’</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_queries_using_input_parameters"><a class="anchor" href="#_queries_using_input_parameters"></a>5.40. Queries Using Input Parameters</h3>
<div class="paragraph">
<p>The following query finds the orders for a
product whose name is designated by an input parameter:</p>
</div>
<div class="paragraph">
<p>SELECT DISTINCT OBJECT(o)</p>
</div>
<div class="paragraph">
<p>FROM Order o, IN(o.lineItems) l</p>
</div>
<div class="paragraph">
<p>WHERE l.product.name = ?1</p>
</div>
<div class="paragraph">
<p>For this query, the input parameter must be
of the type of the cmp-field name, i.e., a string.</p>
</div>
</div>
<div class="sect2">
<h3 id="_queries_for_select_methods"><a class="anchor" href="#_queries_for_select_methods"></a>5.41. Queries for Select Methods</h3>
<div class="paragraph">
<p>The following select queries illustrate the
selection of values other than entity beans.</p>
</div>
<div class="paragraph">
<p>The following EJB QL query selects the names
of all products that have been ordered.</p>
</div>
<div class="paragraph">
<p>SELECT DISTINCT l.product.name</p>
</div>
<div class="paragraph">
<p>FROM Order o, IN(o.lineItems) l</p>
</div>
<div class="paragraph">
<p>The following query finds the names of all
products in the order specified by a particular order number. The order
number is specified by a parameter that corresponds to the primary key
of Order. Note that because this query does not specify DISTINCT in its
SELECT clause, if it is specified for a query method whose return type
is <em>java.util.Collection</em> , the collection that is returned may contain
duplicates. In this example, such duplicates correspond to products that
have been ordered multiple times in the given order.</p>
</div>
<div class="paragraph">
<p>SELECT l.product.name</p>
</div>
<div class="paragraph">
<p>FROM Order o, IN(o.lineItems) l</p>
</div>
<div class="paragraph">
<p>WHERE o.ordernumber = ?1</p>
</div>
<div class="paragraph">
<p>It is the responsibility of the container to
interpret the query such that no duplicates are produced if the result
type of the query method is <em>java.util.Set</em> .</p>
</div>
<div class="paragraph">
<p>Consider the following query for a select
method:</p>
</div>
<div class="paragraph">
<p>SELECT o.shipping_address.city</p>
</div>
<div class="paragraph">
<p>FROM Order o</p>
</div>
<div class="paragraph">
<p>This query
returns the names of all the cities of the shipping addresses of all
orders. The result type of the select method, which is either
<em>java.util.Collection</em> or <em>java.util.Set</em> , determines whether the query
may return duplicate city names.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ejb_ql_and_sql"><a class="anchor" href="#_ejb_ql_and_sql"></a>5.42. EJB QL and SQL</h3>
<div class="paragraph">
<p>EJB QL, like SQL,
treats the FROM clause as a cartesian product. The
FROM clause is similar to that of SQL in
that the declared identification variables affect the results of the
query even if they are not used in the WHERE clause. The Bean Provider
should use caution in defining identification variables because the
domain of the query can depend on whether there are any values of the
declared type.</p>
</div>
<div class="paragraph">
<p>For example, the FROM clause below defines a
query over all orders that have line items and existing products. If
there are no Product instances in the persistent store, the domain of
the query is empty and no order is selected.</p>
</div>
<div class="paragraph">
<p>SELECT OBJECT(o)</p>
</div>
<div class="paragraph">
<p>FROM Order AS o, IN(o.lineItems) l, Product p</p>
</div>
<div class="paragraph">
<p>The container can represent the abstract
schemas of a set of entity beans in an application using a relational
database. There are multiple ways to define a mapping to a set of tables
in a relational database. Although this area is beyond the scope of this
specification, a sample mapping and translation of EJB QL to SQL is
described to clarify the semantics of EJB QL.</p>
</div>
<div class="paragraph">
<p>A mapping strategy from a set of entity beans
to a relational database might be to map each entity bean to a separate
table. One-to-many relationships may be represented by
foreign keys in the related table from the
many side and many-to-many relationships may be represented by using an
auxiliary table that contains the primary keys of the related objects.</p>
</div>
<div class="paragraph">
<p>Because the FROM clause represents a
cartesian product, the SQL result may
contain duplicates. If the query is for a method whose return type is
<em>java.util.Set</em> , the container would therefore typically utilize a
SELECT DISTINCT clause in translating the
query to SQL. The query method result may contain duplicates if the
return type of the query method is <em>java.util.Collection</em> and DISTINCT
is not specified in the SELECT clause of the EJB QL query.</p>
</div>
<div class="paragraph">
<p>The following translation example illustrates
the mapping of entity beans to relational database tables. The entity
bean OrderEJB is represented by the table ORDER and the entity bean
LineItemEJB is represented by the table LINEITEM. The column OKEY
represents the primary key for OrderEJB entity bean, FKEY represents the
foreign key column of LINEITEM that holds the values of the ORDER
primary keys. FKEY is defined in the LINEITEM table to model the
one-to-many relationship.</p>
</div>
<div class="paragraph">
<p>Using this mapping, the following EJB QL
finder query</p>
</div>
<div class="paragraph">
<p>SELECT OBJECT(o)</p>
</div>
<div class="paragraph">
<p>FROM Order o, IN(o.lineItems) l</p>
</div>
<div class="paragraph">
<p>WHERE l.quantity &gt; 5</p>
</div>
<div class="paragraph">
<p>might be represented in SQL as</p>
</div>
<div class="paragraph">
<p>SELECT DISTINCT o.OKEY</p>
</div>
<div class="paragraph">
<p>FROM ORDERBEAN o, LINEITEM l</p>
</div>
<div class="paragraph">
<p>WHERE o.OKEY = l.FKEY AND l.QUANTITY &gt; 5</p>
</div>
</div>
<div class="sect2">
<h3 id="_ejb_ql_bnf"><a class="anchor" href="#_ejb_ql_bnf"></a>5.43. EJB QL BNF</h3>
<div class="paragraph">
<p>EJB QL BNF
notation summary:</p>
</div>
<div class="paragraph">
<p>\{ &#8230;&#8203; } grouping</p>
</div>
<div class="paragraph">
<p>[ &#8230;&#8203; ] optional constructs</p>
</div>
<div class="paragraph">
<p>boldface keywords</p>
</div>
<div class="paragraph">
<p>The following is the complete BNF notation
for EJB QL:</p>
</div>
<div class="paragraph">
<p>EJB QL ::= select_clause from_clause</p>
</div>
<div class="paragraph">
<p>from_clause ::= <em>FROM</em>
identification_variable_declaration</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[, identification_variable_declaration]*</pre>
</div>
</div>
<div class="paragraph">
<p>identification_variable_declaration ::=
collection_member_declaration |</p>
</div>
<div class="literalblock">
<div class="content">
<pre>range_variable_declaration</pre>
</div>
</div>
<div class="paragraph">
<p>collection_member_declaration ::= <em>IN (</em>
collection_valued_path_expression <em>)</em> [AS] identifier</p>
</div>
<div class="paragraph">
<p>range_variable_declaration ::=
abstract_schema_name [ <em>AS</em> ] identifier</p>
</div>
<div class="paragraph">
<p>cmp_path_expression ::=</p>
</div>
<div class="literalblock">
<div class="content">
<pre> \{identification_variable |
single_valued_cmr_path_expression}.cmp_field</pre>
</div>
</div>
<div class="paragraph">
<p>single_valued_cmr_path_expression ::=</p>
</div>
<div class="paragraph">
<p>identification_variable.[single_valued_cmr_field.]*
single_valued_cmr_field</p>
</div>
<div class="paragraph">
<p>single_valued_path_expression ::=</p>
</div>
<div class="literalblock">
<div class="content">
<pre> cmp_path_expression |
single_valued_cmr_path_expression</pre>
</div>
</div>
<div class="paragraph">
<p>collection_valued_path_expression ::=</p>
</div>
<div class="paragraph">
<p>identification_variable.[single_valued_cmr_field.]*collection_valued_cmr_field</p>
</div>
<div class="paragraph">
<p>select_clause ::= <em>SELECT</em> [ <em>DISTINCT</em> ]
\{select_expression | <em>OBJECT(</em> identification_variable <em>)</em> }</p>
</div>
<div class="paragraph">
<p>select_expression ::=
single_valued_path_expression | aggregate_select_expression</p>
</div>
<div class="paragraph">
<p>aggregate_select_expression ::=</p>
</div>
<div class="literalblock">
<div class="content">
<pre> \{ _AVG_ | _MAX_ | _MIN_ | _SUM_ | _COUNT_
_}_ _(_ [ _DISTINCT_ ] cmp_path_expression _)_ |</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> _COUNT (_ [ _DISTINCT_ ]
identification_variable | single_valued_cmr_path_expression _)_</pre>
</div>
</div>
<div class="paragraph">
<p>where_clause ::= <em>WHERE</em>
conditional_expression</p>
</div>
<div class="paragraph">
<p>conditional_expression ::= conditional_term |
conditional_expression <em>OR</em> conditional_term</p>
</div>
<div class="paragraph">
<p>conditional_term ::= conditional_factor |
conditional_term <em>AND</em> conditional_factor</p>
</div>
<div class="paragraph">
<p>conditional_factor ::= [ <em>NOT</em> ]
conditional_primary</p>
</div>
<div class="paragraph">
<p>conditional_primary ::=
simple_cond_expression | (conditional_expression)</p>
</div>
<div class="paragraph">
<p>simple_cond_expression ::=
comparison_expression | between_expression | like_expression |</p>
</div>
<div class="literalblock">
<div class="content">
<pre>in_expression | null_comparison_expression |</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>empty_collection_comparison_expression |</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>collection_member_expression</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>_between_expression ::=_</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>_arithmetic_expression_ [ _NOT_ ] _BETWEEN_</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> _arithmetic_expression_ _AND_
_arithmetic_expression_</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>_in_expression ::=_</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>__ cmp_path_expression [ _NOT_ ] _IN_</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> _(_ _\{literal_ | input_parameter} [, _\{
literal | input_parameter} ]*_ _)_</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>_like_expression ::=_</pre>
</div>
</div>
<div class="paragraph">
<p> <em>_ cmp_path_expression [ _NOT</em> ]
<em>LIKE</em> <em>pattern_value</em> [ <em>ESCAPE</em> <em>escape_character</em> ]</p>
</div>
<div class="paragraph">
<p>null_comparison_expression ::=</p>
</div>
<div class="literalblock">
<div class="content">
<pre> \{single_valued_path_expression |
input_parameter} _IS_ [ _NOT_ ] _NULL_</pre>
</div>
</div>
<div class="paragraph">
<p>empty_collection_comparison_expression ::=</p>
</div>
<div class="literalblock">
<div class="content">
<pre> collection_valued_path_expression _IS [NOT]
EMPTY_</pre>
</div>
</div>
<div class="paragraph">
<p>collection_member_expression ::=</p>
</div>
<div class="literalblock">
<div class="content">
<pre> \{single_valued_cmr_path_expression |
identification_variable | input_parameter}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> [ _NOT_ ] _MEMBER_ _[_ _OF_ _]_
collection_valued_path_expression</pre>
</div>
</div>
<div class="paragraph">
<p>comparison_expression ::=</p>
</div>
<div class="literalblock">
<div class="content">
<pre> string_value comparison_operator
string_expression |</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> boolean_value \{ _=_ | _&lt;&gt;_ }
boolean_expression} |</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> datetime_value comparison_operator
datetime_expression |</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> entity_bean_value \{ _=_ | _&lt;&gt;_ }
entity_bean_expression |</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> arithmetic_value comparison_operator
arithmetic_expression</pre>
</div>
</div>
<div class="paragraph">
<p>arithmetic_value ::= cmp_path_expression |
functions_returning_numerics</p>
</div>
<div class="paragraph">
<p>comparison_operator ::=</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_=_ | _&gt;_ | _&gt;=_ | _&lt;_ | _&lt;=_ | _&lt;&gt;_</pre>
</div>
</div>
<div class="paragraph">
<p>arithmetic_expression ::= arithmetic_term |
arithmetic_expression \{ <em>+</em> | <em>-</em> } arithmetic_term</p>
</div>
<div class="paragraph">
<p>arithmetic_term ::= arithmetic_factor |
arithmetic_term \{ <em>*</em> | <em>/</em> } arithmetic_factor</p>
</div>
<div class="paragraph">
<p>arithmetic_factor ::= [\{ <em>+</em> | <em>-</em> }]
arithmetic_primary</p>
</div>
<div class="paragraph">
<p>arithmetic_primary ::= cmp_path_expression |
literal | (arithmetic_expression) |</p>
</div>
<div class="literalblock">
<div class="content">
<pre> input_parameter |
functions_returning_numerics</pre>
</div>
</div>
<div class="paragraph">
<p>string_value ::= cmp_path_expression |
functions_returning_strings</p>
</div>
<div class="paragraph">
<p>string_expression ::= string_primary |
input_parameter</p>
</div>
<div class="paragraph">
<p>string_primary ::= cmp_path_expression |
literal | (string_expression) |</p>
</div>
<div class="literalblock">
<div class="content">
<pre>functions_returning_strings</pre>
</div>
</div>
<div class="paragraph">
<p>datetime_value ::= cmp_path_expression</p>
</div>
<div class="paragraph">
<p>datetime_expression ::= datetime_value |
input_parameter</p>
</div>
<div class="paragraph">
<p>boolean_value ::= cmp_path_expression</p>
</div>
<div class="paragraph">
<p>boolean_expression ::= cmp_path_expression |
literal | input_parameter</p>
</div>
<div class="paragraph">
<p>entity_bean_value ::=
single_valued_cmr_path_expression | identification_variable</p>
</div>
<div class="paragraph">
<p>entity_bean_expression ::= entity_bean_value
| input_parameter</p>
</div>
<div class="paragraph">
<p>functions_returning_strings ::= <em>CONCAT(</em>
string_expression <em>,</em> string_expression <em>)</em> |</p>
</div>
<div class="literalblock">
<div class="content">
<pre> _SUBSTRING(_ string_expression _,_
arithmetic_expression _,_ arithmetic_expression _)_</pre>
</div>
</div>
<div class="paragraph">
<p>functions_returning_numerics::=</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_LENGTH(_ string_expression _)_ |</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> _LOCATE(_ string_expression _,_
string_expression[ _,_ arithmetic_expression] _) |_</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>_ABS(_ arithmetic_expression _)_ |</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>_SQRT(_ arithmetic_expression _) |_</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> _MOD(_ arithmetic_expression,
arithmetic_expression _)_</pre>
</div>
</div>
<div class="paragraph">
<p>orderby_clause ::= <em>ORDER BY</em> orderby_item [
<em>,</em> orderby_item]*</p>
</div>
<div class="paragraph">
<p>orderby_item ::= cmp_path_expression [
<em>ASC</em> | <em>DESC</em> ]</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a2456"><a class="anchor" href="#a2456"></a>6. EJB 2.1 Entity Bean Component Contract for Bean-Managed Persistence</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The entity bean component contract for
bean-managed persistence is the contract between an entity bean and its
container. It defines the life cycle of the entity bean instances and
the model for method delegation of the client-invoked business methods.
The main goal of this contract is to ensure that a component using
bean-managed persistence is portable across all compliant EJB
containers.</p>
</div>
<div class="paragraph">
<p>This chapter defines the Enterprise Bean
Provider’s view of this contract and the Container Provider’s
responsibility for managing the life cycle of the enterprise bean
instances. It also describes the Bean Provider’s responsibilities when
persistence is provided by the Bean Provider.</p>
</div>
<div class="paragraph">
<p>Note that use of dependency injection,
interceptors, and Java language metadata annotations is not supported
for EJB 2.1 entity beans.</p>
</div>
<div class="sect2">
<h3 id="_overview_of_bean_managed_entity_persistence"><a class="anchor" href="#_overview_of_bean_managed_entity_persistence"></a>6.1. Overview of Bean-Managed Entity Persistence</h3>
<div class="paragraph">
<p>An entity bean
implements an object view of an entity stored in an underlying database,
or an entity implemented by an existing enterprise application (for
example, by a mainframe program or by an ERP application). The data
access protocol for transferring the state of the entity between the
entity bean instances and the underlying database is referred to as
object persistence.</p>
</div>
<div class="paragraph">
<p>The entity bean component protocol for
bean-managed persistence allows the entity
Bean Provider to implement the entity bean’s persistence directly in the
entity bean class or in one or more helper classes provided with the
entity bean class. This chapter describes the contracts for bean-managed
persistence.</p>
</div>
<div class="paragraph">
<p>===</p>
</div>
<div class="paragraph">
<p>Client View of Underlying Data Sources Accessed Through Entity Bean</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-38.png" alt="image"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="_entity_bean_providers_view_of_persistence"><a class="anchor" href="#_entity_bean_providers_view_of_persistence"></a>6.2. Entity Bean Provider’s View of Persistence</h3>
<div class="paragraph">
<p>Using
bean-managed persistence, the entity Bean Provider writes database
access calls (e.g. using JDBC <em>TM</em> or SQLJ) directly in the entity bean
component. The data access calls are performed in the ejbCreate&lt;METHOD&gt;,
ejbRemove, ejbFind&lt;METHOD&gt;, ejbLoad, and ejbStore methods, and/or in the
business methods.</p>
</div>
<div class="paragraph">
<p>The data access calls can be coded directly
into the entity bean class, or they can be encapsulated in a
data access component that is part of the
entity bean. Directly coding data access calls in the entity bean class
may make it more difficult to adapt the entity bean to work with a
database that has a different schema, or with a different type of
database.</p>
</div>
<div class="paragraph">
<p>We expect that most enterprise beans with
bean-managed persistence will be created by application development
tools which will encapsulate data access in components. These data
access components will probably not be the same for all tools. Further,
if the data access calls are encapsulated in data access components, the
data access components may require deployment interfaces to allow
adapting data access to different schemas or even to a different
database type. This EJB specification does not define the architecture
for data access objects, strategies for tailoring and deploying data
access components or ensuring portability of these components for
bean-managed persistence.</p>
</div>
</div>
<div class="sect2">
<h3 id="_runtime_execution_model"><a class="anchor" href="#_runtime_execution_model"></a>6.3. Runtime Execution Model</h3>
<div class="paragraph">
<p>This section describes the runtime model and
the classes used in the description of the contract between an entity
bean with bean-managed persistence and its container.</p>
</div>
<div class="paragraph">
<p>===</p>
</div>
<div class="paragraph">
<p>Overview of the Entity Bean Runtime Execution Model</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-39.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>An enterprise bean instance is an object
whose class is provided by the Bean Provider.</p>
</div>
<div class="paragraph">
<p>An entity EJBObject or EJBLocalObject is an
object whose class is generated at deployment time by the Container
Provider’s tools. The entity EJBObject class implements the entity
bean’s remote interface. The entity EJBLocalObject class implements the
entity bean’s local interface. A client never references an entity bean
instance directly—a client always references an entity EJBObject or
entity EJBLocalObject whose class is generated by the Container
Provider’s tools.</p>
</div>
<div class="paragraph">
<p>An entity EJBHome or EJBLocalHome object
provides the life cycle operations (create,
remove, find) for its entity objects as well as home business methods,
which are not specific to an entity bean instance. The class for the
entity EJBHome or EJBLocalHome object is generated by the Container
Provider’s tools at deployment time. The entity EJBHome or EJBLocalHome
object implements the entity bean’s home interface that was defined by
the Bean Provider.</p>
</div>
</div>
<div class="sect2">
<h3 id="_instance_life_cycle_2"><a class="anchor" href="#_instance_life_cycle_2"></a>6.4. Instance Life Cycle</h3>
<div class="paragraph">
<p>===</p>
</div>
<div class="paragraph">
<p><a id="a2480"></a>Life Cycle of an Entity Bean Instance.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-40.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>An entity bean
instance is in one of the following three states:</p>
</div>
<div class="paragraph">
<p>It does not exist.</p>
</div>
<div class="paragraph">
<p>Pooled state. An instance in the pooled state
is not associated with any particular entity object identity.</p>
</div>
<div class="paragraph">
<p>Ready state. An instance in the ready state
is assigned an entity object identity.</p>
</div>
<div class="paragraph">
<p>The following
steps describe the life cycle of an entity bean instance:</p>
</div>
<div class="paragraph">
<p>An entity bean instance’s life starts when
the container creates the instance using newInstance. The container then
invokes the setEntityContext method to pass the instance a reference to
the EntityContext interface. The EntityContext interface allows the
instance to invoke services provided by the container and to obtain the
information about the caller of a client-invoked method.</p>
</div>
<div class="paragraph">
<p>The instance enters the pool of available
instances. Each entity bean has its own pool. While the instance is in
the available pool, the instance is not associated with any particular
entity object identity. All instances in the pool are considered
equivalent, and therefore any instance can be assigned by the container
to any entity object identity at the transition to the ready state.
While the instance is in the pooled state, the container may use the
instance to execute any of the entity bean’s finder methods (shown as
<em>ejbFind&lt;METHOD&gt;</em> in the diagram) or home methods (shown as
ejbHome&lt;METHOD&gt; in the diagram). The instance does not move to the ready
state during the execution of a finder or a home method.</p>
</div>
<div class="paragraph">
<p>An instance transitions from the pooled state
to the ready state when the container selects that instance to service a
client call to an entity object or an <em>ejbTimeout</em> method. There are two
possible transitions from the pooled to the ready state: through the
<em>ejbCreate</em> &lt;METHOD&gt; and <em>ejbPostCreate</em> &lt;METHOD&gt; methods, or through
the <em>ejbActivate</em> method. The container invokes the <em>ejbCreate</em> &lt;METHOD&gt;
<em>_ and _ejbPostCreate</em> &lt;METHOD&gt; methods when the instance is assigned to
an entity object during entity object creation (i.e., when the client
invokes a <em>create</em> &lt;METHOD&gt; method on the entity bean’s home object).
The container invokes the <em>ejbActivate</em> method on an instance when an
instance needs to be activated to service an invocation on an existing
entity object—this occurs because there is no suitable instance in the
ready state to service the client’s call or the <em>ejbTimeout</em> method.</p>
</div>
<div class="paragraph">
<p>When an entity bean instance is in the ready
state, the instance is associated with a specific entity object
identity. While the instance is in the ready state, the container can
invoke the <em>ejbLoad</em> and <em>ejbStore</em> methods zero or more times. A
business method can be invoked on the instance zero or more times. The
<em>ejbTimeout</em> method can be invoked on the instance zero or more times.
Invocations of the <em>ejbLoad</em> and <em>ejbStore</em> methods can be arbitrarily
mixed with invocations of business methods or the <em>ejbTimeout</em> method.
The purpose of the <em>ejbLoad</em> and <em>ejbStore</em> methods is to synchronize
the state of the instance with the state of the entity in the underlying
data source—the container can invoke these methods whenever it
determines a need to synchronize the instance’s state.</p>
</div>
<div class="paragraph">
<p>The container can choose to passivate an
entity bean instance within a transaction. To passivate an instance, the
container first invokes the ejbStore method to allow the instance to
synchronize the database state with the instance’s state, and then the
container invokes the ejbPassivate method to return the instance to the
pooled state.</p>
</div>
<div class="paragraph">
<p>Eventually, the container will transition the
instance to the pooled state. There are three possible transitions from
the ready to the pooled state: through the <em>ejbPassivate</em> method,
through the <em>ejbRemove</em> method, and because of a transaction rollback
for <em>ejbCreate</em> , <em>ejbPostCreate</em> , or <em>ejbRemove</em> (not shown in
<a href="Ejb.html#a2480">See Life Cycle of an Entity Bean
Instance.</a>). The container invokes the <em>ejbPassivate</em> method when the
container wants to disassociate the instance from the entity object
identity without removing the entity object. The container invokes the
<em>ejbRemove</em> method when the container is removing the entity object
(i.e., when the client invoked the <em>remove</em> method on the entity
object’s component interface, or a <em>remove</em> method on the entity bean’s
home interface). If <em>ejbCreate</em> , <em>ejbPostCreate</em> , or <em>ejbRemove</em> is
called and the transaction rolls back, the container will transition the
bean instance to the pooled state.</p>
</div>
<div class="paragraph">
<p>When the instance is put back into the pool,
it is no longer associated with an entity object identity. The container
can assign the instance to any entity object within the same entity bean
home.</p>
</div>
<div class="paragraph">
<p>An instance in the pool can be removed by
calling the <em>unsetEntityContext</em> method on the instance.</p>
</div>
<div class="paragraph">
<p>Notes:</p>
</div>
<div class="paragraph">
<p>The EntityContext interface passed by the
container to the instance in the setEntityContext method is an
interface, not a class that contains static information. For example,
the result of the EntityContext.getPrimaryKey method might be different
each time an instance moves from the pooled state to the ready state,
and the result of the getCallerPrincipal and isCallerInRole methods may
be different in each business method.</p>
</div>
<div class="paragraph">
<p>A RuntimeException thrown from any method of
the entity bean class (including the business methods and the callbacks
invoked by the container) results in the transition to the “does not
exist” state. The container must not invoke any method on the instance
after a RuntimeException has been caught. From the client perspective,
the corresponding entity object continues to exist. The client can
continue accessing the entity object through its component interface
because the container can use a different entity bean instance to
delegate the client’s requests. Exception handling is described further
in Chapter <a href="Ejb.html#a3210">See Exception Handling</a>.</p>
</div>
<div class="paragraph">
<p>The container is not required to maintain a
pool of instances in the pooled state. The pooling approach is an
example of a possible implementation, but it is not the required
implementation. Whether the container uses a pool or not has no bearing
on the entity bean coding style.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_entity_bean_component_contract_2"><a class="anchor" href="#_the_entity_bean_component_contract_2"></a>6.5. The Entity Bean Component Contract</h3>
<div class="paragraph">
<p>This section specifies the contract between
an entity bean with bean-managed persistence and its container.</p>
</div>
</div>
<div class="sect2">
<h3 id="_entity_bean_instances_view"><a class="anchor" href="#_entity_bean_instances_view"></a>6.6. Entity Bean Instance’s View</h3>
<div class="paragraph">
<p>The following describes the entity bean
instance’s view of the contract:</p>
</div>
<div class="paragraph">
<p>The Bean Provider
is responsible for implementing the following methods in the entity bean
class:</p>
</div>
<div class="paragraph">
<p>A public
constructor that takes no arguments. The container uses this constructor
to create instances of the entity bean class.</p>
</div>
<div class="literalblock">
<div class="content">
<pre> _public void setEntityContext(EntityContext
ic)_ ;</pre>
</div>
</div>
<div class="paragraph">
<p>A container uses
this method to pass a reference to the EntityContext interface to the
entity bean instance. If the entity bean instance needs to use the
EntityContext interface during its lifetime, it must remember the
EntityContext interface in an instance variable.</p>
</div>
<div class="paragraph">
<p>This method executes with an unspecified
transaction context (Refer to EJB Core Contracts and Requirements
document <a href="Ejb.html#a3339">See EJB 3.2 Core Contracts and</a> Subsection 8.6.5 for
how the container executes methods with an unspecified transaction
context). An identity of an entity object is not available during this
method.</p>
</div>
<div class="paragraph">
<p>The instance can take advantage of the
setEntityContext method to allocate any resources that are to be held by
the instance for its lifetime. Such resources cannot be specific to an
entity object identity because the instance might be reused during its
lifetime to serve multiple entity object identities.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_public void unsetEntityContext();_</pre>
</div>
</div>
<div class="paragraph">
<p>A container
invokes this method before terminating the life of the instance.</p>
</div>
<div class="paragraph">
<p>This method executes with an unspecified
transaction context. An identity of an entity object is not available
during this method.</p>
</div>
<div class="paragraph">
<p>The instance can take advantage of the
<em>unsetEntityContext</em> method to free any resources that are held by the
instance. (These resources typically had been allocated by the
setEntityContext method.)</p>
</div>
<div class="literalblock">
<div class="content">
<pre> _public PrimaryKeyClass ejbCreate_
&lt;METHOD&gt;(...);</pre>
</div>
</div>
<div class="paragraph">
<p>There are
zero<a href="#a3385">21</a> or more ejbCreate&lt;METHOD&gt; methods, whose
signatures match the signatures of the create&lt;METHOD&gt; methods of the
entity bean home interface. The container invokes an <em>ejbCreate</em>
&lt;METHOD&gt; method on an entity bean instance when a client invokes a
matching create&lt;METHOD&gt; method to create an entity object.</p>
</div>
<div class="paragraph">
<p>The implementation of the <em>ejbCreate</em>
&lt;METHOD&gt; method typically validates the client-supplied arguments, and
inserts a record representing the entity object into the database. The
method also initializes the instance’s variables. The ejbCreate&lt;METHOD&gt;
method must return the primary key for the created entity object.</p>
</div>
<div class="paragraph">
<p>An <em>ejbCreate</em> &lt;METHOD&gt; method executes in
the transaction context determined by the transaction attribute of the
matching create&lt;METHOD&gt; method, as described in EJB Core Contracts and
Requirements document <a href="Ejb.html#a3339">See EJB 3.2 Core</a>
Subsection “Container-Managed Transaction Demarcation for Business
Methods”.</p>
</div>
<div class="literalblock">
<div class="content">
<pre> _public void ejbPostCreate_ &lt;METHOD&gt;
_(...);_</pre>
</div>
</div>
<div class="paragraph">
<p>For each
ejbCreate&lt;METHOD&gt; method, there is a matching ejbPostCreate&lt;METHOD&gt;
method that has the same input parameters but whose return value is
void. The container invokes the matching ejbPostCreate&lt;METHOD&gt; method on
an instance after it invokes the ejbCreate&lt;METHOD&gt; method with the same
arguments. The entity object identity is available during the
ejbPostCreate&lt;METHOD&gt; method. The instance may, for example, obtain the
component interface of the associated entity object and pass it to
another enterprise bean as a method argument.</p>
</div>
<div class="paragraph">
<p>An <em>ejbPostCreate</em> &lt;METHOD&gt; method executes
in the same transaction context as the previous ejbCreate&lt;METHOD&gt;
method.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_public void ejbActivate();_</pre>
</div>
</div>
<div class="paragraph">
<p>The container
invokes this method on the instance when the container picks the
instance from the pool and assigns it to a specific entity object
identity. The ejbActivate method gives the entity bean instance the
chance to acquire additional resources that it needs while it is in the
ready state.</p>
</div>
<div class="paragraph">
<p>This method executes with an unspecified
transaction context. The instance can obtain the identity of the entity
object via the getPrimaryKey, getEJBLocalObject, or getEJBObject method
on the entity context. The instance can rely on the fact that the
primary key and entity object identity will remain associated with the
instance until the completion of ejbPassivate or ejbRemove.</p>
</div>
<div class="paragraph">
<p>Note that the instance should not use the
ejbActivate method to read the state of the entity from the database;
the instance should load its state only in the ejbLoad method.</p>
</div>
<div class="literalblock">
<div class="content">
<pre> _public void ejbPassivate()_ ; +
The container invokes this method on an
instance when the container decides to disassociate the instance from an
entity object identity, and to put the instance back into the pool of
available instances. The _ejbPassivate_ method gives the instance the
chance to release any resources that should not be held while the
instance is in the pool. (These resources typically had been allocated
during the _ejbActivate_ method.)</pre>
</div>
</div>
<div class="paragraph">
<p>This method executes with an unspecified
transaction context. The instance can still obtain the identity of the
entity object via the getPrimaryKey, getEJBLocalObject, or getEJBObject
method of the EntityContext interface.</p>
</div>
<div class="paragraph">
<p>Note that an instance should not use the
ejbPassivate method to write its state to the database; an instance
should store its state only in the ejbStore method.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_public void ejbRemove()_ ;</pre>
</div>
</div>
<div class="paragraph">
<p>The container
invokes this method on an instance as a result of a client’s invoking a
remove method. The instance is in the ready state when ejbRemove is
invoked and it will be entered into the pool when the method completes.</p>
</div>
<div class="paragraph">
<p>This method executes in the transaction
context determined by the transaction attribute of the remove method
that triggered the <em>ejbRemove</em> method. The instance can still obtain the
identity of the entity object via the getPrimaryKey, getEJBLocalObject,
or getEJBObject method of the EntityContext interface.</p>
</div>
<div class="paragraph">
<p>The container synchronizes the instance’s
state before it invokes the ejbRemove method. This means that the state
of the instance variables at the beginning of the ejbRemove method is
the same as it would be at the beginning of a business method.</p>
</div>
<div class="paragraph">
<p>An entity bean instance should use this
method to remove the entity object’s representation from the database.</p>
</div>
<div class="paragraph">
<p>Since the instance will be entered into the
pool, the state of the instance at the end of this method must be
equivalent to the state of a passivated instance. This means that the
instance must release any resource that it would normally release in the
ejbPassivate method.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_public void ejbLoad()_ ;</pre>
</div>
</div>
<div class="paragraph">
<p>The container
invokes this method on an instance in the ready state to inform the
instance that it should synchronize the entity state cached in its
instance variables from the entity state in the database. The instance
should be prepared for the container to invoke this method at any time
that the instance is in the ready state.</p>
</div>
<div class="paragraph">
<p>If the instance is caching the entity state
(or parts of the entity state), the instance should not use the
previously cached state in the subsequent business method. The instance
may take advantage of the ejbLoad method, for example, to refresh the
cached state by reading it from the database.</p>
</div>
<div class="paragraph">
<p>This method executes in the transaction
context determined by the transaction attribute of the business method
or <em>ejbTimeout</em> method that triggered the ejbLoad method.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_public void ejbStore();_</pre>
</div>
</div>
<div class="paragraph">
<p>The container
invokes this method on an instance to inform the instance that the
instance should synchronize the entity state in the database with the
entity state cached in its instance variables. The instance should be
prepared for the container to invoke this method at any time that the
instance is in the ready state.</p>
</div>
<div class="paragraph">
<p>An instance should write any updates cached
in the instance variables to the database in the ejbStore method.</p>
</div>
<div class="paragraph">
<p>This method executes in the same transaction
context as the previous ejbLoad or ejbCreate <em>&lt;METHOD&gt;</em> method invoked
on the instance. All business methods or the <em>ejbTimeout</em> method invoked
between the previous ejbLoad or ejbCreate <em>&lt;METHOD&gt;</em> method and this
ejbStore method are also invoked in the same transaction context.</p>
</div>
<div class="paragraph">
<p>public &lt;primary key type or collection&gt;
ejbFind&lt;METHOD&gt;(&#8230;&#8203;);</p>
</div>
<div class="paragraph">
<p>The container
invokes this method on the instance when the container selects the
instance to execute a matching client-invoked find&lt;METHOD&gt; method. The
instance is in the pooled state (i.e., it is not assigned to any
particular entity object identity) when the container selects the
instance to execute the ejbFind&lt;METHOD&gt; method on it, and it is returned
to the pooled state when the execution of the ejbFind&lt;METHOD&gt; method
completes.</p>
</div>
<div class="paragraph">
<p>The ejbFind&lt;METHOD&gt; method executes in the
transaction context determined by the transaction attribute of the
matching find method, as described in EJB Core Contracts and
Requirements document <a href="Ejb.html#a3339">See EJB 3.2 Core</a>
Subsection “Container-Managed Transaction Demarcation for Business
Methods”.</p>
</div>
<div class="paragraph">
<p>The implementation of an ejbFind&lt;METHOD&gt;
method typically uses the method’s arguments to locate the requested
entity object or a collection of entity objects in the database. The
method must return a primary key or a collection of primary keys to the
container (see Subsection <a href="Ejb.html#a2729">See Finder Method
Return Type</a>).</p>
</div>
<div class="paragraph">
<p>public <em> &lt;type&gt; </em> ejbHome&lt;METHOD&gt;(&#8230;&#8203;);</p>
</div>
<div class="paragraph">
<p>The container
invokes this method on any instance when the container selects the
instance to execute a matching client-invoked &lt;METHOD&gt; home method. The
instance is in the pooled state (i.e., it is not assigned to any
particular entity object identity) when the container selects the
instance to execute the ejbHome&lt;METHOD&gt; method on it, and it is returned
to the pooled state when the execution of the ejbHome&lt;METHOD&gt; method
completes.</p>
</div>
<div class="paragraph">
<p>The ejbHome&lt;METHOD&gt; method executes in the
transaction context determined by the transaction attribute of the
matching &lt;METHOD&gt; home method, as described in EJB Core Contracts and
Requirements document <a href="Ejb.html#a3339">See EJB 3.2 Core</a>
Subsection “Container-Managed Transaction Demarcation for Business
Methods”.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_public void ejbTimeout(...);_</pre>
</div>
</div>
<div class="paragraph">
<p>The container invokes the <em>ejbTimeout</em> method
on an instance when a timer for the instance has expired. The
<em>ejbTimeout</em> method notifies the instance of the time-based event and
allows the instance to execute the business logic to handle it.</p>
</div>
<div class="paragraph">
<p>The <em>ejbTimeout</em> method executes in the
transaction context determined by its transaction attribute.</p>
</div>
</div>
<div class="sect2">
<h3 id="_containers_view_2"><a class="anchor" href="#_containers_view_2"></a>6.7. <a id="a2553"></a>Container’s View</h3>
<div class="paragraph">
<p>This subsection
describes the container’s view of the state
management contract. The container must call the following methods:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_public void setEntityContext(ec)_ ;</pre>
</div>
</div>
<div class="paragraph">
<p>The container invokes this method to pass a
reference to the EntityContext interface to the entity bean instance.
The container must invoke this method after it creates the instance, and
before it puts the instance into the pool of available instances.</p>
</div>
<div class="paragraph">
<p>The container invokes this method with an
unspecified transaction context. At this point, the EntityContext is not
associated with any entity object identity.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_public void unsetEntityContext()_ ;</pre>
</div>
</div>
<div class="paragraph">
<p>The container invokes this method when the
container wants to reduce the number of instances in the pool. After
this method completes, the container must not reuse this instance.</p>
</div>
<div class="paragraph">
<p>The container invokes this method with an
unspecified transaction context.</p>
</div>
<div class="literalblock">
<div class="content">
<pre> _public PrimaryKeyClass ejbCreate_ &lt;METHOD&gt;
_(...)_ ; +
_public void ejbPostCreate_ &lt;METHOD&gt; _(...)_ ;</pre>
</div>
</div>
<div class="paragraph">
<p>The container invokes these two methods
during the creation of an entity object as a result of a client invoking
a create&lt;METHOD&gt; method on the entity bean’s home interface.</p>
</div>
<div class="paragraph">
<p>The container first invokes the
ejbCreate&lt;METHOD&gt; method whose signature matches the create&lt;METHOD&gt;
method invoked by the client. The ejbCreate&lt;METHOD&gt; method returns a
primary key for the created entity object. The container creates an
entity EJBObject reference and/or EJBLocalObject reference for the
primary key. The container then invokes a matching ejbPostCreate&lt;METHOD&gt;
method to allow the instance to fully initialize itself. Finally, the
container returns the entity object’s remote interface (i.e., a
reference to the entity EJBObject) to the client if the client is a
remote client, or the entity object’s local interface (i.e., a reference
to the entity EJBLocalObject) to the client if the client is a local
client.</p>
</div>
<div class="paragraph">
<p>The container must invoke the
ejbCreate&lt;METHOD&gt; and ejbPostCreate&lt;METHOD&gt; methods in the transaction
context determined by the transaction attribute of the matching
create&lt;METHOD&gt; method, as described in EJB Core Contracts and
Requirements document <a href="Ejb.html#a3339">See EJB 3.2 Core</a>
Subsection “Container-Managed Transaction Demarcation for Business
Methods”.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_public void ejbActivate()_ ;</pre>
</div>
</div>
<div class="paragraph">
<p>The container invokes this method on an
entity bean instance at activation time (i.e., when the instance is
taken from the pool and assigned to an entity object identity). The
container must ensure that the primary key of the associated entity
object is available to the instance if the instance invokes the
getPrimaryKey, getEJBLocalObject, or getEJBObject method on its
EntityContext interface.</p>
</div>
<div class="paragraph">
<p>The container invokes this method with an
unspecified transaction context.</p>
</div>
<div class="paragraph">
<p>Note that instance is not yet ready for the
delivery of a business method. The container must still invoke the
ejbLoad method prior to a business method or <em>ejbTimeout</em> method
invocation.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_public void ejbPassivate()_ ;</pre>
</div>
</div>
<div class="paragraph">
<p>The container invokes this method on an
entity bean instance at passivation time (i.e., when the instance is
being disassociated from an entity object identity and moved into the
pool). The container must ensure that the identity of the associated
entity object is still available to the instance if the instance invokes
the getPrimaryKey, getEJBLocalObject, or getEJBObject method on its
entity context.</p>
</div>
<div class="paragraph">
<p>The container invokes this method with an
unspecified transaction context.</p>
</div>
<div class="paragraph">
<p>Note that if the instance state has been
updated by a transaction, the container must first invoke the ejbStore
method on the instance before it invokes ejbPassivate on it.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_public void ejbRemove();_</pre>
</div>
</div>
<div class="paragraph">
<p>The container invokes this method before it
ends the life of an entity object as a result of a client invoking a
remove operation.</p>
</div>
<div class="paragraph">
<p>The container invokes this method in the
transaction context determined by the transaction attribute of the
invoked remove method. The container must ensure that the identity of
the associated entity object is still available to the instance in the
<em>ejbRemove</em> method (i.e., the instance can invoke the getPrimaryKey,
getEJBLocalObject, or getEJBObject method on its EntityContext in the
<em>ejbRemove</em> method).</p>
</div>
<div class="paragraph">
<p>The container must ensure that the instance’s
state is synchronized from the state in the database before invoking the
ejbRemove method (i.e., if the instance is not already synchronized from
the state in the database, the container must invoke ejbLoad before it
invokes ejbRemove).</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_public void ejbLoad()_ ;</pre>
</div>
</div>
<div class="paragraph">
<p>The container must invoke this method on the
instance whenever it becomes necessary for the instance to synchronize
its instance state from its state in the database. The exact times that
the container invokes <em>ejbLoad</em> depend on the configuration of the
component and the container, and are not defined by the EJB
architecture. Typically, the container will call <em>ejbLoad</em> before the
first business method within a transaction or before invoking the
<em>ejbTimeout</em> method to ensure that the instance can refresh its cached
state of the entity object from the database. After the first <em>ejbLoad</em>
within a transaction, the container is not required to recognize that
the state of the entity object in the database has been changed by
another transaction, and it is not required to notify the instance of
this change via another <em>ejbLoad</em> call.</p>
</div>
<div class="paragraph">
<p>The container must invoke this method in the
transaction context determined by the transaction attribute of the
business method or <em>ejbTimeout</em> method that triggered the ejbLoad
method.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_public void ejbStore()_ ;</pre>
</div>
</div>
<div class="paragraph">
<p>The container must invoke this method on the
instance whenever it becomes necessary for the instance to synchronize
its state in the database with the state of the instance’s fields. This
synchronization always happens at the end of a transaction, unless the
bean is specified as read-only (see section
<a href="Ejb.html#a2598">See Read-only Entity Beans</a>). However, the
container may also invoke this method when it passivates the instance in
the middle of a transaction, or when it needs to transfer the most
recent state of the entity object to another instance for the same
entity object in the same transaction (see EJB Core Contracts and
Requirements document <a href="Ejb.html#a3339">See EJB 3.2 Core</a>
Subsection “Access from Multiple Clients in the Same Transaction
Context”).</p>
</div>
<div class="paragraph">
<p>The container must invoke this method in the
same transaction context as the previously invoked ejbLoad, ejbCreate
<em>&lt;METHOD&gt;</em> , or <em>ejbTimeout</em> method.</p>
</div>
<div class="paragraph">
<p>public &lt;primary key type or collection&gt;
ejbFind&lt;METHOD&gt;(&#8230;&#8203;);</p>
</div>
<div class="paragraph">
<p>The container invokes the ejbFind&lt;METHOD&gt;
method on an instance when a client invokes a matching find&lt;METHOD&gt;
method on the entity bean’s home interface. The container must pick an
instance that is in the pooled state (i.e., the instance is not
associated with any entity object identity) for the execution of the
ejbFind&lt;METHOD&gt; method. If there is no instance in the pooled state, the
container creates one and calls the setEntityContext method on the
instance before dispatching the finder method.</p>
</div>
<div class="paragraph">
<p>Before invoking the <em>ejbFind&lt;METHOD&gt;</em>
method, the container must first synchronize the state of any
non-read-only entity bean instances that are participating in the same
transaction context as is used to execute the <em>ejbFind&lt;METHOD&gt;</em> by
invoking the <em>ejbStore</em> method on those entity bean instances.
<a href="#a3386">22</a></p>
</div>
<div class="paragraph">
<p>After the ejbFind&lt;METHOD&gt; method completes,
the instance remains in the pooled state. The container may, but is not
required to, immediately activate the objects that were located by the
finder using the transition through the ejbActivate method.</p>
</div>
<div class="paragraph">
<p>The container must invoke the ejbFind&lt;METHOD&gt;
method in the transaction context determined by the transaction
attribute of the matching find method, as described in EJB Core
Contracts and Requirements document <a href="Ejb.html#a3339">See EJB</a> Subsection “Container-Managed
Transaction Demarcation for Business Methods”.</p>
</div>
<div class="paragraph">
<p>If the ejbFind&lt;METHOD&gt; method is declared to
return a single primary key, the container creates an entity EJBObject
reference for the primary key and returns it to the client if the client
is a remote client. If the client is a local client, the container
creates and returns an entity EJBLocalObject reference for the primary
key. If the ejbFind&lt;METHOD&gt; method is declared to return a collection of
primary keys, the container creates a collection of entity EJBObject or
EJBLocalObject references for the primary keys returned from
ejbFind&lt;METHOD&gt;, and returns the collection to the client. (See
Subsection <a href="Ejb.html#a2729">See Finder Method Return Type</a>
for information on collections.)</p>
</div>
<div class="paragraph">
<p>public __ &lt;type&gt; ejbHome&lt;METHOD&gt;(&#8230;&#8203;);</p>
</div>
<div class="paragraph">
<p>The container invokes the ejbHome&lt;METHOD&gt;
method on an instance when a client invokes a matching &lt;METHOD&gt; home
method on the entity bean’s home interface. The container must pick an
instance that is in the pooled state (i.e., the instance is not
associated with any entity object identity) for the execution of the
ejbHome&lt;METHOD&gt; method. If there is no instance in the pooled state, the
container creates one and calls the setEntityContext method on the
instance before dispatching the home method.</p>
</div>
<div class="paragraph">
<p>After the ejbHome&lt;METHOD&gt; method completes,
the instance remains in the pooled state.</p>
</div>
<div class="paragraph">
<p>The container must invoke the ejbHome&lt;METHOD&gt;
method in the transaction context determined by the transaction
attribute of the matching &lt;METHOD&gt; home method, as described in EJB Core
Contracts and Requirements document <a href="Ejb.html#a3339">See EJB</a> Subsection “Container-Managed
Transaction Demarcation for Business Methods”.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_public void ejbTimeout(...);_</pre>
</div>
</div>
<div class="paragraph">
<p>The container invokes the <em>ejbTimeout</em> method
on the instance when a timer with which the entity has been registered
expires. If there is no suitable instance in the ready state, the
container must activate an instance, invoking the <em>ejbActivate</em> method
and transitioning it to the ready state.</p>
</div>
<div class="paragraph">
<p>The container invokes the <em>ejbTimeout</em> method
in the context of a transaction determined by its transaction attribute.</p>
</div>
</div>
<div class="sect2">
<h3 id="_read_only_entity_beans_2"><a class="anchor" href="#_read_only_entity_beans_2"></a>6.8. <a id="a2598"></a>Read-only Entity Beans</h3>
<div class="paragraph">
<p>Compliant implementations of this
specification may optionally support read-only entity beans. A read-only
entity bean is an entity bean whose instances are not intended to be
updated and/or created by the application. Read-only beans are best
suited for situations where the underlying data never changes or changes
infrequently.</p>
</div>
<div class="paragraph">
<p>Containers that support read-only
beans do not call the <em>ejbStore</em> method on them. The <em>ejbLoad</em> method
should typically be called by the container when the state of the bean
instance is initially loaded from the database, or at designated refresh
intervals.<a href="#a3387">23</a></p>
</div>
<div class="paragraph">
<p>If a read-only bean is used, the state
of such a bean should not be updated by the application, and the
behavior is unspecified if this occurs.<a href="#a3388">24</a></p>
</div>
<div class="paragraph">
<p>Read-only beans are designated by
vendor-specific means that are outside the scope of this specification,
and their use is therefore not portable.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_entitycontext_interface_2"><a class="anchor" href="#_the_entitycontext_interface_2"></a>6.9. The EntityContext Interface</h3>
<div class="paragraph">
<p>A container
provides the entity bean instances with an <em>EntityContext</em> , which gives
the entity bean instance access to the instance’s context maintained by
the container. The <em>EntityContext</em> interface has the following methods:</p>
</div>
<div class="paragraph">
<p>The <em>getEJBObject</em> method returns the entity
bean’s remote interface.</p>
</div>
<div class="paragraph">
<p>The <em>getEJBHome</em> method returns the entity
bean’s remote home interface.</p>
</div>
<div class="paragraph">
<p>The <em>getEJBLocalObject</em> method returns the
entity bean’s local interface.</p>
</div>
<div class="paragraph">
<p>The <em>getEJBLocalHome</em> method returns the
entity bean’s local home interface.</p>
</div>
<div class="paragraph">
<p>The <em>getCallerPrincipal</em> method returns the
<em>java.security.Principal</em> that identifies the invoker.</p>
</div>
<div class="paragraph">
<p>The <em>isCallerInRole</em> method tests if the
entity bean instance’s caller has a particular role.</p>
</div>
<div class="paragraph">
<p>The <em>setRollbackOnly</em> method allows the
instance to mark the current transaction such that the only outcome of
the transaction is a rollback.</p>
</div>
<div class="paragraph">
<p>The <em>getRollbackOnly</em> method allows the
instance to test if the current transaction has been marked for
rollback.</p>
</div>
<div class="paragraph">
<p>The <em>getPrimaryKey</em> method returns the entity
bean’s primary key.</p>
</div>
<div class="paragraph">
<p>The <em>getTimerService</em> method returns the
<em>javax.ejb.TimerService</em> interface.</p>
</div>
<div class="paragraph">
<p>The <em>getUserTransaction</em> method returns the
<em>javax.transaction.UserTransaction</em> interface. Entity bean instances
must not call this method.</p>
</div>
<div class="paragraph">
<p>The <em>lookup</em> method enables the entity bean
to look up its environment entries in the JNDI naming context.</p>
</div>
</div>
<div class="sect2">
<h3 id="_operations_allowed_in_the_methods_of_the_entity_bean_class_2"><a class="anchor" href="#_operations_allowed_in_the_methods_of_the_entity_bean_class_2"></a>6.10. Operations Allowed in the Methods of the Entity Bean Class</h3>
<div class="paragraph">
<p>Table <a href="Ejb.html#a2625">See
Operations Allowed in the Methods of an Entity Bean</a> defines the methods
of an entity bean class in which the enterprise bean instances can
access the methods of the
javax.ejb.EntityContext interface, the
java:comp/env environment naming context, resource managers,
<em>TimerService</em> and <em>Timer</em> methods, the <em>EntityManagerFactory</em> and
<em>EntityManager</em> methods, and other enterprise beans.</p>
</div>
<div class="paragraph">
<p>If an entity bean instance attempts to invoke
a method of the EntityContext interface, and the access is not allowed
in Table <a href="Ejb.html#a2625">See Operations Allowed in the
Methods of an Entity Bean</a>, the container must throw the
java.lang.IllegalStateException.</p>
</div>
<div class="paragraph">
<p>If an entity bean instance attempts to invoke
a method of the <em>TimerService</em> or <em>Timer</em> interface and the access is
not allowed in Table <a href="Ejb.html#a2625">See Operations Allowed
in the Methods of an Entity Bean</a>, the container must throw the
java.lang.IllegalStateException.</p>
</div>
<div class="paragraph">
<p>If an entity bean instance attempts to access
a resource manager, an enterprise bean, or an entity manager or entity
manager factory, and the access is not allowed in Table
<a href="Ejb.html#a2625">See Operations Allowed in the Methods of an
Entity Bean</a>, the behavior is undefined by the EJB architecture.</p>
</div>
<div class="paragraph">
<p>===</p>
</div>
<div class="paragraph">
<p><a id="a2625"></a>Operations Allowed in the Methods of an Entity
Bean</p>
</div>
<div class="paragraph">
<p>Bean method</p>
</div>
<div class="paragraph">
<p>Bean method can perform the following
operations</p>
</div>
<div class="paragraph">
<p>constructor</p>
</div>
<div class="paragraph">
<p>-</p>
</div>
<div class="paragraph">
<p>setEntityContext</p>
</div>
<div class="paragraph">
<p>unsetEntityContext</p>
</div>
<div class="paragraph">
<p>EntityContext methods: getEJBHome,
getEJBLocalHome, lookup</p>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env</p>
</div>
<div class="paragraph">
<p>ejbCreate</p>
</div>
<div class="paragraph">
<p>EntityContext methods: getEJBHome,
getEJBLocalHome, getCallerPrincipal, getRollbackOnly, isCallerInRole,
setRollbackOnly, getTimerService, lookup</p>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env</p>
</div>
<div class="paragraph">
<p>Resource manager access</p>
</div>
<div class="paragraph">
<p>Enterprise bean access</p>
</div>
<div class="paragraph">
<p>EntityManagerFactory access</p>
</div>
<div class="paragraph">
<p>EntityManager access</p>
</div>
<div class="paragraph">
<p>ejbPostCreate</p>
</div>
<div class="paragraph">
<p>EntityContext methods: getEJBHome,
getEJBLocalHome, getCallerPrincipal, getRollbackOnly, isCallerInRole,
setRollbackOnly, getEJBObject, <em>getEJBLocalObject,</em> getPrimaryKey,
getTimerService, lookup</p>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env</p>
</div>
<div class="paragraph">
<p>Resource manager access</p>
</div>
<div class="paragraph">
<p>Enterprise bean access</p>
</div>
<div class="paragraph">
<p>Timer service or Timer methods</p>
</div>
<div class="paragraph">
<p>EntityManagerFactory access</p>
</div>
<div class="paragraph">
<p>EntityManager access</p>
</div>
<div class="paragraph">
<p>ejbRemove</p>
</div>
<div class="paragraph">
<p>EntityContext methods: getEJBHome,
getEJBLocalHome, getCallerPrincipal, getRollbackOnly, isCallerInRole,
setRollbackOnly, getEJBObject, <em>getEJBLocalObject,</em> getPrimaryKey,
getTimerService, lookup</p>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env</p>
</div>
<div class="paragraph">
<p>Resource manager access</p>
</div>
<div class="paragraph">
<p>Enterprise bean access</p>
</div>
<div class="paragraph">
<p>Timer service or Timer methods</p>
</div>
<div class="paragraph">
<p>EntityManagerFactory access</p>
</div>
<div class="paragraph">
<p>EntityManager access</p>
</div>
<div class="paragraph">
<p>ejbFind</p>
</div>
<div class="paragraph">
<p>EntityContext methods: getEJBHome,
getEJBLocalHome, getCallerPrincipal, getRollbackOnly, isCallerInRole,
setRollbackOnly, lookup</p>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env</p>
</div>
<div class="paragraph">
<p>Resource manager access</p>
</div>
<div class="paragraph">
<p>Enterprise bean access</p>
</div>
<div class="paragraph">
<p>EntityManagerFactory access</p>
</div>
<div class="paragraph">
<p>EntityManager access</p>
</div>
<div class="paragraph">
<p>ejbHome</p>
</div>
<div class="paragraph">
<p>EntityContext methods: getEJBHome,
getEJBLocalHome, getCallerPrincipal, getRollbackOnly, isCallerInRole,
setRollbackOnly, getTimerService, lookup</p>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env</p>
</div>
<div class="paragraph">
<p>Resource manager access</p>
</div>
<div class="paragraph">
<p>Enterprise bean access</p>
</div>
<div class="paragraph">
<p>EntityManagerFactory access</p>
</div>
<div class="paragraph">
<p>EntityManager access</p>
</div>
<div class="paragraph">
<p>ejbActivate</p>
</div>
<div class="paragraph">
<p>ejbPassivate</p>
</div>
<div class="paragraph">
<p>EntityContext methods: getEJBHome,
getEJBLocalHome, getEJBObject, <em>getEJBLocalObject,</em> getPrimaryKey,
getTimerService, lookup</p>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env</p>
</div>
<div class="paragraph">
<p>ejbLoad</p>
</div>
<div class="paragraph">
<p>ejbStore</p>
</div>
<div class="paragraph">
<p>EntityContext methods: getEJBHome,
<em>getEJBLocalHome</em> , getCallerPrincipal, getRollbackOnly, isCallerInRole,
setRollbackOnly, getEJBObject, <em>getEJBLocalObject,</em> getPrimaryKey,
getTimerService, lookup</p>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env</p>
</div>
<div class="paragraph">
<p>Resource manager access</p>
</div>
<div class="paragraph">
<p>Enterprise bean access</p>
</div>
<div class="paragraph">
<p>Timer service or Timer methods</p>
</div>
<div class="paragraph">
<p>EntityManagerFactory access</p>
</div>
<div class="paragraph">
<p>EntityManager access</p>
</div>
<div class="paragraph">
<p>business method</p>
</div>
<div class="paragraph">
<p>from component interface</p>
</div>
<div class="paragraph">
<p>EntityContext methods: getEJBHome,
getEJBLocalHome, getCallerPrincipal, getRollbackOnly, isCallerInRole,
setRollbackOnly, getEJBObject, <em>getEJBLocalObject,</em> getPrimaryKey,
getTimerService, lookup</p>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env</p>
</div>
<div class="paragraph">
<p>Resource manager access</p>
</div>
<div class="paragraph">
<p>Enterprise bean access</p>
</div>
<div class="paragraph">
<p>Timer service or Timer methods</p>
</div>
<div class="paragraph">
<p>EntityManagerFactory access</p>
</div>
<div class="paragraph">
<p>EntityManager access</p>
</div>
<div class="paragraph">
<p>ejbTimeout</p>
</div>
<div class="paragraph">
<p>EntityContext methods: getEJBHome,
getEJBLocalHome, getCallerPrincipal, isCallerInRole, getRollbackOnly,
setRollbackOnly, getEJBObject, <em>getEJBLocalObject,</em> getPrimaryKey,
getTimerService, lookup</p>
</div>
<div class="paragraph">
<p>JNDI access to java:comp/env</p>
</div>
<div class="paragraph">
<p>Resource manager access</p>
</div>
<div class="paragraph">
<p>Enterprise bean access</p>
</div>
<div class="paragraph">
<p>Timer service or Timer methods</p>
</div>
<div class="paragraph">
<p>EntityManagerFactory access</p>
</div>
<div class="paragraph">
<p>EntityManager access</p>
</div>
<div class="paragraph">
<p>Additional restrictions:</p>
</div>
<div class="paragraph">
<p>The getRollbackOnly and setRollbackOnly
methods of the EntityContext interface should be used only in the
enterprise bean methods that execute in the context of a transaction.
The container must throw the java.lang.IllegalStateException if the
methods are invoked while the instance is not associated with a
transaction.</p>
</div>
<div class="paragraph">
<p>Reasons for disallowing operations:</p>
</div>
<div class="paragraph">
<p>Invoking the getEJBObject, getEJBLocalObject,
and getPrimaryKey methods is disallowed in the entity bean methods in
which there is no entity object identity associated with the instance.</p>
</div>
<div class="paragraph">
<p>Invoking the <em>getEJBObject</em> and <em>getEJBHome</em>
methods is disallowed if the entity bean does not define a remote client
view.</p>
</div>
<div class="paragraph">
<p>Invoking the <em>getEJBLocalObject</em> and
<em>getEJBLocalHome</em> methods is disallowed if the entity bean does not
define a local client view.</p>
</div>
<div class="paragraph">
<p>Invoking the getRollbackOnly and
setRollbackOnly methods is disallowed in the entity bean methods for
which the container does not have a meaningful transaction context.
These are the methods that have the NotSupported, Never, or Supports
transaction attribute.</p>
</div>
<div class="paragraph">
<p>Accessing resource managers and enterprise
beans is disallowed in the entity bean methods for which the container
does not have a meaningful transaction context or client security
context.</p>
</div>
</div>
<div class="sect2">
<h3 id="_caching_of_entity_state_and_the_ejbload_and_ejbstore_methods"><a class="anchor" href="#_caching_of_entity_state_and_the_ejbload_and_ejbstore_methods"></a>6.11. Caching of Entity State and the ejbLoad and ejbStore Methods</h3>
<div class="paragraph">
<p>An instance of an
entity bean with bean-managed persistence can cache the entity object’s
state between business method invocations. An instance may choose to
cache the entire entity object’s state, part of the state, or no state
at all.</p>
</div>
<div class="paragraph">
<p>The
container-invoked ejbLoad and ejbStore methods assist the instance with
the management of the cached entity object’s state. The instance should
handle the ejbLoad and ejbStore methods as follows:</p>
</div>
<div class="paragraph">
<p>When the container invokes the ejbStore
method on the instance, the instance should push all cached updates of
the entity object’s state to the underlying database. The container
invokes the ejbStore method at the end of a
transaction<a href="#a3389">25</a>, and may also invoke it at other
times when the instance is in the ready state. (For example the
container may invoke <em>ejbStore</em> when passivating an instance in the
middle of a transaction, or when transferring the instance’s state to
another instance to support distributed transactions in a multi-process
server.)</p>
</div>
<div class="paragraph">
<p>When the container invokes the ejbLoad method
on the instance, the instance should discard any cached entity object’s
state. The instance may, but is not required to, refresh the cached
state by reloading it from the underlying database.</p>
</div>
<div class="paragraph">
<p>The following examples, which are
illustrative but not prescriptive, show how an instance may cache the
entity object’s state:</p>
</div>
<div class="paragraph">
<p>An instance loads the entire entity object’s
state in the ejbLoad method and caches it until the container invokes
the ejbStore method. The business methods read and write the cached
entity state. The ejbStore method writes the updated parts of the entity
object’s state to the database.</p>
</div>
<div class="paragraph">
<p>An instance loads the most frequently used
part of the entity object’s state in the ejbLoad method and caches it
until the container invokes the ejbStore method. Additional parts of the
entity object’s state are loaded as needed by the business methods. The
ejbStore method writes the updated parts of the entity object’s state to
the database.</p>
</div>
<div class="paragraph">
<p>An instance does not cache any entity
object’s state between business methods. The business methods access and
modify the entity object’s state directly in the database. The ejbLoad
and ejbStore methods have an empty implementation.</p>
</div>
<div class="paragraph">
<p>We expect that most entity developers will
not manually code the cache management and data access calls in the
entity bean class. We expect that they will rely on application
development tools to provide various data access components that
encapsulate data access and provide state caching.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ejbload_and_ejbstore_with_the_notsupported_transaction_attribute"><a class="anchor" href="#_ejbload_and_ejbstore_with_the_notsupported_transaction_attribute"></a>6.12. ejbLoad and ejbStore with the NotSupported Transaction Attribute</h3>
<div class="paragraph">
<p>The use of the
ejbLoad and ejbStore methods for caching an
entity object’s state in the instance works well only if the container
can use transaction boundaries to drive the ejbLoad and ejbStore
methods. When the
NotSupported<a href="#a3390">26</a>
transaction attribute is assigned to a component interface method, the
corresponding enterprise bean class method executes with an unspecified
transaction context (See EJB Core Contracts and Requirements document
<a href="Ejb.html#a3339">See EJB 3.2 Core Contracts and Requirements.</a> Subsection “Handling of Methods
that Run with an unspecified transaction context”). This means that the
container does not have any well-defined transaction boundaries to drive
the ejbLoad and ejbStore methods on the instance.</p>
</div>
<div class="paragraph">
<p>Therefore, the ejbLoad and
ejbStore methods are “unreliable” for the
instances that the container uses to dispatch the methods with an
unspecified transaction context. The following are the only guarantees
that the container provides for the instances that execute the methods
with an unspecified transaction context:</p>
</div>
<div class="paragraph">
<p>The container invokes at least one ejbLoad
between ejbActivate and the first business method in the instance.</p>
</div>
<div class="paragraph">
<p>The container invokes at least one ejbStore
between the last business method on the instance and the ejbPassivate
method<a href="#a3391">27</a>.</p>
</div>
<div class="paragraph">
<p>Because the entity object’s state accessed
between the ejbLoad and ejbStore method pair is not protected by a
transaction boundary for the methods that execute with an unspecified
transaction context, the Bean Provider should not attempt to use the
ejbLoad and ejbStore methods to control caching of the entity object’s
state in the instance. Typically, the implementation of the ejbLoad and
ejbStore methods should be a no-op (i.e., an empty method), and each
business method should access the entity object’s state directly in the
database.</p>
</div>
</div>
<div class="sect2">
<h3 id="_finder_method_return_type"><a class="anchor" href="#_finder_method_return_type"></a>6.13. <a id="a2729"></a>Finder Method Return Type</h3>

</div>
<div class="sect2">
<h3 id="_single_object_finder"><a class="anchor" href="#_single_object_finder"></a>6.14. Single-Object Finder</h3>
<div class="paragraph">
<p>Some finder
methods (such as ejbFindByPrimaryKey) are designed to return at most one
entity object. For single-object finders, the result type of a
find&lt;METHOD&gt;method defined in the entity bean’s remote home interface is
the entity bean’s remote interface, and the result type of the
find&lt;METHOD&gt;method defined in the entity bean’s local home interface is
the entity bean’s local interface. The result type of the corresponding
ejbFind&lt;METHOD&gt; method defined in the entity’s implementation class is
the entity bean’s primary key type.</p>
</div>
<div class="paragraph">
<p>The following code illustrates the definition
of a single-object finder on the remote home interface.</p>
</div>
<div class="paragraph">
<p>public AccountHome extends javax.ejb.EJBHome
\{</p>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> Account findByPrimaryKey(AccountPrimaryKey
primkey)</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>throws FinderException, RemoteException;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="paragraph">
<p>Note that a finder method defined on the
local home interface, however, must not throw the <em>RemoteException</em> .</p>
</div>
<div class="paragraph">
<p>public AccountBean implements
javax.ejb.EntityBean \{</p>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> public AccountPrimaryKey
ejbFindByPrimaryKey(</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>AccountPrimaryKey primkey)</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>throws FinderException</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>\{</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
</div>
<div class="sect2">
<h3 id="_multi_object_finders"><a class="anchor" href="#_multi_object_finders"></a>6.15. Multi-Object Finders</h3>
<div class="paragraph">
<p>Some finder methods are designed to return
multiple entity objects. For multi-object
finders defined in the entity bean’s remote home interface, the result
type of the find&lt;METHOD&gt;method is a collection of objects implementing
the entity bean’s remote interface. For multi-object finders defined in
the entity bean’s local home interface, the result type is a collection
of objects implementing the entity bean’s local interface. In either
case, the result type of the corresponding ejbFind&lt;METHOD&gt;
implementation method defined in the entity bean’s implementation class
is a collection of objects of the entity bean’s primary key type.</p>
</div>
<div class="paragraph">
<p>The Bean Provider can choose two types to
define a collection type for a finder:</p>
</div>
<div class="paragraph">
<p>the Java™ 2
java.util.Collection interface</p>
</div>
<div class="paragraph">
<p>the JDK™ 1.1
java.util.Enumeration interface</p>
</div>
<div class="paragraph">
<p>A Bean Provider targeting containers and
clients based on Java 2 should use the java.util.Collection interface
for the finder’s result type.</p>
</div>
<div class="paragraph">
<p>A Bean Provider who wants to ensure that the
entity bean is compatible with containers and clients based on JDK 1.1
must use the java.util.Enumeration interface for the finder’s result
type<a href="#a3392">28</a>.</p>
</div>
<div class="paragraph">
<p>The Bean Provider must ensure that the
objects in the java.util.Enumeration or java.util.Collection returned
from the ejbFind&lt;METHOD&gt; method are instances of the entity bean’s
primary key class.</p>
</div>
<div class="paragraph">
<p>A client program must use the
PortableRemoteObject.narrow method to
convert the objects contained in the collections returned by a finder
method on the entity bean’s remote home interface to the entity bean’s
remote interface type.</p>
</div>
<div class="paragraph">
<p>The following is
an example of a multi-object finder method definition that is compatible
with containers and clients based on Java 2:</p>
</div>
<div class="paragraph">
<p>public AccountHome extends javax.ejb.EJBHome
\{</p>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> java.util.Collection
findLargeAccounts(double limit)</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>throws FinderException, RemoteException;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="paragraph">
<p>public AccountBean implements
javax.ejb.EntityBean \{</p>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> public java.util.Collection
ejbFindLargeAccounts(</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>double limit) throws FinderException</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>\{</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="paragraph">
<p>The following is an example of a multi-object
finder method definition compatible with containers and clients that are
based on both JDK 1.1 and Java 2:</p>
</div>
<div class="paragraph">
<p>public AccountHome extends javax.ejb.EJBHome
\{</p>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> java.util.Enumeration
findLargeAccounts(double limit)</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>throws FinderException, RemoteException;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="paragraph">
<p>public AccountBean implements
javax.ejb.EntityBean \{</p>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> public java.util.Enumeration
ejbFindLargeAccounts(</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>double limit) throws FinderException</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>\{</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>...</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
</div>
<div class="sect2">
<h3 id="_timer_notifications_2"><a class="anchor" href="#_timer_notifications_2"></a>6.16. Timer Notifications</h3>
<div class="paragraph">
<p>An entity bean can be registered with the EJB
Timer Service for time-based event notifications if it implements the
<em>javax.ejb.TimedObject</em> interface. The container invokes the bean
instance’s <em>ejbTimeout</em> method when a timer for the bean has expired.
See <a href="Ejb.html#a3258">See Timer Service</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_standard_application_exceptions_for_entities_2"><a class="anchor" href="#_standard_application_exceptions_for_entities_2"></a>6.17. <a id="a2806"></a>Standard Application Exceptions for Entities</h3>
<div class="paragraph">
<p>The EJB
specification defines the following standard application exceptions:</p>
</div>
<div class="paragraph">
<p>javax.ejb.CreateException</p>
</div>
<div class="paragraph">
<p>javax.ejb.DuplicateKeyException</p>
</div>
<div class="paragraph">
<p>javax.ejb.FinderException</p>
</div>
<div class="paragraph">
<p>javax.ejb.ObjectNotFoundException</p>
</div>
<div class="paragraph">
<p>javax.ejb.RemoveException</p>
</div>
</div>
<div class="sect2">
<h3 id="_createexception_2"><a class="anchor" href="#_createexception_2"></a>6.18. CreateException</h3>
<div class="paragraph">
<p>From the client’s
perspective, a CreateException (or a subclass of CreateException)
indicates that an application level error occurred during the
create&lt;METHOD&gt; operation. If a client receives this exception, the
client does not know, in general, whether the entity object was created
but not fully initialized, or not created at all. Also, the client does
not know whether or not the transaction has been marked for rollback.
(However, the client may determine the transaction status using the
UserTransaction interface or the <em>setRollbackOnly</em> method of the
<em>EJBContext</em> interface.)</p>
</div>
<div class="paragraph">
<p>The Bean Provider throws the CreateException
(or subclass of CreateException) from the ejbCreate&lt;METHOD&gt; and
ejbPostCreate&lt;METHOD&gt; methods to indicate an application-level error
from the create or initialization operation. Optionally, the Bean
Provider may mark the transaction for rollback before throwing this
exception.</p>
</div>
<div class="paragraph">
<p>The Bean Provider is encouraged to mark the
transaction for rollback only if data integrity would be lost if the
transaction were committed by the client. Typically, when a
<em>CreateException</em> is thrown, it leaves the database in a consistent
state, allowing the client to recover. For example, <em>ejbCreate</em> may
throw the <em>CreateException</em> to indicate that the some of the arguments
to the <em>create&lt;METHOD&gt;</em> method are invalid.</p>
</div>
<div class="paragraph">
<p>The container treats the CreateException as
any other application exception. See Section
<a href="Ejb.html#a3227">See Container Provider Responsibilities</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_duplicatekeyexception_2"><a class="anchor" href="#_duplicatekeyexception_2"></a>6.19. DuplicateKeyException</h3>
<div class="paragraph">
<p>The
DuplicateKeyException is a subclass of CreateException. It is thrown by
the ejbCreate&lt;METHOD&gt; method to indicate to the client that the entity
object cannot be created because an entity object with the same key
already exists. The unique key causing the violation may be the primary
key, or another key defined in the underlying database.</p>
</div>
<div class="paragraph">
<p>Normally, the Bean Provider should not mark
the transaction for rollback before throwing the exception.</p>
</div>
<div class="paragraph">
<p>When the client receives the
DuplicateKeyException, the client knows that the entity was not created,
and that the client’s transaction has not typically been marked for
rollback.</p>
</div>
</div>
<div class="sect2">
<h3 id="_finderexception_2"><a class="anchor" href="#_finderexception_2"></a>6.20. FinderException</h3>
<div class="paragraph">
<p>From the client’s
perspective, a FinderException (or a subclass of FinderException)
indicates that an application level error occurred during the find
operation. Typically, the client’s transaction has not been marked for
rollback because of the FinderException.</p>
</div>
<div class="paragraph">
<p>The Bean Provider throws the FinderException
(or subclass of FinderException) from the ejbFind&lt;METHOD&gt; method to
indicate an application-level error in the finder method. The Bean
Provider should not, typically, mark the transaction for rollback before
throwing the FinderException.</p>
</div>
<div class="paragraph">
<p>The container treats the FinderException as
any other application exception. See Section
<a href="Ejb.html#a3227">See Container Provider Responsibilities</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_objectnotfoundexception_2"><a class="anchor" href="#_objectnotfoundexception_2"></a>6.21. ObjectNotFoundException</h3>
<div class="paragraph">
<p>The
ObjectNotFoundException is a subclass of FinderException. It is thrown
by the ejbFind&lt;METHOD&gt; method to indicate that the requested entity
object does not exist.</p>
</div>
<div class="paragraph">
<p>Only single-object finders (see Subsection
<a href="Ejb.html#a2729">See Finder Method Return Type</a>) should throw
this exception. Multi-object finders must not throw this exception.
Multi-object finders should return an empty collection as an indication
that no matching objects were found.</p>
</div>
</div>
<div class="sect2">
<h3 id="_removeexception_2"><a class="anchor" href="#_removeexception_2"></a>6.22. RemoveException</h3>
<div class="paragraph">
<p>From the client’s
perspective, a RemoveException (or a subclass of RemoveException)
indicates that an application level error occurred during a remove
operation. If a client receives this exception, the client does not
know, in general, whether the entity object was removed or not. The
client also does not know if the transaction has been marked for
rollback. (However, the client may determine the transaction status
using the UserTransaction interface.)</p>
</div>
<div class="paragraph">
<p>The Bean Provider throws the RemoveException
(or subclass of RemoveException) from the ejbRemove method to indicate
an application-level error from the entity object removal operation.
Optionally, the Bean Provider may mark the transaction for rollback
before throwing this exception.</p>
</div>
<div class="paragraph">
<p>The Bean Provider is encouraged to mark the
transaction for rollback only if data integrity would be lost if the
transaction were committed by the client. Typically, when a
<em>RemoveException</em> is thrown, it leaves the database in a consistent
state, allowing the client to recover.</p>
</div>
<div class="paragraph">
<p>The container
treats the RemoveException as any other application exception. See
Section <a href="Ejb.html#a3227">See Container Provider
Responsibilities</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_commit_options_2"><a class="anchor" href="#_commit_options_2"></a>6.23. Commit Options</h3>
<div class="paragraph">
<p>The Entity Bean
protocol is designed to give the container the flexibility to select the
disposition of the instance state at transaction commit time. This
flexibility allows the container to optimally manage the caching of
entity object’s state and the association of an entity object identity
with the enterprise bean instances.</p>
</div>
<div class="paragraph">
<p>The container can select from the following
commit-time options:</p>
</div>
<div class="paragraph">
<p>Option A: The container caches a “ready”
instance between transactions. The container ensures that the instance
has exclusive access to the state of the object in the persistent
storage. Therefore, the container does not have to synchronize the
instance’s state from the persistent storage at the beginning of the
next transaction.</p>
</div>
<div class="paragraph">
<p>Option B: The container caches a “ready”
instance between transactions. In contrast to Option A, in this option
the container does not ensure that the instance has exclusive access to
the state of the object in the persistent storage. Therefore, the
container must synchronize the instance’s state from the persistent
storage at the beginning of the next transaction.</p>
</div>
<div class="paragraph">
<p>Option <em>C</em> : The container does not cache a
“ready” instance between transactions. The container returns the
instance to the pool of available instances after a transaction has
completed.</p>
</div>
<div class="paragraph">
<p>The following table provides a summary of the
commit-time options.</p>
</div>
<div class="paragraph">
<p>===</p>
</div>
<div class="paragraph">
<p>Summary of Commit-Time Options</p>
</div>
<div class="paragraph">
<p>Write instance state to database</p>
</div>
<div class="paragraph">
<p>Instance stays</p>
</div>
<div class="paragraph">
<p>ready</p>
</div>
<div class="paragraph">
<p>Instance state remains valid</p>
</div>
<div class="paragraph">
<p>Option A</p>
</div>
<div class="paragraph">
<p>Yes</p>
</div>
<div class="paragraph">
<p>Yes</p>
</div>
<div class="paragraph">
<p>Yes</p>
</div>
<div class="paragraph">
<p>Option B</p>
</div>
<div class="paragraph">
<p>Yes</p>
</div>
<div class="paragraph">
<p>Yes</p>
</div>
<div class="paragraph">
<p>No</p>
</div>
<div class="paragraph">
<p>Option C</p>
</div>
<div class="paragraph">
<p>Yes</p>
</div>
<div class="paragraph">
<p>No</p>
</div>
<div class="paragraph">
<p>No</p>
</div>
<div class="paragraph">
<p>Note that the container synchronizes the
instance’s state with the persistent storage at transaction commit for
all three options.</p>
</div>
<div class="paragraph">
<p>The selection of the commit option is
transparent to the entity bean implementation—the entity bean will work
correctly regardless of the commit-time option chosen by the container.
The Bean Provider writes the entity bean in the same way.</p>
</div>
</div>
<div class="sect2">
<h3 id="_concurrent_access_from_multiple_transactions_2"><a class="anchor" href="#_concurrent_access_from_multiple_transactions_2"></a>6.24. Concurrent Access from Multiple Transactions</h3>
<div class="paragraph">
<p>When writing the entity bean business
methods, the Bean Provider does not have to worry about
concurrent access from multiple
transactions. The Bean Provider may assume that the container will
ensure appropriate synchronization for entity objects that are accessed
concurrently from multiple transactions.</p>
</div>
<div class="paragraph">
<p>The container
typically uses one of the following implementation strategies to achieve
proper synchronization. (These strategies are illustrative, not
prescriptive.)</p>
</div>
<div class="paragraph">
<p>The container activates multiple instances of
the entity bean, one for each transaction in which the entity object is
being accessed. The transaction synchronization is performed
automatically by the underlying database during the database access
calls performed by the business methods and the <em>ejbTimeout</em> method; and
by the <em>ejbLoad</em> , <em>ejbCreate&lt;METHOD&gt;</em> , <em>ejbStore</em> , and <em>ejbRemove</em>
methods. The database system provides all the necessary transaction
synchronization; the container does not have to perform any
synchronization logic.</p>
</div>
<div class="paragraph">
<p>===</p>
</div>
<div class="paragraph">
<p>Multiple Clients Can Access the Same Entity Object
Using Multiple Instances</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-41.png" alt="image"></span></p>
</div>
<div class="paragraph">
<p>With this strategy, the type of lock acquired
by <em>ejbLoad</em> leads to a trade-off. If <em>ejbLoad</em> acquires an exclusive
lock on the instance&#8217;s state in the database, then throughput of
read-only transactions could be impacted. If <em>ejbLoad</em> acquires a shared
lock and the instance is updated, then <em>ejbStore</em> will need to promote
the lock to an exclusive lock. This may cause a deadlock if it happens
concurrently under multiple transactions.</p>
</div>
<div class="paragraph">
<p>The container acquires exclusive access to
the entity object’s state in the database. The container activates a
single instance and serializes the access from multiple transactions to
this instance. The commit-time option A applies to this type of
container.</p>
</div>
<div class="paragraph">
<p>===</p>
</div>
<div class="paragraph">
<p>Multiple Clients Can Access the Same Entity Object Using Single Instance</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/EBOpt-42.png" alt="image"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="_non_reentrant_and_re_entrant_instances_2"><a class="anchor" href="#_non_reentrant_and_re_entrant_instances_2"></a>6.25. Non-reentrant and R<a id="a2872"></a>e-entrant Instances</h3>
<div class="paragraph">
<p>An entity Bean
Provider can specify that an entity bean is non-reentrant. If an
instance of a non-reentrant entity bean executes a client request in a
given transaction context, and another request with the same transaction
context arrives for the same entity object, the container will throw an
exception to the second request. This rule allows the Bean Provider to
program the entity bean as single-threaded, non-reentrant code.</p>
</div>
<div class="paragraph">
<p>The functionality of some entity beans may
require loopbacks in the same transaction
context. An example of a loopback is when the client calls entity object
A, A calls entity object B, and B calls back A in the same transaction
context. The entity bean’s method invoked by the loopback shares the
current execution context (which includes the transaction and security
contexts) with the bean’s method invoked by the client.</p>
</div>
<div class="paragraph">
<p>If the entity bean is specified as
non-reentrant in the deployment descriptor, the container must reject an
attempt to re-enter the instance via the entity bean’s component
interface while the instance is executing a business method. (This can
happen, for example, if the instance has invoked another enterprise
bean, and the other enterprise bean tries to make a loopback call.) If
the attempt is made to reenter the instance through the remote
interface, the container must throw the <em>java.rmi.RemoteException</em> to
the caller. If the attempt is made to reenter the instance through the
local interface, the container must throw the <em>javax.ejb.EJBException</em>
to the caller. The container must allow the call if the bean’s
deployment descriptor specifies that the entity bean is re-entrant.</p>
</div>
<div class="paragraph">
<p>Re-entrant entity beans must be programmed
and used with caution. First, the Bean Provider must code the entity
bean with the anticipation of a loopback call. Second, since the
container cannot, in general, tell a loopback from a concurrent call
from a different client, the client programmer must be careful to avoid
code that could lead to a concurrent call in the same transaction
context.</p>
</div>
<div class="paragraph">
<p>Concurrent calls in the same transaction
context targeted at the same entity object are illegal and may lead to
unpredictable results. Since the container cannot, in general,
distinguish between an illegal concurrent call and a legal loopback,
application programmers are encouraged to avoid using loopbacks. Entity
beans that do not need callbacks should be marked as non-reentrant in
the deployment descriptor, allowing the container to detect and prevent
illegal concurrent calls from clients.</p>
</div>
</div>
<div class="sect2">
<h3 id="_responsibilities_of_the_enterprise_bean_provider_2"><a class="anchor" href="#_responsibilities_of_the_enterprise_bean_provider_2"></a>6.26. Responsibilities of the Enterprise Bean Provider</h3>
<div class="paragraph">
<p>This section describes the responsibilities
of a bean-managed persistence entity Bean Provider to ensure that the
entity bean can be deployed in any EJB container.</p>
</div>
</div>
<div class="sect2">
<h3 id="_classes_and_interfaces_2"><a class="anchor" href="#_classes_and_interfaces_2"></a>6.27. Classes and Interfaces</h3>
<div class="paragraph">
<p>The Bean Provider is responsible for
providing the following class files:</p>
</div>
<div class="paragraph">
<p>Entity bean class and any dependent classes</p>
</div>
<div class="paragraph">
<p>Primary key class</p>
</div>
<div class="paragraph">
<p>Entity bean’s remote interface and remote
home interface, if the entity bean provides a remote client view</p>
</div>
<div class="paragraph">
<p>Entity bean’s local interface and local home
interface, if the entity bean provides a local client view</p>
</div>
<div class="paragraph">
<p>The Bean Provider must provide a remote
interface and a remote home interface or a local interface an local home
interface for the bean. The Bean Provider may provide a remote
interface, remote home interface, local interface, and local home
interface for the bean. Other combinations are not allowed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_enterprise_bean_class_3"><a class="anchor" href="#_enterprise_bean_class_3"></a>6.28. Enterprise Bean Class</h3>
<div class="paragraph">
<p>The following are
the requirements for an entity bean class:</p>
</div>
<div class="paragraph">
<p>The class must implement, directly or
indirectly, the javax.ejb.EntityBean interface.</p>
</div>
<div class="paragraph">
<p>The class may implement, directly or
indirectly, the <em>javax.ejb.TimedObject</em> interface.</p>
</div>
<div class="paragraph">
<p>The class must be defined as public and must
not be abstract. The class must be a top level class.</p>
</div>
<div class="paragraph">
<p>The class must not be defined as final.</p>
</div>
<div class="paragraph">
<p>The class must define a public constructor
that takes no arguments.</p>
</div>
<div class="paragraph">
<p>The class must not define the finalize
method.</p>
</div>
<div class="paragraph">
<p>The class may, but is not required to,
implement the entity bean’s component
interface<a href="#a3393">29</a>. If the class implements the entity
bean’s component interface, the class must provide no-op implementations
of the methods defined in the javax.ejb.EJBObject or
javax.ejb.EJBLocalObject interface. The container will never invoke
these methods on the bean instances at runtime.</p>
</div>
<div class="paragraph">
<p>A no-op implementation of these methods is
required to avoid defining the entity bean class as abstract.</p>
</div>
<div class="paragraph">
<p>The entity bean class must implement the
business methods, and the ejbCreate&lt;METHOD&gt;, ejbPostCreate&lt;METHOD&gt;,
ejbFind&lt;METHOD&gt;, and ejbHome&lt;METHOD&gt; methods as described later in this
section.</p>
</div>
<div class="paragraph">
<p>The entity bean class may have superclasses
and/or superinterfaces. If the entity bean
has superclasses, the business methods, the ejbCreate and ejbPostCreate
methods, the finder methods, and the methods of the EntityBean interface
or the <em>TimedObject</em> interface may be implemented in the enterprise bean
class or in any of its superclasses.</p>
</div>
<div class="paragraph">
<p>The entity bean class is allowed to implement
other methods (for example helper methods
invoked internally by the business methods) in addition to the methods
required by the EJB specification.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ejbcreatemethod_methods_2"><a class="anchor" href="#_ejbcreatemethod_methods_2"></a>6.29. ejbCreate&lt;METHOD&gt; Methods</h3>
<div class="paragraph">
<p>The
entity bean class must implement the ejbCreate&lt;METHOD&gt; methods that
correspond to the create&lt;METHOD&gt; methods specified in the entity bean’s
home interface.</p>
</div>
<div class="paragraph">
<p>The entity bean class may define zero or more
ejbCreate&lt;METHOD&gt; methods whose signatures must follow these rules:</p>
</div>
<div class="paragraph">
<p>The method name must have ejbCreate as its
prefix.</p>
</div>
<div class="paragraph">
<p>The method must be declared as public.</p>
</div>
<div class="paragraph">
<p>The method must not be declared as final or
static.</p>
</div>
<div class="paragraph">
<p>The return type must be the entity bean’s
primary key type.</p>
</div>
<div class="paragraph">
<p>The method argument and return value types
must be legal types for RMI-IIOP if the e <em>jbCreate&lt;METHOD&gt;</em> corresponds
to a <em>create&lt;METHOD&gt;</em> on the entity bean’s remote home interface.</p>
</div>
<div class="paragraph">
<p>The <em>throws</em> clause may define arbitrary
application specific exceptions, including the
javax.ejb.CreateException.</p>
</div>
<div class="paragraph">
<p>EJB 1.0 allowed the <em>ejbCreate</em> method to
throw the java.rmi.RemoteException to indicate a non-application
exception. This practice was deprecated in EJB 1.1—an EJB 1.1 or EJB 2.0
or later compliant enterprise bean should throw the
<em>javax.ejb.EJBException</em> or another <em>java.lang.RuntimeException</em> to
indicate non-application exceptions to the container (see Section
<a href="Ejb.html#a3221">See System Exceptions</a>). An EJB 2.0 or later
enterprise bean should not throw the <em>java.rmi.RemoteException</em> . from
the <em>ejbCreate</em> method.</p>
</div>
<div class="paragraph">
<p>The entity object created by the
ejbCreate&lt;METHOD&gt; method must have a unique primary key. This means that
the primary key must be different from the primary keys of all the
existing entity objects within the same home. The ejbCreate&lt;METHOD&gt;
method should throw the DuplicateKeyException on an attempt to create an
entity object with a duplicate primary key. However, it is legal to
reuse the primary key of a previously removed entity object.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ejbpostcreatemethod_methods_2"><a class="anchor" href="#_ejbpostcreatemethod_methods_2"></a>6.30. ejbPostCreate&lt;METHOD&gt; Methods</h3>
<div class="paragraph">
<p>For each
ejbCreate&lt;METHOD&gt; method, the entity bean class must define a matching
ejbPostCreate&lt;METHOD&gt; method, using the following rules:</p>
</div>
<div class="paragraph">
<p>The method name must have ejbPostCreate as
its prefix.</p>
</div>
<div class="paragraph">
<p>The method must be declared as public.</p>
</div>
<div class="paragraph">
<p>The method must not be declared as final or
static.</p>
</div>
<div class="paragraph">
<p>The return type must be <em>void</em> .</p>
</div>
<div class="paragraph">
<p>The method arguments must be the same as the
arguments of the matching ejbCreate&lt;METHOD&gt; method.</p>
</div>
<div class="paragraph">
<p>The <em>throws</em> clause may define arbitrary
application specific exceptions, including the
javax.ejb.CreateException.</p>
</div>
<div class="paragraph">
<p>EJB 1.0 allowed the <em>ejbPostCreate</em> method to
throw the java.rmi.RemoteException to indicate a non-application
exception. This practice was deprecated in EJB 1.1—an EJB 1.1 or EJB 2.0
or later compliant enterprise bean should throw the
<em>javax.ejb.EJBException</em> or another <em>java.lang.RuntimeException</em> to
indicate non-application exceptions to the container (see Section
<a href="Ejb.html#a3221">See System Exceptions</a>). An EJB 2.0 or later
enterprise bean should not throw the <em>java.rmi.RemoteException</em> . from
the <em>ejbPostCreate</em> method.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ejbfind_methods"><a class="anchor" href="#_ejbfind_methods"></a>6.31. ejbFind Methods</h3>
<div class="paragraph">
<p>The entity bean
class may also define additional ejbFind&lt;METHOD&gt; finder methods.</p>
</div>
<div class="paragraph">
<p>The signatures of the finder methods must
follow the following rules:</p>
</div>
<div class="paragraph">
<p>A finder method name must start with the
prefix “ <em>ejbFind</em> ” (e.g. ejbFindByPrimaryKey, ejbFindLargeAccounts,
ejbFindLateShipments).</p>
</div>
<div class="paragraph">
<p>A finder method must be declared as public.</p>
</div>
<div class="paragraph">
<p>The method must not be declared as final or
static.</p>
</div>
<div class="paragraph">
<p>The method argument types must be legal types
for RMI-IIOP if the <em>ejbFind&lt;METHOD&gt;</em> method corresponds to a
<em>find&lt;METHOD&gt;</em> method on the entity bean’s remote home interface.</p>
</div>
<div class="paragraph">
<p>The return type of a finder method must be
the entity bean’s primary key type, or a collection of primary keys (see
Subsection <a href="Ejb.html#a2729">See Finder Method Return Type</a>).</p>
</div>
<div class="paragraph">
<p>The <em>throws</em> clause may define arbitrary
application specific exceptions, including the
javax.ejb.FinderException.</p>
</div>
<div class="paragraph">
<p>EJB 1.0 allowed the finder methods to throw
the java.rmi.RemoteException to indicate a non-application exception.
This practice was deprecated in EJB 1.1—an EJB 1.1 or EJB 2.0 or later
compliant enterprise bean should throw the <em>javax.ejb.EJBException</em> or
another <em>java.lang.RuntimeException</em> to indicate non-application
exceptions to the container (see Section <a href="Ejb.html#a3221">See
System Exceptions</a>). An EJB 2.0 or later enterprise bean should not
throw the <em>java.rmi.RemoteException</em> . from the <em>ejbFind</em> method.</p>
</div>
<div class="paragraph">
<p>Every entity bean must define the
ejbFindByPrimaryKey method. The result type for this method must be the
primary key type (i.e., the ejbFindByPrimaryKey method must be a
single-object finder).</p>
</div>
</div>
<div class="sect2">
<h3 id="_ejbhomemethod_methods_2"><a class="anchor" href="#_ejbhomemethod_methods_2"></a>6.32. ejbHome&lt;METHOD&gt; Methods</h3>
<div class="paragraph">
<p>The entity bean class may define zero or more
home methods whose signatures must follow the following rules:</p>
</div>
<div class="paragraph">
<p>An <em>ejbHome&lt;METHOD&gt;</em>
 method must exist for every home <em>&lt;METHOD&gt;</em>
method on the entity bean’s remote home or local home interface. The
method name must have ejbHome as its prefix followed by the name of the
<em>&lt;METHOD&gt;</em> method in which the first character has been uppercased.</p>
</div>
<div class="paragraph">
<p>The method must be declared as public.</p>
</div>
<div class="paragraph">
<p>The method must not be declared as static.</p>
</div>
<div class="paragraph">
<p>The method argument and return value types
must be legal types for RMI-IIOP if the <em>ejbHome</em> method corresponds to
a method on the entity bean’s remote home interface.</p>
</div>
<div class="paragraph">
<p>The <em>throws</em> clause may define arbitrary
application specific exceptions. The <em>throws</em> clause must not throw the
<em>java.rmi.RemoteException</em> .</p>
</div>
</div>
<div class="sect2">
<h3 id="_business_methods_2"><a class="anchor" href="#_business_methods_2"></a>6.33. Business Methods</h3>
<div class="paragraph">
<p>The entity bean
class may define zero or more business methods whose signatures must
follow these rules:</p>
</div>
<div class="paragraph">
<p>The method names can be arbitrary, but they
must not start with ‘ <em>ejb</em> ’ to avoid conflicts with the callback
methods used by the EJB architecture.</p>
</div>
<div class="paragraph">
<p>The business method must be declared as
public.</p>
</div>
<div class="paragraph">
<p>The method must not be declared as final or
static.</p>
</div>
<div class="paragraph">
<p>The method argument and return value types
must be legal types for RMI-IIOP if the method corresponds to a business
method on the entity bean’s remote interface.</p>
</div>
<div class="paragraph">
<p>The <em>throws</em> clause may define arbitrary
application specific exceptions.</p>
</div>
<div class="paragraph">
<p>EJB 1.0 allowed the business methods to throw
the java.rmi.RemoteException to indicate a non-application exception.
This practice was deprecated in EJB 1.1—an EJB 1.1 or EJB 2.0 or later
compliant enterprise bean should throw the <em>javax.ejb.EJBException</em> or
another <em>java.lang.RuntimeException</em> to indicate non-application
exceptions to the container (see Section <a href="Ejb.html#a3221">See
System Exceptions</a>). An EJB 2.0 or later enterprise bean should not
throw the <em>java.rmi.RemoteException</em> . from a business method.</p>
</div>
</div>
<div class="sect2">
<h3 id="_entity_beans_remote_interface_3"><a class="anchor" href="#_entity_beans_remote_interface_3"></a>6.34. Entity Bean’s Remote Interface</h3>
<div class="paragraph">
<p>The following are
the requirements for the entity bean’s remote interface:</p>
</div>
<div class="paragraph">
<p>The interface must extend the
javax.ejb.EJBObject interface.</p>
</div>
<div class="paragraph">
<p>The methods defined in the remote interface
must follow the rules for RMI-IIOP. This means that their argument and
return value types must be valid types for RMI-IIOP, and their <em>throws</em>
clauses must include the java.rmi.RemoteException.</p>
</div>
<div class="paragraph">
<p>The remote
interface is allowed to have superinterfaces. Use of interface
inheritance is subject to the RMI-IIOP rules for the definition of
remote interfaces.</p>
</div>
<div class="paragraph">
<p>For each method defined in the remote
interface, there must be a matching method in the entity bean’s class.
The matching method must have:</p>
</div>
<div class="paragraph">
<p>The same name.</p>
</div>
<div class="paragraph">
<p>The same number and types of its arguments,
and the same return type.</p>
</div>
<div class="paragraph">
<p>All the exceptions defined in the <em>throws</em>
clause of the matching method of the enterprise bean class must be
defined in the <em>throws</em> clause of the method of the remote interface.</p>
</div>
<div class="paragraph">
<p>The remote interface methods must not expose
local interface types, local home interface types, timers or timer
handles, or the managed collection classes that are used for entity
beans with container-managed persistence as arguments or results.</p>
</div>
</div>
<div class="sect2">
<h3 id="_entity_beans_remote_home_interface_3"><a class="anchor" href="#_entity_beans_remote_home_interface_3"></a>6.35. Entity Bean’s Remote Home Interface</h3>
<div class="paragraph">
<p>The following are
the requirements for the entity bean’s remote home interface:</p>
</div>
<div class="paragraph">
<p>The interface must extend the
javax.ejb.EJBHome interface.</p>
</div>
<div class="paragraph">
<p>The methods defined in this interface must
follow the rules for RMI-IIOP. This means that their argument and return
types must be of valid types for RMI-IIOP, and that their <em>throws</em>
clauses must include the java.rmi.RemoteException.</p>
</div>
<div class="paragraph">
<p>The remote home interface is allowed to have
superinterfaces. Use of interface inheritance is subject to the RMI-IIOP
rules for the definition of remote interfaces.</p>
</div>
<div class="paragraph">
<p>Each method defined in the remote home
interface must be one of the following:</p>
</div>
<div class="paragraph">
<p>A create method.</p>
</div>
<div class="paragraph">
<p>A finder method.</p>
</div>
<div class="paragraph">
<p>A home method.</p>
</div>
<div class="paragraph">
<p>Each create method must be the named “
<em>create&lt;METHOD&gt;</em> ”, and it must match one of the ejbCreate <em>&lt;METHOD&gt;</em>
methods defined in the enterprise bean class. The matching ejbCreate
<em>&lt;METHOD&gt;</em> method must have the same number and types of its arguments.
(Note that the return type is different.)</p>
</div>
<div class="paragraph">
<p>The return type for a create&lt;METHOD&gt; method
must be the entity bean’s remote interface type.</p>
</div>
<div class="paragraph">
<p>All the exceptions defined in the <em>throws</em>
clause of the matching ejbCreate <em>&lt;METHOD&gt;</em> and ejbPostCreate <em>&lt;METHOD&gt;</em>
methods of the enterprise bean class must be included in the <em>throws</em>
clause of the matching create&lt;METHOD&gt; method of the remote home
interface (i.e., the set of exceptions defined for the create&lt;METHOD&gt;
method must be a superset of the union of exceptions defined for the
ejbCreate&lt;METHOD&gt; and ejbPostCreate&lt;METHOD&gt; methods).</p>
</div>
<div class="paragraph">
<p>The <em>throws</em> clause of a create <em>&lt;METHOD&gt;</em>
method must include the javax.ejb.CreateException.</p>
</div>
<div class="paragraph">
<p>Each finder method must be named “
<em>find&lt;METHOD&gt;</em> ” (e.g. findLargeAccounts), and it must match one of the
ejbFind&lt;METHOD&gt; methods defined in the entity bean class (e.g.
ejbFindLargeAccounts). The matching ejbFind&lt;METHOD&gt; method must have the
same number and types of arguments. (Note that the return type may be
different.)</p>
</div>
<div class="paragraph">
<p>The return type for a find&lt;METHOD&gt; method
must be the entity bean’s remote interface type (for a single-object
finder), or a collection thereof (for a multi-object finder).</p>
</div>
<div class="paragraph">
<p>The remote home interface must always include
the findByPrimaryKey method, which is always a single-object finder. The
method must declare the primary key class as the method argument.</p>
</div>
<div class="paragraph">
<p>All the exceptions defined in the <em>throws</em>
clause of an ejbFind method of the entity bean class must be included in
the <em>throws</em> clause of the matching find method of the remote home
interface.</p>
</div>
<div class="paragraph">
<p>The <em>throws</em> clause of a finder method must
include the javax.ejb.FinderException.</p>
</div>
<div class="paragraph">
<p>Home methods can have arbitrary names,
provided that they do not clash with create, find, and remove method
names. The matching ejbHome method specified in the entity bean class
must have the same number and types of arguments and must return the
same type as the home method as specified in the remote home interface
of the bean.</p>
</div>
<div class="paragraph">
<p>The remote home interface methods must not
expose local interface types, local home interface types, timer handles,
or the managed collection classes that are used for entity beans with
container-managed persistence as arguments or results.</p>
</div>
</div>
<div class="sect2">
<h3 id="_entity_beans_local_interface_3"><a class="anchor" href="#_entity_beans_local_interface_3"></a>6.36. Entity Bean’s Local Interface</h3>
<div class="paragraph">
<p>The following are
the requirements for the entity bean’s local interface:</p>
</div>
<div class="paragraph">
<p>The interface must extend the
javax.ejb.EJBLocalObject interface.</p>
</div>
<div class="paragraph">
<p>The <em>throws</em> clause of a method defined on
the local interface must not include the java.rmi.RemoteException.</p>
</div>
<div class="paragraph">
<p>The local interface is allowed to have
superinterfaces.</p>
</div>
<div class="paragraph">
<p>For each method defined in the local
interface, there must be a matching method in the entity bean’s class.
The matching method must have:</p>
</div>
<div class="paragraph">
<p>The same name.</p>
</div>
<div class="paragraph">
<p>The same number and types of its arguments,
and the same return type.</p>
</div>
<div class="paragraph">
<p>All the exceptions defined in the <em>throws</em>
clause of the matching method of the enterprise Bean class must be
defined in the <em>throws</em> clause of the method of the local interface.</p>
</div>
</div>
<div class="sect2">
<h3 id="_entity_beans_local_home_interface_3"><a class="anchor" href="#_entity_beans_local_home_interface_3"></a>6.37. Entity Bean’s Local Home Interface</h3>
<div class="paragraph">
<p>The following are
the requirements for the entity bean’s local home interface:</p>
</div>
<div class="paragraph">
<p>The interface must extend the
javax.ejb.EJBLocalHome interface.</p>
</div>
<div class="paragraph">
<p>The <em>throws</em> clause of a method on the local
home interface must not include the java.rmi.RemoteException.</p>
</div>
<div class="paragraph">
<p>The local home interface is allowed to have
superinterfaces.</p>
</div>
<div class="paragraph">
<p>Each method defined in the local home
interface must be one of the following:</p>
</div>
<div class="paragraph">
<p>A create method.</p>
</div>
<div class="paragraph">
<p>A finder method.</p>
</div>
<div class="paragraph">
<p>A home method.</p>
</div>
<div class="paragraph">
<p>Each create method must be the named “
<em>create&lt;METHOD&gt;</em> ”, and it must match one of the ejbCreate <em>&lt;METHOD&gt;</em>
methods defined in the enterprise bean class. The matching ejbCreate
<em>&lt;METHOD&gt;</em> method must have the same number and types of its arguments.
(Note that the return type is different.)</p>
</div>
<div class="paragraph">
<p>The return type for a create&lt;METHOD&gt; method
must be the entity bean’s local interface type.</p>
</div>
<div class="paragraph">
<p>All the exceptions defined in the <em>throws</em>
clause of the matching ejbCreate <em>&lt;METHOD&gt;</em> and ejbPostCreate <em>&lt;METHOD&gt;</em>
methods of the enterprise bean class must be included in the <em>throws</em>
clause of the matching create&lt;METHOD&gt; method of the local home interface
(i.e., the set of exceptions defined for the create&lt;METHOD&gt; method must
be a superset of the union of exceptions defined for the
ejbCreate&lt;METHOD&gt; and ejbPostCreate&lt;METHOD&gt; methods).</p>
</div>
<div class="paragraph">
<p>The <em>throws</em> clause of a create <em>&lt;METHOD&gt;</em>
method must include the javax.ejb.CreateException.</p>
</div>
<div class="paragraph">
<p>Each finder method must be named “
<em>find&lt;METHOD&gt;</em> ” (e.g. findLargeAccounts), and it must match one of the
ejbFind&lt;METHOD&gt; methods defined in the entity bean class (e.g.
ejbFindLargeAccounts). The matching ejbFind&lt;METHOD&gt; method must have the
same number and types of arguments. (Note that the return type may be
different.)</p>
</div>
<div class="paragraph">
<p>The return type for a find&lt;METHOD&gt; method
must be the entity bean’s local interface type (for a single-object
finder), or a collection thereof (for a multi-object finder).</p>
</div>
<div class="paragraph">
<p>The local home interface must always include
the findByPrimaryKey method, which is always a single-object finder. The
method must declare the primary key class as the method argument.</p>
</div>
<div class="paragraph">
<p>All the exceptions defined in the <em>throws</em>
clause of an ejbFind method of the entity bean class must be included in
the <em>throws</em> clause of the matching find method of the local home
interface.</p>
</div>
<div class="paragraph">
<p>The <em>throws</em> clause of a finder method must
include the javax.ejb.FinderException.</p>
</div>
<div class="paragraph">
<p>Home methods can have arbitrary names,
provided that they do not clash with create, find, and remove method
names. The matching ejbHome method specified in the entity bean class
must have the same number and types of arguments and must return the
same type as the home method as specified in the local home interface of
the bean.</p>
</div>
<div class="paragraph">
<p>The <em>throws</em> clause of any method on the
entity bean’s local home interface must not include the
<em>java.rmi.RemoteException</em> .</p>
</div>
</div>
<div class="sect2">
<h3 id="_entity_beans_primary_key_class_2"><a class="anchor" href="#_entity_beans_primary_key_class_2"></a>6.38. <a id="a3011"></a>Entity Bean’s Primary Key Class</h3>
<div class="paragraph">
<p>The Bean Provider
must specify a primary key class in the deployment descriptor.</p>
</div>
<div class="paragraph">
<p>The primary key type must be a legal Value
Type in RMI-IIOP.</p>
</div>
<div class="paragraph">
<p>The class must provide suitable
implementation of the hashCode() and equals(Object other) methods to
simplify the management of the primary keys by client code.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_responsibilities_of_the_container_provider_2"><a class="anchor" href="#_the_responsibilities_of_the_container_provider_2"></a>6.39. The Responsibilities of the Container Provider</h3>
<div class="paragraph">
<p>This section describes the responsibilities
of the Container Provider to support bean-managed persistence entity
beans. The Container Provider is responsible for providing the
deployment tools, and for managing entity bean instances at runtime.</p>
</div>
<div class="paragraph">
<p>Because the EJB specification does not define
the API between deployment tools and the container, we assume that the
deployment tools are provided by the Container Provider. Alternatively,
the deployment tools may be provided by a different vendor who uses the
container vendor’s specific API.</p>
</div>
</div>
<div class="sect2">
<h3 id="_generation_of_implementation_classes_2"><a class="anchor" href="#_generation_of_implementation_classes_2"></a>6.40. Generation of Implementation Classes</h3>
<div class="paragraph">
<p>The deployment
tools provided by the Container Provider are responsible for the
generation of additional classes when the entity bean is deployed. The
tools obtain the information that they need for generation of the
additional classes by introspecting the classes and interfaces provided
by the entity Bean Provider and by examining the entity bean’s
deployment descriptor.</p>
</div>
<div class="paragraph">
<p>The deployment tools must generate the
following classes:</p>
</div>
<div class="paragraph">
<p>A class that implements the entity bean’s
remote home interface (i.e., the entity EJBHome class).</p>
</div>
<div class="paragraph">
<p>A class that implements the entity bean’s
remote interface (i.e., the entity EJBObject class).</p>
</div>
<div class="paragraph">
<p>A class that implements the entity bean’s
local home interface (i.e., the entity EJBLocalHome class).</p>
</div>
<div class="paragraph">
<p>A class that implements the entity bean’s
local interface (i.e., the entity EJBLocalObject class).</p>
</div>
<div class="paragraph">
<p>The deployment tools may also generate a
class that mixes some container-specific code with the entity bean
class. The code may, for example, help the container to manage the
entity bean instances at runtime. Tools can use subclassing, delegation,
and code generation.</p>
</div>
<div class="paragraph">
<p>The deployment tools may also allow
generation of additional code that wraps the business methods and that
is used to customize the business logic for an existing operational
environment. For example, a wrapper for a debit function on the Account
bean may check that the debited amount does not exceed a certain limit,
or perform security checking that is specific to the operational
environment.</p>
</div>
</div>
<div class="sect2">
<h3 id="_entity_ejbhome_class_2"><a class="anchor" href="#_entity_ejbhome_class_2"></a>6.41. Entity EJBHome Class</h3>
<div class="paragraph">
<p>The entity
EJBHome class, which is generated by deployment tools, implements the
entity bean’s remote home interface. This class implements the methods
of the javax.ejb.EJBHome interface, and the type-specific create,
finder, and home methods specific to the entity bean.</p>
</div>
<div class="paragraph">
<p>The implementation of each create&lt;METHOD&gt;
method invokes a matching ejbCreate&lt;METHOD&gt; method, followed by the
matching ejbPostCreate&lt;METHOD&gt; method, passing the create&lt;METHOD&gt;
parameters to these matching methods.</p>
</div>
<div class="paragraph">
<p>The implementation of the remove methods
defined in the javax.ejb.EJBHome interface must activate an instance (if
an instance is not already in the ready state) and invoke the ejbRemove
method on the instance.</p>
</div>
<div class="paragraph">
<p>The implementation of each find&lt;METHOD&gt;
method invokes a matching ejbFind&lt;METHOD&gt; method. The implementation of
the find&lt;METHOD&gt; method must create an entity object reference for the
primary key returned from the ejbFind&lt;METHOD&gt; and return the entity
object reference (i.e., EJBObject) to the client. If the ejbFind&lt;METHOD&gt;
method returns a collection of primary keys, the implementation of the
find&lt;METHOD&gt; method must create a collection of entity object references
for the primary keys and return the collection to the client.</p>
</div>
<div class="paragraph">
<p>The implementation of each &lt;METHOD&gt; home
method invokes a matching ejbHome&lt;METHOD&gt; method (in which the first
character of <em>&lt;METHOD&gt;</em> is uppercased in the name of the ejbHome&lt;METHOD&gt;
method), passing the &lt;METHOD&gt; parameters to the matching method.</p>
</div>
</div>
<div class="sect2">
<h3 id="_entity_ejbobject_class_2"><a class="anchor" href="#_entity_ejbobject_class_2"></a>6.42. Entity EJBObject Class</h3>
<div class="paragraph">
<p>The entity
EJBObject class, which is generated by deployment tools, implements the
entity bean’s remote interface. It implements the methods of the
javax.ejb.EJBObject interface and the business methods specific to the
entity bean.</p>
</div>
<div class="paragraph">
<p>The implementation of the remove method
(defined in the javax.ejb.EJBObject interface) must activate an instance
(if an instance is not already in the ready state) and invoke the
ejbRemove method on the instance.</p>
</div>
<div class="paragraph">
<p>The implementation of each business method
must activate an instance (if an instance is not already in the ready
state) and invoke the matching business method on the instance.</p>
</div>
</div>
<div class="sect2">
<h3 id="_entity_ejblocalhome_class_2"><a class="anchor" href="#_entity_ejblocalhome_class_2"></a>6.43. Entity EJBLocalHome Class</h3>
<div class="paragraph">
<p>The entity
EJBLocalHome class, which is generated by deployment tools, implements
the entity bean’s local home interface. This class implements the
methods of the javax.ejb.EJBLocalHome interface, and the type-specific
create, finder, and home methods specific to the entity bean.</p>
</div>
<div class="paragraph">
<p>The implementation of each create&lt;METHOD&gt;
method invokes a matching ejbCreate&lt;METHOD&gt; method, followed by the
matching ejbPostCreate&lt;METHOD&gt; method, passing the create&lt;METHOD&gt;
parameters to these matching methods.</p>
</div>
<div class="paragraph">
<p>The implementation of the remove method
defined in the javax.ejb.EJBLocalHome interface must activate an
instance (if an instance is not already in the ready state) and invoke
the ejbRemove method on the instance.</p>
</div>
<div class="paragraph">
<p>The implementation of each find&lt;METHOD&gt;
method invokes a matching ejbFind&lt;METHOD&gt; method. The implementation of
the find&lt;METHOD&gt; method must create an entity object reference for the
primary key returned from the ejbFind&lt;METHOD&gt; and return the entity
object reference (i.e., EJBLocalObject) to the client. If the
ejbFind&lt;METHOD&gt; method returns a collection of primary keys, the
implementation of the find&lt;METHOD&gt; method must create a collection of
entity object references for the primary keys and return the collection
to the client.</p>
</div>
<div class="paragraph">
<p>The implementation of each &lt;METHOD&gt; home
method invokes a matching ejbHome&lt;METHOD&gt; method (in which the first
character of <em>&lt;METHOD&gt;</em> is uppercased in the name of the ejbHome&lt;METHOD&gt;
method), passing the &lt;METHOD&gt; parameters to the matching method.</p>
</div>
</div>
<div class="sect2">
<h3 id="_entity_ejblocalobject_class_2"><a class="anchor" href="#_entity_ejblocalobject_class_2"></a>6.44. Entity EJBLocalObject Class</h3>
<div class="paragraph">
<p>The entity
EJBLocalObject class, which is generated by deployment tools, implements
the entity bean’s local interface. It implements the methods of the
javax.ejb.EJBLocalObject interface and the business methods specific to
the entity bean.</p>
</div>
<div class="paragraph">
<p>The implementation of the remove method
(defined in the javax.ejb.EJBLocalObject interface) must activate an
instance (if an instance is not already in the ready state) and invoke
the ejbRemove method on the instance.</p>
</div>
<div class="paragraph">
<p>The implementation of each business method
must activate an instance (if an instance is not already in the ready
state) and invoke the matching business method on the instance.</p>
</div>
</div>
<div class="sect2">
<h3 id="_handle_class_2"><a class="anchor" href="#_handle_class_2"></a>6.45. Handle Class</h3>
<div class="paragraph">
<p>The deployment
tools are responsible for implementing the handle class for the entity
bean. The handle class must be serializable by the Java Serialization
protocol.</p>
</div>
<div class="paragraph">
<p>As the handle class is not entity-bean
specific, the container may, but is not required to, use a single class
for all deployed entity beans.</p>
</div>
</div>
<div class="sect2">
<h3 id="_home_handle_class_2"><a class="anchor" href="#_home_handle_class_2"></a>6.46. Home Handle Class</h3>
<div class="paragraph">
<p>The deployment
tools responsible for implementing the home
handle class for the entity bean. The handle class must be serializable
by the Java Serialization protocol.</p>
</div>
<div class="paragraph">
<p>Because the home handle class is not
entity-bean specific, the container may, but is not required to, use a
single class for the home handles of all deployed entity beans.</p>
</div>
</div>
<div class="sect2">
<h3 id="_metadata_class_2"><a class="anchor" href="#_metadata_class_2"></a>6.47. Metadata Class</h3>
<div class="paragraph">
<p>The deployment
tools are responsible for implementing the class that provides metadata
information to the remote client view contract. The class must be a
valid RMI-IIOP Value Type, and must implement the javax.ejb.EJBMetaData
interface.</p>
</div>
<div class="paragraph">
<p>Because the metadata class is not entity-bean
specific, the container may, but is not required to, use a single class
for all deployed enterprise beans.</p>
</div>
</div>
<div class="sect2">
<h3 id="_instances_re_entrance_2"><a class="anchor" href="#_instances_re_entrance_2"></a>6.48. Instance’s Re-entrance</h3>
<div class="paragraph">
<p>The container runtime must enforce the rules
defined in Section <a href="Ejb.html#a2872">See Non-reentrant and
Re-entrant Instances</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_transaction_scoping_security_exceptions_2"><a class="anchor" href="#_transaction_scoping_security_exceptions_2"></a>6.49. Transaction Scoping, Security, Exceptions</h3>
<div class="paragraph">
<p>The container runtime must follow the rules
on transaction scoping and
exception handling described in Chapters 9
and <a href="Ejb.html#a3210">See Exception Handling</a>. The container
runtime must follow the rules on security
checking described in the EJB Core Contracts and Requirements document
<a href="Ejb.html#a3339">See EJB 3.2 Core Contracts and Requirements.</a> Chapter “Security Management”.</p>
</div>
</div>
<div class="sect2">
<h3 id="_implementation_of_object_references_2"><a class="anchor" href="#_implementation_of_object_references_2"></a>6.50. Implementation of Object References</h3>
<div class="paragraph">
<p>The container should implement
the distribution protocol between the client
and the container such that the object references of the remote home and
remote interfaces used by entity bean clients are usable for a long
period of time. Ideally, a client should be able to use an object
reference across a server crash and restart. An
object reference should become invalid only
when the entity object has been removed, or after a reconfiguration of
the server environment (for example, when the entity bean is moved to a
different EJB server or container).</p>
</div>
<div class="paragraph">
<p>The motivation for this is to simplify the
programming model for the entity bean client. While the client code
needs to have a recovery handler for the system exceptions thrown from
the individual method invocations on the home and remote interface, the
client should not be forced to re-obtain the object references.</p>
</div>
</div>
<div class="sect2">
<h3 id="_entitycontext_2"><a class="anchor" href="#_entitycontext_2"></a>6.51. EntityContext</h3>
<div class="paragraph">
<p>The container must implement the
EntityContext.getEJBObject method such that
the bean instance can use the Java language cast to convert the returned
value to the entity bean’s remote interface type. Specifically, the bean
instance does not have to use the PortableRemoteObject.narrow method for
the type conversion.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ejb_1_1_entity_bean_component_contract_for_container_managed_persistence"><a class="anchor" href="#_ejb_1_1_entity_bean_component_contract_for_container_managed_persistence"></a>7. EJB 1.1 Entity Bean Component Contract for Container-Managed Persistence</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter specifies the EJB 1.1 entity
bean component contract for container-managed persistence.</p>
</div>
<div class="sect2">
<h3 id="_ejb_1_1_entity_beans_with_container_managed_persistence"><a class="anchor" href="#_ejb_1_1_entity_beans_with_container_managed_persistence"></a>7.1. EJB 1.1 Entity Beans with Container-Managed Persistence</h3>
<div class="paragraph">
<p><a href="Ejb.html#a2456">See EJB 2.1
Entity Bean Component Contract for Bean-Managed Persistence</a> describes
the component contract for entity beans with bean-managed persistence.
The contract for an EJB 1.1 entity bean with container-managed
persistence is the same as the contract for an entity bean with
bean-managed persistence as described in <a href="Ejb.html#a2456">See
EJB 2.1 Entity Bean Component Contract for Bean-Managed Persistence</a>,
except for the differences described in this chapter.</p>
</div>
<div class="literalblock">
<div class="content">
<pre> _An EJB 1.1 entity bean with
container-managed persistence cannot have a local interface or local
home interface. Use of the local interfaces of other enterprise beans is
not supported for an EJB 1.1 entity bean with container-managed
persistence._</pre>
</div>
</div>
<div class="paragraph">
<p>Use of the EJB Timer Service is not supported
for an EJB 1.1 entity bean with container-managed persistence. An EJB
1.1 entity bean with container-managed persistence should not implement
the <em>javax.ejb.TimedObject</em> interface. Use of dependency injection,
interceptors, and any Java language metadata annotations is not
supported for EJB 1.1 entity beans.</p>
</div>
</div>
<div class="sect2">
<h3 id="_container_managed_fields_2"><a class="anchor" href="#_container_managed_fields_2"></a>7.2. Container-Managed Fields</h3>
<div class="paragraph">
<p>An EJB 1.1 entity bean with container-managed
persistence relies on the Container Provider’s tools to generate methods
that perform data access on behalf of the entity bean instances. The
generated methods transfer data between the entity bean instance’s
variables and the underlying resource manager at the times defined by
the EJB specification. The generated methods also implement the
creation, removal, and lookup of the entity object in the underlying
database.</p>
</div>
<div class="paragraph">
<p>An entity bean with container-manager
persistence must not code explicit data access—all data access must be
deferred to the container.</p>
</div>
<div class="paragraph">
<p>The EJB 1.1 entity Bean Provider is
responsible for using the cmp-field elements of the deployment
descriptor to declare the instance’s fields that the container must load
and store at the defined times. The fields must be defined in the entity
bean class as <em>public</em> , and must not be defined as transient.</p>
</div>
<div class="paragraph">
<p>The container is responsible for transferring
data between the entity bean’s instance variables and the underlying
data source before or after the execution of the ejbCreate, ejbRemove,
ejbLoad, and ejbStore methods, as described in the following
subsections. The container is also responsible for the implementation of
the finder methods.</p>
</div>
<div class="paragraph">
<p>The EJB 2.0 or
later deployment descriptor for an EJB 1.1 entity bean with
container-managed persistence indicates that the entity bean uses
container-managed persistence and that the value of its <em>cmp-version</em>
element is <em>1.x</em> .</p>
</div>
<div class="paragraph">
<p>The EJB 1.1 component contract does not
architect support for relationships for entity beans with
container-managed persistence. The EJB 2.0 and later specifications do
not support the use of the <em>cmr-field</em> , <em>ejb-relation</em> , or <em>query</em>
deployment descriptor elements or their subelements for EJB 1.1 entity
beans.</p>
</div>
<div class="paragraph">
<p>The following requirements ensure that an EJB
1.1 entity bean with container-managed persistence can be deployed in
any compliant container.</p>
</div>
<div class="paragraph">
<p>The Bean Provider must ensure that the Java
types assigned to the container-managed fields are restricted to the
following: Java primitive types, Java serializable types, and references
of enterprise beans’ remote or remote home interfaces.</p>
</div>
<div class="paragraph">
<p>The Container Provider may, but is not
required to, use Java Serialization to store the container-managed
fields in the database. If the container chooses a different approach,
the effect should be equivalent to that of Java Serialization. The
container must also be capable of persisting references to enterprise
beans’ remote and remote home interfaces (for example, by storing their
handle or primary key).</p>
</div>
<div class="paragraph">
<p>Although the above requirements allow the
Bean Provider to specify almost any arbitrary type for the
container-managed fields, we expect that in practice the Bean Provider
of EJB 1.1 entity beans with container-managed persistence will use
relatively simple Java types, and that most containers will be able to
map these simple Java types to columns in a database schema to
externalize the entity state in the database, rather than use Java
serialization.</p>
</div>
<div class="paragraph">
<p>If the Bean Provider expects that the
container-managed fields will be mapped to database fields, he or she
should provide mapping instructions to the Deployer. The mapping between
the instance’s container-managed fields and the schema of the underlying
database manager will be then realized by the data access classes
generated by the Container Provider’s tools. Because entity beans are
typically coarse-grained objects, the content of the container-managed
fields may be stored in multiple rows, possibly spread across multiple
database tables. These mapping techniques are beyond the scope of the
EJB specification, and do not have to be supported by an EJB compliant
container. (The container may simply use the Java serialization protocol
in all cases).</p>
</div>
</div>
<div class="sect2">
<h3 id="_ejbcreate_ejbpostcreate"><a class="anchor" href="#_ejbcreate_ejbpostcreate"></a>7.3. ejbCreate, ejbPostCreate</h3>
<div class="paragraph">
<p>With bean-managed persistence, the entity
Bean Provider is responsible for writing the code that inserts a record
into the database in the ejbCreate methods. However, with
container-managed persistence, the container performs the database
insert after the ejbCreate method completes.</p>
</div>
<div class="paragraph">
<p>The container must ensure that the values of
the container-managed fields are set to the Java language defaults (e.g.
0 for integer, null for pointers) prior to invoking an ejbCreate method
on an instance.</p>
</div>
<div class="paragraph">
<p>The EJB 1.1 entity Bean Provider’s
responsibility is to initialize the container-managed fields in the
ejbCreate methods from the input arguments such that when an ejbCreate
method returns, the container can extract the container-managed fields
from the instance and insert them into the database.</p>
</div>
<div class="paragraph">
<p>The ejbCreate methods must be defined to
return the primary key class type. The implementation of the ejbCreate
methods should be coded to return a null. The returned value is ignored
by the container.</p>
</div>
<div class="paragraph">
<p>Note: The above requirement is to allow the
creation of an entity bean with bean-managed persistence by subclassing
an EJB 1.1 entity bean with container-managed persistence. The Java
language rules for overriding methods in subclasses requires the
signatures of the <em>ejbCreate</em> methods in the subclass and the superclass
be the same.</p>
</div>
<div class="paragraph">
<p>The container is responsible for creating the
entity object’s representation in the underlying database, extracting
the primary key fields of the newly created entity object representation
in the database, and for creating an entity EJBObject reference for the
newly created entity object. The container must establish the primary
key before it invokes the ejbPostCreate method. The container may create
the representation of the entity in the database immediately after
ejbCreate returns, or it can defer it to a later time (for example to
the time after the matching ejbPostCreate has been called, or to the end
of the transaction).</p>
</div>
<div class="paragraph">
<p>The container then invokes the matching
ejbPostCreate method on the instance. The instance can discover the
primary key by calling the getPrimaryKey method on its entity context
object.</p>
</div>
<div class="paragraph">
<p>The container must invoke ejbCreate, perform
the database insert operation, and invoke ejbPostCreate in the
transaction context determined by the transaction attribute of the
matching create method, as described in EJB Core Contracts and
Requirements document <a href="Ejb.html#a3339">See EJB 3.2 Core</a>
Subsection “Container-Managed Transaction Demarcation for Business
Methods”.</p>
</div>
<div class="paragraph">
<p>The container throws the
DuplicateKeyException if the newly created entity object would have the
same primary key as one of the existing entity objects within the same
home.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ejbremove"><a class="anchor" href="#_ejbremove"></a>7.4. ejbRemove</h3>
<div class="paragraph">
<p>The container invokes the ejbRemove method on
an entity bean instance with container-managed persistence in response
to a client-invoked remove operation on the entity bean’s remote home or
remote interface.</p>
</div>
<div class="paragraph">
<p>The entity Bean Provider can use the
ejbRemove method to implement any actions that must be done before the
entity object’s representation is removed from the database.</p>
</div>
<div class="paragraph">
<p>The container synchronizes the instance’s
state before it invokes the ejbRemove method. This means that the state
of the instance variables at the beginning of the ejbRemove method is
the same as it would be at the beginning of a business method.</p>
</div>
<div class="paragraph">
<p>After ejbRemove returns, the container
removes the entity object’s representation from the database.</p>
</div>
<div class="paragraph">
<p>The container must perform ejbRemove and the
database delete operation in the transaction context determined by the
transaction attribute of the invoked remove method, as described in EJB
Core Contracts and Requirements document <a href="Ejb.html#a3339">See
EJB 3.2 Core Contracts and Requirements.</a> Subsection “Container-Managed
Transaction Demarcation for Business Methods”.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ejbload"><a class="anchor" href="#_ejbload"></a>7.5. ejbLoad</h3>
<div class="paragraph">
<p>When the container needs to synchronize the
state of an enterprise bean instance with the entity object’s state in
the database, the container reads the entity object’s state from the
database into the container-managed fields and then it invokes the
ejbLoad method on the instance.</p>
</div>
<div class="paragraph">
<p>The entity Bean Provider can rely on the
container’s having loaded the container-managed fields from the database
just before the container invokes the ejbLoad method. The entity bean
can use the ejbLoad method, for instance, to perform some computation on
the values of the fields that were read by the container (for example,
uncompressing text fields).</p>
</div>
</div>
<div class="sect2">
<h3 id="_ejbstore"><a class="anchor" href="#_ejbstore"></a>7.6. ejbStore</h3>
<div class="paragraph">
<p>When the container needs to synchronize the
state of the entity object in the database with the state of the
enterprise bean instance, the container first calls the ejbStore method
on the instance, and then it extracts the container-managed fields and
writes them to the database.</p>
</div>
<div class="paragraph">
<p>The entity Bean Provider should use the
ejbStore method to set up the values of the container-managed fields
just before the container writes them to the database. For example, the
ejbStore method may perform compression of text before the text is
stored in the database.</p>
</div>
</div>
<div class="sect2">
<h3 id="_finder_hethods"><a class="anchor" href="#_finder_hethods"></a>7.7. Finder Hethods</h3>
<div class="paragraph">
<p>The entity Bean Provider does not write the
finder (ejbFind&lt;METHOD&gt;) methods.</p>
</div>
<div class="paragraph">
<p>The finder methods are generated at the
entity bean deployment time using the Container Provider’s tools. The
tools can, for example, create a subclass of the entity bean class that
implements the ejbFind&lt;METHOD&gt; methods, or the tools can generate the
implementation of the finder methods directly in the class that
implements the entity bean’s remote home interface.</p>
</div>
<div class="paragraph">
<p>Note that the ejbFind&lt;METHOD&gt; names and
parameter signatures of EJB 1.1 entity beans do not provide the
container tools with sufficient information for automatically generating
the implementation of the finder methods for methods other than
ejbFindByPrimaryKey. Therefore, the Bean Provider is responsible for
providing a description of each finder method. The entity bean Deployer
uses container tools to generate the implementation of the finder
methods based in the description supplied by the Bean Provider. The
EJB1.1 component contract for container-managed persistence does not
specify the format of the finder method description.</p>
</div>
</div>
<div class="sect2">
<h3 id="_home_methods_3"><a class="anchor" href="#_home_methods_3"></a>7.8. Home Methods</h3>
<div class="paragraph">
<p>The EJB1.1 entity bean contract does not
support <em>ejbHome</em> methods.</p>
</div>
</div>
<div class="sect2">
<h3 id="_create_methods_3"><a class="anchor" href="#_create_methods_3"></a>7.9. Create Methods</h3>
<div class="paragraph">
<p>The EJB1.1 entity bean contract does not
support <em>create&lt;METHOD&gt;</em> methods.</p>
</div>
</div>
<div class="sect2">
<h3 id="_primary_key_type"><a class="anchor" href="#_primary_key_type"></a>7.10. Primary Key Type</h3>
<div class="paragraph">
<p>The container must be able to manipulate the
primary key type. Therefore, the primary key type for an entity bean
with container-managed persistence must follow the rules in this
subsection, in addition to those specified in Subsection
<a href="Ejb.html#a3011">See Entity Bean’s Primary Key Class</a>.</p>
</div>
<div class="paragraph">
<p>There are two ways to specify a primary key
class for an entity bean with container-managed persistence:</p>
</div>
<div class="paragraph">
<p>Primary key that maps to a single field in
the entity bean class.</p>
</div>
<div class="paragraph">
<p>Primary key that maps to multiple fields in
the entity bean class.</p>
</div>
<div class="paragraph">
<p>The second method is necessary for
implementing compound keys, and the first method is convenient for
single-field keys. Without the first method, simple types such as
<em>String</em> would have to be wrapped in a user-defined class.</p>
</div>
</div>
<div class="sect2">
<h3 id="_primary_key_that_maps_to_a_single_field_in_the_entity_bean_class_2"><a class="anchor" href="#_primary_key_that_maps_to_a_single_field_in_the_entity_bean_class_2"></a>7.11. Primary Key that Maps to a Single Field in the Entity Bean Class</h3>
<div class="paragraph">
<p>The Bean Provider uses the primkey-field
element of the deployment descriptor to specify the container-managed
field of the entity bean class that contains the primary key. The
field’s type must be the primary key type.</p>
</div>
</div>
<div class="sect2">
<h3 id="_primary_key_that_maps_to_multiple_fields_in_the_entity_bean_class_2"><a class="anchor" href="#_primary_key_that_maps_to_multiple_fields_in_the_entity_bean_class_2"></a>7.12. Primary Key that Maps to Multiple Fields in the Entity Bean Class</h3>
<div class="paragraph">
<p>The primary key class must be public, and
must have a public constructor with no parameters.</p>
</div>
<div class="paragraph">
<p>All fields in the primary key class must be
declared as public.</p>
</div>
<div class="paragraph">
<p>The names of the fields in the primary key
class must be a subset of the names of the container-managed fields.
(This allows the container to extract the primary key fields from an
instance’s container-managed fields, and vice versa.)</p>
</div>
</div>
<div class="sect2">
<h3 id="_special_case_unknown_primary_key_class_2"><a class="anchor" href="#_special_case_unknown_primary_key_class_2"></a>7.13. Special Case: Unknown Primary Key Class</h3>
<div class="paragraph">
<p>In special situations, the entity Bean
Provider may choose not to specify the primary key class for an entity
bean with container-managed persistence. This case usually happens when
the entity bean does not have a natural primary key, and the Bean
Provider wants to allow the Deployer to select the primary key fields at
deployment time. The entity bean’s primary key type will usually be
derived from the primary key type used by the underlying database system
that stores the entity objects. The primary key used by the database
system may not be known to the Bean Provider.</p>
</div>
<div class="paragraph">
<p>When defining the primary key for the
enterprise bean, the Deployer may sometimes need to subclass the entity
bean class to add additional container-managed fields (this typically
happens for entity beans that do not have a natural primary key, and the
primary keys are system-generated by the underlying database system that
stores the entity objects).</p>
</div>
<div class="paragraph">
<p>In this special
case, the type of the argument of the findByPrimaryKey method must be
declared as java.lang.Object, and the return value of ejbCreate must be
declared as java.lang.Object. The Bean Provider must specify the primary
key class in the deployment descriptor as of the type java.lang.Object.</p>
</div>
<div class="paragraph">
<p>The primary key class is specified at
deployment time in the situations when the Bean Provider develops an
entity bean that is intended to be used with multiple back-ends that
provide persistence, and when these multiple back-ends require different
primary key structures.</p>
</div>
<div class="paragraph">
<p>Use of entity beans with a deferred primary
key type specification limits the client application programming model,
because the clients written prior to deployment of the entity bean may
not use, in general, the methods that rely on the knowledge of the
primary key type.</p>
</div>
<div class="paragraph">
<p>The implementation of the enterprise bean
class methods must be done carefully. For example, the methods should
not depend on the type of the object returned from
<em>EntityContext.getPrimaryKey</em> , because the return type is determined by
the Deployer after the EJB class has been written.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a3139"><a class="anchor" href="#a3139"></a>8. Support for JAX-RPC Web Service Endpoints</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A stateless session bean may implement a
JAX-RPC web service endpoint. JAX-RPC web service endpoints are accessed
by Java clients through the JAX-RPC client APIs, which utilize an
XML-based protocol (SOAP 1.2 <a href="Ejb.html#a3338">See W3C: SOAP</a>) over an HTTP transport.</p>
</div>
<div class="paragraph">
<p>A JAX-RPC web service client makes use of the
enterprise bean’s JAX-RPC web service client view corresponding to the
web service endpoint interface, as described by a WSDL document.</p>
</div>
<div class="paragraph">
<p>This chapter defines requirements for
stateless sessions beans and EJB containers that support JAX-RPC web
service endpoints. See EJB Core Contracts and Requirements document
<a href="Ejb.html#a3339">See EJB 3.2 Core Contracts and Requirements.</a> for additional requirements that
apply to stateless session beans.</p>
</div>
<div class="sect2">
<h3 id="_jax_rpc_web_service_client_view"><a class="anchor" href="#_jax_rpc_web_service_client_view"></a>8.1. JAX-RPC Web Service Client View</h3>
<div class="paragraph">
<p>The JAX-RPC web service client obtains a
reference to the service object that implements the
<em>javax.xml.rpc.Service</em> interface through dependency injection or using
JNDI. The service interface can be a generic <em>javax.xml.rpc.Service</em>
interface or a generated service interface which extends the
<em>javax.xml.rpc.Service</em> interface. The service interface is then used to
obtain a stub or proxy that implements the session bean’s web service
endpoint interface. The mechanisms and APIs for client web service
access is described in the JAX-RPC specification
<a href="Ejb.html#a3332">See Java API for XML-based RPC (JAX-RPC)</a>.</p>
</div>
<div class="paragraph">
<p>The following example illustrates how a Java
EE client looks up a web service in JNDI using a logical name called a
service reference (specified using the <em>service-ref</em> element), obtains a
stub instance for a web service endpoint, and invokes a method on that
endpoint.</p>
</div>
<div class="paragraph">
<p>Context ctx = new InitialContext();</p>
</div>
<div class="paragraph">
<p>com.example.StockQuoteService sqs =
(com.example.StockQuoteService)</p>
</div>
<div class="paragraph">
<p>ctx.lookup("java:comp/env/service/StockQuoteService");</p>
</div>
<div class="paragraph">
<p>com.example.StockQuoteProvider sqp =</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sqs.getStockQuoteProviderPort();</pre>
</div>
</div>
<div class="paragraph">
<p>float quotePrice =
sqp.getLastTradePrice("ACME");</p>
</div>
<div class="paragraph">
<p>&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>The use of service references and the
<em>service-ref</em> deployment descriptor element are described in further
detail in <a href="Ejb.html#a3337">See Web Services for Java EE</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_responsibilities_of_the_bean_provider"><a class="anchor" href="#_the_responsibilities_of_the_bean_provider"></a>8.2. The Responsibilities of the Bean Provider</h3>
<div class="paragraph">
<p>This section describes the responsibilities
of the session Bean Provider to support JAX-RPC web service endpoints.
These requirements are in addition to those specified in the EJB Core
Contracts and Requirements document <a href="Ejb.html#a3339">See EJB</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_session_beans_jax_rpc_service_endpoint_interface"><a class="anchor" href="#_session_beans_jax_rpc_service_endpoint_interface"></a>8.3. Session Bean’s JAX-RPC Service Endpoint Interface</h3>
<div class="paragraph">
<p>The following are
the requirements for stateless session beans with JAX-RPC web service
endpoint interfaces.</p>
</div>
<div class="paragraph">
<p>The interface must follow the rules for
JAX-RPC service endpoint interfaces <a href="Ejb.html#a3332">See Java</a>.</p>
</div>
<div class="paragraph">
<p>The interface must extend the
<em>java.rmi.Remote</em> interface.</p>
</div>
<div class="paragraph">
<p>The methods defined in the interface must
follow the rules for JAX-RPC service endpoint interfaces. This means
that their argument and return values must be of valid types for
JAX-RPC, and their <em>throws</em> clauses must include the
java.rmi.RemoteException. The <em>throws</em> clause may additionally include
application exceptions.</p>
</div>
<div class="literalblock">
<div class="content">
<pre> _Note that JAX-RPC Holder classes may be
used as method parameters. The JAX-RPC specification requires support
for Holder classes as part of the standard Java mapping of WSDL
operations in order to handle out and inout parameters. Holder classes
implement the javax.xml.rpc.holders.Holder interface. See the JAX-RPC
specification link:Ejb.html#a3332[See Java API for XML-based RPC
(JAX-RPC) 2.0. http://jcp.org/en/jsr/detail?id=101.] for further
details._</pre>
</div>
</div>
<div class="paragraph">
<p>For each method defined in the web service
endpoint interface, there must be a matching method in the session
bean’s class. The matching method must have:</p>
</div>
<div class="paragraph">
<p>The same name.</p>
</div>
<div class="paragraph">
<p>The same number and types of arguments, and
the same return type.</p>
</div>
<div class="paragraph">
<p>All the exceptions defined in the <em>throws</em>
clause of the matching method of the session bean class must be defined
in the <em>throws</em> clause of the method of the web service endpoint
interface.</p>
</div>
<div class="paragraph">
<p>The web service endpoint interface must not
include an EJBObject or EJBLocalObject as either a parameter or return
type. An array or JAX-RPC value type must not include an EJBObject or
EJBLocalObject as a contained element. The web service endpoint
interface methods must not expose business interface types, local or
remote component interface types, local or remote home interface types,
timers or timer handles, or the managed collection classes that are used
for entity beans with container-managed persistence as arguments or
results or as fields of value types.</p>
</div>
<div class="paragraph">
<p>JAX-RPC serialization rules apply for any
value types that are used by the web service endpoint interface. If it
is important that Java serialization semantics apply, the Bean Provider
should use the restricted set of JAX-RPC value types for which the
semantics of Java serialization apply under JAX-RPC serialization. See
the JAX-RPC specification <a href="Ejb.html#a3332">See Java API for</a> for
details.</p>
</div>
<div class="paragraph">
<p>The web service endpoint interface must not
include constant (as <em>public final static</em> ) declarations.</p>
</div>
<div class="paragraph">
<p>The Bean Provider must designate the web
service endpoint interface in the deployment descriptor by means of the
<em>service-endpoint</em> element. The service endpoint itself is only exposed
within a web service if it is referenced by a web service deployment
descriptor as defined by <a href="Ejb.html#a3337">See Web Services</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_messagecontext_interface"><a class="anchor" href="#_messagecontext_interface"></a>8.4. MessageContext Interface</h3>
<div class="paragraph">
<p>The <em>MessageContext</em> interface allows the
stateless session bean instance to see the SOAP message for the web
service endpoint, as well as the properties set by the JAX-RPC SOAP
message handlers, if any. The stateless session bean may use the
<em>MessageContext</em> interface to set properties for JAX-RPC message
response handlers.</p>
</div>
<div class="paragraph">
<p>A stateless session bean that implements a
web service endpoint using the JAX-RPC contracts accesses the JAX-RPC
<em>MessageContext</em> interface by means of the
<em>SessionContext.getMessageContext</em> method. The <em>getMessageContext</em>
method returns the <em>javax.xml.rpc.handler.MessageContext</em> interface of a
stateless session bean that implements a JAX-RPC web service endpoint.</p>
</div>
<div class="paragraph">
<p>Only stateless session beans with web service
endpoint interfaces are permitted to use this method.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_responsibilities_of_the_container_provider_3"><a class="anchor" href="#_the_responsibilities_of_the_container_provider_3"></a>8.5. The Responsibilities of the Container Provider</h3>
<div class="paragraph">
<p>This section describes the responsibilities
of the Container Provider to support JAX-RPC web service endpoints.
These requirements are in addition to those specified in the EJB Core
Contracts and Requirements document <a href="Ejb.html#a3339">See EJB</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_generation_of_wsdl"><a class="anchor" href="#_generation_of_wsdl"></a>8.6. Generation of WSDL</h3>
<div class="paragraph">
<p>Reference <a href="Ejb.html#a3337">See Web</a>
describes the generation of a WSDL document for a web service endpoint.
The Java to WSDL mapping must adhere to the requirements of JAX-RPC
specification <a href="Ejb.html#a3332">See Java API for XML-based RPC</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_jax_rpc_message_handlers_for_web_service_endpoints"><a class="anchor" href="#_jax_rpc_message_handlers_for_web_service_endpoints"></a>8.7. JAX-RPC Message Handlers for Web Service Endpoints</h3>
<div class="paragraph">
<p>The container must support the use of JAX-RPC
message handlers for web service endpoints. Container requirements for
support of message handlers are specified in
<a href="Ejb.html#a3337">See Web Services for Java EE</a>.</p>
</div>
<div class="paragraph">
<p>If message handlers are present, they must be
invoked before any business method interceptor methods.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_sessioncontext_interface_restrictions"><a class="anchor" href="#_the_sessioncontext_interface_restrictions"></a>8.8. The SessionContext Interface Restrictions</h3>
<div class="paragraph">
<p>Invoking the <em>getMessageContext</em> method of
the <em>SessionContext interface</em> is disallowed in session bean methods
that were not invoked by the container through the session bean’s web
service endpoint.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a3185"><a class="anchor" href="#a3185"></a>9. Support for Transactions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview_5"><a class="anchor" href="#_overview_5"></a>9.1. Overview</h3>
<div class="paragraph">
<p>This chapter defines requirements for
transaction support of entity beans in addition to the contracts
specified in the EJB Core Contracts and Requirements document
<a href="Ejb.html#a3339">See EJB 3.2 Core Contracts and Requirements.</a> Chapter “Support for Transactions”.</p>
</div>
</div>
<div class="sect2">
<h3 id="_bean_providers_responsibilities"><a class="anchor" href="#_bean_providers_responsibilities"></a>9.2. Bean Provider’s Responsibilities</h3>
<div class="paragraph">
<p>This section defines the responsibilities of
the Bean Provider for transaction demarcation in entity beans. See the
corresponding section in the EJB Core Contracts and Requirements
document [<a href="Ejb.html#a3339">See EJB 3.2 Core Contracts and</a>] for the complete
description of the Bean Provider responsibilities.</p>
</div>
</div>
<div class="sect2">
<h3 id="_bean_managed_versus_container_managed_transaction_demarcation"><a class="anchor" href="#_bean_managed_versus_container_managed_transaction_demarcation"></a>9.3. Bean-Managed Versus Container-Managed Transaction Demarcation</h3>
<div class="paragraph">
<p>An entity bean
must always use container-managed transaction demarcation. An entity
bean must not be designated with bean-managed transaction demarcation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_isolation_levels"><a class="anchor" href="#_isolation_levels"></a>9.4. Isolation Levels</h3>
<div class="paragraph">
<p>The isolation
level describes the degree to which the access to a resource manager by
a transaction is isolated from the access to the resource manager by
other concurrently executing transactions.</p>
</div>
<div class="paragraph">
<p>The following are guidelines for managing
isolation levels in entity beans:</p>
</div>
<div class="paragraph">
<p>The Container Provider should insure that
suitable isolation levels are provided to guarantee data consistency for
entity beans. Typically this means that an equivalent of a repeatable
read or serializable isolation level should be available for
applications that require a high degree of isolation.</p>
</div>
<div class="paragraph">
<p>For entity beans with container-managed
persistence, transaction isolation is managed by the data access classes
that are generated by the Container Provider’s tools. The tools must
ensure that the management of the isolation levels performed by the data
access classes will not result in conflicting isolation level requests
for a resource manager within a transaction.</p>
</div>
</div>
<div class="sect2">
<h3 id="_specification_of_the_transaction_attributes_for_a_beans_methods"><a class="anchor" href="#_specification_of_the_transaction_attributes_for_a_beans_methods"></a>9.5. Specification of the Transaction Attributes for a Bean’s Methods</h3>
<div class="paragraph">
<p>The Bean Provider
of an enterprise bean with container-managed transaction demarcation may
specify the transaction attributes for the enterprise bean’s methods.</p>
</div>
<div class="paragraph">
<p>A transaction attribute is a value associated
with a method of an entity bean’s home or component interface.</p>
</div>
<div class="paragraph">
<p>The transaction attributes are
specified for the methods defined in the bean’s component interface and
all the direct and indirect superinterfaces of the component interface,
excluding the getEJBHome, <em>getEJBLocalHome</em> , getHandle, getPrimaryKey,
and isIdentical methods; for the methods defined in the bean’s home
interface and all the direct and indirect superinterfaces of the home
interface, excluding the getEJBMetaData and getHomeHandle methods
specific to the remote home interface; and for the timeout callback
methods, if any.<a href="#a3394">30</a></p>
</div>
<div class="paragraph">
<p>For entity beans that use container-managed
persistence, only the <em>Required</em> , <em>RequiresNew</em> , or <em>Mandatory</em>
deployment descriptor transaction attribute values should be used for
the methods defined in the bean’s component interface and all the direct
and indirect superinterfaces of the component interface, excluding the
getEJBHome, <em>getEJBLocalHome</em> , getHandle, getPrimaryKey, and
isIdentical methods; and for the methods defined in the bean’s home
interface and all the direct and indirect superinterfaces of the home
interface, excluding the getEJBMetaData and getHomeHandle methods
specific to the remote home interface.</p>
</div>
<div class="paragraph">
<p>The Bean Provider and Application Assembler
must exercise caution when using the <em>RequiresNew</em> transaction
attributes with the navigation of container-managed relationships. If
higher levels of isolation are used, navigating a container-managed
relationship in a new transaction context may result in deadlock.</p>
</div>
<div class="paragraph">
<p>Containers may <em>optionally</em> support the use
of the <em>NotSupported</em> , <em>Supports</em> , and <em>Never</em> transaction attributes
for the methods of entity beans with container-managed persistence.
However, entity beans with container-managed persistence that use these
transaction attributes will not be portable.</p>
</div>
<div class="paragraph">
<p>Containers may optionally support the use of
the <em>NotSupported</em> , <em>Supports</em> , and <em>Never</em> transaction attributes for
the methods of entity beans with container-managed persistence because
the use of these transaction modes may be needed to make use of
container-managed persistence with non-transactional data stores. In
general, however, the Bean Provider and Application Assembler should
avoid use <em>of the NotSupported</em> <em>,</em> <em>Supports</em> , <em>and</em> <em>Never</em>
<em>transaction attribute values for the methods of entity beans with
container-managed persistence because it may lead to inconsistent
results or to the inconsistent and/or to the partial updating of
persistent state and relationships in the event of concurrent use</em> .</p>
</div>
</div>
<div class="sect2">
<h3 id="_container_provider_responsibilities"><a class="anchor" href="#_container_provider_responsibilities"></a>9.6. Container Provider Responsibilities</h3>
<div class="paragraph">
<p>This section defines the responsibilities of
the Container Provider for transaction demarcation in entity beans. See
the EJB Core Contracts and Requirements document
[<a href="Ejb.html#a3339">See EJB 3.2 Core Contracts and</a>] for the complete
description of the Container Provider responsibilities.</p>
</div>
</div>
<div class="sect2">
<h3 id="_container_managed_transaction_demarcation_for_entity_beans"><a class="anchor" href="#_container_managed_transaction_demarcation_for_entity_beans"></a>9.7. Container-Managed Transaction Demarcation for Entity Beans</h3>
<div class="paragraph">
<p>The container is responsible for providing
the transaction demarcation for the entity beans with bean-managed
persistence and container-managed persistence.</p>
</div>
<div class="paragraph">
<p>The container must demarcate transactions as
specified by the transaction attribute values specified in the
deployment descriptor. See subsections of “Container-Managed Transaction
Demarcation for Business Methods” of the EJB Core Contracts and
Requirements document <a href="Ejb.html#a3339">See EJB 3.2 Core</a> for the
available options and detailed description of the responsibilities of
the Container Provider.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a3210"><a class="anchor" href="#a3210"></a>10. Exception Handling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter defines requirements for
exception handling of entity beans and JAX-RPC web service endpoints in
addition to the contracts specified in the EJB Core Contracts and
Requirements document <a href="Ejb.html#a3339">See EJB 3.2 Core</a> Chapter
“Exception Handling”.</p>
</div>
<div class="sect2">
<h3 id="_application_exceptions"><a class="anchor" href="#_application_exceptions"></a>10.1. Application Exceptions</h3>
<div class="paragraph">
<p>The
javax.ejb.CreateException,
javax.ejb.RemoveException,
javax.ejb.FinderException, and subclasses
thereof are application exceptions used to report errors to the client
from the create, remove, and finder methods of the EJBHome and/or
EJBLocalHome interfaces of entity bean components (see Subsections
<a href="Ejb.html#a1524">See Standard Application Exceptions for
Entities</a> and <a href="Ejb.html#a2806">See Standard Application
Exceptions for Entities</a>). See rules for the application exceptions
defined in the corresponding section of the EJB Core Contracts and
Requirements document <a href="Ejb.html#a3339">See EJB 3.2 Core</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_bean_providers_responsibilities_2"><a class="anchor" href="#_bean_providers_responsibilities_2"></a>10.2. Bean Provider’s Responsibilities</h3>
<div class="paragraph">
<p>This section defines the responsibilities of
the Bean Provider for exception handling of entity beans in addition to
the Bean Provider’s responsibilities specified in the corresponding
section in the EJB Core Contracts and Requirements document
[<a href="Ejb.html#a3339">See EJB 3.2 Core Contracts and</a>].</p>
</div>
</div>
<div class="sect2">
<h3 id="_application_exceptions_2"><a class="anchor" href="#_application_exceptions_2"></a>10.3. Application Exceptions</h3>
<div class="paragraph">
<p>The Bean Provider is responsible for using
the standard EJB application exceptions (javax.ejb.CreateException,
javax.ejb.RemoveException, javax.ejb.FinderException, and subclasses
thereof) for entity beans as described in Subsections
<a href="Ejb.html#a1524">See Standard Application Exceptions for
Entities</a> and <a href="Ejb.html#a2806">See Standard Application
Exceptions for Entities</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_system_exceptions"><a class="anchor" href="#_system_exceptions"></a>10.4. <a id="a3221"></a>System Exceptions</h3>
<div class="paragraph">
<p>The Bean Provider should handle various
system-level exceptions and errors that an entity bean instance may
encounter during the execution of a business method (e.g. ejbLoad).</p>
</div>
</div>
<div class="sect2">
<h3 id="_javax_ejb_nosuchentityexception"><a class="anchor" href="#_javax_ejb_nosuchentityexception"></a>10.5. javax.ejb.NoSuchEntityException</h3>
<div class="paragraph">
<p>The
NoSuchEntityException is a subclass of
EJBException. It should be thrown by the entity bean class methods to
indicate that the underlying entity has been removed from the database.</p>
</div>
<div class="paragraph">
<p>A bean-managed
persistence entity bean class typically throws this exception from the
ejbLoad and ejbStore methods, and from the methods that implement the
business methods defined in the component interface.</p>
</div>
</div>
<div class="sect2">
<h3 id="_container_provider_responsibilities_2"><a class="anchor" href="#_container_provider_responsibilities_2"></a>10.6. <a id="a3227"></a>Container Provider Responsibilities</h3>
<div class="paragraph">
<p>This section defines the responsibilities of
the Container Provider for exception handling of entity beans in
addition to the Container Provider’s responsibilities specified in the
corresponding section in the EJB Core Contracts and Requirements
document [<a href="Ejb.html#a3339">See EJB 3.2 Core Contracts and</a>].</p>
</div>
</div>
<div class="sect2">
<h3 id="_exceptions_from_method_invoked_via_entity_beans_client_view"><a class="anchor" href="#_exceptions_from_method_invoked_via_entity_beans_client_view"></a>10.7. <a id="a3229"></a>Exceptions from Method Invoked via Entity Bean’s Client View</h3>
<div class="paragraph">
<p>The following entity bean methods:
ejbCreate&lt;METHOD&gt;, ejbPostCreate&lt;METHOD&gt;, ejbRemove, <em>ejbHome&lt;METHOD&gt;</em> ,
and ejbFind&lt;METHOD&gt; are considered to be business methods in this
context.</p>
</div>
<div class="paragraph">
<p>Rules for exception handling of these methods
are specified in the Table “Handling of Exceptions Thrown by Methods of
Web Service Client View or EJB 2.1 Client View of a Bean with
Container-Managed Transaction Demarcation” of the EJB Core Contracts and
Requirements document [<a href="Ejb.html#a3339">See EJB 3.2 Core</a>].</p>
</div>
</div>
<div class="sect2">
<h3 id="_exceptions_from_other_container_invoked_callbacks"><a class="anchor" href="#_exceptions_from_other_container_invoked_callbacks"></a>10.8. <a id="a3232"></a>Exceptions from Other Container-invoked Callbacks</h3>
<div class="paragraph">
<p>This subsection applies to the ejbActivate,
ejbLoad, ejbPassivate, ejbStore, setEntityContext, and
unsetEntityContext container-invoked callbacks methods of the EntityBean
interface.</p>
</div>
<div class="paragraph">
<p>The container must handle all exceptions or
errors from these methods as follows:</p>
</div>
<div class="paragraph">
<p>Log the exception or error to bring the
problem to the attention of the System Administrator.</p>
</div>
<div class="paragraph">
<p>If the instance is in a transaction, mark the
transaction for rollback.</p>
</div>
<div class="paragraph">
<p>Discard the instance (i.e., the container
must not invoke any business methods or container callbacks on the
instance).</p>
</div>
<div class="paragraph">
<p>If the exception or error happened during the
processing of a client invoked method, throw the
<em>javax.ejb.EJBException<a href="#a3395">31</a></em> . If the EJB 2.1 client
view or web service client view is used, throw the
java.rmi.RemoteException to the client if the client is a remote client
or throw the <em>javax.ejb.EJBException</em> to the client if the client is a
local client. If the instance executed in the client’s transaction, the
container should throw the
<em>javax.ejb.EJBTransactionRolledbackException<a href="#a3396">32</a></em> .
If the EJB 2.1 client view or web service client view is used, the
container should throw the
javax.transaction.TransactionRolledbackException to a remote client or
the <em>javax.ejb.TransactionRolledbackLocalException</em> to a local client,
because it provides more information to the client. (The client knows
that it is fruitless to continue the transaction.)</p>
</div>
</div>
<div class="sect2">
<h3 id="_javax_ejb_nosuchentityexception_2"><a class="anchor" href="#_javax_ejb_nosuchentityexception_2"></a>10.9. javax.ejb.NoSuchEntityException</h3>
<div class="paragraph">
<p>The
NoSuchEntityException is a subclass of
EJBException. If it is thrown by a method of an entity bean class, the
container must handle the exception using the rules in Sections
<a href="Ejb.html#a3229">See Exceptions from Method Invoked via
Entity Bean’s Client View</a> and <a href="Ejb.html#a3232">See
Exceptions from Other Container-invoked Callbacks</a>.</p>
</div>
<div class="paragraph">
<p>To give the client a better indication of the
cause of the error, the container should throw the
java.rmi.NoSuchObjectException (which is a subclass of
java.rmi.RemoteException) to a remote client, or the
<em>javax.ejb.NoSuchObjectLocalException</em> to a local client.</p>
</div>
</div>
<div class="sect2">
<h3 id="_non_existing_entity_object"><a class="anchor" href="#_non_existing_entity_object"></a>10.10. Non-existing Entity Object</h3>
<div class="paragraph">
<p>If a client makes a call to an entity object
that has been removed, the container should throw the
<em>javax.ejb.NoSuchEJBException<a href="#a3397">33</a></em> . If the EJB 2.1
client view is used, the container should throw the
java.rmi.NoSuchObjectException (which is a
subclass of java.rmi.RemoteException) to a remote client, or the
<em>javax.ejb.NoSuchObjectLocalException</em> to a local client.</p>
</div>
</div>
<div class="sect2">
<h3 id="_support_for_deprecated_use_of_java_rmi_remoteexception"><a class="anchor" href="#_support_for_deprecated_use_of_java_rmi_remoteexception"></a>10.11. Support for Deprecated Use of java.rmi.RemoteException</h3>
<div class="paragraph">
<p>The EJB 1.0
specification allowed the business methods, ejbCreate, ejbPostCreate,
ejbFind&lt;METHOD&gt;, ejbRemove, and the container-invoked callbacks (i.e.,
the methods defined in the EntityBean interface) implemented in the
enterprise bean class to use the java.rmi.RemoteException to report
non-application exceptions to the container.</p>
</div>
<div class="paragraph">
<p>See the corresponding section in the EJB Core
Contracts and Requirements document [<a href="Ejb.html#a3339">See EJB</a>] for the rules on support of the
deprecated use of java.rmi.RemoteException.</p>
</div>
</div>
<div class="sect2">
<h3 id="_clients_view_of_exceptions"><a class="anchor" href="#_clients_view_of_exceptions"></a>10.12. Client’s View of Exceptions</h3>
<div class="paragraph">
<p>The JAX-RPC web service endpoint interface is
Java RMI interface, and therefore the <em>throws</em> clauses of all its
methods (including those inherited from superinterfaces) include the
mandatory java.rmi.RemoteException.The
<em>throws</em> clauses may include an arbitrary number of application
exceptions.</p>
</div>
<div class="paragraph">
<p>See the corresponding section in the EJB Core
Contracts and Requirements document [<a href="Ejb.html#a3339">See EJB</a>] for the client’s view of
exceptions received from from enterprise beans and web service
endpoints.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a3253"><a class="anchor" href="#a3253"></a>11. Support for Distributed Interoperability</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The JAX-RPC specification
<a href="Ejb.html#a3332">See Java API for XML-based RPC (JAX-RPC)</a> describes requirements for
interoperability with other JAX-RPC implementations and XML based RPC
products.</p>
</div>
<div class="paragraph">
<p>This chapter defines requirements for
interoperability of entity beans in addition to the contracts specified
in the EJB Core Contracts and Requirements document
<a href="Ejb.html#a3339">See EJB 3.2 Core Contracts and Requirements.</a> Chapter “Support for Distributed
Interoperability”.</p>
</div>
<div class="sect2">
<h3 id="_mapping_objects_returned_by_entity_bean_finder_methods_to_idl"><a class="anchor" href="#_mapping_objects_returned_by_entity_bean_finder_methods_to_idl"></a>11.1. Mapping Objects Returned by Entity Bean Finder Methods to IDL</h3>
<div class="paragraph">
<p>The <em>Enumeration</em>
or <em>Collection</em> objects returned by entity bean finder methods are value
types that are mapped to IDL abstract value types or abstract interfaces
using the rules in the Java Language to IDL Mapping.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a3258"><a class="anchor" href="#a3258"></a>12. Timer Service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter defines limitations of the EJB
container-managed timer service when used with EJB 2.1 entity beans.</p>
</div>
<div class="sect2">
<h3 id="_bean_providers_view_of_the_timer_service"><a class="anchor" href="#_bean_providers_view_of_the_timer_service"></a>12.1. Bean Provider’s View of the Timer Service</h3>
<div class="paragraph">
<p>Timers can be created for EJB 2.1 entity
beans. A timer that is created for the EJB 2.1 entity bean is associated
with the entity bean’s identity.</p>
</div>
<div class="paragraph">
<p>Use of the EJB Timer Service is not supported
for an EJB 1.1 entity bean with container-managed persistence.</p>
</div>
</div>
<div class="sect2">
<h3 id="_calendar_based_time_expressions"><a class="anchor" href="#_calendar_based_time_expressions"></a>12.2. Calendar-Based Time Expressions</h3>
<div class="paragraph">
<p>Calendar based timers are not supported for
entity beans.</p>
</div>
</div>
<div class="sect2">
<h3 id="_non_persistent_timers"><a class="anchor" href="#_non_persistent_timers"></a>12.3. Non-persistent Timers</h3>
<div class="paragraph">
<p>Non-persistent timers are not supported for
entity beans.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_timerservice_interface"><a class="anchor" href="#_the_timerservice_interface"></a>12.4. The TimerService Interface</h3>
<div class="paragraph">
<p>For an EJB 2.1 entity bean, the result of
<em>getTimers</em> is a collection of those timers that are associated with the
bean’s identity.</p>
</div>
</div>
<div class="sect2">
<h3 id="_timer_expiration_and_timeout_callback_method"><a class="anchor" href="#_timer_expiration_and_timeout_callback_method"></a>12.5. Timer Expiration and Timeout Callback Method</h3>
<div class="paragraph">
<p>If a timer for an EJB 2.1 entity bean
expires, and the bean has been passivated, the container must call the
<em>ejbActivate</em> and <em>ejbLoad</em> methods on the entity bean class before
calling the timeout callback method, as described in Sections
<a href="Ejb.html#a1279">See Container’s View</a> and
<a href="Ejb.html#a2553">See Container’s View</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_entity_bean_removal"><a class="anchor" href="#_entity_bean_removal"></a>12.6. Entity Bean Removal</h3>
<div class="paragraph">
<p>If an entity bean is removed, the container
must remove the timers for that bean.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a3273"><a class="anchor" href="#a3273"></a>13. Deployment Descriptor</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter defines the EJB deployment
descriptor elements and the Bean Provider and the Application Assembler
responsibilities corresponding to entity beans. The rules defined in
this chapter are in addition to the rules defined in the Chapter 14 of
the EJB Core Contracts and Requirements document
<a href="Ejb.html#a3339">See EJB 3.2 Core Contracts and Requirements.</a>.</p>
</div>
<div class="paragraph">
<p>See EJB Core Contracts and Requirements
document <a href="Ejb.html#a3339">See EJB 3.2 Core Contracts and</a> for the complete XML
Schema for the EJB 3.2 deployment descriptor.</p>
</div>
<div class="sect2">
<h3 id="_bean_providers_responsibilities_3"><a class="anchor" href="#_bean_providers_responsibilities_3"></a>13.1. Bean Provider’s Responsibilities</h3>
<div class="paragraph">
<p>The Bean Provider is responsible for
providing the following structural information for each entity bean in
the deployment descriptor.</p>
</div>
<div class="literalblock">
<div class="content">
<pre> _Re-entrancy indication_
. The Bean Provider must specify whether an
entity bean is re-entrant.</pre>
</div>
</div>
<div class="paragraph">
<p>Entity bean’s persistence management.
If the enterprise bean is an entity bean,
the Bean Provider must use the persistence-type element to declare
whether persistence management is performed by the enterprise bean or by
the container.</p>
</div>
<div class="paragraph">
<p>Entity bean’s primary key class.
If the enterprise bean is an entity bean,
the Bean Provider specifies the fully-qualified name of the entity
bean’s primary key class in the prim-key-class element. The Bean
Provider must specify the primary key class for an entity with
bean-managed persistence.</p>
</div>
<div class="paragraph">
<p>Entity bean’s abstract schema name. If the
enterprise bean is an entity bean with container-managed persistence and
<em>cmp-version</em> <em>2.x</em> , the Bean Provider must specify the
abstract schema name of the entity bean
using the abstract-schema-name element.</p>
</div>
<div class="paragraph">
<p>Container-managed fields.
If the enterprise bean is an entity bean
with container-managed persistence, the Bean Provider must specify the
container-managed fields using the cmp-field elements.</p>
</div>
<div class="paragraph">
<p>Container-managed relationships. If the
enterprise bean is an entity bean with container-managed persistence and
<em>cmp-version</em> <em>2.x</em> , the Bean Provider must specify the
container-managed relationships of the
entity bean using the relationships element.</p>
</div>
<div class="paragraph">
<p>Finder and select queries. If the enterprise
bean is an entity bean with container-managed persistence and
<em>cmp-version</em> <em>2.x</em> , the Bean Provider must use the <em>query</em>
 element to specify any EJB QL finder or
select query for the entity bean other than a query for the
<em>findByPrimaryKey</em> method.</p>
</div>
<div class="paragraph">
<p>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_application_assemblers_responsibility"><a class="anchor" href="#_application_assemblers_responsibility"></a>13.2. Application Assembler’s Responsibility</h3>
<div class="paragraph">
<p>The Application Assembler may modify the
following information that was specified by the Bean Provider:</p>
</div>
<div class="literalblock">
<div class="content">
<pre> _Relationship names for EJB 2.x entity
beans._ If multiple ejb-jar files use the same names for relationships
and are merged into a single ejb-jar file, it is the responsibility of
the Application Assembler to modify the relationship names defined in
the _ejb-relation-name_ elements.</pre>
</div>
</div>
<div class="paragraph">
<p>In general, the Application Assembler should
never modify any of the following.</p>
</div>
<div class="paragraph">
<p>Enterprise bean’s abstract schema name. The
Application Assembler should not change the enterprise bean’s name
defined in the abstract-schema-name element since EJB QL queries may
depend on the content of this element.</p>
</div>
<div class="paragraph">
<p>Relationship role source element. The
Application Assembler should not change the value of an ejb-name element
in the <em>relationship-role-source</em>  element.</p>
</div>
<div class="paragraph">
<p>If any of these elements must be modified by
the Application Assembler in order to resolve name clashes during the
merging of ejb-jar files, the Application Assembler must also modify all
ejb-ql query strings that depend on the value of the modified
element(s).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_packaging_restrictions"><a class="anchor" href="#_packaging_restrictions"></a>14. Packaging Restrictions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_restrictions_2"><a class="anchor" href="#_restrictions_2"></a>14.1. Restrictions</h3>
<div class="paragraph">
<p>Entity Beans are not supported within .war
files. These component types must only be packaged in a stand-alone
ejb-jar file or an ejb-jar file packaged within an .ear file.</p>
</div>
<div class="paragraph">
<p>JAX-RPC based web service endpoints are not
supported within <em>.war</em> files. These endpoints must be only be packaged
in a stand-alone ejb-jar file or an ejb-jar file packaged within an .ear
file.</p>
</div>
<div class="paragraph">
<p>Entity Beans and JAX-RPC based web service
endpoints are not supported with the EJB 3.2 Lite API (see EJB Core
Contracts and Requirements document <a href="Ejb.html#a3339">See EJB</a>, Subsection “EJB 3.2 Lite”).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_related_documents"><a class="anchor" href="#_related_documents"></a>15. Related Documents</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Enterprise JavaBeans™, version 3.2. (this
specification) <em><a href="http://jcp.org/en/jsr/detail?id=3" class="bare">http://jcp.org/en/jsr/detail?id=3</a></em> 45</p>
</div>
<div class="paragraph">
<p><a id="a3323"></a>Enterprise JavaBeans™,
version 3.1. (EJB 3.1). <em><a href="http://jcp.org/en/jsr/detail?id=318" class="bare">http://jcp.org/en/jsr/detail?id=318</a></em> .</p>
</div>
<div class="paragraph">
<p>Enterprise JavaBeans™,
version 2. (EJB 2.1).
<a href="http://www.oracle.com/technetwork/java/javaee/ejb/index.html" class="bare">http://www.oracle.com/technetwork/java/javaee/ejb/index.html</a>.</p>
</div>
<div class="paragraph">
<p><a id="a3325"></a>Java™ Persistence API,
version 2.1. <em><a href="http://jcp.org/en/jsr/detail?id=338" class="bare">http://jcp.org/en/jsr/detail?id=338</a></em> .</p>
</div>
<div class="paragraph">
<p>Java™ Naming and Directory
Interface 1.2 Specification (JNDI).
<a href="http://docs.oracle.com/javase/7/docs/technotes/guides/jndi/index.html" class="bare">http://docs.oracle.com/javase/7/docs/technotes/guides/jndi/index.html</a>.</p>
</div>
<div class="paragraph">
<p><a id="a3327"></a>Java Remote Method
Invocation (RMI).
<a href="http://docs.oracle.com/javase/7/docs/technotes/guides/rmi/" class="bare">http://docs.oracle.com/javase/7/docs/technotes/guides/rmi/</a>.</p>
</div>
<div class="paragraph">
<p>IDL To Java™ Language
Mapping Specification. <a href="http://www.omg.org/cgi-bin/doc?ptc/2000-01-08" class="bare">http://www.omg.org/cgi-bin/doc?ptc/2000-01-08</a>.</p>
</div>
<div class="paragraph">
<p>Java™ Platform, Enterprise
Edition Specification Version 7 (Java EE).
<em><a href="http://jcp.org/en/jsr/detail?id=342" class="bare">http://jcp.org/en/jsr/detail?id=342</a></em> .</p>
</div>
<div class="paragraph">
<p>Java 2 Enterprise Edition
Connector Architecture, v1.7. <em><a href="http://jcp.org/en/jsr/detail?id=322" class="bare">http://jcp.org/en/jsr/detail?id=322</a></em> .</p>
</div>
<div class="paragraph">
<p><a id="a3331"></a>Database Language SQL.
ANSI X3.135-1992 or ISO/IEC 9075:1992.</p>
</div>
<div class="paragraph">
<p><a id="a3332"></a>Java API for XML-based RPC
(JAX-RPC) 2.0. <em><a href="http://jcp.org/en/jsr/detail?id=101" class="bare">http://jcp.org/en/jsr/detail?id=101</a>.</em></p>
</div>
<div class="paragraph">
<p>Web Services Description
Language (WSDL) 1.1. <em><a href="http://www.w3.org/TR/wsdl" class="bare">http://www.w3.org/TR/wsdl</a>.</em></p>
</div>
<div class="paragraph">
<p><a id="a3334"></a>The Java Virtual Machine
Specification.</p>
</div>
<div class="paragraph">
<p><a id="a3335"></a>JDBC™ 4.1 API (JDBC
specification). <a href="http://jcp.org/en/jsr/detail?id=221" class="bare">http://jcp.org/en/jsr/detail?id=221</a>.</p>
</div>
<div class="paragraph">
<p>Web Services Metadata for
the Java Platform, version 2.1. <em><a href="http://jcp.org/en/jsr/detail?id=181" class="bare">http://jcp.org/en/jsr/detail?id=181</a>.</em></p>
</div>
<div class="paragraph">
<p><a id="a3337"></a>Web Services for Java EE,
version 1.3. <em><a href="http://jcp.org/en/jsr/detail?id=109" class="bare">http://jcp.org/en/jsr/detail?id=109</a>.</em></p>
</div>
<div class="paragraph">
<p><a id="a3338"></a>W3C: SOAP 1.2.
<a href="http://www.w3.org/TR/SOAP/" class="bare">http://www.w3.org/TR/SOAP/</a>.</p>
</div>
<div class="paragraph">
<p><a id="a3339"></a>EJB 3.2 Core Contracts and
Requirements. <em><a href="http://jcp.org/en/jsr/detail?id=345" class="bare">http://jcp.org/en/jsr/detail?id=345</a></em></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_revision_history"><a class="anchor" href="#_revision_history"></a>16. Revision History</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This appendix lists the significant changes
that have been made to this document during the development of this
Specification.</p>
</div>
<div class="sect2">
<h3 id="_early_draft"><a class="anchor" href="#_early_draft"></a>16.1. Early Draft</h3>
<div class="paragraph">
<p>Created document from the EJB 3.2 Draft.</p>
</div>
</div>
<div class="sect2">
<h3 id="_early_draft_2"><a class="anchor" href="#_early_draft_2"></a>16.2. Early Draft 2</h3>
<div class="paragraph">
<p>Updated the expert group list.</p>
</div>
</div>
<div class="sect2">
<h3 id="_public_draft"><a class="anchor" href="#_public_draft"></a>16.3. Public Draft</h3>
<div class="paragraph">
<p>Removed Interceptors specification from the
list of the EJB 3.2 set of documents</p>
</div>
<div class="paragraph">
<p>Minor editorial changes</p>
</div>
<div class="paragraph">
<p>Updated related documents to their latest
versions where applicable</p>
</div>
<div class="paragraph">
<p>Replaced section number with the section
title when referencing EJB Core Contracts and Requirements document.</p>
</div>
<div class="paragraph">
<p>Removed text from
<a href="Ejb.html#a3185">See Support for Transactions</a> that is
exactly the same as in the EJB Core Contracts and Requirements document.
Added references to the corresponding sections with the complete rules.</p>
</div>
<div class="paragraph">
<p>Removed text from
<a href="Ejb.html#a3210">See Exception Handling</a> that is exactly the
same as in the EJB Core Contracts and Requirements document. Added
references to the corresponding sections with the complete rules.</p>
</div>
<div class="paragraph">
<p>Removed most of the text from
<a href="Ejb.html#a3253">See Support for Distributed
Interoperability</a> as it was an unnecessary duplication of the
corresponding chapter in the EJB Core Contracts and Requirements
document. Left only section “Mapping Objects Returned by Entity Bean
Finder Methods to IDL”</p>
</div>
<div class="paragraph">
<p>Removed chapters “Enterprise Bean
Environment” and “Security Management” as it was an unnecessary
duplication of the corresponding chapters in the EJB Core Contracts and
Requirements document.</p>
</div>
</div>
<div class="sect2">
<h3 id="_proposed_final_draft"><a class="anchor" href="#_proposed_final_draft"></a>16.4. Proposed Final Draft</h3>
<div class="paragraph">
<p>Minor editorial changes</p>
</div>
<div class="paragraph">
<p>Updated to the final versions of the related
documents</p>
</div>
<div class="paragraph">
<p>Changed the rule for optional feature support
for CMP/BMP beans and EJBQL to be that if any of the features is
supported, all these features must be supported</p>
</div>
</div>
<div class="sect2">
<h3 id="_final_release_candidate"><a class="anchor" href="#_final_release_candidate"></a>16.5. Final Release Candidate</h3>
<div class="paragraph">
<p>Editorial changes</p>
</div>
<div class="paragraph">
<p>Rearranged sections in the
<a href="Ejb.html#a3139">See Support for JAX-RPC Web Service
Endpoints</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_final_release"><a class="anchor" href="#_final_release"></a>16.6. Final Release</h3>
<div class="paragraph">
<p>Minor editorial changes</p>
</div>
<hr>
<div class="paragraph">
<p>[.footnoteNumber]# 1.# <a id="a3365"></a>More literally,
references are passed by value in the JVM: an argument variable of
primitive type holds a value of that primitive type; an argument
variable of a reference type hold a reference to the object. See
<a href="Ejb.html#a3334">See The Java Virtual Machine
Specification.</a>.</p>
</div>
<div class="paragraph">
<p>[.footnoteNumber]# 2.# <a id="a3366"></a>The <em>findByPrimaryKey</em>
method is mandatory for the remote home interface of all entity beans.</p>
</div>
<div class="paragraph">
<p>[.footnoteNumber]# 3.# <a id="a3367"></a>The <em>findByPrimaryKey</em>
method is mandatory for the local home interface of all Entity Beans.</p>
</div>
<div class="paragraph">
<p>[.footnoteNumber]# 4.# <a id="a3368"></a>At this point it must
appear to the application that the entity has been removed from the
persistent store. If the container employs an optimistic caching
strategy and defers the removal of the entity from the database (e.g.,
to the end of transaction), this must be invisible to the application.</p>
</div>
<div class="paragraph">
<p>[.footnoteNumber]# 5.# <a id="a3369"></a>The relation names and
the relationship role names are not used in the code provided by the
Bean Provider.</p>
</div>
<div class="paragraph">
<p>[.footnoteNumber]# 6.# <a id="a3370"></a>An entity bean has no
<em>ejbCreate</em> <em>&lt;METHOD&gt;</em> and <em>ejbPostCreate</em> <em>&lt;METHOD&gt;</em> methods if it does
not define any create methods in its home interface. Such an entity bean
does not allow its clients to create new EJB objects. The entity bean
restricts the clients to accessing entities that were created through
direct database inserts.</p>
</div>
<div class="paragraph">
<p>[.footnoteNumber]# 7.# <a id="a3371"></a>The above requirement
is to allow the creation of an entity bean with bean-managed persistence
by subclassing an entity bean with container-managed persistence.</p>
</div>
<div class="paragraph">
<p>[.footnoteNumber]# 8.# <a id="a3372"></a>Containers using
optimistic caching strategies, for example, may rollback the transaction
at a later point.</p>
</div>
<div class="paragraph">
<p>[.footnoteNumber]# 9.# <a id="a3373"></a>The ability to refresh
the state of a read-only bean and the intervals at which such refresh
occurs are vendor-specific.</p>
</div>
<div class="paragraph">
<p>[.footnoteNumber]# 10.# <a id="a3374"></a>For example, an
implementation might choose to ignore such updates or to disallow them.</p>
</div>
<div class="paragraph">
<p>[.footnoteNumber]# 11.# <a id="a3375"></a>The
<em>findByPrimaryKey</em> method is mandatory for all entity beans.</p>
</div>
<div class="paragraph">
<p>[.footnoteNumber]# 12.# <a id="a3376"></a>It is consistent with
this specification to provide options for this refresh to be deferred or
avoided in the case of read-only beans.</p>
</div>
<div class="paragraph">
<p>[.footnoteNumber]# 13.# <a id="a3377"></a>If the entity bean
class does implement the component interface, care must be taken to
avoid passing of this as a method argument or result. This potential
error can be avoided by choosing not to implement the component
interface in the entity bean class.</p>
</div>
<div class="paragraph">
<p>[.footnoteNumber]# 14.# <a id="a3378"></a>Not currently used in
EJB QL; reserved for future use.</p>
</div>
<div class="paragraph">
<p>[.footnoteNumber]# 15.# <a id="a3379"></a>Use of ejb-names in
EJB QL is reserved for future use.</p>
</div>
<div class="paragraph">
<p>[.footnoteNumber]# 16.# <a id="a3380"></a>Refer to
<a href="Ejb.html#a3331">See Database Language SQL. ANSI X3.135-1992
or ISO/IEC 9075:1992.</a> for a more precise characterization of these
rules.</p>
</div>
<div class="paragraph">
<p>[.footnoteNumber]# 17.# <a id="a3381"></a>The use of the
reserved word OF is optional in this expression.</p>
</div>
<div class="paragraph">
<p>[.footnoteNumber]# 18.# <a id="a3382"></a>These functions are a
subset of the functions defined for JDBC 2.0 and later drivers, as
described in Appendix D of the JDBC specification
<a href="Ejb.html#a3335">See JDBC™ 4.1 API (JDBC specification).</a>.</p>
</div>
<div class="paragraph">
<p>[.footnoteNumber]# 19.# <a id="a3383"></a>Containers and
databases may not support the use of the optional, third argument of the
LOCATE function. Portable applications should therefore avoid use of
this argument.</p>
</div>
<div class="paragraph">
<p>[.footnoteNumber]# 20.# <a id="a3384"></a>It is legal to
specify DISTINCT with MAX or MIN, but it does not affect the result.</p>
</div>
<div class="paragraph">
<p>[.footnoteNumber]# 21.# <a id="a3385"></a>An entity Bean has no
<em>ejbCreate&lt;METHOD&gt;</em> and <em>ejbPostCreate&lt;METHOD&gt;</em> methods if it does not
define any create methods in its home interface. Such an entity bean
does not allow the clients to create new entity objects. The entity bean
restricts the clients to accessing entities that were created through
direct database inserts.</p>
</div>
<div class="paragraph">
<p>[.footnoteNumber]# 22.# <a id="a3386"></a>The EJB specification
does not require the distributed flushing of state. The container in
which the <em>ejbFind&lt;METHOD&gt;</em> method executes is not required to propagate
the flush to a different container.</p>
</div>
<div class="paragraph">
<p>[.footnoteNumber]# 23.# <a id="a3387"></a>The ability to
refresh the state of a read-only bean and the intervals at which such
refresh occurs are vendor-specific.]</p>
</div>
<div class="paragraph">
<p>[.footnoteNumber]# 24.# <a id="a3388"></a>For example, an
implementation might choose to ignore such updates or to disallow them.</p>
</div>
<div class="paragraph">
<p>[.footnoteNumber]# 25.# <a id="a3389"></a>This call may be
omitted if the bean has been specified as read-only.</p>
</div>
<div class="paragraph">
<p>[.footnoteNumber]# 26.# <a id="a3390"></a>This applies also to
the Never and Supports attribute.</p>
</div>
<div class="paragraph">
<p>[.footnoteNumber]# 27.# <a id="a3391"></a>This ejbStore call
may be omitted if the bean has been specified as read-only.</p>
</div>
<div class="paragraph">
<p>[.footnoteNumber]# 28.# <a id="a3392"></a>The finder will be
also compatible with Java 2-based containers and clients.</p>
</div>
<div class="paragraph">
<p>[.footnoteNumber]# 29.# <a id="a3393"></a>If the entity bean
class does implement the component interface, care must be taken to
avoid passing of this as a method argument or result. This potential
error can be avoided by choosing not to implement the component
interface in the entity bean class.</p>
</div>
<div class="paragraph">
<p>[.footnoteNumber]# 30.# <a id="a3394"></a>Note that the
deployment descriptor must be used to specify transaction attributes for
entity bean methods if the transaction attribute is not <em>Required</em> (the
default value)</p>
</div>
<div class="paragraph">
<p>[.footnoteNumber]# 31.# <a id="a3395"></a>If the business
interface is a remote business interface that extends <em>java.rmi.Remote</em>
, the <em>java.rmi.RemoteException</em> is thrown to the client instead.</p>
</div>
<div class="paragraph">
<p>[.footnoteNumber]# 32.# <a id="a3396"></a>If the business
interface is a remote business interface that extends <em>java.rmi.Remote</em>
, the <em>javax.transaction.TransactionRolledbackException</em> is thrown to
the client instead.</p>
</div>
<div class="paragraph">
<p>[.footnoteNumber]# 33.# <a id="a3397"></a>If the business
interface is a remote business interface that extends <em>java.rmi.Remote</em>
, the <em>java.rmi.NoSuchObjectException</em> is thrown to the client instead.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-03-02 11:35:43 +0530
</div>
</div>
</body>
</html>